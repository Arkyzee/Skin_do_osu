(self.webpackChunk=self.webpackChunk||[]).push([[143],{9524:()=>{window.Timeout=function(){function t(){}return t.clear=function(t){return clearTimeout(t)},t.set=function(t,e){return setTimeout(e,t)},t}()},6218:(t,e,r)=>{var i,n=r(9755);i=document.getElementsByClassName("js-fixed-element"),n(document).on("shown.bs.modal",".modal",(function(t){return n(t.target).find(".modal-af").focus()})),n(document).on("hidden.bs.modal",".modal",(function(){return n(".modal-backdrop").remove(),n("body, .js-fixed-element").css({paddingRight:""})})),n(document).on("show.bs.modal",".modal",(function(){var t,e,r,s,o,a,u,l;for(Timeout.set(10,(function(){return n(".modal-backdrop").trigger("bsTransitionEnd")})),t=[],r=s=0,a=i.length;s<a;r=++s)e=i[r],t[r]=e.getBoundingClientRect(),t[r].skip="fixed"!==getComputedStyle(e).position;for(l=[],r=o=0,u=i.length;o<u;r=++o)e=i[r],t[r].skip||(e.style.left=t[r].left+"px",l.push(e.style.width=t[r].width+"px"));return l})),n(document).on("shown.bs.modal",".modal",(function(){var t,e,r,s,o,a,u,l,c;for(u=n("body").css("padding-right"),c=[],e=r=0,o=i.length;r<o;e=++r)t=i[e],c[e]="fixed"!==getComputedStyle(t).position;for(l=[],e=s=0,a=i.length;s<a;e=++s)t=i[e],c[e]||(t.style.paddingRight=u,t.style.left="",l.push(t.style.width=""));return l}))},4725:(t,e,r)=>{var i,n=r(9755);i=function(t,e,r){var i,s,o,a,u,l;return null==r&&(r=""),o=(i=n(t.target).parents("form").find("[name=body], .js-bbcode-body")).val(),u=(s=i[0]).selectionStart,a=s.selectionEnd,(l=[o.substring(0,u),o.substring(u,a),o.substring(a)])[0]=l[0]+e,l[2]=r+l[2],u===a?(i.val(l[0]+l[2]),s.selectionStart=l[0].length,s.selectionEnd=s.selectionStart):(i.val(l[0]+l[1]+l[2]),s.selectionStart=u,s.selectionEnd=l[0].length+l[1].length+r.length),i.trigger("bbcode:inserted").trigger("input").focus()},[["bold","[b]","[/b]"],["heading","[heading]","[/heading]"],["image","[img]","[/img]"],["imagemap","[imagemap]\nhttps://example.com/image.jpg\n0 10 10 50 https://example.com example\n","[/imagemap]"],["italic","[i]","[/i]"],["link","[url]","[/url]"],["list","[list]\n[*]","[/list]"],["list-numbered","[list=1]\n[*]","[/list]"],["strikethrough","[s]","[/s]"],["underline","[u]","[/u]"],["spoilerbox","[box=]","[/box]"]].forEach((function(t){var e,r,s;return e=t[0],s=t[1],r=t[2],n(document).on("click",".js-bbcode-btn--"+e,(function(t){return i(t,s,r)}))})),n(document).on("turbolinks:load",(function(){return n(".js-bbcode-btn--size").val("")})),n(document).on("change",".js-bbcode-btn--size",(function(t){var e,r;return e=n(t.target),r=parseInt(e.val(),10),e.val(""),i(t,"[size="+r+"]","[/size]")}))},2712:(t,e,r)=>{var i,n=r(9755);i=n({}),n.subscribe=i.on.bind(i),n.unsubscribe=i.off.bind(i),n.publish=i.trigger.bind(i)},4910:(t,e,r)=>{var i=r(9755);i(document).on("click",".js-spoilerbox__link",(function(t){return t.preventDefault(),i(t.target).closest(".js-spoilerbox").toggleClass("js-spoilerbox--open"),i.publish("sync-height:force")}))},8537:(t,e,r)=>{var i,n=r(9755);n(document).on("click","#new-address-switch a",(function(t){var e,r;return t.preventDefault(),r=n(t.target),e=n("#new-address-form"),r.is(":visible")?(r.siblings("button").show(),r.hide(),e.find("input").first().focus()):(r.siblings("button").hide(),r.show()),e.slideToggle()})),i=function(){return n(".js-checkout-confirmation-step").filter(":checked")},n(document).on("turbolinks:load",i),n(document).on("change",".js-checkout-confirmation-step",i),n(document).on("turbolinks:load",(function(){if(!(parseInt(n(".js-store-item-quantity").val(),10)>0))return n(".js-store-add-to-cart").hide()})),n(document).on("turbolinks:load",(function(){return n("#product-form").submit((function(t){return!n(t.target).data("disabled")}))}))},2353:()=>{},5737:(t,e,r)=>{"use strict";var i=r(9755);r(1545),r(7915),r(3795),r(9186),r(7440),r(6400),r(6227),r(2526),r(1355);function n(t,e){return"pt-br"===e&&(e="pt"),this._origGetPluralForm(t,e)}var s,o=r(9705),a=r.n(o),u=r(8949),l=r(381),c=r(2918),h=r.n(c),d=r(3599),p=r(9014);window.$=i,window.jQuery=i,null!==(s=window.LangMessages)&&void 0!==s||(window.LangMessages={}),window.Lang=function(t){return t._origGetPluralForm=t._getPluralForm,t._getPluralForm=n,t}(new(a())({fallback:window.fallbackLocale,locale:window.currentLocale,messages:window.LangMessages})),window.moment=l,window.popup=d.g,window.reloadPage=p.sl,window.Turbolinks=h(),window._styles={header:{height:90,heightMobile:50,heightSticky:50}},(0,u.jQ)({computedRequiresReaction:!0});r(2712);var m=r(1270);window.StoreSupporterTagPrice=function(){function t(t){this._price=t}return t.durationToPrice=function(t){switch(t=+t,!1){case!(t>=12):return Math.ceil(t/12*26);case 10!==t:return 24;case 9!==t:return 22;case 8!==t:return 20;case 6!==t:return 16;case 4!==t:return 12;case 2!==t:return 8;case 1!==t:return 4}},t.prototype.price=function(){return this._price},t.prototype.duration=function(){return null!=this._duration?this._duration:this._duration=function(){switch(!1){case!(this._price>=26):return Math.floor(this._price/26*12);case!(this._price>=24):return 10;case!(this._price>=22):return 9;case!(this._price>=20):return 8;case!(this._price>=16):return 6;case!(this._price>=12):return 4;case!(this._price>=8):return 2;case!(this._price>=4):return 1;default:return 0}}.call(this)},t.prototype.discount=function(){var t;return this.duration()>=12?46:(t=100*(1-this._price/this.duration()/4),Math.max(0,Math.round(t,0)))},t.prototype.discountText=function(){return(0,m.dW)("store.discount",{percent:this.discount()})},t.prototype.durationInYears=function(){return{years:Math.floor(this.duration()/12),months:Math.floor(this.duration()%12)}},t.prototype.durationText=function(){var t,e;return e=[],(t=this.durationInYears()).years>0&&e.push((0,m.jn)("common.count.years",t.years)),t.months>0&&e.push((0,m.jn)("common.count.months",t.months)),e.join(", ")},t}();r(9524),r(4910),r(8537);var f=r(3664),g=r(9755);function v(t){g(".js-store-add-to-cart").prop("disabled",!t),g("#product-form").data("disabled",!t)}var b,y,w,k=r(9755),j=r(6486);w=function(){return v(!1),k("#username-check-price").text("")},b=function(){var t,e;return t=k("#username-check-status"),e=k(".js-username-change-input").val(),k.post((0,f.B)("users.check-username-availability"),{username:e}).done((function(e){if(e.username===k(".js-username-change-input").val())return e.available?(v(!0),k("#username-check-price").text(e.costString),k("#username-form-price").val(e.cost)):w(),t.html(e.message),t.toggleClass("green-dark",e.available),t.toggleClass("pink-dark",!e.available)})).fail((function(t,e){return k(".js-username-change-input").trigger("ajax:error",[t,e]).one("click",b)}))},y=j.debounce(b,300),k(document).on("input",".js-username-change-input",(function(t){var e,r,i;return r=t.currentTarget,e=k("#username-check-status"),i=r.value,e.removeClass("green-dark"),e.removeClass("pink-dark"),w(),0===i.length?e.text((0,m.dW)("store.username_change.check")):(e.text((0,m.dW)("store.username_change.checking",{username:i})),y())})),k(document).on("turbolinks:load",(function(){if(0!==k(".js-username-change-input").length)return w()}));r(4725);var _=r(9703),E=r(9711),x=r(9755),S=r(6486);x(document).on("ajax:before",(function(){return(0,E.Uq)(),x(document).one("ajax:complete.ujsHideLoadingOverlay",E.Lt)})),x(document).on("ajax:success",(function(t,e){var r,i;return i=function(){if(!S.isEmpty(null!=e?e.message:void 0))return(0,d.g)(e.message,"success")},"1"===t.target.getAttribute("data-reload-on-success")?(r="1"===t.target.getAttribute("data-reload-reset-scroll"),x(document).one("turbolinks:load",i),(0,p.sl)(!r)):i()})),x(document).on("ajax:error",(function(t,e){if("1"!==t.target.dataset.skipAjaxErrorPopup&&401!==e.status)return(0,_.qQ)(e)}));r(6218);var P=r(3775),C=r(9755);C(document).on("keypress",".js-auto-submit",(function(t){if(13===t.which)return t.preventDefault(),C(t.target).trigger("change")})),C(document).on("change",".js-auto-submit",(function(t){var e;if((e=C(t.target)).val()!==e.data("last-submitted-value"))return e.data("last-submitted-value",e.val()),e.parents("form").submit()})),C(document).on("keypress",".content-editable-submit",(function(t){if(13===t.which)return t.preventDefault(),C(t.target).trigger("blur")})),C(document).on("blur",".content-editable-submit",(function(t){var e,r,i;if((r=C(t.target)).html()!==r.data("last-submitted-value"))return r.data("last-submitted-value",r.html()),e=r.parents("form"),(i=C(document.createElement("input"))).attr("type","hidden"),i.attr("name",r.attr("data-name")),i.attr("value",r.html()),e.append(i),e.submit(),i.remove()})),C(document).on("turbolinks:load",(function(){return C(".content-editable-submit").each((function(t,e){var r;return(r=C(e)).data("last-submitted-value",r.html())}))})),C(document).on("click","#popup-container, #overlay",(function(t){var e;return C("#overlay").fadeOut(),(e=C(t.target).closest(".popup-active")).fadeOut(null,(function(){return e.remove()}))})),C(document).on("click",".clickable-row",(function(t){var e,r,i;if(i=t.target,!(0,P.ri)(i))return(r=t.currentTarget).classList.contains("clickable-row-link")?r.click():null!=(e=r.getElementsByClassName("clickable-row-link")[0])?e.click():void 0})),C(document).on("keydown",".js-quick-submit",(function(t){if((t.ctrlKey||t.metaKey)&&"Enter"===t.key)return t.preventDefault(),C(t.target).closest("form").submit()})),C(document).on("ajax:beforeSend",(function(t){var e,r,i,n,s,o;if((r=t.target)._submitting)return!1;for(r._submitting=!0,r._ujsSubmitDisabled=[],o=[],i=0,n=(s=r.querySelectorAll(".js-ujs-submit-disable")).length;i<n;i++)(e=s[i]).disabled||("1"===e.dataset.blurOnSubmitDisable&&e.blur(),e.disabled=!0,o.push(r._ujsSubmitDisabled.push(e)));return o})),C(document).on("ajax:complete",(function(t){var e,r,i;for((r=t.target)._submitting=!1,i=[];e=r._ujsSubmitDisabled.pop();)i.push(e.disabled=!1);return i}));var T=r(5076),O=r(9755),M=r(2918);O(document).on("click",'a[href^="#"]',(function(t){var e,r,i,n;if("collapse"!==(r=t.currentTarget).dataset.toggle&&(e=r.href,""!==(n=decodeURIComponent(e.slice(e.indexOf("#")+1)))&&null!=(i=document.getElementById(n))))return t.preventDefault(),M.controller.advanceHistory(e),i.scrollIntoView()})),M.HttpRequest.prototype.requestLoaded=function(){return this.endRequest((t=this,function(){var e,r;return 200<=(e=t.xhr.status)&&e<300||401===(r=t.xhr.status)||403===r||404===r||500===r?t.delegate.requestCompletedWithResponse(t.xhr.responseText,t.xhr.getResponseHeader("Turbolinks-Location")):(t.failed=!0,t.delegate.requestFailedWithStatusCode(t.xhr.status,t.xhr.responseText))}));var t},M.Controller.prototype.advanceHistory=function(t){var e,r;if(t!==(0,p.JJ)().href)return r=this.view.getSnapshot(),e=this.lastRenderedLocation,this.cache.put(e,r.clone()),this.lastRenderedLocation=M.Location.wrap(t),this.pushHistoryWithLocationAndRestorationIdentifier(t,M.uuid())},M.Controller.prototype.replaceHistory=function(t){if(t!==(0,p.JJ)().href)return history.replaceState(history.state,"",t),this.lastRenderedLocation=M.Location.wrap(t)},M.Snapshot.prototype.hasAnchor=function(){return!0},M.Controller.prototype.locationIsVisitable=function(t){return t.isPrefixedBy(this.view.getRootLocation())&&(0,T.ni)(t)&&(0,T.FP)(t)};var L=r(7181),N=r(9755),I=function(t,e){return function(){return t.apply(e,arguments)}};const D=function(){function t(){this.rollback=I(this.rollback,this),this.overlayStart=I(this.overlayStart,this),this.overlayLeave=I(this.overlayLeave,this),this.overlayHover=I(this.overlayHover,this),this.overlayEnter=I(this.overlayEnter,this),this.overlayEnd=I(this.overlayEnd,this),this.initialize=I(this.initialize,this),N(document).on("turbolinks:load",this.initialize),N(document).on("turbolinks:before-cache",this.rollback),N.subscribe("dragenterGlobal",this.overlayStart),N.subscribe("dragendGlobal",this.overlayEnd),N(document).on("dragenter",".js-account-edit-avatar",this.overlayEnter),N(document).on("dragover",".js-account-edit-avatar",this.overlayHover),this.main=document.getElementsByClassName("js-account-edit-avatar")}return t.prototype.$button=function(){return N(".js-account-edit-avatar__button")},t.prototype.initialize=function(){var t;if(null!=this.main[0])return this.isAvailable=!0,this.$main=N(this.main),this.$button().fileupload({url:(0,f.B)("account.avatar"),dataType:"json",dropZone:this.$main,submit:(t=this,function(){return t.main[0].classList.add("js-account-edit-avatar--saving"),N.publish("dragendGlobal")}),done:function(t,e){return N.publish("user:update",e.result)},fail:_.Jn,complete:function(t){return function(){return t.main[0].classList.remove("js-account-edit-avatar--saving")}}(this)})},t.prototype.overlayEnd=function(){if(this.isAvailable)return this.main[0].classList.remove("js-account-edit-avatar--start")},t.prototype.overlayEnter=function(){return null!=this.dragging?this.dragging:this.dragging=!0},t.prototype.overlayHover=function(){if(this.dragging)return this.main[0].classList.add("js-account-edit-avatar--hover"),Timeout.clear(this.overlayLeaveTimeout),this.overlayLeaveTimeout=Timeout.set(100,this.overlayLeave)},t.prototype.overlayLeave=function(){return this.dragging=null,this.main[0].classList.remove("js-account-edit-avatar--hover")},t.prototype.overlayStart=function(){if(this.isAvailable)return this.main[0].classList.add("js-account-edit-avatar--start")},t.prototype.rollback=function(){if(this.isAvailable)return this.isAvailable=!1,this.$button().fileupload("destroy")},t}();var B=r(9755),R=function(t,e){return function(){return t.apply(e,arguments)}};const U=function(){function t(){this.toggle=R(this.toggle,this),this.updateBlockCount=R(this.updateBlockCount,this),B(document).on("click",this.jsClass,this.toggle),B.subscribe("user:update",this.updateBlockCount)}return t.prototype.element="block-list__content",t.prototype.jsClass=".js-account-edit-blocklist",t.prototype.updateBlockCount=function(){var t,e;if(null!=currentUser.id)return B(this.jsClass+"-count").text((0,m.dW)("users.blocks.blocked_count",{count:null!=(t=null!=(e=currentUser.blocks)?e.length:void 0)?t:0}))},t.prototype.toggle=function(t){var e;return t.preventDefault(),B("."+this.element).toggleClass("hidden"),e=B("."+this.element).hasClass("hidden")?(0,m.dW)("common.buttons.show"):(0,m.dW)("common.buttons.hide"),B(this.jsClass).text(e)},t}();var q=r(9755),A=r(6486),z=function(t,e){return function(){return t.apply(e,arguments)}};const F=function(){function t(){this.update=z(this.update,this),this.abortUpdate=z(this.abortUpdate,this),this.saving=z(this.saving,this),this.saved=z(this.saved,this),this.clearState=z(this.clearState,this),this.ajaxSaved=z(this.ajaxSaved,this),this.ajaxSaving=z(this.ajaxSaving,this),this.ajaxError=z(this.ajaxError,this),this.initializeUpdate=z(this.initializeUpdate,this),q(document).on("input change",".js-account-edit",this.initializeUpdate),q(document).on("ajax:error",".js-account-edit",this.ajaxError),q(document).on("ajax:send",".js-account-edit",this.ajaxSaving),q(document).on("ajax:success",".js-account-edit",this.ajaxSaved),q(document).on("ajax:success",".js-user-preferences-update",this.ajaxUserPreferencesUpdate)}return t.prototype.initializeUpdate=function(t){var e;if("1"===(e=t.currentTarget).dataset.accountEditAutoSubmit)return this.abortUpdate(e),this.saving(e),null==e.debouncedUpdate&&(e.debouncedUpdate=A.debounce(this.update,1e3)),e.debouncedUpdate(e)},t.prototype.ajaxError=function(t){return this.clearState(t.currentTarget)},t.prototype.ajaxSaving=function(t){return this.saving(t.currentTarget)},t.prototype.ajaxSaved=function(t){return this.saved(t.currentTarget)},t.prototype.ajaxUserPreferencesUpdate=function(t,e){return q.publish("user:update",e)},t.prototype.clearState=function(t){return t.dataset.accountEditState=""},t.prototype.getValue=function(t){var e,r,i,n,s,o,a,u,l,c;if("array"===t.dataset.accountEditType)for(a=null,c=[""],r=0,s=(u=t.querySelectorAll("input")).length;r<s;r++)(e=u[r]).checked&&c.push(e.value);else if("radio"===t.dataset.accountEditType){for(a=t.dataset.lastValue,n=0,o=(l=t.querySelectorAll('input[type="radio"]')).length;n<o;n++)if((e=l[n]).checked){c=e.value;break}}else a=t.dataset.lastValue,c="checkbox"===(i=t.querySelector(".js-account-edit__input")).type?i.checked:i.value;return{value:c,prevValue:a}},t.prototype.getMultiValue=function(t){var e,r,i,n,s;for(r={},i=0,n=(s=t.querySelectorAll(".js-account-edit__input")).length;i<n;i++)r[(e=s[i]).name]=e.checked;return r},t.prototype.saved=function(t){return t.dataset.accountEditState="saved",t.savedTimeout=Timeout.set(3e3,(e=this,function(){return e.clearState(t)}));var e},t.prototype.saving=function(t){return t.dataset.accountEditState="saving"},t.prototype.abortUpdate=function(t){var e;return Timeout.clear(t.savedTimeout),null!=(e=t.updating)&&e.abort(),this.clearState(t)},t.prototype.update=function(t){var e,r,i,n,s,o,a,u,l,c,h;if("multi"===t.dataset.accountEditType)e=this.getMultiValue(t);else{if((c=(o=this.getValue(t)).value)===(s=o.prevValue))return this.clearState(t);i=t.querySelector(".js-account-edit__input"),r=null!=(a=t.dataset.field)?a:i.name,t.dataset.lastValue=c,(n={})[""+r]=c,e=n}return l=null!=(u=t.dataset.url)?u:(0,f.B)("account.update"),t.updating=q.ajax(l,{method:"PUT",data:e}).done((h=this,function(e){return h.saved(t),q(t).trigger("ajax:success",e)})).fail(function(e){return function(r,i){if("abort"!==i)return t.lastValue=s,e.clearState(t),q(t).trigger("ajax:error",[r,i])}}(this))},t}();var W=r(3924),V=r(9755),Z=function(t,e){return function(){return t.apply(e,arguments)}};const H=function(){function t(){this.hidePreview=Z(this.hidePreview,this),this.showPreview=Z(this.showPreview,this),this.fetchPreview=Z(this.fetchPreview,this),V(document).on("click",".js-bbcode-preview--show",this.fetchPreview),V(document).on("click",".js-bbcode-preview--hide",this.hidePreview)}return t.prototype.fetchPreview=function(t){var e,r,i,n,s;if(n=t.target,r=V(n).parents(".js-bbcode-preview--form"),i=r.find(".js-bbcode-preview--preview"),e=r.find(".js-bbcode-preview--body"),s=e.val(),e.attr("data-last-text"),"preview"!==r.attr("data-state")&&(0,W.W)(s)){var o;if(s!==e.attr("data-last-text"))return r.attr("data-state","loading-preview"),V.ajax({url:(0,f.B)("bbcode-preview"),method:"POST",data:{text:s}}).done((o=this,function(r){return e.attr("data-last-text",s),i.html(r),o.showPreview(t)})).fail((0,_.hd)(n));this.showPreview(t)}},t.prototype.showPreview=function(t){return V(t.target).parents(".js-bbcode-preview--form").attr("data-state","preview"),V.publish("sync-height:force")},t.prototype.hidePreview=function(t){var e;return(e=V(t.target).parents(".js-bbcode-preview--form")).attr("data-state","write"),V.publish("sync-height:force"),e.find(".js-bbcode-preview--body").focus()},t}();var $=r(9755),J=function(t,e){return function(){return t.apply(e,arguments)}};const X=function(){function t(t){var e;this.slideDown=J(this.slideDown,this),this.close=J(this.close,this),this.open=J(this.open,this),this.onClick=J(this.onClick,this),this.el=t,this.packTag=t.dataset.packTag,this.packBody=this.el.querySelector(".js-accordion__item-body"),this.expander=this.el.querySelector(".js-accordion__item-header"),this.busy=!1,this.isCurrent=this.el.classList.contains("js-accordion__item--expanded"),$(".js-accordion").on("beatmappack:clicked",this.onClick),$(this.expander).on("click",(e=this,function(t){return t.preventDefault(),$(e.el).trigger("beatmappack:clicked",e.packTag)}))}return t.initialize=function(){var e,r,i,n,s;for(s=[],r=0,i=(n=document.querySelectorAll(".js-beatmap-pack")).length;r<i;r++)e=n[r],s.push(new t(e));return s},t.prototype.onClick=function(t,e){return t.stopPropagation(),this.isCurrent||this.packTag!==e?this.close():this.open()},t.prototype.open=function(){var t,e;if(this.isCurrent=!0,!this.busy)return this.nextFrame((e=this,function(){return $(e.el).addClass("js-accordion__item--expanded")})),(null!=(t=this.packBody.innerHTML)?t.length:void 0)?this.isCurrent?this.slideDown():void 0:(this.busy=!0,this.getBeatmapPackItem(this.packTag).done(function(t){return function(e){return t.nextFrame((function(){if(t.packBody.innerHTML=e,t.isCurrent)return t.slideDown()}))}}(this)).fail(_.qQ).always(function(t){return function(){return t.busy=!1}}(this)))},t.prototype.close=function(){var t;if(this.isCurrent)return this.isCurrent=!1,this.nextFrame((t=this,function(){return t.packBody.style.height="0",$(t.el).removeClass("js-accordion__item--expanded")}))},t.prototype.getBeatmapPackItem=function(t){return $.get((0,f.B)("packs.show",{pack:t,format:"raw"}))},t.prototype.slideDown=function(){var t,e;return this.packBody.style.height="",t=this.packBody.getBoundingClientRect(),this.packBody.style.height="0",this.nextFrame((e=this,function(){return e.packBody.style.height=t.height+"px"}))},t.prototype.nextFrame=function(t){return window.requestAnimationFrame(t)},t}();var G=r(9162),K=r(8278),Q=r(7543),Y=r(6486),tt=r(381),et=function(t,e){return function(){return t.apply(e,arguments)}},rt={}.hasOwnProperty;const it=function(){function t(t){var e;this.resize=et(this.resize,this),this.positionTooltip=et(this.positionTooltip,this),this.moveTooltip=et(this.moveTooltip,this),this.hideTooltip=et(this.hideTooltip,this),this.showTooltip=et(this.showTooltip,this),this.options={scales:{x:Q.scaleTime(),y:Q.scaleLinear(),class:Q.scaleOrdinal()}},this.area=Q.select(t),this.area.classed("changelog-chart",!0),this.svg=this.area.append("svg"),this.svgWrapper=this.svg.append("g"),this.areaFunction=Q.area().curve(Q.curveMonotoneX).x((e=this,function(t){return e.options.scales.x(t.data.date)})).y1(function(t){return function(e){return t.options.scales.y(e[1])}}(this)).y0(function(t){return function(e,r){return t.options.scales.y(e[0])}}(this)),this.hoverArea=this.svg.append("rect").classed("changelog-chart__hover-area",!0).on("mouseout",this.hideTooltip).on("mousemove",this.moveTooltip),this.tooltipArea=this.area.append("div").classed("changelog-chart__tooltip-area",!0),this.tooltipContainer=this.tooltipArea.append("div").classed("changelog-chart__tooltip-container",!0).attr("data-visibility","hidden"),this.tooltipContainer.append("div").classed("changelog-chart__tooltip-line",!0),this.tooltip=this.tooltipContainer.append("div").classed("changelog-chart__tooltip",!0),this.tooltipName=this.tooltip.append("div"),this.tooltipUserCount=this.tooltip.append("div").classed("changelog-chart__text changelog-chart__text--user-count",!0),this.tooltipDate=this.tooltip.append("div").classed("changelog-chart__text changelog-chart__text--date",!0),this.tooltipContainer.append("div").classed("changelog-chart__tooltip-line",!0),this.tooltipLine=this.tooltipContainer.selectAll(".changelog-chart__tooltip-line")}return t.prototype.loadData=function(){var t,e,r,i;return this.config=(0,K.Mo)("json-chart-config"),t=(r=this.normalizeData(this.config.build_history)).data,e=r.hasData,i=Q.stack().keys(this.config.order).value((function(t,e){return null!=t[e]?t[e].normalized:0})),this.data=i(t),this.hasData=null!=this.config.build_history&&this.config.build_history.length>0&&e,this.resize()},t.prototype.setDimensions=function(){var t;return t=this.area.node().getBoundingClientRect(),this.width=t.width,this.height=t.height},t.prototype.setSvgSize=function(){return this.svg.attr("width",this.width).attr("height",this.height)},t.prototype.setHoverAreaSize=function(){return this.hoverArea.attr("width",this.width).attr("height",this.height)},t.prototype.setScalesRange=function(){var t,e,r;return this.options.scales.x.range([0,this.width]).domain([null!=(t=Y.first(this.data[0]))?t.data.date:void 0,null!=(e=Y.last(this.data[0]))?e.data.date:void 0]),this.options.scales.y.range([0,this.height]).domain([0,1]),this.options.scales.class.range(Y.map(this.config.order,(r=this,function(t,e){return null!=r.config.stream_name?r.config.stream_name+"-build-"+e%7:Y.kebabCase(t)}))).domain(this.config.order)},t.prototype.drawLines=function(){return this.svgWrapper.selectAll("g").data(this.data).enter().append("path").attr("class",(t=this,function(e){return"changelog-chart__area changelog-chart__area--"+t.options.scales.class(e.key)})).attr("d",this.areaFunction);var t},t.prototype.showTooltip=function(){return(0,G.Ji)(this.tooltipContainer.node())},t.prototype.hideTooltip=function(){return(0,G.U6)(this.tooltipContainer.node())},t.prototype.moveTooltip=function(t){var e;return e=Q.pointer(t),this.x=this.options.scales.x.invert(e[0]),this.y=e[1]/this.height,this.showTooltip(),Timeout.clear(this._autoHideTooltip),this._autoHideTooltip=Timeout.set(3e3,this.hideTooltip),this.positionTooltip()},t.prototype.positionTooltip=function(){var t,e,r,i,n,s,o,a,u,l,c,h,d,p,m;if(p=this.x,m=this.y,null!=p&&null!=(u=Q.bisector((function(t){return t.data.date})).left(this.data[0],p))){for(n=s=0,a=(l=this.data).length;s<a;n=++s)if(m<=(i=l[n])[u][1]&&null!=i[u].data[i.key]){r=n,e=i.key,o=this.options.scales.class(e);break}return t=this.options.scales.x(p),this.tooltipName.attr("class","changelog-chart__text changelog-chart__text--name changelog-chart__text--"+o).text(e),this.tooltipUserCount.text((0,P.uf)(this.data[r][u].data[e].user_count)),this.tooltipDate.text(this.data[r][u].data.date_formatted),h=(d=t-(c=this.tooltip.node().getBoundingClientRect().width)/2)<0?0:d+c>this.width?this.width-c:d,this.tooltip.style("transform","translateX("+h+"px)"),this.tooltipLine.style("transform","translateX("+t+"px)")}},t.prototype.resize=function(){if(this.area.classed("hidden",!this.hasData),this.hasData)return this.setDimensions(),this.setScalesRange(),this.setSvgSize(),this.setHoverAreaSize(),this.drawLines(),this.positionTooltip()},t.prototype.normalizeData=function(t){var e,r,i,n,s,o,a,u,l;return s=null,r=null,{data:function(){var c,h,d,p;for(a in p=[],d=Y.groupBy(t,"created_at"))if(rt.call(d,a)){for(l=d[a],0===(o=Y.sumBy(l,"user_count"))?(null!=s&&(e=Y.find(l,{label:s})),null==e&&(e=Y.last(l),s=e.label),e.user_count=1,o=1):null==r&&(r=!0),i=tt(l[0].created_at),n={created_at:a,date:i.toDate(),date_formatted:i.format("YYYY/MM/DD")},c=0,h=l.length;c<h;c++)(u=l[c]).normalized=u.user_count/o,n[u.label]=u;p.push(n)}return p}(),hasData:r}},t}();var nt=r(9755),st=function(t,e){return function(){return t.apply(e,arguments)}};const ot=function(){function t(){this.resize=st(this.resize,this),this.initialize=st(this.initialize,this),nt(window).on("resize",this.resize),nt(document).on("turbolinks:load",this.initialize)}return t.prototype.container=document.getElementsByClassName("js-changelog-chart"),t.prototype.initialize=function(){if(null!=this.container[0])return this.container[0]._chart=new it(this.container[0]),this.container[0]._chart.loadData()},t.prototype.resize=function(){var t;return null!=(t=this.container[0])?t._chart.resize():void 0},t}();var at=r(9755);const ut=function(){function t(){var t,e;this.validate=(t=this.validate,e=this,function(){return t.apply(e,arguments)}),at(document).on("change",".js-checkbox-validation",this.validate)}return t.prototype.validate=function(t){var e,r,i,n,s,o,a,u;if(null==(e=t.currentTarget)._checkboxValidationCache&&(e._checkboxValidationCache=JSON.parse(t.currentTarget.dataset.checkboxValidation)),a=t.target.name,null!=(n=t.currentTarget._checkboxValidationCache[a])){for(r=t.currentTarget.querySelectorAll("[name='"+a+"']"),u=t.currentTarget.getElementsByClassName("js-checkbox-validation--submit")[0],i=0,s=0,o=r.length;s<o;s++)r[s].checked&&(i+=1);return u.disabled=i<n.min||i>n.max}},t}();var lt=r(6486),ct=r(3336),ht=r(9755),dt=function(t,e){return function(){return t.apply(e,arguments)}};const pt=function(){function t(){var t;this.updateFollowUserMapping=dt(this.updateFollowUserMapping,this),this.setData=dt(this.setData,this),this.setCovers=dt(this.setCovers,this),this.setAvatars=dt(this.setAvatars,this),this.reinit=dt(this.reinit,this),this.covers=document.getElementsByClassName("js-current-user-cover"),this.avatars=document.getElementsByClassName("js-current-user-avatar"),ht.subscribe("user:update",this.setData),ht(document).on("turbolinks:load",this.reinit),ht.subscribe("user:followUserMapping:update",this.updateFollowUserMapping),ht((t=this,function(){return(0,u.U5)((function(){var t;return null!=(t=L.Z.currentUser)?t.cover.url:void 0}),t.setCovers)}))}return t.prototype.reinit=function(){return this.setAvatars(),this.setSentryUser()},t.prototype.setAvatars=function(t){var e,r,i,n,s;for(null==t&&(t=this.avatars),null!=currentUser.id&&(e=(0,ct.eF)(currentUser.avatar_url)),s=[],i=0,n=t.length;i<n;i++)r=t[i],s.push(r.style.backgroundImage=e);return s},t.prototype.setCovers=function(){var t,e,r,i,n,s;for(null!=L.Z.currentUser&&(t=(0,ct.eF)(L.Z.currentUser.cover.url)),s=[],r=0,i=(n=this.covers).length;r<i;r++)e=n[r],s.push(e.style.backgroundImage=t);return s},t.prototype.setData=function(t,e){return window.currentUser=e,this.reinit()},t.prototype.setSentryUser=function(){if("undefined"!=typeof Sentry&&null!==Sentry)return Sentry.configureScope((function(t){return t.setUser({id:currentUser.id,username:currentUser.username})}))},t.prototype.updateFollowUserMapping=function(t,e){return e.following?currentUser.follow_user_mapping.push(e.userId):(0,lt.pull)(currentUser.follow_user_mapping,e.userId),L.Z.currentUser.follow_user_mapping=currentUser.follow_user_mapping,ht.publish("user:followUserMapping:refresh")},t}();var mt=r(7543),ft=r(6486),gt=r(9755),vt=function(t,e){return function(){return t.apply(e,arguments)}};const bt=function(){function t(t,e){var r,i,n,s;this.options=null!=e?e:{},this.lookupIndexFromX=vt(this.lookupIndexFromX,this),this.hoverRefresh=vt(this.hoverRefresh,this),this.hoverEnd=vt(this.hoverEnd,this),this.resize=vt(this.resize,this),this.recalc=vt(this.recalc,this),this.reveal=vt(this.reveal,this),this.drawLine=vt(this.drawLine,this),this.setWrapperSize=vt(this.setWrapperSize,this),this.setSvgSize=vt(this.setSvgSize,this),this.setLineSize=vt(this.setLineSize,this),this.setScalesRange=vt(this.setScalesRange,this),this.setHoverAreaSize=vt(this.setHoverAreaSize,this),this.setDimensions=vt(this.setDimensions,this),this.loadData=vt(this.loadData,this),this.hide=vt(this.hide,this),null==(r=this.options).scales&&(r.scales={}),null==(i=this.options.scales).x&&(i.x=mt.scaleLinear()),null==(n=this.options.scales).y&&(n.y=mt.scaleLinear()),this.margins={top:25,right:20,bottom:10,left:0},this.area=mt.select(t),this.area.selectAll(".fancy-graph").remove(),this.svg=this.area.append("svg").classed("fancy-graph",!0),this.svgWrapper=this.svg.append("g"),this.svgLine=this.svgWrapper.append("path").classed("fancy-graph__line",!0).attr("opacity",0),this.line=mt.line().curve(mt.curveMonotoneX),this.svgEndCircle=this.svgWrapper.append("circle").classed("fancy-graph__circle",!0).attr("r",2).attr("opacity",0),this.svgHoverArea=this.svg.append("rect").classed("fancy-graph__hover-area",!0).on("mouseout",this.hoverEnd).on("mousemove",this.hoverRefresh).on("drag",this.hoverRefresh),this.svgHoverMark=this.svgWrapper.append("circle").classed("fancy-graph__circle",!0).attr("data-visibility","hidden").attr("r",2),s=(0,K.Um)(t.dataset.src),this.loadData(s)}return t.prototype.hide=function(){return this.svgEndCircle.attr("opacity",0),this.svgLine.attr("opacity",0)},t.prototype.loadData=function(t){if(!ft.isEqual(t,this.data))return this.data=null!=t?t:[],this.svgLine.datum(this.data),this.reveal()},t.prototype.setDimensions=function(){var t;return t=this.area.node().getBoundingClientRect(),this.width=t.width-(this.margins.left+this.margins.right),this.height=t.height-(this.margins.top+this.margins.bottom)},t.prototype.setHoverAreaSize=function(){return this.svgHoverArea.attr("width",this.width+(this.margins.left+this.margins.right)).attr("height",this.height+(this.margins.top+this.margins.bottom))},t.prototype.setScalesRange=function(){var t,e,r,i;return this.options.scales.x.range([0,this.width]).domain(null!=(t=null!=(e=this.options.domains)?e.x:void 0)?t:mt.extent(this.data,(function(t){return t.x}))),this.options.scales.y.range([this.height,0]).domain(null!=(r=null!=(i=this.options.domains)?i.y:void 0)?r:mt.extent(this.data,(function(t){return t.y})))},t.prototype.setLineSize=function(){var t,e;if(this.line.x((e=this,function(t){return e.options.scales.x(t.x)})).y(function(t){return function(e){return t.options.scales.y(e.y)}}(this)),null!=(t=ft.last(this.data)))return this.svgEndCircle.attr("transform","translate("+this.options.scales.x(t.x)+", "+this.options.scales.y(t.y)+")")},t.prototype.setSvgSize=function(){return this.svg.attr("width",this.width+(this.margins.left+this.margins.right)).attr("height",this.height+(this.margins.top+this.margins.bottom))},t.prototype.setWrapperSize=function(){return this.svgWrapper.attr("transform","translate("+this.margins.left+", "+this.margins.top+")")},t.prototype.drawLine=function(){return this.svgLine.attr("stroke-dasharray",0).attr("d",this.line)},t.prototype.reveal=function(){var t;return null==this.data[0]?this.hide():(this.recalc(),this.svgLine.attr("d",this.line),t=this.svgLine.node().getTotalLength(),this.svgEndCircle.attr("opacity",0),this.svgLine.attr("stroke-dasharray",t).attr("stroke-dashoffset",t).transition().delay(400).duration(1e3).ease(mt.easeSinOut).attr("stroke-dashoffset",0).attr("opacity",1),this.svgEndCircle.transition().delay(1300).duration(300).ease(mt.easeSinOut).attr("opacity",1))},t.prototype.recalc=function(){return this.setDimensions(),this.setScalesRange(),this.setSvgSize(),this.setWrapperSize(),this.setLineSize(),this.setHoverAreaSize()},t.prototype.resize=function(){return this.recalc(),this.drawLine()},t.prototype.hoverEnd=function(){return(0,G.U6)(this.svgHoverMark.node()),gt.publish("fancy-chart:hover-"+this.options.hoverId+":end")},t.prototype.hoverRefresh=function(t){var e,r,i,n,s;if(null!=this.options.hoverId&&(null!=this.data[0]&&(n=this.options.scales.x.invert(mt.pointer(t)[0]-this.margins.left),null!=(i=this.lookupIndexFromX(n)))))return(0,G.Ji)(this.svgHoverMark.node()),Timeout.clear(this._hoverTimeout),this._hoverTimeout=Timeout.set(3e3,this.hoverEnd),r=0===i?this.data[0]:i>=this.data.length?ft.last(this.data):n-this.data[i-1].x<=this.data[i].x-n?this.data[i-1]:this.data[i],e=["x","y"].map((s=this,function(t){return s.options.scales[t](r[t])})),this.svgHoverMark.attr("transform","translate("+e.join(", ")+")"),gt.publish("fancy-chart:hover-"+this.options.hoverId+":refresh",{data:r})},t.prototype.lookupIndexFromX=function(t){return mt.bisector((function(t){return t.x})).left(this.data,t)},t}();var yt=r(9755),wt=function(t,e){return function(){return t.apply(e,arguments)}};const kt=function(){function t(){this.resize=wt(this.resize,this),this.initialize=wt(this.initialize,this),yt(window).on("resize",this.resize),yt(document).on("turbolinks:load",this.initialize)}return t.prototype.container=document.getElementsByClassName("js-fancy-graph"),t.prototype.initialize=function(){var t;if(null!=this.container[0])return null!=(t=this.container[0])._chart?t._chart:t._chart=new bt(this.container[0])},t.prototype.resize=function(){var t;if(null!=this.container[0])return null!=(t=this.container[0]._chart)?t.resize():void 0},t}();var jt=r(9755);const _t=function(){function t(){jt(document).on("ajax:success",".js-form-clear",this.clear)}return t.prototype.clear=function(t){return t.currentTarget.reset()},t}();var Et=r(9755),xt=r(6486),St=function(t,e){return function(){return t.apply(e,arguments)}};const Pt=function(){function t(t){this.formError=t,this.onInput=St(this.onInput,this),this.boot=St(this.boot,this),Et(document).on("input",".js-form-confirmation",this.onInput)}return t.prototype.boot=function(t){var e,r,i;if(null==t.formConfirmation)return r={},xt.endsWith(t.name,"_confirmation")||xt.endsWith(t.name,"_confirmation]")?(i=t.name.replace(/_confirmation(]?)$/,"$1"),r.confirmation=t,r.main=Et(t).closest("form").find("[name='"+i+"']")[0]):(e=t.name.replace(/(]?)$/,"_confirmation$1"),r.main=t,r.confirmation=Et(t).closest("form").find("[name='"+e+"']")[0]),r.main.formConfirmation=r,r.confirmation.formConfirmation=r},t.prototype.onInput=function(t){var e,r,i,n;return e=t.currentTarget,this.boot(e),n=(r=e.formConfirmation).main.value,i=r.confirmation.value,0===n.length||0===i.length||n===i?this.formError.setOneError(r.confirmation,[]):this.formError.setOneError(r.confirmation,[(0,m.dW)("model_validation.wrong_confirmation")])},t}();var Ct=r(9755),Tt=function(t,e){return function(){return t.apply(e,arguments)}};const Ot=function(){function t(){this.setOneError=Tt(this.setOneError,this),this.setError=Tt(this.setError,this),this.showError=Tt(this.showError,this),this.clearError=Tt(this.clearError,this),Ct(document).on("ajax:error",".js-form-error",this.showError),Ct(document).on("ajax:success",".js-form-error",this.clearError)}return t.prototype.clearError=function(t){return this.setError(t.target)},t.prototype.showError=function(t,e){var r,i;return null==(r=null!=(i=e.responseJSON)?i.form_error:void 0)?(0,_.qQ)(e):this.setError(t.target,(0,K.lv)(r))},t.prototype.setError=function(t,e){return Ct(t).find("[name]").each((r=this,function(t,i){return r.setOneError(i,null!=e?e.get(i.name):void 0)}));var r},t.prototype.setOneError=function(t,e){var r;return null==e&&(e=[]),r=e.length>0?"error":"",Ct(t).closest("label, .js-form-error--field").attr("data-form-error-state",r).find(".js-form-error--error").text(e.join(" "))},t}();var Mt=r(9755),Lt=function(t,e){return function(){return t.apply(e,arguments)}};const Nt=function(){function t(){this.sync=Lt(this.sync,this),this.onChange=Lt(this.onChange,this),addEventListener("turbolinks:load",this.sync),Mt(document).on("change",".js-form-toggle--input",this.onChange)}return t.prototype.onChange=function(t){return this.toggle(t.currentTarget)},t.prototype.sync=function(){var t,e,r,i,n;for(n=[],t=0,i=(r=document.getElementsByClassName("js-form-toggle--input")).length;t<i;t++)e=r[t],n.push(this.toggle(e));return n},t.prototype.toggle=function(t){var e,r;return r=t.dataset.formToggleId,e=t.checked?"Down":"Up",Mt(".js-form-toggle--form[data-form-toggle-id='"+r+"']").stop()["slide"+e]()},t}();var It,Dt,Bt=r(3857),Rt=r(2918),Ut=r(6486),qt=r(9755),At=function(t,e){return function(){return t.apply(e,arguments)}};Dt=function(t){return Rt.controller.replaceHistory(t)},It=Ut.debounce(Dt,250);const zt=function(){function t(){this.jumpToSubmit=At(this.jumpToSubmit,this),this.showMore=At(this.showMore,this),this.postUrlClick=At(this.postUrlClick,this),this.initialScrollTo=At(this.initialScrollTo,this),this.toggleDeleted=At(this.toggleDeleted,this),this.scrollTo=At(this.scrollTo,this),this.keyboardNavigation=At(this.keyboardNavigation,this),this.jumpTo=At(this.jumpTo,this),this.refreshCounter=At(this.refreshCounter,this),this.refreshLoadMoreLinks=At(this.refreshLoadMoreLinks,this),this.lastPostLoaded=At(this.lastPostLoaded,this),this.startingPostLoaded=At(this.startingPostLoaded,this),this.endPost=At(this.endPost,this),this.setCounter=At(this.setCounter,this),this.showDeleted=At(this.showDeleted,this),this.setTotalPosts=At(this.setTotalPosts,this),this.totalPosts=At(this.totalPosts,this),this.postPosition=At(this.postPosition,this),this.boot=At(this.boot,this),this._totalPostsDiv=document.getElementsByClassName("js-forum__total-count"),this._deletedPostsDiv=document.getElementsByClassName("js-forum__deleted-count"),this._postsCounter=document.getElementsByClassName("js-forum__posts-counter"),this._postsProgress=document.getElementsByClassName("js-forum__posts-progress"),this.posts=document.getElementsByClassName("js-forum-post"),this.loadMoreLinks=document.getElementsByClassName("js-forum-posts-show-more"),this.throttledBoot=Ut.throttle(this.boot,100),this.refreshCounterPaused=!0,this.maxPosts=250,qt(document).on("turbolinks:load",this.throttledBoot),qt(window).on("scroll",this.refreshCounter),qt(document).on("click",".js-forum-posts-show-more",this.showMore),qt(document).on("click",".js-post-url",this.postUrlClick),qt(document).on("submit",".js-forum-posts-jump-to",this.jumpToSubmit),qt(document).on("keyup",this.keyboardNavigation),qt(document).on("click",".js-forum-topic-moderate--toggle-deleted",this.toggleDeleted),qt(document).on("turbolinks:before-cache",It.cancel)}return t.prototype.boot=function(){return this.refreshCounterPaused=!0,this.refreshLoadMoreLinks(),this.initialScrollTo()},t.prototype.userCanModerate=function(){return"1"===this.topicMeta().userCanModerate},t.prototype.postPosition=function(t){return parseInt(t.getAttribute("data-post-position"),10)},t.prototype.firstPostId=function(){return parseInt(this.topicMeta().firstPostId,10)},t.prototype.postId=function(t){return parseInt(t.getAttribute("data-post-id"),10)},t.prototype.topicMeta=function(){var t;return null!=(t=newBody.querySelector(".js-forum--topic-meta"))?t.dataset:void 0},t.prototype.totalPosts=function(){return 0===this._totalPostsDiv.length?null:parseInt(this._totalPostsDiv[0].dataset.total,10)},t.prototype.setTotalPosts=function(t){return qt(this._totalPostsDiv).text((0,P.uf)(t)).attr("data-total",t)},t.prototype.showDeleted=function(){var t;if(null!=(t=document.querySelector(".js-forum-topic-moderate--toggle-deleted")))return"1"===t.dataset.showDeleted},t.prototype.deletedPosts=function(){return 0===this._deletedPostsDiv.length?null:parseInt(this._deletedPostsDiv[0].dataset.total,10)},t.prototype.setDeletedPosts=function(t){return qt(this._deletedPostsDiv).text((0,P.uf)(t)).attr("data-total",t)},t.prototype.setCounter=function(t){return this.currentPostPosition=this.postPosition(t),this.currentPostPosition>this.totalPosts()&&this.setTotalPosts(this.currentPostPosition),It(this.postUrlN(this.currentPostPosition)),this._postsCounter[0].textContent=(0,P.uf)(this.currentPostPosition),this._postsProgress[0].style.width=100*this.currentPostPosition/this.totalPosts()+"%"},t.prototype.endPost=function(){return this.posts[this.posts.length-1]},t.prototype.startingPostLoaded=function(){var t,e;return(e="1"===(t=document.querySelector(".js-forum__posts-show-more--previous")).dataset.noMore)||(e=this.postId(this.posts[0])<=this.firstPostId())&&(t.dataset.noMore="1"),e},t.prototype.lastPostLoaded=function(){var t,e;return(t="1"===(e=document.querySelector(".js-forum__posts-show-more--next")).dataset.noMore)||(t=this.postPosition(this.endPost())>=this.totalPosts())&&(e.dataset.noMore="1"),t},t.prototype.refreshLoadMoreLinks=function(){var t,e;if(this.loadMoreLinks.length)return e=this.startingPostLoaded(),qt(".js-header--main").toggleClass("hidden",!e),qt(".js-header--alt").toggleClass("hidden",e),t=this.lastPostLoaded(),qt(".js-forum__posts-show-more--next").toggleClass("hidden",t),this.userCanModerate()||qt(".js-post-delete-toggle").hide(),t?qt(this.endPost()).find(".js-post-delete-toggle").css({display:""}):void 0},t.prototype.refreshCounter=function(){var t,e,r,i,n,s,o;if(!this.refreshCounterPaused&&0!==this._postsCounter.length){if(t=null,(0,P.Mu)())t=this.posts[this.posts.length-1];else for(o=L.Z.stickyHeader.scrollOffsetValue,e=0,r=(s=this.posts).length;e<r&&(n=(i=s[e]).getBoundingClientRect().top,Math.floor(n-o)<=0);e++)t=i;return null==t&&(t=this.posts[0]),this.setCounter(t)}},t.prototype.jumpTo=function(t){var e;return t=parseInt(t,10),!!isFinite(t)&&(t=Math.max(t,1),t=Math.min(t,this.totalPosts()),e=qt(".js-forum-post[data-post-position='"+t+"']"),this._postsCounter[0].textContent=(0,P.uf)(t),e.length?this.scrollTo(e.attr("data-post-id")):Rt.visit(this.postUrlN(t)),!0)},t.prototype.keyboardNavigation=function(t){var e;if(!(0,P.cK)(t.target)&&null==t.target.closest("[role=dialog]")&&!(0,Bt._j)()&&0!==this._postsCounter.length){t.preventDefault(),e=function(){switch(t.which){case 37:return this.currentPostPosition-1;case 39:return this.currentPostPosition+1}}.call(this);try{return this.jumpTo(e)}catch(r){}}},t.prototype.scrollTo=function(t){var e,r,i;if(e=document.querySelector(".js-forum-post[data-post-id='"+t+"']"))return this.refreshCounterPaused=!0,r=1===this.postPosition(e)?0:qt(e).offset().top,qt.publish("sync-height:force"),0!==r&&(r=L.Z.stickyHeader.scrollOffset(r)),window.scrollTo(window.pageXOffset,r),this.highlightPost(e),this.setCounter(e),i=this,setTimeout((function(){return i.refreshCounterPaused=!1}),0)},t.prototype.highlightPost=function(t){return qt(".js-forum-post--highlighted").removeClass("js-forum-post--highlighted"),qt(t).addClass("js-forum-post--highlighted")},t.prototype.toggleDeleted=function(){var t,e,r;return e=osuCore.userPreferences.set("forum_posts_show_deleted",!this.showDeleted()),r=this,t=function(){return Rt.visit(r.postUrlN(r.currentPostPosition))},null!=e?e.done(t):t()},t.prototype.initialScrollTo=function(){var t;if(null!=(t=this.topicMeta()))return history.scrollRestoration="manual",qt(document).one("turbolinks:before-cache",(function(){return history.scrollRestoration="auto"})),""===(0,p.JJ)().hash&&(0,W.W)(t.postJumpTo)?(this.scrollTo(parseInt(t.postJumpTo,10)),t.postJumpTo=""):(this.refreshCounterPaused=!1,this.refreshCounter())},t.prototype.postUrlClick=function(t){var e;return t.preventDefault(),e=qt(t.target).closest(".js-forum-post").attr("data-post-id"),this.scrollTo(e)},t.prototype.postUrlN=function(t){return(0,p.JJ)().pathname+"?n="+t},t.prototype.showMore=function(t){var e,r,i,n;if(t.preventDefault(),!(e=t.currentTarget).classList.contains("js-disabled"))return e.classList.add("js-disabled"),r=e.dataset.mode,i="previous"===r?this.posts[0]:this.endPost(),qt.get(e.href).done((n=this,function(t){var s,o,a,u,l,c,h,d,p,m,f,g;if(null==t)return e.dataset.noMore="1",void n.refreshLoadMoreLinks();if(e.href=t.next_url,d=(h=i).getBoundingClientRect().top,"previous"===r?(e.insertAdjacentHTML("afterend",t.content),f=n.maxPosts,m=n.posts.length):(e.insertAdjacentHTML("beforebegin",t.content),f=0,m=n.posts.length-n.maxPosts),f<m)for(u=n.posts[0].parentNode,o=0,a=(c=Ut.slice(n.posts,f,m)).length;o<a;o++)l=c[o],u.removeChild(l);return n.refreshLoadMoreLinks(),g=window.pageXOffset,s=h.getBoundingClientRect().top,p=window.pageYOffset+s-d,window.scrollTo(g,p),e.dataset.failed="0"})).always((function(){return e.classList.remove("js-disabled")})).fail((function(t){return e.dataset.failed="1",(0,_.qQ)(t)}))},t.prototype.jumpToSubmit=function(t){if(t.preventDefault(),(0,E.Lt)(),this.jumpTo(qt(t.target).find('[name="n"]').val()))return qt.publish("forum:topic:jumpTo")},t}();var Ft=r(6486),Wt=r(9755),Vt=function(t,e){return function(){return t.apply(e,arguments)}};const Zt=function(){function t(){this.previousClick=Vt(this.previousClick,this),this.onScroll=Vt(this.onScroll,this),this.onLoad=Vt(this.onLoad,this),this.nextClick=Vt(this.nextClick,this),this._triggerDistance=1200,this.throttledOnScroll=Ft.throttle(this.onScroll,1e3),Wt(document).on("turbolinks:load",this.onLoad)}return t.prototype.commonClick=function(t){if("1"!==t.dataset.noMore&&"1"!==t.dataset.failed&&0!==t.getBoundingClientRect().height)return t.click()},t.prototype.nextClick=function(){if(null!=this.nextLink&&!(this.nextLink.getBoundingClientRect().top>document.documentElement.clientHeight+this._triggerDistance))return this.commonClick(this.nextLink)},t.prototype.onLoad=function(){if(window.removeEventListener("scroll",this.throttledOnScroll),this.nextLink=document.querySelector(".js-forum__posts-show-more--next"),this.previousLink=document.querySelector(".js-forum__posts-show-more--previous"),null!=this.nextLink&&null!=this.previousLink)return this.throttledOnScroll(),window.addEventListener("scroll",this.throttledOnScroll)},t.prototype.onScroll=function(){return this.previousClick(),this.nextClick()},t.prototype.previousClick=function(){if(null!=this.previousLink&&!(this.previousLink.getBoundingClientRect().top<-this._triggerDistance))return this.commonClick(this.previousLink)},t}();var Ht=r(9755),$t=function(t,e){return function(){return t.apply(e,arguments)}};const Jt=function(){function t(){var t;this.refresh=$t(this.refresh,this),this.remove=$t(this.remove,this),this.updateOptions=$t(this.updateOptions,this),this.update=$t(this.update,this),this.setOverlay=$t(this.setOverlay,this),this.initFileupload=$t(this.initFileupload,this),this.isModalOpen=$t(this.isModalOpen,this),this.hasCoverEditor=$t(this.hasCoverEditor,this),this.hasCover=$t(this.hasCover,this),this.checkModal=$t(this.checkModal,this),this.$uploadButton=$t(this.$uploadButton,this),this.header=document.getElementsByClassName("js-forum-cover--header"),this.uploadButton=document.getElementsByClassName("js-forum-cover--upload-button"),this.removeButton=document.getElementsByClassName("js-forum-cover--remove-button"),this.overlay=document.getElementsByClassName("js-forum-cover--overlay"),this.loading=document.getElementsByClassName("js-forum-cover--loading"),this.modal=document.getElementsByClassName("js-forum-cover--modal"),Ht.subscribe("click-menu:current",this.checkModal),Ht(document).on("click",".js-forum-cover--remove-button",this.remove),Ht.subscribe("dragenterGlobal",(t=this,function(){return t.setOverlay("active")})),Ht.subscribe("dragendGlobal",function(t){return function(){return t.setOverlay("hidden")}}(this)),Ht(document).on("dragenter",".js-forum-cover--overlay",function(t){return function(){return t.setOverlay("hover")}}(this)),Ht(document).on("dragleave",".js-forum-cover--overlay",function(t){return function(){return t.setOverlay("active")}}(this)),Ht(document).on("turbolinks:load",this.refresh)}return t.prototype.$uploadButton=function(){return Ht(this.uploadButton[0])},t.prototype.checkModal=function(t,e){if("forum-cover-edit"===e.target)return this.initFileupload()},t.prototype.hasCover=function(){return"post"!==this.uploadButton[0].dataset.customMethod},t.prototype.hasCoverEditor=function(){return this.uploadButton.length>0},t.prototype.isModalOpen=function(t){var e;return!!this.hasCoverEditor()&&"hidden"!==(null!=(e=this.modal[0])?e.dataset.visibility:void 0)},t.prototype.initFileupload=function(){var t,e;if(this.isModalOpen()&&!this.uploadButton[0]._initialized)return this.uploadButton[0]._initialized=!0,t=Ht(".js-forum-cover--modal"),this.$uploadButton().fileupload({method:"POST",paramName:"cover_file",dataType:"json",dropZone:t,submit:(e=this,function(){return e.uploadButton[0].dataset.state="loading"}),done:function(t){return function(e,r){return t.update(r.result)}}(this),fail:_.Jn,complete:function(t){return function(e,r){return t.uploadButton[0].dataset.state=""}}(this)}),this.updateOptions()},t.prototype.setOverlay=function(t){if(this.hasCoverEditor()&&t!==this.overlay[0].getAttribute("data-state"))return this.overlay[0].setAttribute("data-state",t)},t.prototype.update=function(t){return Ht(".js-forum-cover--input").val(t.id),this.uploadButton[0].dataset.url=t.url,this.uploadButton[0].dataset.customMethod=t.method,this.uploadButton[0].dataset.fileUrl=t.fileUrl||"",this.updateOptions(),this.refresh()},t.prototype.updateOptions=function(){if(this.uploadButton[0]._initialized)return this.$uploadButton().fileupload("option",{url:this.uploadButton[0].dataset.url,formData:{_method:this.uploadButton[0].dataset.customMethod}})},t.prototype.remove=function(t){var e;if((t.preventDefault(),this.hasCover())&&confirm(t.currentTarget.dataset.destroyConfirm))return this.removeButton[0].dataset.state="loading",Ht.ajax({url:this.uploadButton[0].dataset.url,method:"delete"}).done((e=this,function(t){return e.update(t)})).always(function(t){return function(){return t.removeButton[0].dataset.state=""}}(this))},t.prototype.refresh=function(){var t,e;if(this.hasCoverEditor())return t=this.uploadButton[0].dataset.fileUrl||this.uploadButton[0].dataset.defaultFileUrl,Ht(this.header).css({backgroundImage:null!=(e=(0,ct.eF)(t))?e:""}),this.removeButton[0].disabled=!this.hasCover(),this.initFileupload()},t}();var Xt=r(9755),Gt=function(t,e){return function(){return t.apply(e,arguments)}};const Kt=function(){function t(t){this.forum=t,this.setPostPosition=Gt(this.setPostPosition,this),this.reset=Gt(this.reset,this),this.jump=Gt(this.jump,this),this.click=Gt(this.click,this),this.move=Gt(this.move,this),this.hideTooltip=Gt(this.hideTooltip,this),this.tooltip=document.getElementsByClassName("js-forum-posts-seek--tooltip"),this.tooltipNumber=document.getElementsByClassName("js-forum-posts-seek-tooltip-number"),this.seekbar=document.getElementsByClassName("js-forum__posts-seek"),Xt(document).on("mousemove",".js-forum__posts-seek",this.move),Xt(document).on("mouseleave",".js-forum__posts-seek",this.hideTooltip),Xt(document).on("click",".js-forum__posts-seek",this.click),Xt(document).on("click",".js-forum-posts-seek--jump",this.jump),addEventListener("turbolinks:before-cache",this.reset)}return t.prototype.hideTooltip=function(){if(0!==this.tooltip.length)return(0,G.U6)(this.tooltip[0])},t.prototype.move=function(t){return t.preventDefault(),t.stopPropagation(),this.setPostPosition(t.clientX),(0,G.Ji)(this.tooltip[0]),Timeout.clear(this._autohide),this._autohide=Timeout.set(1e3,this.hideTooltip)},t.prototype.click=function(){return this.forum.jumpTo(this.postPosition)},t.prototype.jump=function(t){var e,r,i,n,s,o,a,u;return t.preventDefault(),r=this.forum.currentPostPosition,u=this.forum.totalPosts(),e=Xt(t.currentTarget),n=e.attr("data-jump-target"),a=function(){switch(n){case"first":return 1;case"last":return u;case"previous":return i=r-10,o=this.forum.postPosition(this.forum.posts[0]),Math.max(i,o);case"next":return i=r+10,s=this.forum.postPosition(this.forum.endPost()),Math.min(i,s)}}.call(this),e.blur(),this.forum.jumpTo(a)},t.prototype.reset=function(){return Timeout.clear(this._autohide),this.hideTooltip()},t.prototype.setPostPosition=function(t){var e,r,i;return e=t/this.seekbar[0].offsetWidth,i=this.forum.totalPosts(),r=Math.ceil(e*this.forum.totalPosts()),r=Math.min(r,i),this.postPosition=Math.max(r,1),this.tooltip[0].style.transform="translateX("+t+"px)",this.tooltipNumber[0].textContent=this.postPosition},t}();var Qt=r(9755),Yt=function(t,e){return function(){return t.apply(e,arguments)}};const te=function(){function t(t){this.forum=t,this.start=Yt(this.start,this),this.keyup=Yt(this.keyup,this),this.end=Yt(this.end,this),Qt(document).on("click",".js-forum-topic-post-jump--cover",this.start),Qt(document).on("blur",".js-forum-topic-post-jump--input",this.end),Qt(document).on("keyup",".js-forum-topic-post-jump--input",this.keyup),Qt.subscribe("forum:topic:jumpTo",this.end)}return t.prototype.end=function(){return Qt(".js-forum-topic-post-jump--container").removeClass("js-forum-topic-post-jump--container-focus"),Qt(".js-forum-topic-post-jump--cover").show(),Qt(".js-forum-topic-post-jump--counter").show(),Qt(".js-forum-topic-post-jump--input").hide()},t.prototype.keyup=function(t){var e,r,i;if("Escape"!==t.key){if(r=(i=(e=t.currentTarget).value).replace(/\D/g,""),i!==r)return e.value=r}else Qt(t.currentTarget).blur()},t.prototype.start=function(){var t;return Qt(".js-forum-topic-post-jump--container").addClass("js-forum-topic-post-jump--container-focus"),Qt(".js-forum-topic-post-jump--cover").hide(),Qt(".js-forum-topic-post-jump--counter").hide(),(t=Qt(".js-forum-topic-post-jump--input").val(this.forum.currentPostPosition).show().focus())[0].selectionStart=0,t[0].selectionEnd=t.val().length},t}();var ee=r(9755),re=function(t,e){return function(){return t.apply(e,arguments)}};const ie=function(){function t(t){this.bbcodePreview=t.bbcodePreview,this.forum=t.forum,this.stickyFooter=t.stickyFooter,this.toggleStick=re(this.toggleStick,this),this.toggleDeactivate=re(this.toggleDeactivate,this),this.toggle=re(this.toggle,this),this.stickOrUnstick=re(this.stickOrUnstick,this),this.posted=re(this.posted,this),this.enableFlash=re(this.enableFlash,this),this.deactivate=re(this.deactivate,this),this.activateWithReply=re(this.activateWithReply,this),this.activate=re(this.activate,this),this.setState=re(this.setState,this),this.getState=re(this.getState,this),this.deleteState=re(this.deleteState,this),this.available=re(this.available,this),this.initialize=re(this.initialize,this),this.container=document.getElementsByClassName("js-forum-topic-reply--container"),this.box=document.getElementsByClassName("js-forum-topic-reply"),this.block=document.getElementsByClassName("js-forum-topic-reply--block"),this.input=document.getElementsByClassName("js-forum-topic-reply--input"),this.toggleButtons=document.getElementsByClassName("js-forum-topic-reply--toggle"),this.fixedBar=document.getElementsByClassName("js-sticky-footer--fixed-bar"),ee(document).on("ajax:success",".js-forum-topic-reply",this.posted),ee(document).on("click",".js-forum-topic-reply--deactivate",this.toggleDeactivate),ee(document).on("click",".js-forum-topic-reply--toggle",this.toggle),ee(document).on("ajax:success",".js-forum-topic-reply--quote",this.activateWithReply),ee(document).on("focus",".js-forum-topic-reply--input",this.activate),ee.subscribe("stickyFooter",this.stickOrUnstick),ee(document).on("turbolinks:load",this.initialize)}return t.prototype.marker=function(){return document.querySelector('.js-sticky-footer[data-sticky-footer-target="forum-topic-reply"]')},t.prototype.$input=function(){return ee(".js-forum-topic-reply--input")},t.prototype.initialize=function(){if(this.available())return this.deleteState("sticking"),"1"===this.getState("active")?this.activate():void 0},t.prototype.available=function(){return this.block.length},t.prototype.deleteState=function(t){return localStorage.removeItem("forum-topic-reply--"+(0,p.JJ)().pathname+"--"+t)},t.prototype.getState=function(t){return localStorage.getItem("forum-topic-reply--"+(0,p.JJ)().pathname+"--"+t)},t.prototype.setState=function(t,e){return localStorage.setItem("forum-topic-reply--"+(0,p.JJ)().pathname+"--"+t,e)},t.prototype.activate=function(){var t,e,r,i;for(this.setState("active","1"),this.stickyFooter.markerEnable(this.marker()),ee.publish("stickyFooter:check"),t=0,e=(r=this.toggleButtons).length;t<e;t++)r[t].classList.add("js-activated");return"1"!==this.getState("sticking")&&null!=currentUser.id&&this.enableFlash(),Timeout.set(0,(i=this,function(){return i.input[0].focus()}))},t.prototype.activateWithReply=function(t,e){var r,i;return e+="\n",(i=(r=this.$input()).val())&&(e=i+"\n"+e),r.val(e).trigger("input"),r[0].selectionStart=e.length,this.activate()},t.prototype.deactivate=function(){var t,e,r,i,n;for(this.stickyFooter.markerDisable(this.marker()),this.setState("active","0"),ee.publish("stickyFooter:check"),this.disableFlash(),n=[],e=0,r=(i=this.toggleButtons).length;e<r;e++)t=i[e],n.push(t.classList.remove("js-activated"));return n},t.prototype.disableFlash=function(){return ee(".js-forum-topic-reply").removeClass("js-forum-topic-reply-flash")},t.prototype.enableFlash=function(){return ee(".js-forum-topic-reply").addClass("js-forum-topic-reply-flash"),Timeout.set(500,this.disableFlash)},t.prototype.posted=function(t,e){var r,i;return i=this.input[0],this.deactivate(),i.value="",this.bbcodePreview.hidePreview({target:i}),r=ee(e),this.forum.postPosition(r[0])-1!==this.forum.postPosition(this.forum.endPost())||"1"===t.target.dataset.forceReload?(0,p.c4)(r.find(".js-post-url").attr("href")):(this.forum.setTotalPosts(this.forum.totalPosts()+1),this.forum.endPost().insertAdjacentHTML("afterend",e),this.forum.endPost().scrollIntoView())},t.prototype.stickOrUnstick=function(t,e){var r;return r=osuCore.windowSize.isDesktop?"forum-topic-reply"===e:"1"===this.getState("active"),this.toggleStick(r)},t.prototype.toggle=function(){return"1"===this.getState("active")?this.deactivate():this.activate()},t.prototype.toggleDeactivate=function(t){return t.stopPropagation(),this.deactivate()},t.prototype.toggleStick=function(t){var e,r,i,n,s;if(n="1"===this.getState("sticking"),document.body.style.overflow=!t||osuCore.windowSize.isDesktop?"":"hidden",t!==n)return r=this.box[0],t?(this.setState("sticking","1"),r.dataset.state="stick",s=this.fixedBar[0]):(this.deleteState("sticking"),null!=r.dataset.state&&delete r.dataset.state,s=this.container[0]),i=(e=this.$input()).is(":focus"),s.insertBefore(r,s.firstChild),i?e.focus():void 0},t}();var ne=r(9755),se=function(t,e){return function(){return t.apply(e,arguments)}};const oe=function(){function t(){this.save=se(this.save,this),this.onKeyup=se(this.onKeyup,this),this.onInput=se(this.onInput,this),this.editShow=se(this.editShow,this),this.cancel=se(this.cancel,this),this.abort=se(this.abort,this),this.input=document.getElementsByClassName("js-forum-topic-title--input"),this.saveButton=document.getElementsByClassName("js-forum-topic-title--save"),this.title=document.getElementsByClassName("js-forum-topic-title--title"),this.toggleables=document.getElementsByClassName("js-forum-topic-title--toggleable"),addEventListener("turbolinks:before-cache",this.abort),ne(document).on("click",".js-forum-topic-title--edit-start",this.editShow),ne(document).on("click",".js-forum-topic-title--save",this.save),ne(document).on("keyup",".js-forum-topic-title--input",this.onKeyup),ne(document).on("click",".js-forum-topic-title--cancel",this.cancel),ne(document).on("input",".js-forum-topic-title--input",this.onInput)}return t.prototype.abort=function(){var t;return null!=(t=this.xhr)?t.abort():void 0},t.prototype.cancel=function(){return this.abort(),ne(this.toggleables).removeAttr("data-title-edit"),this.input[0].value=this.input[0].defaultValue},t.prototype.editShow=function(){return ne(this.toggleables).attr("data-title-edit",1),this.input[0].selectionStart=this.input[0].value.length,this.input[0].focus()},t.prototype.onInput=function(){return this.saveButton[0].disabled=!(0,W.W)(this.input[0].value)},t.prototype.onKeyup=function(t){switch(t.key){case"Enter":return this.save();case"Escape":return this.cancel()}},t.prototype.save=function(){var t,e,r,i;if(e=(t=this.input[0]).value,null!=(0,W.G)(e))return e===t.defaultValue?this.cancel():(t.disabled=!0,this.saveButton[0].disabled=!0,this.abort(),this.xhr=ne.ajax(t.dataset.url,{method:"PUT",data:(r={},r[""+t.name]=e,r)}).done((function(){return(0,p.sl)()})).fail((i=this,function(e){return t.disabled=!1,i.saveButton[0].disabled=!1,(0,_.hd)()(e)})))},t}();var ae=r(9755),ue=function(t,e){return function(){return t.apply(e,arguments)}};const le=function(){function t(){this.shouldContinue=ue(this.shouldContinue,this),this.loading=ue(this.loading,this),this.fail=ue(this.fail,this),this.done=ue(this.done,this),this.abortAll=ue(this.abortAll,this),ae(document).on("ajax:before",".js-forum-topic-watch-ajax",this.shouldContinue),ae(document).on("ajax:send",".js-forum-topic-watch-ajax",this.loading),ae(document).on("ajax:error",".js-forum-topic-watch-ajax",this.fail),ae(document).on("ajax:success",".js-forum-topic-watch-ajax",this.done),this.xhr=[],this.unknownState=!1}return t.prototype.abortAll=function(){var t,e;for(t=[];null!=(e=this.xhr.pop());)t.push(e.abort());return t},t.prototype.done=function(){return this.unknownState=!1},t.prototype.fail=function(t,e,r){var i;i=t.currentTarget,"abort"===r&&(i.dataset.skipAjaxErrorPopup="1"),i.classList.remove("js-forum-topic-watch-ajax--loading"),i.disabled=!1},t.prototype.loading=function(t,e){var r;this.unknownState=!0,this.abortAll(),this.xhr.push(e),(0,E.Lt)(),(r=t.currentTarget).dataset.skipAjaxErrorPopup="0",r.classList.add("js-forum-topic-watch-ajax--loading"),r.disabled=!0},t.prototype.shouldContinue=function(t){return this.unknownState||"1"!==t.currentTarget.dataset.forumTopicWatchAjaxIsActive},t}();var ce=r(7294),he=r(9139),de=r(9755);class pe extends ce.PureComponent{constructor(t){super(t),Object.defineProperty(this,"eventId",{enumerable:!0,configurable:!0,writable:!0,value:`gallery-contest-${(0,he.d)()}`}),Object.defineProperty(this,"mainRef",{enumerable:!0,configurable:!0,writable:!0,value:ce.createRef()}),Object.defineProperty(this,"buttonState",{enumerable:!0,configurable:!0,writable:!0,value:()=>{const t=this.button();return null!=t&&null!=t.dataset.contestVoteMeta?JSON.parse(t.dataset.contestVoteMeta):{hasVote:!1,isLoading:!1,isSelected:!1,votingOver:!1}}}),Object.defineProperty(this,"buttonTitle",{enumerable:!0,configurable:!0,writable:!0,value:()=>{if(!this.state.isLoading&&!this.state.button.votingOver)return this.state.button.isSelected?(0,m.dW)("contest.voting.button.remove"):this.state.button.hasVote?(0,m.dW)("contest.voting.button.add"):(0,m.dW)("contest.voting.button.used_up")}}),Object.defineProperty(this,"isDisabled",{enumerable:!0,configurable:!0,writable:!0,value:()=>this.state.isLoading||this.state.button.votingOver||!this.state.button.isSelected&&!this.state.button.hasVote}),Object.defineProperty(this,"loadingEnd",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.setState({isLoading:!1}),this.syncState()}}),Object.defineProperty(this,"loadingStart",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.setState({isLoading:!0})}}),Object.defineProperty(this,"mainClass",{enumerable:!0,configurable:!0,writable:!0,value:()=>{let t="pswp__button pswp__button--contest-vote js-gallery-extra";return this.state.button.isSelected&&(t+=" pswp__button--contest-vote-active"),this.isDisabled()&&(t+=" pswp__button--disabled"),t}}),Object.defineProperty(this,"resetTooltip",{enumerable:!0,configurable:!0,writable:!0,value:()=>{const t=this.mainRef.current;null!=t&&tooltipDefault.remove(t)}}),Object.defineProperty(this,"syncState",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.setState({button:this.buttonState()})}}),Object.defineProperty(this,"vote",{enumerable:!0,configurable:!0,writable:!0,value:()=>{if(this.isDisabled())return;const t=this.button();null!=t&&t.click()}}),this.state={button:this.buttonState(),isLoading:!1}}componentDidMount(){de.subscribe(`contest:vote:click.${this.eventId}`,this.loadingStart),de.subscribe(`contest:vote:end.${this.eventId}`,this.loadingEnd),this.props.pswp.listen("afterChange",this.syncState)}componentDidUpdate(){this.resetTooltip()}componentWillUnmount(){de.unsubscribe(`.${this.eventId}`)}render(){return ce.createElement("button",{ref:this.mainRef,className:this.mainClass(),onClick:this.vote,title:this.buttonTitle()},ce.createElement("span",{className:this.iconClass()}))}button(){if(null==this.props.pswp.currItem)return;const t=this.props.pswp.currItem.element.dataset.buttonId;return document.querySelector(`.js-contest-vote-button[data-button-id='${t}']`)}iconClass(){return this.state.isLoading?"fas fa-sync fa-spin":"fas fa-star"}}var me=r(7735),fe=r(9755);class ge extends ce.PureComponent{constructor(t){super(t),Object.defineProperty(this,"getVoteState",{enumerable:!0,configurable:!0,writable:!0,value:()=>{var t;return JSON.parse(null!==(t=this.voteSummary().dataset.contestVoteSummary)&&void 0!==t?t:"")}}),Object.defineProperty(this,"syncState",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.setState(this.getVoteState())}}),Object.defineProperty(this,"voteSummary",{enumerable:!0,configurable:!0,writable:!0,value:()=>{const t=document.querySelector(".js-contest-vote-summary");if(t instanceof HTMLElement)return t;throw new Error(".js-contest-vote-summary is not HTMLElement")}}),this.state=this.getVoteState()}componentDidMount(){fe.subscribe("contest:vote:end",this.syncState)}componentWillUnmount(){fe.unsubscribe("contest:vote:end",this.syncState)}render(){return ce.createElement("div",{className:"pswp__button pswp__button--vote-progress"},ce.createElement(me.D,{current:this.state.voteCount,max:this.state.maxVotes,theme:"gallery-contest",tooltip:(0,m.dW)("contest.voting.progress._",{max:this.state.maxVotes,used:this.state.voteCount})}))}}var ve=r(3935),be=r(9755);class ye{constructor(t,e){Object.defineProperty(this,"eventId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"root",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"destroy",{enumerable:!0,configurable:!0,writable:!0,value:()=>{(0,ve.unmountComponentAtNode)(this.root),be(document).off(`.${this.eventId}`)}}),this.root=t.querySelector(".js-pswp-buttons"),(0,ve.render)(ce.createElement(ce.Fragment,null,ce.createElement(pe,{pswp:e}),ce.createElement(ge,null)),this.root),this.eventId=`gallery-contest-${(0,he.d)()}`,be(document).on(`turbolinks:before-cache.${this.eventId}`,this.destroy),e.listen("destroy",this.destroy)}}var we=r(8832),ke=r.n(we),je=r(8411),_e=r.n(je),Ee=r(9755),xe=r(6486),Se=function(t,e){return function(){return t.apply(e,arguments)}};const Pe=function(){function t(){this.switchPreview=Se(this.switchPreview,this),this.thumbBoundsFn=Se(this.thumbBoundsFn,this),this.open=Se(this.open,this),this.initiateOpen=Se(this.initiateOpen,this),this.container=document.getElementsByClassName("pswp"),Ee(document).on("click",".js-gallery",this.initiateOpen),Ee(document).on("click",".js-gallery-thumbnail",this.switchPreview),Ee(document).on("turbolinks:before-cache",(function(){return Ee(".js-gallery--container").remove()}))}return t.prototype.initiateOpen=function(t){var e,r,i;if(!(e=Ee(t.currentTarget)).parents("a").length)return t.preventDefault(),i=parseInt(e.attr("data-index"),10),r=e.attr("data-gallery-id"),this.open({galleryId:r,index:i})},t.prototype.open=function(t){var e,r,i,n;return r=t.galleryId,i=t.index,(e=this.container[0].cloneNode(!0)).classList.add("js-gallery--container"),document.body.appendChild(e),n=new(ke())(e,_e(),this.data(r),{showHideOpacity:!0,getThumbBoundsFn:this.thumbBoundsFn(r),index:i,history:!1,timeToIdle:null}),xe.startsWith(r,"contest-")&&new ye(e,n),n.init(),Ee(document).one("gallery:close",(function(){try{return n.close()}catch(t){}}))},t.prototype.data=function(t){var e,r,i,n,s,o,a;for(o=[],r=0,i=(n=document.querySelectorAll(".js-gallery[data-gallery-id='"+t+"']")).length;r<i;r++)a=null!=(s=(e=n[r]).getAttribute("data-src"))?s:e.getAttribute("href"),o.push({element:e,msrc:a,src:a,w:parseInt(e.getAttribute("data-width"),10),h:parseInt(e.getAttribute("data-height"),10)});return o},t.prototype.thumbBoundsFn=function(t){return function(e){var r,i,n,s,o,a,u;return u=(r=Ee(".js-gallery[data-gallery-id='"+t+"'][data-index='"+e+"']")).offset(),a=[r.width(),r.height()],i=[u.left+a[0]/2,u.top+a[1]/2],n=[parseInt(r.attr("data-width"),10),parseInt(r.attr("data-height"),10)],s=Math.max(a[0]/n[0],a[1]/n[1]),o=n.map((function(t){return t*s})),{x:i[0]-o[0]/2,y:i[1]-o[1]/2,w:o[0]}}},t.prototype.switchPreview=function(t){var e,r,i,n,s,o,a,u,l,c;for(t.preventDefault(),i=(u=Ee(t.currentTarget)[0].dataset).galleryId,n=u.index,r=Ee(".js-gallery[data-gallery-id='"+i+"']"),e=Ee(".js-gallery-thumbnail[data-gallery-id='"+i+"']"),c=[],s=0,o=(l=xe.zip(e,r)).length;s<o;s++)n===(a=l[s])[0].dataset.index?(a[0].classList.add("js-gallery-thumbnail--active"),c.push((0,G.Ji)(a[1]))):(a[0].classList.remove("js-gallery-thumbnail--active"),c.push((0,G.U6)(a[1])));return c},t}();var Ce=r(9755),Te=function(t,e){return function(){return t.apply(e,arguments)}};const Oe=function(){function t(){this.dragend=Te(this.dragend,this),this.dragenter=Te(this.dragenter,this),Ce(document).on("dragenter",this.dragenter),Ce(document).on("dragover",this.dragend)}return t.prototype.dragenter=function(){if(!this.dragging)return this.dragging=!0,Ce.publish("dragenterGlobal")},t.prototype.dragend=function(t){var e,r;if(this.dragging)return r=this,e=function(){return r.dragging=!1,Ce.publish("dragendGlobal")},Timeout.clear(this.dragendTimer),this.dragendTimer=Timeout.set(100,e)},t}();var Me=r(7543);const Le=0,Ne=0,Ie=0,De=40;class Be{constructor(){Object.defineProperty(this,"area",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"data",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"height",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"maxElem",{enumerable:!0,configurable:!0,writable:!0,value:{x:0,y:0}}),Object.defineProperty(this,"peakTextLength",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"scaleX",{enumerable:!0,configurable:!0,writable:!0,value:Me.scaleLinear()}),Object.defineProperty(this,"scaleY",{enumerable:!0,configurable:!0,writable:!0,value:Me.scaleTime()}),Object.defineProperty(this,"svg",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"svgArea",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"svgContainerInner",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"svgContainerOuter",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"svgPeakCircle",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"svgPeakText",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"width",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"resize",{enumerable:!0,configurable:!0,writable:!0,value:()=>{0!==this.data.length&&(this.width=parseInt(this.svgContainerOuter.style("width"),10)-Ne-Ie,this.height=parseInt(this.svgContainerOuter.style("height"),10)-De-Le,this.scaleX.range([0,this.width]),this.scaleY.range([this.height,0]),this.svgContainerInner.attr("width",this.width+Ne+Ie).attr("height",this.height+De+Le),this.svgArea.datum(this.data).attr("d",this.area),this.svgPeakCircle.attr("cx",this.scaleX(this.maxElem.x)),this.svgPeakText.attr("x",(()=>{const t=this.scaleX(this.maxElem.x)+10;return this.peakTextLength+t>this.width?this.scaleX(this.maxElem.x)-(this.peakTextLength+10):t})))}}),this.svgContainerOuter=Me.select(".js-landing-graph"),this.svgContainerOuter.selectAll("svg").remove(),this.svgContainerInner=this.svgContainerOuter.append("svg").attr("class","landing-graph"),this.svg=this.svgContainerInner.append("g").attr("transform",`translate(${Ne}, ${De+1})`),this.svgArea=this.svg.append("path").attr("class","landing-graph__area"),this.svgPeakText=this.svg.append("text").attr("class","landing-graph__text").attr("y",-10),this.svgPeakCircle=this.svg.append("circle").attr("class","landing-graph__circle").attr("cy",0).attr("r",5),this.area=Me.area().curve(Me.curveBasis).x((t=>this.scaleX(t.x))).y0((()=>this.height)).y1((t=>this.scaleY(t.y))),this.loadData(),this.resize()}loadData(){var t,e,r;if(this.data=(0,K.Mo)("json-stats"),0===this.data.length)return;this.maxElem=null!==(t=(0,lt.maxBy)(this.data,(t=>t.y)))&&void 0!==t?t:this.data[0];const i=Me.extent(this.data,(t=>t.x));this.scaleX.domain([null!==(e=i[0])&&void 0!==e?e:0,null!==(r=i[1])&&void 0!==r?r:0]),this.scaleY.domain([0,this.maxElem.y]),this.svgPeakText.text((0,m.dW)("home.landing.peak",{count:(0,P.uf)(this.maxElem.y)}));const n=this.svgPeakText.node();if(null==n)throw new Error("peak text node is missing");this.peakTextLength=n.getComputedTextLength()}}var Re=r(9755),Ue=function(t,e){return function(){return t.apply(e,arguments)}};const qe=function(){function t(){this.resize=Ue(this.resize,this),this.initialize=Ue(this.initialize,this),Re(window).on("resize",this.resize),Re(document).on("turbolinks:load",this.initialize)}return t.prototype.container=document.getElementsByClassName("js-landing-graph"),t.prototype.initialize=function(){var t;if(null!=this.container[0])return null!=(t=this.container[0])._chart?t._chart:t._chart=new Be},t.prototype.resize=function(){var t;if(null!=this.container[0])return null!=(t=this.container[0]._chart)?t.resize():void 0},t}();var Ae=r(9755),ze=function(t,e){return function(){return t.apply(e,arguments)}};const Fe=function(){function t(){this.setMenu=ze(this.setMenu,this),this.refresh=ze(this.refresh,this),this.hideMenu=ze(this.hideMenu,this),this.onMouseLeave=ze(this.onMouseLeave,this),this.onMouseEnter=ze(this.onMouseEnter,this),this.onTouchStart=ze(this.onTouchStart,this),this.onGlobalTouchstart=ze(this.onGlobalTouchstart,this),this.onDocumentReady=ze(this.onDocumentReady,this),this.currentTree=ze(this.currentTree,this),this.defaultMenu=ze(this.defaultMenu,this),this.menuTimeout=150,Ae(document).on("touchstart",".js-menu",this.onTouchStart),Ae(document).on("mouseenter",".js-menu",this.onMouseEnter),Ae(document).on("mouseleave",".js-menu",this.onMouseLeave),Ae(document).on("touchstart",this.onGlobalTouchstart),Ae(document).on("turbolinks:load",this.onDocumentReady)}return t.prototype.$menuLink=function(t){return Ae(".js-menu[data-menu-target"+(t?"='"+t+"'":"")+"]")},t.prototype.closestMenuId=function(t){return t.closest("[data-menu-id]").attr("data-menu-id")},t.prototype.defaultMenu=function(){var t,e;return null!=(t=document.querySelector('.js-menu[data-menu-default="1"]'))&&null!=(e=t.dataset)?e.menuTarget:void 0},t.prototype.parentsMenuId=function(t){return t.parents("[data-menu-id]").attr("data-menu-id")},t.prototype.currentTree=function(){var t,e;if(!this.currentMenu)return[];for(t=[e=this.currentMenu];e=this.closestMenuId(this.$menuLink(e));)t.push(e);return t},t.prototype.onDocumentReady=function(){return this.refresh(),this.setMenu(null,(t=this,function(){return t.closestMenuId(Ae(":hover").last())}));var t},t.prototype.onGlobalTouchstart=function(t){if(this.currentMenu&&null==t.target.closest(".js-menu"))return this.hideMenu()},t.prototype.onTouchStart=function(t){var e,r,i,n,s,o;if(r=t.currentTarget,null!=(n=r.dataset.menuTarget))return e=Ae(n),t.preventDefault(),s=parseInt(null!=(i=r.dataset.menuShowDelay)?i:this.menuTimeout,10),this.setMenu(s,(o=this,function(){return o.currentMenu===n?o.closestMenuId(e):n}))},t.prototype.onMouseEnter=function(t){var e,r,i,n;return e=t.currentTarget,i=parseInt(null!=(r=e.dataset.menuShowDelay)?r:this.menuTimeout,10),this.setMenu(i,(n=this,function(){var t;return null!=(t=e.dataset.menuTarget)?t:n.closestMenuId(Ae(e))}))},t.prototype.onMouseLeave=function(t){var e,r;return e=Ae(t.currentTarget),this.setMenu(null,(r=this,function(){return r.parentsMenuId(e)}))},t.prototype.hideMenu=function(){return this.setMenu()},t.prototype.refresh=function(){var t,e,r,i,n,s,o;for(null==this.currentMenu&&(this.currentMenu=this.defaultMenu()),s=document.querySelectorAll(".js-menu[data-menu-id]"),t=this.currentTree(),Ae.publish("menu:current",this.currentMenu),o=[],e=0,r=s.length;e<r;e++)n=(i=s[e]).getAttribute("data-menu-id"),-1===t.indexOf(n)?((0,G.U6)(i),o.push(this.$menuLink(n).removeClass("js-menu--active"))):((0,G.Ji)(i),this.$menuLink(n).addClass("js-menu--active"),o.push(Ae(i).trigger("menu:showing")));return o},t.prototype.setMenu=function(t,e){return null==t&&(t=this.menuTimeout),Timeout.clear(this.refreshTimeout),this.refreshTimeout=Timeout.set(t,(r=this,function(){return r.currentMenu="function"==typeof e?e():void 0,r.refresh()}));var r},t}();var We=r(9755),Ve=function(t,e){return function(){return t.apply(e,arguments)}};const Ze=function(){function t(){this.hideOrShow=Ve(this.hideOrShow,this),this.load=Ve(this.load,this),this.containers=document.getElementsByClassName("js-nav-button--container"),this.items=document.getElementsByClassName("js-nav-button--item"),this.main=document.getElementsByClassName("js-nav-button"),addEventListener("turbolinks:load",this.load)}return t.prototype.load=function(){var t,e,r,i;if(this.listening||(this.listening=!0,We(window).on("resize",this.hideOrShow)),0!==this.main.length){for(this.itemWidth=this.items[0].offsetWidth,this.defaultWidth=0,e=0,r=(i=this.containers).length;e<r;e++)t=i[e],this.defaultWidth+=t.offsetWidth;return this.hideOrShow()}},t.prototype.hideOrShow=function(){var t,e,r,i,n,s,o,a,u;if(0!==this.main.length){for(t=this.main[0].offsetWidth,e=this.defaultWidth,i=0,s=(a=this.items).length;i<s;i++)a[i].classList.remove("hidden");if(t<e)for(n=0,o=(u=this.items).length;n<o;n++)if(r=u[n],e-=this.itemWidth,r.classList.add("hidden"),t>=e)return}},t}();var He=r(9755),$e=r(6486),Je=function(t,e){return function(){return t.apply(e,arguments)}};const Xe=function(){function t(t){this.clickMenu=t,this.showMenuBg=Je(this.showMenuBg,this),this.loginBoxVisible=Je(this.loginBoxVisible,this),this.autoMobileNav=Je(this.autoMobileNav,this),this.autoCenterPopup=Je(this.autoCenterPopup,this),this.menuBg=document.getElementsByClassName("js-nav2--menu-bg"),He.subscribe("click-menu:current",this.autoCenterPopup),He.subscribe("click-menu:current",this.autoMobileNav),He.subscribe("menu:current",this.showMenuBg)}return t.prototype.autoCenterPopup=function(t,e){var r,i,n,s,o,a,u,l,c,h,d;for(h=e.target,this.currentMenu=h,He(window).off("resize.nav2-center-popup"),s=0,o=(l=document.querySelectorAll(".js-nav2--centered-popup")).length;s<o;s++)null!=(r=(u=l[s]).closest(".js-click-menu"))&&(r.dataset.clickMenuId===this.currentMenu?(u.classList.remove("hidden"),i=u,a=document.querySelector(".js-click-menu[data-click-menu-target='"+this.currentMenu+"']")):u.classList.add("hidden"));if(null!=i)return d=this,n=function(){return d.centerPopup(i,a)},He(window).on("resize.nav2-center-popup",n),n(),null!=(c=i.querySelector(".js-nav2--autofocus"))?c.focus():void 0},t.prototype.autoMobileNav=function(t,e){var r,i,n,s;return r=e.previousTree,i=e.target,n=e.tree,"mobile-menu"===i&&(this.clickMenu.show("mobile-nav"),Timeout.set(0,(s=this,function(){return He(s.clickMenu.menu("mobile-menu")).finish().slideDown(150)}))),this.showingMobileNav=-1!==n.indexOf("mobile-menu"),this.showingMobileNav?(document.body.classList.add("js-nav2--active"),(0,Bt.C)()):-1!==r.indexOf("mobile-menu")?((0,Bt.M6)(),Timeout.set(0,function(t){return function(){return He(t.clickMenu.menu("mobile-menu")).finish().slideUp(150,(function(){return document.body.classList.toggle("js-nav2--active",t.showingMobileNav)}))}}(this))):void 0},t.prototype.centerPopup=function(t,e){var r,i,n,s,o,a,u,l,c,h,d,p;return l=t.getBoundingClientRect(),n=t.parentElement.getBoundingClientRect(),p=e.getBoundingClientRect(),r=document.body.getBoundingClientRect().width-5,d=p.width/2,s=l.width/2,i=(u=(o=n.left)+(a=p.left+d-o-s))<0?-1*p.left:(h=u+l.width,(c=Math.round(h-r))>0?a-c:a),i=Math.floor(i),t.style.transform="translateX("+i+"px)"},t.prototype.loginBoxVisible=function(){return"nav2-login-box"===this.currentMenu},t.prototype.showMenuBg=function(t,e){var r;return r=$e.startsWith(e,"nav2-menu-popup-"),(0,G.Eo)(this.menuBg[0],r)},t}();var Ge=r(6486),Ke=r(9755);const Qe=function(){function t(){var t,e,r;this.loadPreview=(t=this.loadPreview,e=this,function(){return t.apply(e,arguments)}),this.debouncedLoadPreview=Ge.debounce(this.loadPreview,500),Ke(document).on("input",".js-post-preview--auto",(r=this,function(t){return r.debouncedLoadPreview(t.currentTarget)}))}return t.prototype.loadPreview=function(t){var e,r,i,n,s,o;if(e=Ke(t).closest("form"),n=t.value,s=(r=e.find(".js-post-preview--preview"))[0],i=e.find(".js-post-preview--box"),null!=s)if(null!=(o=s._xhr)&&o.abort(),""!==n){if(r.attr("data-raw")!==n)return s._xhr=Ke.post((0,f.B)("bbcode-preview"),{text:n}).done((function(t){return r.html(t),r.attr("data-raw",n),i.removeClass("hidden")}));i.removeClass("hidden")}else i.addClass("hidden")},t}();var Ye=r(6486),tr=r(9755),er=r(2918),rr=function(t,e){return function(){return t.apply(e,arguments)}};const ir=function(){function t(){this.restoreFocus=rr(this.restoreFocus,this),this.searchingToggle=rr(this.searchingToggle,this),this.submit=rr(this.submit,this),this.submitForm=rr(this.submitForm,this),this.submitInput=rr(this.submitInput,this),this.maybeSubmitInput=rr(this.maybeSubmitInput,this),this.forumPostReset=rr(this.forumPostReset,this),this.debouncedSubmitInput=Ye.debounce(this.submitInput,500),tr(document).on("click",".js-search--forum-options-reset",this.forumPostReset),tr(document).on("input",".js-search--input",this.debouncedSubmitInput),tr(document).on("keydown",".js-search--input",this.maybeSubmitInput),tr(document).on("submit",".js-search",this.submitForm),addEventListener("turbolinks:load",this.restoreFocus)}return t.prototype.forumPostReset=function(){var t;return(t=tr(".js-search")).find("[name=username], [name=forum_id]").val(""),t.find("[name=forum_children]").prop("checked",!1)},t.prototype.maybeSubmitInput=function(t){if("Enter"===t.key)return t.preventDefault(),t.target.blur(),this.submitInput(t)},t.prototype.submitInput=function(t){var e,r,i;if(""!==(i=(e=t.currentTarget).value.trim())&&i!==(null!=(r=e.dataset.searchCurrent)?r.trim():void 0))return e.dataset.searchCurrent=i,this.submit()},t.prototype.submitForm=function(t){return t.preventDefault(),this.submit()},t.prototype.submit=function(){var t,e;return this.searchingToggle(!0),t=tr(".js-search").serialize(),tr(document).one("turbolinks:before-cache",(e=this,function(){return e.activeElement=document.activeElement,e.searchingToggle(!1)})),er.visit("?"+t)},t.prototype.searchingToggle=function(t){return tr(".js-search--header").toggleClass("js-search--searching",t)},t.prototype.restoreFocus=function(){var t;return null!=(t=this.activeElement)&&t.focus(),this.activeElement=null},t}();var nr=r(6486),sr=r(9755);const or=function(){function t(){var t,e;this.stickOrUnstick=(t=this.stickOrUnstick,e=this,function(){return t.apply(e,arguments)}),this.stickMarker=document.getElementsByClassName("js-sticky-footer"),this.permanentFixedFooter=document.getElementsByClassName("js-permanent-fixed-footer"),this.throttledStickOrUnstick=nr.throttle(this.stickOrUnstick,100),sr(window).on("scroll resize",this.stickOrUnstick),sr.subscribe("stickyFooter:check",this.throttledStickOrUnstick),sr(document).on("turbolinks:load",this.throttledStickOrUnstick)}return t.prototype.stickOrUnstick=function(){var t,e,r,i,n;if(0!==this.stickMarker.length){for(t=window.innerHeight-this.permanentFixedFooter[0].offsetHeight,e=0,r=(n=this.stickMarker).length;e<r;e++)if("1"!==(i=n[e]).getAttribute("data-sticky-footer-disabled")&&i.getBoundingClientRect().top>=t)return void sr.publish("stickyFooter",i.getAttribute("data-sticky-footer-target"));return sr.publish("stickyFooter")}},t.prototype.markerCheckEnabled=function(t){return"1"===t.getAttribute("data-sticky-footer-disabled")},t.prototype.markerDisable=function(t){return t.setAttribute("data-sticky-footer-disabled","1")},t.prototype.markerEnable=function(t){return t.setAttribute("data-sticky-footer-disabled","")},t}();var ar=r(9755),ur=function(){function t(){}return t.fetchApprovalLink=function(t){return new Promise((function(e,r){return ar.post((0,f.B)("payments.paypal.create"),{order_id:t}).done(e).fail((function(t){return r({xhr:t})}))}))},t}(),lr=r(9755),cr=function(){function t(){}return t.promiseInit=function(e){return Promise.all([t.fetchToken(e),t.fetchScript()]).then((function(r){return t.onXsollaReady(e),XPayStationWidget.init(r[0])}))},t.fetchScript=function(){var t;return null!=(t=L.Z.turbolinksReload.load("https://static.xsolla.com/embed/paystation/1.0.7/widget.min.js"))?t:Promise.resolve()},t.fetchToken=function(t){return new Promise((function(e,r){return lr.post((0,f.B)("payments.xsolla.token"),{orderNumber:t}).done((function(t){return e(t)})).fail((function(t){return r({xhr:t})}))}))},t.onXsollaReady=function(t){var e;return e=!1,XPayStationWidget.on(XPayStationWidget.eventTypes.STATUS_DONE,(function(){return e=!0})),XPayStationWidget.on(XPayStationWidget.eventTypes.CLOSE,(function(){if(e)return(0,E.Uq)(),E.Uq.flush(),window.location=(0,f.B)("payments.xsolla.completed",{foreignInvoice:t})}))},t}(),hr=r(9755),dr=r(6486),pr=function(){function t(){}return t.CHECKOUT_SELECTOR=".js-store-checkout-button",t.initialize=function(){var e,r,i,n,s,o,a;for(i={},r=0,n=(a=document.querySelectorAll(t.CHECKOUT_SELECTOR)).length;r<n;r++)switch(e=a[r],o=e.dataset.provider,s=e.dataset.orderNumber,o){case"centili":i.centili=Promise.resolve();break;case"free":i.free=Promise.resolve();break;case"paypal":i.paypal=Promise.resolve();break;case"xsolla":i.xsolla=cr.promiseInit(s)}return hr(t.CHECKOUT_SELECTOR).on("click.checkout",(function(e){var r,n,s;if(n=e.target.dataset,r=n.orderId,null!=(o=n.provider))return(0,E.Uq)(),E.Uq.flush(),null!=(s=i[o])?s.then((function(){var t,e;return t=null!=(e=document.querySelector(".js-hide-from-activity"))?e.checked:void 0,hr.post((0,f.B)("store.checkout.store"),{hide_from_activity:t,provider:o,orderId:r})})).then((function(){return t.startPayment(e.target.dataset)})).catch(t.handleError):void 0}))},t.startPayment=function(t){var e,r,i;switch(e=t.orderId,r=t.provider,i=t.url,r){case"centili":return new Promise((function(t){return window.location.href=i}));case"paypal":return ur.fetchApprovalLink(e).then((function(t){return window.location.href=t}));case"xsolla":return new Promise((function(t){return XPayStationWidget.open(),(0,E.Lt)(),t()}))}},t.handleError=function(t){var e;if((0,E.Lt)(),!t.getResponseHeader||(e=t.getResponseHeader("Content-Type"),!dr.startsWith(e,"application/javascript")))return(0,_.qQ)(null!=t?t.xhr:void 0)},t}(),mr=r(6486),fr=r(9755),gr=function(t,e){return function(){return t.apply(e,arguments)}};const vr=function(){function t(t){var e;this.updateUserInteraction=gr(this.updateUserInteraction,this),this.updateTargetId=gr(this.updateTargetId,this),this.updateSearchResult=gr(this.updateSearchResult,this),this.updateCostDisplay=gr(this.updateCostDisplay,this),this.onInput=gr(this.onInput,this),this.onSliderValueChanged=gr(this.onSliderValueChanged,this),this.calculate=gr(this.calculate,this),this.getUser=gr(this.getUser,this),this.initializeUsernameInput=gr(this.initializeUsernameInput,this),this.initializeSliderPresets=gr(this.initializeSliderPresets,this),this.initializeSlider=gr(this.initializeSlider,this),this.debouncedGetUser=mr.debounce(this.getUser,300),this.el=t,this.searching=!1,this.priceElement=this.el.querySelector(".js-price"),this.durationElement=this.el.querySelector(".js-duration"),this.discountElement=this.el.querySelector(".js-discount"),this.messageInput=this.el.querySelector(".js-store-supporter-tag-message"),this.slider=this.el.querySelector(".js-slider"),this.sliderPresets=this.el.querySelectorAll(".js-slider-preset"),this.targetIdElement=this.el.querySelector('input[name="item[extra_data][target_id]"]'),this.usernameInput=this.el.querySelector(".js-username-input"),this.reactElement=this.el.querySelector(".js-react--user-card-store"),this.user=JSON.parse(this.reactElement.dataset.user),null==this.user&&(this.user=currentUser,this.reactElement.dataset.user=JSON.stringify(this.user)),fr(document).one("turbolinks:before-cache",(e=this,function(){return e.reactElement.dataset.user=JSON.stringify(e.user)})),this.cost=this.calculate(this.initializeSlider().slider("value")),this.initializeSliderPresets(),this.initializeUsernameInput(),this.updateCostDisplay(),this.updateSearchResult(),""!==this.usernameInput.value&&fr(this.usernameInput).trigger("input")}return t.prototype.RESOLUTION=8,t.prototype.MIN_VALUE=4,t.prototype.MAX_VALUE=52,t.initialize=function(){var e,r,i,n,s;for(s=[],r=0,i=(n=document.getElementsByClassName("js-store-supporter-tag")).length;r<i;r++)e=n[r],s.push(new t(e));return s},t.prototype.initializeSlider=function(){var t;return fr(this.slider).find(".ui-slider-range").remove(),fr(this.slider).slider({range:"min",value:null!=(t=this.slider.dataset.lastValue)?t:this.sliderValue(this.MIN_VALUE),min:this.sliderValue(this.MIN_VALUE),max:this.sliderValue(this.MAX_VALUE),step:1,animate:!0,slide:this.onSliderValueChanged,change:this.onSliderValueChanged})},t.prototype.initializeSliderPresets=function(){return fr(this.sliderPresets).on("click",(t=this,function(e){var r,i;if(i=e.currentTarget,r=StoreSupporterTagPrice.durationToPrice(i.dataset.months))return fr(t.slider).slider("value",t.sliderValue(r))}));var t},t.prototype.initializeUsernameInput=function(){return fr(this.usernameInput).on("input",this.onInput)},t.prototype.getUser=function(t){return t?fr.ajax({data:{username:t},dataType:"json",type:"POST",url:(0,f.B)("users.check-username-exists")}).done((e=this,function(t){return e.user=t})).fail(function(t){return function(e,r){return fr(t.usernameInput).trigger("ajax:error",[e,r]).one("click",t.onInput)}}(this)).always(function(t){return function(){return t.searching=!1,t.updateSearchResult()}}(this)):(this.user=window.currentUser,this.searching=!1,void this.updateSearchResult());var e},t.prototype.calculate=function(t){return new StoreSupporterTagPrice(Math.floor(t/this.RESOLUTION))},t.prototype.onSliderValueChanged=function(t,e){return this.slider.dataset.lastValue=e.value,this.cost=this.calculate(e.value),this.updateCostDisplay()},t.prototype.onInput=function(t){return this.searching||(this.searching=!0,this.user=null,this.updateSearchResult()),this.debouncedGetUser(t.currentTarget.value)},t.prototype.sliderValue=function(t){return t*this.RESOLUTION},t.prototype.updateCostDisplay=function(){var t,e,r,i,n;for(this.el.querySelector('input[name="item[cost]"]').value=this.cost.price(),this.priceElement.textContent="USD "+this.cost.price(),this.durationElement.textContent=this.cost.durationText(),this.discountElement.textContent=this.cost.discountText(),n=[],e=0,r=(i=this.sliderPresets).length;e<r;e++)t=i[e],n.push(this.updateSliderPreset(t,this.cost));return n},t.prototype.updateSearchResult=function(){return fr.publish("store-supporter-tag:update-user",this.user),this.updateTargetId(),this.updateUserInteraction()},t.prototype.updateSliderPreset=function(t,e){return fr(t).toggleClass("js-slider-preset--active",e.duration()>=+t.dataset.months)},t.prototype.updateTargetId=function(){var t;return this.targetIdElement.value=null!=(t=this.user)?t.id:void 0},t.prototype.updateUserInteraction=function(){var t,e,r,i;return e=(t=null!=(null!=(r=this.user)?r.id:void 0)&&Number.isFinite(this.user.id)&&this.user.id>0)&&(null!=(i=this.user)?i.id:void 0)!==window.currentUser.id,(0,G.Eo)(this.messageInput,e),v(t),fr(this.el).toggleClass("js-store--disabled",!t),fr(".js-slider").slider({disabled:!t})},t}();var br=r(6486),yr=r(9755),wr=function(t,e){return function(){return t.apply(e,arguments)}};const kr=function(){function t(){this.sync=wr(this.sync,this),this.onResize=wr(this.onResize,this),this.observe=wr(this.observe,this),this.targets=document.getElementsByClassName("js-sync-height--target"),this.references=document.getElementsByClassName("js-sync-height--reference"),this.throttledSync=br.throttle(this.sync,100),yr(document).on("turbolinks:load",this.sync),yr.subscribe("sync-height:force",this.sync),yr(window).on("resize",this.sync),this.observe()}return t.prototype.observe=function(){var t;return t={attributes:!0,subtree:!0},this.observer=new MutationObserver(this.onResize),this.observer.observe(document,t)},t.prototype.onResize=function(t){var e,r;for(e=0,r=t.length;e<r;e++)if("TEXTAREA"===t[e].target.tagName)return this.sync()},t.prototype.sync=function(){var t,e,r,i,n,s,o,a,u,l,c;for(e={},r=0,n=(o=this.references).length;r<n;r++)e[(u=o[r]).getAttribute("data-sync-height-target")]=u.offsetHeight;for(l=[],i=0,s=(a=this.targets).length;i<s;i++)null!=(t=e[(c=a[i]).getAttribute("data-sync-height-id")])?l.push(c.style.minHeight=t+"px"):l.push(void 0);return l},t}();var jr=r(9755),_r=r(6486),Er=r(381),xr=function(t,e){return function(){return t.apply(e,arguments)}};const Sr=function(){function t(){this.timeagoTip=xr(this.timeagoTip,this),this.rollback=xr(this.rollback,this),this.autoAddTooltip=xr(this.autoAddTooltip,this),this.onMouseOver=xr(this.onMouseOver,this),jr(document).on("mouseover touchstart","[title]:not(iframe)",this.onMouseOver),jr(document).on("mouseenter touchstart",".u-ellipsis-overflow, .u-ellipsis-overflow-desktop, .u-ellipsis-pre-overflow",this.autoAddTooltip),jr(document).on("turbolinks:load",this.rollback)}return t.prototype.onMouseOver=function(t){var e,r,i,n,s,o,a,u,l,c;if(c=(n=t.currentTarget).getAttribute("title"),n.removeAttribute("title"),s=(0,W.G)(n.dataset.htmlTitle),0!==_r.size(c)||null!=s){if(e=n.classList.contains("js-timeago")||n.classList.contains("js-tooltip-time")?this.timeagoTip(n,c):null!=s?s:jr("<span>").text(c),!n._tooltip)return n._tooltip=!0,r=null!=(l=n.dataset.tooltipPosition)?l:"top center",a=function(){switch(r){case"top center":return"bottom center";case"left center":return"right center";case"right center":return"left center";case"bottom center":return"top center"}}(),o="1"===n.dataset.tooltipHoverable,i="qtip tooltip-default","fixed"===n.dataset.tooltipFloat&&(i+=" tooltip-default--fixed"),null!=n.dataset.tooltipModifiers&&(i+=" tooltip-default--"+n.dataset.tooltipModifiers),o&&(i+=" u-hover"),u={overwrite:!1,content:e,position:{my:a,at:r,viewport:jr(window)},show:{event:t.type,ready:!0},hide:{event:"click mouseleave"},style:{classes:i,tip:{width:10,height:8}}},"touchstart"===t.type&&(u.hide={inactive:3e3,event:"unfocus"}),n.dataset.tooltipPinPosition&&(u.position.effect=!1),n.dataset.tooltipHideEvents&&(u.hide.event=n.dataset.tooltipHideEvents),o&&(u.hide.delay=200,u.hide.fixed=!0),n.dataset.origTitle=c,jr(n).qtip(u,t);jr(n).qtip("set",{"content.text":e})}},t.prototype.autoAddTooltip=function(t){var e,r,i;return i=t.currentTarget,r=(e=jr(i)).qtip("api"),i.offsetWidth<i.scrollWidth?r?r.enable():(e.attr("title",e.text()),e.trigger(t.type)):null!=r?r.disable():void 0},t.prototype.remove=function(t){if(t._tooltip)return jr(t).qtip("destroy",!0),t._tooltip=!1,null==t.getAttribute("title")&&t.setAttribute("title",t.dataset.origTitle),delete t.dataset.origTitle},t.prototype.rollback=function(){var t,e,r,i,n;for(jr(".qtip").remove(),n=[],e=0,r=(i=document.querySelectorAll("[data-orig-title]")).length;e<r;e++)t=i[e],n.push(t.setAttribute("title",t.dataset.origTitle));return n},t.prototype.timeagoTip=function(t,e){var r,i,n,s,o,a;return a=null!=(n=null!=(s=t.getAttribute("datetime"))?s:e)?n:t.textContent,o=Er(a),r=jr("<strong>").text(o.format("LL")),i=jr("<span>").addClass("tooltip-default__time").text(o.format("LTS")+" "+this.tzString(o)),jr("<span>").append(r).append(" ").append(i)},t.prototype.tzString=function(t){var e;return"UTC"+((e=t.utcOffset())%60==0?(e>=0?"+":"")+e/60:t.format("Z"))},t}();var Pr=function(t,e){return function(){return t.apply(e,arguments)}};const Cr=function(){function t(t){this.turbolinksReload=t,this.openPlayer=Pr(this.openPlayer,this),this.noCookieDiv=Pr(this.noCookieDiv,this),this.start=Pr(this.start,this),this.startAll=Pr(this.startAll,this),this.initializeEmbed=Pr(this.initializeEmbed,this),this.playerDivs=document.getElementsByClassName("js-twitch-player"),addEventListener("turbolinks:load",this.startAll)}return t.prototype.initializeEmbed=function(){var t;return null!=(t=this.turbolinksReload.load("https://player.twitch.tv/js/embed/v1.js"))?t.then(this.startAll):void 0},t.prototype.startAll=function(){var t,e,r,i,n;if(0!==this.playerDivs.length){if("undefined"==typeof Twitch||null===Twitch)return this.initializeEmbed();for(n=[],e=0,r=(i=this.playerDivs).length;e<r;e++)t=i[e],n.push(this.start(t));return n}},t.prototype.start=function(t){var e,r;if(!t.dataset.twitchPlayerStarted)return t.dataset.twitchPlayerStarted=!0,e={width:"100%",height:"100%",channel:t.dataset.channel},new Twitch.Player(t.id,e).addEventListener(Twitch.Player.PLAY,(r=this,function(){return r.openPlayer(t)}))},t.prototype.noCookieDiv=function(t){return document.querySelector(".js-twitch-player--no-cookie[data-player-id='"+t+"']")},t.prototype.openPlayer=function(t){if(t.classList.contains("hidden"))return t.classList.remove("hidden"),(0,G.U6)(this.noCookieDiv(t.id))},t}();var Tr=r(2918),Or=r(381),Mr=r(9755),Lr=r(9755);Tr.start(),Tr.setProgressBarDelay(0),Or.relativeTimeThreshold("ss",44),Or.relativeTimeThreshold("s",120),Or.relativeTimeThreshold("m",120),Or.relativeTimeThreshold("h",48),Or.relativeTimeThreshold("d",62),Or.relativeTimeThreshold("M",24),Mr.timeago.inWords=function(t){return Or.duration(-1*t).humanize(!0)},Lr(document).on("turbolinks:request-start",E.Uq),Lr(document).on("turbolinks:request-end",E.Lt),Lr(document).on("submit","form",(function(t){if("0"!==t.currentTarget.dataset.loadingOverlay)return(0,E.Uq)()})),Lr(document).on("turbolinks:load",(function(){return X.initialize(),vr.initialize(),pr.initialize()})),null==window.currentUserObserver&&(window.currentUserObserver=new pt),null==window.syncHeight&&(window.syncHeight=new kr),null==window.accountEdit&&(window.accountEdit=new F),null==window.accountEditAvatar&&(window.accountEditAvatar=new D),null==window.accountEditBlocklist&&(window.accountEditBlocklist=new U),null==window.bbcodePreview&&(window.bbcodePreview=new H),null==window.changelogChartLoader&&(window.changelogChartLoader=new ot),null==window.checkboxValidation&&(window.checkboxValidation=new ut),null==window.fancyGraph&&(window.fancyGraph=new kt),null==window.formClear&&(window.formClear=new _t),null==window.formError&&(window.formError=new Ot),null==window.formToggle&&(window.formToggle=new Nt),null==window.forum&&(window.forum=new zt),null==window.forumAutoClick&&(window.forumAutoClick=new Zt),null==window.forumCover&&(window.forumCover=new Jt),null==window.forumTopicTitle&&(window.forumTopicTitle=new oe),null==window.forumTopicWatchAjax&&(window.forumTopicWatchAjax=new le),null==window.gallery&&(window.gallery=new Pe),null==window.globalDrag&&(window.globalDrag=new Oe),null==window.landingGraph&&(window.landingGraph=new qe),null==window.menu&&(window.menu=new Fe),null==window.navButton&&(window.navButton=new Ze),null==window.postPreview&&(window.postPreview=new Qe),null==window.search&&(window.search=new ir),null==window.stickyFooter&&(window.stickyFooter=new or),null==window.tooltipDefault&&(window.tooltipDefault=new Sr),null==window.formConfirmation&&(window.formConfirmation=new Pt(window.formError)),null==window.forumPostsSeek&&(window.forumPostsSeek=new Kt(window.forum)),null==window.forumTopicPostJump&&(window.forumTopicPostJump=new te(window.forum)),null==window.forumTopicReply&&(window.forumTopicReply=new ie({bbcodePreview:window.bbcodePreview,forum:window.forum,stickyFooter:window.stickyFooter})),null==window.nav2&&(window.nav2=new Xe(osuCore.clickMenu)),null==window.twitchPlayer&&(window.twitchPlayer=new Cr(osuCore.turbolinksReload)),Lr(document).on("change",".js-url-selector",(function(t){return(0,p.c4)(t.target.value,"1"===t.target.dataset.keepScroll)})),Lr(document).on("keydown",(function(t){if("Escape"===t.key)return Lr.publish("key:esc")}));var Nr=r(9119),Ir=r(714),Dr=r(5069),Br=r(9323);function Rr(t){const e={glow:t.count>0,mobile:"mobile"===t.type};return ce.createElement("span",{className:(0,ct.sb)("notification-icon",e)},ce.createElement("i",{className:t.iconClassName}),ce.createElement("span",{className:"notification-icon__count"},t.ready?(r=t.count,(0,P.uf)(r>0?r:0)):"..."));var r}var Ur=function(t,e,r,i){var n,s=arguments.length,o=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(s<3?n(o):s>3?n(e,r,o):n(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o};let qr=class extends ce.Component{get unreadCount(){return L.Z.dataStore.notificationStore.unreadStacks.getOrCreateType({objectType:"channel"}).total}constructor(t){super(t),(0,u.rC)(this)}render(){return ce.createElement(Rr,{count:this.unreadCount,iconClassName:"fas fa-comment-alt",ready:L.Z.notificationsWorker.hasData,type:this.props.type})}};Ur([u.Fl],qr.prototype,"unreadCount",null),qr=Ur([Br.Pi],qr);const Ar=qr;var zr=function(t,e,r,i){var n,s=arguments.length,o=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(s<3?n(o):s>3?n(e,r,o):n(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o};const Fr="countdown-timer";let Wr=class extends ce.Component{get deadline(){return l(this.props.deadline).valueOf()}get diff(){return Math.max(this.deadline-(new Date).valueOf(),0)/1e3}constructor(t){super(t),Object.defineProperty(this,"timer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),(0,u.rC)(this)}componentWillUnmount(){window.clearTimeout(this.timer)}render(){const t=this.diff,e={days:Math.floor(t/86400),hours:Math.floor(t/3600%24),minutes:Math.floor(t/60%60),seconds:Math.floor(t%60)};return 0!==t&&this.setTimeout(),ce.createElement("div",{className:Fr},ce.createElement("div",{className:`${Fr}__header`},`${(0,m.dW)("common.time.remaining")}:`),Object.entries(e).map((([t,e])=>ce.createElement("div",{key:t,className:`${Fr}__field`},ce.createElement("div",{className:`${Fr}__digit`},e<10?`0${e}`:e),ce.createElement("div",{className:`${Fr}__label`},(0,m.dW)(`common.countdown.${t}`))))))}setTimeout(){this.timer=window.setTimeout((()=>this.forceUpdate()),1e3)}};zr([u.Fl],Wr.prototype,"deadline",null),Wr=zr([Br.Pi],Wr);const Vr=Wr;var Zr=r(6244),Hr=r(3890);function $r({posts:t}){return ce.createElement("div",{className:"landing-news"},t.length>0&&ce.createElement(ce.Fragment,null,ce.createElement("div",{className:"landing-news__posts"},ce.createElement(Zr.Z,{modifiers:["landing","hover"],post:t[0]})),ce.createElement("div",{className:"landing-news__posts"},lt.slice(t,1).map(((t,e)=>ce.createElement(Zr.Z,{key:e,modifiers:["landing","hover"],post:t})))),ce.createElement("div",{className:"landing-news__link"},ce.createElement(Hr.Z,{hasMore:!0,label:(0,m.dW)("home.landing.see_more_news"),loading:!1,modifiers:["no-icon"],url:(0,f.B)("news.index")}))))}var Jr=r(7581),Xr=function(t,e,r,i){var n,s=arguments.length,o=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(s<3?n(o):s>3?n(e,r,o):n(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o};let Gr=class extends ce.Component{get unreadCount(){return Jr.O3.filter((t=>!(null==t||"channel"===t))).reduce(((t,e)=>t+L.Z.dataStore.notificationStore.unreadStacks.getOrCreateType({objectType:e}).total),0)}constructor(t){super(t),(0,u.rC)(this)}render(){return ce.createElement(Rr,{count:this.unreadCount,iconClassName:"fas fa-bell",ready:L.Z.notificationsWorker.hasData,type:this.props.type})}};Xr([u.Fl],Gr.prototype,"unreadCount",null),Gr=Xr([Br.Pi],Gr);const Kr=Gr;var Qr=r(6741),Yr=r(4403),ti=r(7292),ei=r(6817);function ri({beatmapset:t,modifiers:e=[]}){const r=(0,f.B)("beatmapsets.show",{beatmapset:t.id});return ce.createElement("a",{className:(0,ct.sb)("beatmapset-search-card",e),href:r},ce.createElement(ti.Z,{beatmapset:t,modifiers:"search",size:"list"}),ce.createElement("div",{className:"beatmapset-search-card__details"},ce.createElement("div",{className:"beatmapset-search-card__title"},`${(0,ei.YQ)(t)} `,ce.createElement("span",{className:"beatmapset-search-card__title-artist"},(0,m.dW)("users.show.extra.beatmaps.by_artist",{artist:(0,ei.aU)(t)}))),ce.createElement("div",{className:"beatmapset-search-card__extra"},(0,m.dW)("beatmapsets.show.details.mapped_by",{mapper:t.creator}))))}var ii=r(5523),ni=r(1759),si=r(6568),oi=r(6407);function ai({user:t,modifiers:e=[]}){const r=(0,f.B)("users.show",{user:t.id});return ce.createElement("div",{className:(0,ct.sb)("user-search-card",e)},ce.createElement("a",{className:"user-search-card__background-container",href:r}),ce.createElement("div",{className:"user-search-card__container"},ce.createElement("a",{className:"user-search-card__avatar-container",href:r},ce.createElement("div",{className:"avatar avatar--full",style:{backgroundImage:(0,ct.eF)(t.avatar_url)}})),ce.createElement("div",{className:"user-search-card__details"},ce.createElement("div",{className:"user-search-card__col user-search-card__col--flag"},ce.createElement(ii.Z,{country:t.country})),ce.createElement("a",{className:"user-search-card__col user-search-card__col--username",href:r},t.username),t.is_supporter?ce.createElement("div",{className:"user-search-card__col user-search-card__col--icon u-hidden-narrow"},ce.createElement(si._,{level:t.support_level,modifiers:["quick-search"]})):null,ce.createElement(oi.Z,{groups:t.groups,short:!0,wrapper:"user-search-card__col user-search-card__col--icon"}),ce.createElement("div",{className:"user-search-card__col user-search-card__col--icon"},ce.createElement(ni.Z,{modifiers:"quick-search",userId:t.id})))))}var ui=function(t,e,r,i){var n,s=arguments.length,o=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(s<3?n(o):s>3?n(e,r,o):n(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o};const li=["forum_post","wiki_page"];let ci=class extends ce.Component{constructor(){super(...arguments),Object.defineProperty(this,"inputRef",{enumerable:!0,configurable:!0,writable:!0,value:ce.createRef()}),Object.defineProperty(this,"focus",{enumerable:!0,configurable:!0,writable:!0,value:()=>{var t;null!=this.inputRef.current&&(this.inputRef.current.selectionStart=0,this.inputRef.current.selectionEnd=this.inputRef.current.value.length,this.props.worker.selectNone(),null===(t=this.inputRef.current)||void 0===t||t.focus())}}),Object.defineProperty(this,"onInputKeyDown",{enumerable:!0,configurable:!0,writable:!0,value:t=>{var e;const r=t.key;"Enter"===r&&(null===(e=(0,P.h3)(t.target))||void 0===e||e.blur(),this.props.worker.debouncedSearch.flush(),this.navigateToSelected()),"ArrowUp"!==r&&"ArrowDown"!==r||this.props.worker.cycleSelectedItem("ArrowDown"===r?1:-1)}}),Object.defineProperty(this,"onMouseEnter",{enumerable:!0,configurable:!0,writable:!0,value:t=>{var e;const r=t.currentTarget.dataset.section,i=parseInt(null!==(e=t.currentTarget.dataset.index)&&void 0!==e?e:"0",10);this.selectBox(r,i)}}),Object.defineProperty(this,"onMouseLeave",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.props.worker.selectNone()}}),Object.defineProperty(this,"updateQuery",{enumerable:!0,configurable:!0,writable:!0,value:t=>{this.props.worker.updateQuery(t.currentTarget.value)}})}render(){let t=(0,ct.sb)("quick-search",this.props.modifiers);return t+=" u-fancy-scrollbar",ce.createElement("div",{className:t},ce.createElement("div",{className:"quick-search-input"},ce.createElement("div",{className:"quick-search-input__field"},ce.createElement("span",{className:"quick-search-input__icon"},this.props.worker.searching?ce.createElement(Qr.$,null):ce.createElement("span",{className:"fas fa-search"})),ce.createElement("input",{ref:this.inputRef,className:"quick-search-input__input js-click-menu--autofocus",onChange:this.updateQuery,onKeyDown:this.onInputKeyDown,placeholder:(0,m.dW)("home.search.placeholder"),type:"search",value:this.props.worker.query})),null!=this.props.onClose&&ce.createElement("button",{className:"btn-osu-big btn-osu-big--quick-search-close",onClick:this.props.onClose,type:"button"},(0,m.dW)("common.buttons.close"))),this.renderResult())}boxIsActive(t,e){var r;const i=this.props.worker;return i.currentSection===t&&(null===(r=i.selected)||void 0===r?void 0:r.index)===e}count(t){return null===this.props.worker.searchResult?0:this.props.worker.searchResult[t].total}navigateToSelected(){const t=this.props.worker.selectedURL;null!=t&&(0,p.c4)(t,!1)}renderBeatmapsets(){return null===this.props.worker.searchResult?null:ce.createElement("div",{className:"quick-search-items"},this.props.worker.searchResult.beatmapset.beatmapsets.map(((t,e)=>ce.createElement("div",{key:t.id,className:"quick-search-items__item","data-index":e,"data-section":"beatmapset",onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave},ce.createElement(ri,{beatmapset:t,modifiers:this.boxIsActive("beatmapset",e)?["active"]:[]})))),ce.createElement("div",{className:"quick-search-items__item","data-section":"beatmapset_others",onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave},this.renderResultLink("beatmapset",this.boxIsActive("beatmapset_others",0))))}renderMoreOtherResultLink(){const t=li.filter((t=>this.count(t)>0));return 0===t.length?null:ce.createElement("div",{className:"quick-search-items"},t.map(((t,e)=>ce.createElement("div",{key:t,className:"quick-search-items__item","data-index":e,"data-section":"others",onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave},this.renderResultLink(t,this.boxIsActive("others",e))))))}renderNoMoreOtherResultLink(){const t=li.filter((t=>0===this.count(t)));return 0===t.length?null:ce.createElement("div",{className:"quick-search-items quick-search-items--empty"},t.map((t=>ce.createElement("div",{key:t,className:"quick-search-items__item"},(0,m.dW)("quick_search.result.empty_for",{modes:(0,m.dW)(`quick_search.mode.${t}`)})))))}renderOthers(){return 0===this.count("forum_post")&&0===this.count("wiki_page")?ce.createElement("span",{className:"quick-search-items quick-search-items--empty"},(0,m.dW)("quick_search.result.empty_for",{modes:(0,m.m2)([(0,m.dW)("quick_search.mode.forum_post"),(0,m.dW)("quick_search.mode.wiki_page")])})):ce.createElement(ce.Fragment,null,this.renderMoreOtherResultLink(),this.renderNoMoreOtherResultLink())}renderResult(){return null==this.props.worker.searchResult?null:ce.createElement("div",{className:"quick-search-result"},ce.createElement("div",{className:"quick-search-result__item"},this.renderTitle("user"),this.renderUsers()),ce.createElement("div",{className:"quick-search-result__item"},this.renderTitle("beatmapset"),this.renderBeatmapsets()),ce.createElement("div",{className:"quick-search-result__item"},this.renderTitle("other"),this.renderOthers()))}renderResultLink(t,e=!1){let r="quick_search.result.";return r+=li.includes(t)?"title":"more",ce.createElement("a",{className:(0,ct.sb)("search-result-more",e?["active"]:[]),href:(0,f.B)("search",{mode:t,query:this.props.worker.query})},ce.createElement("div",{className:"search-result-more__content"},(0,m.dW)(r,{mode:(0,m.dW)(`quick_search.mode.${t}`)}),ce.createElement("span",{className:"search-result-more__count"},(0,P.uf)(this.count(t)))),ce.createElement("div",{className:"search-result-more__arrow"},ce.createElement("span",{className:"fas fa-angle-right"})))}renderTitle(t){return ce.createElement("h2",{className:"title"},ce.createElement(Yr.Z,{mappings:{mode:ce.createElement("strong",null,(0,m.dW)(`quick_search.mode.${t}`))},pattern:(0,m.dW)("quick_search.result.title")}))}renderUsers(){return null==this.props.worker.searchResult?null:0===this.count("user")?ce.createElement("span",{className:"quick-search-items quick-search-items--empty"},(0,m.dW)("quick_search.result.empty",{mode:(0,m.dW)("quick_search.mode.beatmapset")})):ce.createElement("div",{className:"quick-search-items"},this.props.worker.searchResult.user.users.map(((t,e)=>ce.createElement("div",{key:t.id,className:"quick-search-items__item","data-index":e,"data-section":"user",onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave},ce.createElement(ai,{modifiers:this.boxIsActive("user",e)?["active"]:[],user:t})))),this.count("user")>this.props.worker.searchResult.user.users.length&&ce.createElement("div",{className:"quick-search-items__item","data-section":"user_others",onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave},this.renderResultLink("user",this.boxIsActive("user_others",0))))}selectBox(t,e=0){this.props.worker.setSelected(t,e)}};ci=ui([Br.Pi],ci);const hi=ci;var di=r(9003),pi=r(9755),mi=function(t,e,r,i){var n,s=arguments.length,o=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(s<3?n(o):s>3?n(e,r,o):n(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o};let fi=class extends ce.Component{constructor(){super(...arguments),Object.defineProperty(this,"formRef",{enumerable:!0,configurable:!0,writable:!0,value:ce.createRef()}),Object.defineProperty(this,"searchPath",{enumerable:!0,configurable:!0,writable:!0,value:(0,f.B)("search",null,!1)}),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:{open:!1}}),Object.defineProperty(this,"toggle",{enumerable:!0,configurable:!0,writable:!0,value:t=>{null!=L.Z.currentUser&&(null!=t&&t.preventDefault(),this.isSearchPage?pi(".js-search--input").focus():this.setState({open:!this.state.open}))}})}get isSearchPage(){return(0,p.JJ)().pathname===this.searchPath}componentDidUpdate(t,e){var r;!e.open&&this.state.open&&(null===(r=this.formRef.current)||void 0===r||r.focus())}render(){let t="nav2__menu-link-main nav2__menu-link-main--search";return(this.state.open||(0,p.JJ)().pathname===(0,f.B)("search",null,!1))&&(t+=" u-section--bg-normal"),ce.createElement(ce.Fragment,null,ce.createElement("a",{className:t,href:(0,f.B)("search"),onClick:this.toggle},ce.createElement("span",{className:"fas fa-search"})),this.renderModal())}renderModal(){return!this.state.open||this.isSearchPage?null:ce.createElement(di.Z,{onClose:this.toggle},ce.createElement(hi,{ref:this.formRef,onClose:this.toggle,worker:this.props.worker}))}};fi=mi([Br.Pi],fi);const gi=fi;var vi=r(7018),bi=function(t,e,r,i){var n,s=arguments.length,o=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(s<3?n(o):s>3?n(e,r,o):n(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o};const yi={id:null,text:(0,m.dW)("rankings.countries.all")};let wi=class extends ce.Component{get items(){return[yi,...this.props.items.sort(((t,e)=>{var r,i;return(null===(r=L.Z.currentUser)||void 0===r?void 0:r.country_code)===t.id?-1:(null===(i=L.Z.currentUser)||void 0===i?void 0:i.country_code)===e.id?1:t.text.localeCompare(e.text)}))]}constructor(t){super(t),Object.defineProperty(this,"handleRenderOption",{enumerable:!0,configurable:!0,writable:!0,value:t=>ce.createElement("a",{key:t.option.id,className:t.cssClasses,href:(0,T.bj)(null,{country:t.option.id,page:null}),onClick:t.onClick},t.children)}),Object.defineProperty(this,"onChange",{enumerable:!0,configurable:!0,writable:!0,value:t=>{(0,p.c4)((0,T.bj)(null,{country:t.id,page:null}))}}),(0,u.rC)(this)}render(){var t;return ce.createElement("div",{className:"ranking-filter ranking-filter--full"},ce.createElement("div",{className:"ranking-filter__title"},(0,m.dW)("rankings.countries.title")),ce.createElement(vi.Z,{modifiers:"ranking",onChange:this.onChange,options:this.items,renderOption:this.handleRenderOption,selected:null!==(t=this.props.current)&&void 0!==t?t:yi}))}};bi([u.Fl],wi.prototype,"items",null),wi=bi([Br.Pi],wi);const ki=wi;var ji=r(7275),_i=r(2873);const Ei=["all","friends"];class xi extends ce.PureComponent{constructor(){super(...arguments),Object.defineProperty(this,"onChange",{enumerable:!0,configurable:!0,writable:!0,value:t=>{(0,p.c4)((0,T.bj)(null,{filter:t.currentTarget.dataset.value,page:null}))}})}render(){var t;return ce.createElement("div",{className:"ranking-filter"},ce.createElement("div",{className:"ranking-filter__title"},(0,m.dW)("rankings.filter.title")),ce.createElement(_i.P,{currentValue:null!==(t=this.props.current)&&void 0!==t?t:"all",onChange:this.onChange,showTitle:!1,values:Ei}))}}class Si extends ce.PureComponent{constructor(){super(...arguments),Object.defineProperty(this,"onChange",{enumerable:!0,configurable:!0,writable:!0,value:t=>{(0,p.c4)((0,T.bj)(null,{page:null,variant:t.currentTarget.dataset.value}))}})}render(){var t;return ce.createElement("div",{className:"ranking-filter"},ce.createElement("div",{className:"ranking-filter__title"},(0,m.dW)("rankings.filter.variant.title")),ce.createElement(_i.P,{currentValue:null!==(t=this.props.current)&&void 0!==t?t:"all",onChange:this.onChange,showTitle:!1,transPrefix:`beatmaps.variant.${this.props.current_ruleset}.`,values:this.props.items}))}}function Pi(t){return(0,T.bj)(null,{spotlight:t.toString()})}class Ci extends ce.PureComponent{render(){return ce.createElement(vi.Z,{modifiers:"spotlight",onChange:this.handleChange,options:this.props.options,renderOption:this.renderOption,selected:this.props.selected})}handleChange(t){(0,p.c4)(Pi(t.id))}renderOption({children:t,cssClasses:e,onClick:r,option:i}){return ce.createElement("a",{key:i.id,className:e,href:Pi(i.id),onClick:r},t)}}var Ti=r(4888),Oi=r(9755);class Mi extends ce.PureComponent{constructor(){super(...arguments),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:{user:this.props.user}}),Object.defineProperty(this,"setUser",{enumerable:!0,configurable:!0,writable:!0,value:(t,e)=>{this.setState({user:e})}})}componentDidMount(){Oi.subscribe("store-supporter-tag:update-user",this.setUser)}componentWillUnmount(){Oi.unsubscribe("store-supporter-tag:update-user",this.setUser)}render(){return ce.createElement(Ti.O,{user:this.state.user})}}var Li=r(7762),Ni=r(8259),Ii=r(2094),Di=r(9755);const Bi="qtip--user-card";let Ri,Ui,qi=!1;function Ai(t){const e=t.dataset.userId;t._tooltip=e;const r=function(){if(null==Ui){const t=document.createElement("div");t.innerHTML=(0,Li.renderToStaticMarkup)(ce.createElement(Ti.O,null));const e=t.children[0];if(!(e instanceof HTMLElement))throw new Error("expected render of UserCard to be HTMLElement but got something else");Ui=e}return Ui}().cloneNode(!0);r.classList.remove("js-react--user-card"),r.classList.add("js-react--user-card-tooltip"),r.dataset.lookup=e,null!=t.dataset.tooltipPosition&&(r.dataset.tooltipPosition=t.dataset.tooltipPosition),Di(t).qtip(function(t){var e;const r=null!==(e=t.dataset.tooltipPosition)&&void 0!==e?e:"right center";return{content:{text:t},events:{render:L.Z.reactTurbolinks.boot,show:Xi},hide:{delay:220,effect:$i,fixed:!0},position:{adjust:{scroll:!1},at:r,my:zi(r),viewport:Di(window)},show:{delay:200,effect:Hi,ready:!0},style:{classes:Bi,def:!1,tip:!1}}}(r))}function zi(t){switch(t){case"top center":return"bottom center";case"top right":return"bottom left";case"left center":return"right center";case"bottom center":return"top center"}return"left center"}function Fi(){qi=!1,Ri=null}function Wi(){qi=!0}function Vi(){qi=!1}function Zi(t){var e,r;if(null!=Ri)return;if(L.Z.windowSize.isMobile)return;const i=t.currentTarget,n=(0,W.G)(i.dataset.userId);if(null!=n&&!lt.find(null!==(r=null===(e=L.Z.currentUser)||void 0===e?void 0:e.blocks)&&void 0!==r?r:[],{target_id:parseInt(n,10)})){if(null==i._tooltip)return Ai(i);if(i._tooltip!==i.dataset.userId){const t=Di(i).qtip("api");if(null!=t){const e=t.tooltip;if(null!=e){const t=e.querySelector(".js-react--user-card-tooltip");null!=t&&(0,ve.unmountComponentAtNode)(t)}t.destroy(),delete i._tooltip}}}}function Hi(){Di(this).fadeTo(110,1)}function $i(){Di(this).fadeTo(110,0)}function Ji(t,e){if(null==e)return;const r=e.dataset.hasqtip;if(null==r)return;const i=document.getElementById(`qtip-${r}`);if(null==i)return;const n=Di(i).qtip("api");if(null!=n){const t=i.querySelector(".js-react--user-card-tooltip");null!=t&&(0,ve.unmountComponentAtNode)(t),setTimeout((()=>{n.destroy(!0),delete e._tooltip}),0)}}function Xi(t,e){if(null!=Ri||L.Z.windowSize.isMobile)return t.preventDefault();const r=e.target[0];r._tooltip!==r.dataset.userId&&(t.preventDefault(),Di(r).trigger("mouseover"))}class Gi extends ce.PureComponent{constructor(){super(...arguments),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"contextActiveKeyDidChange",{enumerable:!0,configurable:!0,writable:!0,value:Ni.Gw.bind(this)}),Object.defineProperty(this,"activeKeyDidChange",{enumerable:!0,configurable:!0,writable:!0,value:t=>{Ri=t,this.contextActiveKeyDidChange(t),null!=t||qi||Di(`.${Bi}`).qtip("hide")}})}componentDidMount(){this.getUser().then((t=>{this.setState({user:t})}))}getUser(){const t=(0,f.B)("users.card",{user:this.props.lookup});return Di.ajax({dataType:"json",type:"GET",url:t})}render(){const t=this.state.activeKey===this.props.lookup;return ce.createElement(Ii.d.Provider,{value:this.props.container},ce.createElement(Ni.Xl.Provider,{value:{activeKeyDidChange:this.activeKeyDidChange}},ce.createElement(Ni.XI.Provider,{value:this.props.lookup},ce.createElement(Ti.O,{activated:t,user:this.state.user}))))}}var Ki=r(8293),Qi=r(2918),Yi=r(9755),tn=function(t,e,r,i){var n,s=arguments.length,o=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(s<3?n(o):s>3?n(e,r,o):n(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o};class en{get isSuggestionsVisible(){return this.shouldShowSuggestions&&this.suggestions.length>0}get selectedItem(){return this.suggestions[this.selectedIndex]}get displayText(){return null==this.selectedItem?this.query:this.selectedItem.title}constructor(){Object.defineProperty(this,"selectedIndex",{enumerable:!0,configurable:!0,writable:!0,value:-1}),Object.defineProperty(this,"shouldShowSuggestions",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"suggestions",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"debouncedFetchSuggestions",{enumerable:!0,configurable:!0,writable:!0,value:(0,lt.debounce)((()=>this.fetchSuggestions()),200)}),Object.defineProperty(this,"query",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"xhr",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),(0,u.rC)(this)}cancel(){var t;null===(t=this.xhr)||void 0===t||t.abort(),this.debouncedFetchSuggestions.cancel()}search(){const t=this.displayText.trim();t.length&&Qi.visit((0,f.B)("search",{mode:"wiki_page",query:t}))}selectIndex(t){return t<-1?this.selectIndex(this.suggestions.length-1):t>=this.suggestions.length?this.selectIndex(-1):(this.selectedIndex=t,void(this.shouldShowSuggestions=!0))}shiftSelectedIndex(t){this.selectIndex(this.selectedIndex+t)}unselect(t){this.selectIndex(-1),this.shouldShowSuggestions=this.shouldShowSuggestions&&!t}updateQuery(t){var e;const r=t.trim(),i=this.query.trim();this.query=t,this.selectedIndex=-1,i!==r&&(null===(e=this.xhr)||void 0===e||e.abort(),r.length>1?this.debouncedFetchSuggestions():this.suggestions.length=0)}fetchSuggestions(){this.xhr=Yi.getJSON((0,f.B)("wiki-suggestions"),{query:this.query.trim()}).done((0,u.aD)((t=>{null!=t&&(this.suggestions=(0,u.LO)(t),this.shouldShowSuggestions=!0)})))}}tn([u.LO],en.prototype,"selectedIndex",void 0),tn([u.LO],en.prototype,"shouldShowSuggestions",void 0),tn([u.LO],en.prototype,"suggestions",void 0),tn([u.LO],en.prototype,"query",void 0),tn([u.Fl],en.prototype,"isSuggestionsVisible",null),tn([u.Fl],en.prototype,"selectedItem",null),tn([u.Fl],en.prototype,"displayText",null),tn([u.aD],en.prototype,"cancel",null),tn([u.aD],en.prototype,"search",null),tn([u.aD],en.prototype,"selectIndex",null),tn([u.aD],en.prototype,"shiftSelectedIndex",null),tn([u.aD],en.prototype,"unselect",null),tn([u.aD],en.prototype,"updateQuery",null),tn([u.aD],en.prototype,"fetchSuggestions",null);var rn=r(9755),nn=function(t,e,r,i){var n,s=arguments.length,o=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(s<3?n(o):s>3?n(e,r,o):n(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o};let sn=class extends ce.Component{constructor(){super(...arguments),Object.defineProperty(this,"controller",{enumerable:!0,configurable:!0,writable:!0,value:new en}),Object.defineProperty(this,"keepSelectionInView",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ref",{enumerable:!0,configurable:!0,writable:!0,value:ce.createRef()}),Object.defineProperty(this,"handleChange",{enumerable:!0,configurable:!0,writable:!0,value:t=>{this.controller.updateQuery(t.target.value)}}),Object.defineProperty(this,"handleEsc",{enumerable:!0,configurable:!0,writable:!0,value:t=>{"Escape"===t.key&&this.controller.unselect(!0)}}),Object.defineProperty(this,"handleKeyDown",{enumerable:!0,configurable:!0,writable:!0,value:t=>{const e=t.key;"Enter"===e?null==this.controller.selectedItem?this.handleSearch():(0,p.c4)((0,T.dP)(this.controller.selectedItem.path)):"ArrowUp"!==e&&"ArrowDown"!==e||(this.keepSelectionInView=!0,this.controller.shiftSelectedIndex("ArrowDown"===e?1:-1))}}),Object.defineProperty(this,"handleMouseDown",{enumerable:!0,configurable:!0,writable:!0,value:t=>{null!=this.ref.current&&(t.composedPath().includes(this.ref.current)||this.controller.unselect(!0))}}),Object.defineProperty(this,"handleMouseLeave",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.controller.unselect(!1)}}),Object.defineProperty(this,"handleSearch",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.controller.search()}}),Object.defineProperty(this,"handleSuggestionMouseEnter",{enumerable:!0,configurable:!0,writable:!0,value:t=>{var e;this.keepSelectionInView=!1,this.controller.selectIndex(parseInt(null!==(e=t.currentTarget.dataset.index)&&void 0!==e?e:"",10))}})}componentDidMount(){document.addEventListener("keydown",this.handleEsc),document.addEventListener("mousedown",this.handleMouseDown)}componentDidUpdate(){var t;this.keepSelectionInView&&(null===(t=rn(".wiki-search__suggestion--active")[0])||void 0===t||t.scrollIntoView({block:"nearest",inline:"nearest"}),this.keepSelectionInView=!1)}componentWillUnmount(){document.removeEventListener("keydown",this.handleEsc),document.removeEventListener("mousedown",this.handleMouseDown),this.controller.cancel()}render(){return ce.createElement("div",{className:"wiki-search"},ce.createElement("div",{className:"wiki-search__bar"},ce.createElement("input",{autoFocus:!0,className:"wiki-search__input",onChange:this.handleChange,onKeyDown:this.handleKeyDown,placeholder:(0,m.dW)("common.input.search"),value:this.controller.displayText}),ce.createElement("button",{className:"wiki-search__button",onClick:this.handleSearch},ce.createElement("i",{className:"fa fa-search"}))),this.renderSuggestions())}renderSuggestions(){return this.controller.isSuggestionsVisible?ce.createElement("div",{ref:this.ref,className:"wiki-search__suggestions u-fancy-scrollbar",onMouseLeave:this.handleMouseLeave},this.controller.suggestions.map(((t,e)=>ce.createElement("a",{key:e,className:(0,ct.sb)("wiki-search__suggestion",{active:this.controller.selectedIndex===e}),"data-index":e,href:(0,T.dP)(t.path),onMouseEnter:this.handleSuggestionMouseEnter},ce.createElement("span",{dangerouslySetInnerHTML:{__html:t.highlight}}))))):null}};sn=nn([Br.Pi],sn);var on=r(8125),an=r(8050),un=r(6160),ln=r(2903),cn=r(8035),hn=function(t,e,r,i){var n,s=arguments.length,o=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(s<3?n(o):s>3?n(e,r,o):n(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o};let dn=class extends ce.Component{get links(){return this.typeNames.map((t=>({title:(0,m.dW)(`notifications.filters.${null!=t?t:"_"}`),type:t})))}constructor(t){var e;super(t),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:{hasError:!1}}),Object.defineProperty(this,"controller",{enumerable:!0,configurable:!0,writable:!0,value:new un.Z(L.Z.dataStore.notificationStore,{excludes:this.props.excludes,isWidget:!0},null!==(e=this.props.only)&&void 0!==e?e:null)}),Object.defineProperty(this,"typeNames",{enumerable:!0,configurable:!0,writable:!0,value:Jr.O3.filter((t=>!this.props.excludes.includes(t)))}),Object.defineProperty(this,"handleFilterClick",{enumerable:!0,configurable:!0,writable:!0,value:t=>{var e;const r=null!==(e=t.currentTarget.dataset.type)&&void 0!==e?e:null;this.controller.navigateTo(r)}}),Object.defineProperty(this,"handleMarkAsRead",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.controller.markCurrentTypeAsRead()}}),Object.defineProperty(this,"handleShowMore",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.controller.loadMore()}}),Object.defineProperty(this,"renderFilter",{enumerable:!0,configurable:!0,writable:!0,value:t=>{const e=this.controller.getType(t.type),r=t.type===this.controller.currentFilter;if(null!==e.name&&e.isEmpty&&!r)return null;const i={"data-type":t.type},n=r?["active"]:[];return ce.createElement("button",Object.assign({key:t.title,className:(0,ct.sb)("notification-popup__filter",n),onClick:this.handleFilterClick},i),ce.createElement("span",{className:"notification-popup__filter-count"},this.controller.getTotal(e)),ce.createElement("span",null,t.title))}}),(0,u.rC)(this)}static getDerivedStateFromError(t){return console.error(t),{hasError:!0}}render(){var t;const e=`notification-popup u-fancy-scrollbar ${null!==(t=this.props.extraClasses)&&void 0!==t?t:""}`;return ce.createElement(an.u.Provider,{value:{excludes:this.props.excludes,isWidget:!0}},ce.createElement("div",{className:e},ce.createElement("div",{className:"notification-popup__scroll-container"},this.renderFilters(),ce.createElement("div",{className:"notification-popup__buttons"},this.renderHistoryLink(),ce.createElement("div",{className:"notification-popup__clear-button"},this.renderMarkAsReadButton())),ce.createElement("div",{className:"notification-stacks"},this.renderStacks(),this.renderShowMore()))))}renderFilters(){return null==this.props.only&&L.Z.notificationsWorker.hasData?ce.createElement("div",{className:"notification-popup__filters"},this.links.map(this.renderFilter)):null}renderHistoryLink(){var t;const e="channel"===this.props.only?"chat.index":"notifications.index";return ce.createElement("a",{className:"notification-popup__filter",href:(0,f.B)(e)},(0,m.dW)(`notifications.see_${null!==(t=this.props.only)&&void 0!==t?t:"all"}`))}renderMarkAsReadButton(){var t;const e=this.controller.type;return e.isEmpty?null:ce.createElement(ln.Z,{isMarkingAsRead:this.controller.isMarkingCurrentTypeAsRead,onMarkAsRead:this.handleMarkAsRead,text:(0,m.dW)("notifications.mark_read",{type:(0,m.dW)(`notifications.action_type.${null!==(t=e.name)&&void 0!==t?t:"_"}`)})})}renderShowMore(){const t=this.controller.type;return ce.createElement(Hr.Z,{callback:this.handleShowMore,hasMore:null==t?void 0:t.hasMore,loading:null==t?void 0:t.isLoading,modifiers:["notification-group","notification-list"]})}renderStacks(){if(this.state.hasError)return;const t=this.controller.stacks.map((t=>ce.createElement(cn.Z,{key:t.id,stack:t})));if(0===t.length){let t="notifications.loading";return L.Z.notificationsWorker.hasData?t=null==this.controller.currentFilter?"notifications.all_read":"notifications.none":L.Z.notificationsWorker.waitingVerification&&(t="notifications.verifying"),ce.createElement("p",{key:"empty",className:"notification-popup__empty"},(0,m.dW)(t))}return t}};Object.defineProperty(dn,"defaultProps",{enumerable:!0,configurable:!0,writable:!0,value:{excludes:[]}}),hn([u.Fl],dn.prototype,"links",null),dn=hn([Br.Pi],dn);const pn=dn;var mn=r(9755),fn=function(t,e,r,i){var n,s=arguments.length,o=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(s<3?n(o):s>3?n(e,r,o):n(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o};const gn=["user","user_others","beatmapset","beatmapset_others","others"],vn=["forum_post","wiki_page"];class bn{constructor(){Object.defineProperty(this,"debouncedSearch",{enumerable:!0,configurable:!0,writable:!0,value:(0,lt.debounce)((()=>this.search()),500)}),Object.defineProperty(this,"query",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"searching",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"searchResult",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"selected",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"xhr",{enumerable:!0,configurable:!0,writable:!0,value:null}),(0,u.rC)(this)}cycleSelectedItem(t){let e;if(this.selected)e=Object.assign({},this.selected),e.index+=t;else if(t>0)e={index:0,section:0};else{const t=gn.length-1,r=gn[t];e={index:this.sectionLength(r)-1,section:t}}if(e.index<0||e.index>=this.sectionLength(gn[e.section])){let r=e.section;do{if(r=(r+t)%gn.length,r<0&&(r=gn.length+r),r===e.section)return}while(0===this.sectionLength(gn[r]));e={index:t>0?0:this.sectionLength(gn[r])-1,section:r}}this.selected=e}get currentSection(){if(this.selected)return gn[this.selected.section]}get selectedURL(){var t,e;const r=this.searchResult;if(this.selected&&r)switch(gn[this.selected.section]){case"user":{const e=null===(t=r.user.users[this.selected.index])||void 0===t?void 0:t.id;return e?(0,f.B)("users.show",{user:e}):void 0}case"user_others":return(0,f.B)("search",{mode:"user",query:this.query});case"beatmapset":{const t=null===(e=r.beatmapset.beatmapsets[this.selected.index])||void 0===e?void 0:e.id;return t?(0,f.B)("beatmapsets.show",{beatmapset:t}):void 0}case"beatmapset_others":return(0,f.B)("search",{mode:"beatmapset",query:this.query});case"others":{const t=vn.filter((t=>r[t].total>0))[this.selected.index];return(0,f.B)("search",{mode:t,query:this.query})}}}search(){const t=this.query.trim();0!==t.length?(this.searching=!0,this.xhr=mn.get((0,f.B)("quick-search"),{query:t}).done((0,u.aD)((t=>{this.searchResult=t,this.selected=null}))).always((0,u.aD)((()=>{this.searching=!1})))):this.reset()}selectNone(){this.selected=null}setSelected(t,e){this.selected={index:e,section:gn.indexOf(t)}}updateQuery(t){this.query=t,this.selected=null,this.debouncedSearch()}reset(){this.debouncedSearch.cancel(),null!=this.xhr&&this.xhr.abort(),this.searching=!1,this.searchResult=null,this.selected=null}sectionLength(t){const e=this.searchResult;if(!e)return 0;switch(t){case"user":return e.user.users.length;case"user_others":return e.user.total>e.user.users.length?1:0;case"beatmapset":return e.beatmapset.beatmapsets.length;case"beatmapset_others":return 1;case"others":return vn.filter((t=>e[t].total>0)).length}return 0}}fn([u.LO],bn.prototype,"query",void 0),fn([u.LO],bn.prototype,"searching",void 0),fn([u.LO],bn.prototype,"searchResult",void 0),fn([u.LO],bn.prototype,"selected",void 0),fn([u.aD],bn.prototype,"cycleSelectedItem",null),fn([u.Fl],bn.prototype,"currentSection",null),fn([u.Fl],bn.prototype,"selectedURL",null),fn([u.aD],bn.prototype,"search",null),fn([u.aD],bn.prototype,"selectNone",null),fn([u.aD],bn.prototype,"setSelected",null),fn([u.aD],bn.prototype,"updateQuery",null),fn([u.aD],bn.prototype,"reset",null);var yn=r(9755);function wn(t){return JSON.parse(null!=t?t:"")}function kn(t){if(null==t)throw new Error("unexpected undefined value");return t}L.Z.reactTurbolinks.register("countdownTimer",(t=>ce.createElement(Vr,{deadline:kn(t.dataset.deadline)}))),L.Z.reactTurbolinks.register("blockButton",(t=>ce.createElement(Dr.Z,{userId:parseInt(kn(t.dataset.target),10)}))),L.Z.reactTurbolinks.register("beatmap-discussion-events",(()=>{const t={events:(0,K.Mo)("json-events"),mode:"list",users:(0,lt.keyBy)((0,K.Mo)("json-users"),"id")};return t.users.null=t.users.undefined=on.z7,ce.createElement(Ir.Z,Object.assign({},t))})),L.Z.reactTurbolinks.register("beatmapset-panel",(t=>{const e=wn(t.dataset.beatmapsetPanel);return ce.createElement(Nr.Z,Object.assign({},(0,u.LO)(e)))})),L.Z.reactTurbolinks.register("ranking-select-options",(()=>ce.createElement(ji.Z,Object.assign({},(0,K.Mo)("json-ranking-select-options"))))),L.Z.reactTurbolinks.register("spotlight-select-options",(()=>ce.createElement(Ci,Object.assign({},(0,K.Mo)("json-spotlight-select-options"))))),L.Z.reactTurbolinks.register("chat-icon",(t=>ce.createElement(Ar,{type:t.dataset.type}))),L.Z.reactTurbolinks.register("main-notification-icon",(t=>ce.createElement(Kr,{type:t.dataset.type}))),L.Z.reactTurbolinks.register("notification-widget",(t=>ce.createElement(pn,Object.assign({},wn(t.dataset.notificationWidget)))));const jn=new bn;L.Z.reactTurbolinks.register("quick-search",(()=>ce.createElement(hi,{worker:jn}))),L.Z.reactTurbolinks.register("quick-search-button",(()=>ce.createElement(gi,{worker:jn}))),L.Z.reactTurbolinks.register("ranking-country-filter",(()=>ce.createElement(ki,Object.assign({},(0,K.Mo)("json-country-filter"))))),L.Z.reactTurbolinks.register("ranking-user-filter",(()=>ce.createElement(xi,Object.assign({},(0,K.Mo)("json-user-filter"))))),L.Z.reactTurbolinks.register("ranking-variant-filter",(()=>ce.createElement(Si,Object.assign({},(0,K.Mo)("json-variant-filter"))))),L.Z.reactTurbolinks.register("user-card",(t=>{var e,r;return ce.createElement(Ti.O,{modifiers:wn(null!==(e=t.dataset.modifiers)&&void 0!==e?e:"null"),user:"1"===t.dataset.isCurrentUser?L.Z.currentUser:wn(null!==(r=t.dataset.user)&&void 0!==r?r:"null")})})),L.Z.reactTurbolinks.register("user-card-store",(t=>ce.createElement(Mi,{user:wn(t.dataset.user)}))),L.Z.reactTurbolinks.register("user-card-tooltip",(t=>ce.createElement(Gi,{container:t,lookup:kn(t.dataset.lookup)}))),yn(document).ready((function(){Di(document).on("mouseover",".js-usercard",Zi),Di(document).on("mouseenter",".js-react--user-card-tooltip",Wi),Di(document).on("mouseleave",".js-react--user-card-tooltip",Vi),Di(document).on("turbolinks:before-cache",Fi),Di.subscribe("user-card:remove.tooltip",Ji)})),L.Z.reactTurbolinks.register("user-cards",(t=>{var e,r;return ce.createElement(Ki.G,{modifiers:wn(null!==(e=t.dataset.modifiers)&&void 0!==e?e:"null"),users:wn(null!==(r=t.dataset.users)&&void 0!==r?r:"[]"),viewMode:"card"})})),L.Z.reactTurbolinks.register("wiki-search",(()=>ce.createElement(sn,null))),L.Z.reactTurbolinks.register("landing-news",(()=>ce.createElement($r,{posts:(0,K.Mo)("json-posts")})))}},t=>{var e=e=>t(t.s=e);t.O(0,[736,351],(()=>(e(2353),e(5737))));t.O()}]);
//# sourceMappingURL=app.19a2128d.js.map