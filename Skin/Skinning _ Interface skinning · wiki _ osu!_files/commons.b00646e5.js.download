"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[351],{2858:(e,t,s)=>{s.d(t,{Z:()=>f});var r,i=s(7294),n=s(2278),a=s(3336),o=s(5076),l=s(1270),c=s(6486);i.createElement,r={add:"fas fa-plus",fix:"fas fa-check",misc:"far fa-circle"};var u,d=function(e){var t,s;return t=e.entry,s=c.escape(t.title).replace(/(`+)([^`]+)\1/g,"<code>$2</code>"),(0,n.div)({className:"changelog-entry",key:t.id},(0,n.div)({className:"changelog-entry__row"},(0,n.div)({className:"changelog-entry__title "+(t.major?"changelog-entry__title--major":"")},(0,n.span)({className:"changelog-entry__title-icon"},(0,n.span)({className:"changelog-entry__icon "+r[t.type]})),null!=t.url?(0,n.a)({href:t.url,className:"changelog-entry__link",dangerouslySetInnerHTML:{__html:s}}):(0,n.span)({dangerouslySetInnerHTML:{__html:s}}),null!=t.github_url?(0,n.span)(null," (",(0,n.a)({className:"changelog-entry__link",href:t.github_url},t.repository.replace(/^.*\//,"")+"#"+t.github_pull_request_id),")"):void 0,function(){var e,s,r,i,a;return a=c.escape(t.github_user.display_name),e=null!=(i=null!=(s=t.github_user.github_url)?s:t.github_user.user_url)?"<a data-user-id='"+(null!=(r=t.github_user.user_id)?r:"")+"' class='changelog-entry__user-link js-usercard' href='"+c.escape(i)+"' >"+a+"</a>":a,(0,n.span)({className:"changelog-entry__user",dangerouslySetInnerHTML:{__html:(0,l.dW)("changelog.entry.by",{user:e})}})}())),null!=t.message_html?(0,n.div)({className:"changelog-entry__row changelog-entry__row--message",dangerouslySetInnerHTML:{__html:t.message_html}}):void 0)},p=s(6486),m=s(381),h=function(e,t){return function(){return e.apply(t,arguments)}},b={}.hasOwnProperty;u=i.createElement;var f=function(e){function t(){return this.renderNav=h(this.renderNav,this),this.render=h(this.render,this),t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var s in t)b.call(t,s)&&(e[s]=t[s]);function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype}(t,e),t.prototype.render=function(){var e,t,s,r,i,l,c;return e=(0,a.sb)("build",this.props.modifiers),r=p.groupBy(this.props.build.changelog_entries,"category"),t=p(r).keys().sort().value(),(0,n.div)({className:e+" t-changelog-stream--"+p.kebabCase(this.props.build.update_stream.display_name)},(0,n.div)({className:"build__version"},this.renderNav({version:"previous",icon:"fas fa-chevron-left"}),(0,n.a)({className:"build__version-link",href:(0,o.TR)(this.props.build)},(0,n.span)({className:"build__stream"},this.props.build.update_stream.display_name)," ",(0,n.span)({className:"u-changelog-stream--text"},this.props.build.display_version)),this.renderNav({version:"next",icon:"fas fa-chevron-right"})),null!=(l=this.props.showDate)&&l?(0,n.div)({className:"build__date"},m(this.props.build.created_at).format("LL")):void 0,null!=this.props.build.youtube_id&&null!=(c=this.props.showVideo)&&c?(0,n.div)({className:"build__video"},(0,n.iframe)({className:"u-embed-wide",allowFullScreen:!0,src:"https://www.youtube.com/embed/"+this.props.build.youtube_id+"?rel=0"})):void 0,function(){var e,a,o;for(o=[],e=0,a=t.length;e<a;e++)s=t[e],o.push((0,n.div)({key:s,className:"build__changelog-entries-container"},(0,n.div)({className:"build__changelog-entries-category"},s),(0,n.div)({className:"build__changelog-entries"},function(){var e,t,a,o,l;for(l=[],e=0,t=(a=r[s]).length;e<t;e++)i=a[e],l.push((0,n.div)({key:null!=(o=i.id)?o:i.created_at+"-"+i.title,className:"build__changelog-entry"},u(d,{entry:i})));return l}())));return o}())},t.prototype.renderNav=function(e){var t,s,r;if(r=e.version,s=e.icon,null!=this.props.build.versions)return null!=(t=this.props.build.versions[r])?(0,n.a)({className:"build__version-link",href:(0,o.TR)(t),title:t.display_version},(0,n.i)({className:s})):(0,n.span)({className:"build__version-link build__version-link--disabled"},(0,n.i)({className:s}))},t}(i.PureComponent)},735:(e,t,s)=>{s.d(t,{s:()=>d});var r=s(7294),i=s(2278),n=s(3336),a=s(1270),o=s(5076),l=s(6486),c=function(e,t){return function(){return e.apply(t,arguments)}},u={}.hasOwnProperty;r.createElement;var d=function(e){function t(){return this.renderHeaderStream=c(this.renderHeaderStream,this),this.render=c(this.render,this),t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var s in t)u.call(t,s)&&(e[s]=t[s]);function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype}(t,e),t.prototype.render=function(){var e;return(0,i.div)({className:(0,n.sb)("update-streams-v2",[null!=this.props.currentStreamId?"with-active":void 0])},(0,i.div)({className:"update-streams-v2__container"},function(){var t,s,r,i;for(i=[],t=0,s=(r=this.props.updateStreams).length;t<s;t++)e=r[t],i.push(this.renderHeaderStream({stream:e}));return i}.call(this)))},t.prototype.renderHeaderStream=function(e){var t,s,r;return s=e.stream,r=l.kebabCase(s.display_name),t=(0,n.sb)("update-streams-v2__item",[r,s.is_featured?"featured":void 0,this.props.currentStreamId===s.id?"active":void 0]),t+=" t-changelog-stream--"+r,(0,i.a)({href:(0,o.TR)(s.latest_build),key:s.id,className:t},(0,i.div)({className:"update-streams-v2__bar u-changelog-stream--bg"}),(0,i.p)({className:"update-streams-v2__row update-streams-v2__row--name"},s.display_name),(0,i.p)({className:"update-streams-v2__row update-streams-v2__row--version"},s.latest_build.display_version),s.user_count>0?(0,i.p)({className:"update-streams-v2__row update-streams-v2__row--users"},(0,a.jn)("changelog.builds.users_online",s.user_count)):void 0)},t}(r.PureComponent)},8457:(e,t,s)=>{s.d(t,{O:()=>r});class r{constructor(e){Object.defineProperty(this,"message",{enumerable:!0,configurable:!0,writable:!0,value:e})}}},8701:(e,t,s)=>{s.d(t,{Z:()=>r});class r{}},789:(e,t,s)=>{s.d(t,{Z:()=>r});class r{constructor(e){Object.defineProperty(this,"userId",{enumerable:!0,configurable:!0,writable:!0,value:e})}}},1723:(e,t,s)=>{s.d(t,{WI:()=>i,yz:()=>n});const r=new class{constructor(){Object.defineProperty(this,"listeners",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"dispatch",{enumerable:!0,configurable:!0,writable:!0,value:e=>{this.listeners.forEach((t=>{t.handleDispatchAction(e)}))}})}get size(){return this.listeners.size}clear(){this.listeners.clear()}has(e){return this.listeners.has(e)}register(e){this.listeners.add(e)}unregister(e){this.listeners.delete(e)}};const i=r.dispatch;function n(e){return class extends e{constructor(...e){var t;super(...e),"object"==typeof(t=this)&&null!=t&&"handleDispatchAction"in t&&r.register(this)}}}},6945:(e,t,s)=>{s.d(t,{g:()=>r});const r=s(7294).createContext({})},7871:(e,t,s)=>{s.d(t,{h:()=>r});const r=s(7294).createContext({})},5692:(e,t,s)=>{s.d(t,{Z:()=>a});var r=s(5050),i=s(7294),n=s(41);function a({message:e,isTimeline:t}){return t?i.createElement(r.Z,{maxLength:n.nc,message:e,modifiers:"discussion"}):null}},1480:(e,t,s)=>{s.d(t,{Z:()=>v});var r=s(3974),i=s(7294),n=s(9469),a=s(1356),o=s(3955),l=s(5305),c=s(6741),u=s(3664),d=s(8949),p=s(9323),m=function(e,t,s,r){var i,n=arguments.length,a=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(n<3?i(a):n>3?i(t,s,a):i(t,s))||a);return n>3&&a&&Object.defineProperty(t,s,a),a};let h=class extends i.Component{constructor(e){super(e),Object.defineProperty(this,"loaded",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"handleOnLoad",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.loaded=!0}}),(0,d.rC)(this)}render(){if(null==this.props.src)return null;const e=(0,u.B)("beatmapsets.discussions.media-url",{url:this.props.src}),t=i.createElement(i.Fragment,null,!this.loaded&&this.renderSpinner(),i.createElement("img",Object.assign({},this.props.node.properties,{loading:"lazy",onLoad:this.handleOnLoad,src:e})));return i.createElement(r.FU.Consumer,null,(({inLink:s})=>s?i.createElement("span",{className:"beatmapset-discussion-image-link"},t):i.createElement("a",{className:"beatmapset-discussion-image-link",href:e,rel:"nofollow noreferrer",target:"_blank"},t)))}renderSpinner(){return i.createElement("span",{className:"beatmapset-discussion-image-link__spinner"},i.createElement(c.$,null))}};m([d.LO],h.prototype,"loaded",void 0),m([d.aD],h.prototype,"handleOnLoad",void 0),h=m([p.Pi],h);const b=h,f=Object.freeze({a:r.fv,em:(0,r.Us)("em"),img:b,li:(0,r.Us)("li"),p:(0,r.Us)("p"),strong:(0,r.Us)("strong")});class v extends i.Component{render(){return i.createElement(n.D,{className:"osu-md osu-md--discussions",components:f,remarkPlugins:[o.Z,[l.Z,{type:this.props.type}],a.Z],transformLinkUri:r.H,unwrapDisallowed:!0},this.props.markdown)}}},7005:(e,t,s)=>{s.d(t,{q:()=>r});const r=["reviews","generalAll","general","timeline","events"]},5813:(e,t,s)=>{s.d(t,{n:()=>r,y:()=>i});const r=["hype","mapper_note","praise","problem","review","suggestion"],i={hype:"fas fa-bullhorn",mapper_note:"far fa-sticky-note",praise:"fas fa-heart",problem:"fas fa-exclamation-circle",resolved:"far fa-check-circle",review:"fas fa-tasks",suggestion:"far fa-circle"}},6835:(e,t,s)=>{s.d(t,{$:()=>G});var r=s(6486),i=s(8949),n=s(9323),a=s(8125),o=s(7181),l=s(7294),c=s(41),u=s(6817),d=s(3336),p=s(1270),m=s(5813),h=s(2009),b=s(3664),f=s(7762),v=s(9703),g=s(9711),y=s(9755),w=function(e,t,s,r){var i,n=arguments.length,a=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(n<3?i(a):n>3?i(t,s,a):i(t,s))||a);return n>3&&a&&Object.defineProperty(t,s,a),a};const _=["up","down"];let E=class extends l.Component{get canDownvote(){return null!=o.Z.currentUser&&(o.Z.currentUser.is_admin||o.Z.currentUser.is_moderator||o.Z.currentUser.is_bng)}constructor(e){super(e),Object.defineProperty(this,"tooltips",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"voteXhr",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"handleClick",{enumerable:!0,configurable:!0,writable:!0,value:e=>{null==this.voteXhr&&((0,g.Uq)(),this.voteXhr=y.ajax((0,b.B)("beatmapsets.discussions.vote",{discussion:this.props.discussion.id}),{data:{beatmap_discussion_vote:{score:e.currentTarget.dataset.score}},method:"PUT"}),this.voteXhr.done((e=>y.publish("beatmapsetDiscussions:update",{beatmapset:e}))).fail(v.qQ).always((0,i.aD)((()=>{(0,g.Lt)(),this.voteXhr=null}))))}}),Object.defineProperty(this,"handleHover",{enumerable:!0,configurable:!0,writable:!0,value:e=>{var t,s;const r=e.currentTarget,i=r.dataset.type;null!==(t=(s=this.tooltips)[i])&&void 0!==t||(s[i]=(0,h.N)(r,"top center",this.getTooltipContent(i)))}}),(0,i.rC)(this)}componentDidUpdate(){var e,t;for(const s of _)null===(t=null===(e=this.tooltips[s])||void 0===e?void 0:e.qtip("api"))||void 0===t||t.set("content.text",this.getTooltipContent(s))}componentWillUnmount(){var e;null===(e=this.voteXhr)||void 0===e||e.abort()}render(){return _.map((e=>l.createElement("div",{key:e,"data-type":e,onMouseOver:this.handleHover,onTouchStart:this.handleHover},this.renderVote(e))))}getTooltipContent(e){const t=this.props.discussion.votes[e],s=t<1?(0,p.dW)(`beatmaps.discussions.votes.none.${e}`):`${(0,p.dW)(`beatmaps.discussions.votes.latest.${e}`)}:`,r=this.props.discussion.votes.voters[e].map((e=>{var t;return null!==(t=this.props.users[e])&&void 0!==t?t:{id:e}}));return(0,f.renderToStaticMarkup)(l.createElement(h.Z,{count:t,title:s,users:r}))}renderVote(e){var t;const[s,r]="up"===e?[1,"thumbs-up"]:[-1,"thumbs-down"],i=(null===(t=this.props.discussion.current_user_attributes)||void 0===t?void 0:t.vote_score)===s?0:s,n=null!=this.voteXhr||this.props.cannotVote||"down"===e&&!this.canDownvote;return l.createElement("button",{className:(0,d.sb)("beatmap-discussion-vote",e,{inactive:0!==i}),"data-score":i,disabled:n,onClick:this.handleClick},l.createElement("i",{className:`fas fa-${r}`}),l.createElement("span",{className:"beatmap-discussion-vote__count"},this.props.discussion.votes[e]))}};w([i.LO],E.prototype,"voteXhr",void 0),w([i.Fl],E.prototype,"canDownvote",null),w([i.aD],E.prototype,"handleClick",void 0),E=w([n.Pi],E);const O=E;var P=s(9333),j=s(7010),k=s(2163),N=s(4929),S=s(7937),C=s(3924),T=s(5692),x=s(9755),D=function(e,t,s,r){var i,n=arguments.length,a=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(n<3?i(a):n>3?i(t,s,a):i(t,s))||a);return n>3&&a&&Object.defineProperty(t,s,a),a};const R="beatmap-discussion-post",M={reply:"fas fa-reply",reply_reopen:"fas fa-exclamation-circle",reply_resolve:"fas fa-check"},I={reply_reopen:!1,reply_resolve:!0};let L=class extends l.Component{get canReopen(){var e,t;return this.props.discussion.can_be_resolved&&null!==(t=null===(e=this.props.discussion.current_user_attributes)||void 0===e?void 0:e.can_reopen)&&void 0!==t&&t}get canResolve(){var e,t;return this.props.discussion.can_be_resolved&&null!==(t=null===(e=this.props.discussion.current_user_attributes)||void 0===e?void 0:e.can_resolve)&&void 0!==t&&t}get isTimeline(){return null!=this.props.discussion.timestamp}get storageKey(){return`beatmapset-discussion:reply:${this.props.discussion.id}:message`}get storedMessage(){var e;return null!==(e=localStorage.getItem(this.storageKey))&&void 0!==e?e:""}get validPost(){return(0,c.Ks)(this.message,this.isTimeline)}constructor(e){super(e),Object.defineProperty(this,"box",{enumerable:!0,configurable:!0,writable:!0,value:l.createRef()}),Object.defineProperty(this,"editing",{enumerable:!0,configurable:!0,writable:!0,value:(0,C.W)(this.storedMessage)}),Object.defineProperty(this,"handleKeyDown",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"message",{enumerable:!0,configurable:!0,writable:!0,value:this.storedMessage}),Object.defineProperty(this,"posting",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"postXhr",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"startEditing",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"editStart",{enumerable:!0,configurable:!0,writable:!0,value:()=>{o.Z.userLogin.showIfGuest(this.editStart)||(this.editing=!0,this.startEditing=!0)}}),Object.defineProperty(this,"handleChange",{enumerable:!0,configurable:!0,writable:!0,value:e=>{this.setMessage(e.target.value)}}),Object.defineProperty(this,"handleKeyDownCallback",{enumerable:!0,configurable:!0,writable:!0,value:(e,t)=>{switch(e){case S.z.Cancel:this.editing=!1;break;case S.z.Submit:this.post(t)}}}),Object.defineProperty(this,"onCancelClick",{enumerable:!0,configurable:!0,writable:!0,value:()=>{(0,C.W)(this.message)&&!confirm((0,p.dW)("common.confirmation_unsaved"))||(this.editing=!1,this.setMessage(""))}}),Object.defineProperty(this,"post",{enumerable:!0,configurable:!0,writable:!0,value:e=>{var t;if(!this.validPost||null!=this.postXhr)return;(0,g.Uq)();const s=null!==(t=e.currentTarget.dataset.action)&&void 0!==t?t:"reply";this.posting=s;const r={beatmap_discussion:{resolved:I[s]},beatmap_discussion_id:this.props.discussion.id,beatmap_discussion_post:{message:this.message}};this.postXhr=x.ajax((0,b.B)("beatmapsets.discussions.posts.store"),{data:r,method:"POST"}),this.postXhr.done((e=>(0,i.z)((()=>{this.editing=!1,this.setMessage(""),x.publish("beatmapDiscussionPost:markRead",{id:e.beatmap_discussion_post_ids}),x.publish("beatmapsetDiscussions:update",{beatmapset:e.beatmapset})})))).fail(v.qQ).always((0,i.aD)((()=>{(0,g.Lt)(),this.postXhr=null,this.posting=null})))}}),(0,i.rC)(this),this.handleKeyDown=(0,S.k)(this.handleKeyDownCallback)}componentDidUpdate(e){var t;e.discussion.id===this.props.discussion.id?this.startEditing&&(this.startEditing=!1,null===(t=this.box.current)||void 0===t||t.focus()):this.message=this.storedMessage}componentWillUnmount(){var e;null===(e=this.postXhr)||void 0===e||e.abort()}render(){return this.editing?this.renderBox():this.renderPlaceholder()}renderBox(){return l.createElement("div",{className:`${R} ${R}--reply ${R}--new-reply`},this.renderCancelButton(),l.createElement("div",{className:`${R}__content`},l.createElement("div",{className:`${R}__avatar`},l.createElement(N.Z,{modifiers:"full-rounded",user:o.Z.currentUser})),l.createElement("div",{className:`${R}__message-container`},l.createElement(k.Z,{className:`${R}__message ${R}__message--editor`,disabled:null!=this.posting,innerRef:this.box,onChange:this.handleChange,onKeyDown:this.handleKeyDown,placeholder:(0,p.dW)("beatmaps.discussions.reply_placeholder"),value:this.message}))),l.createElement("div",{className:`${R}__footer ${R}__footer--notice`},(0,p.dW)("beatmaps.discussions.reply_notice"),l.createElement(T.Z,{isTimeline:this.isTimeline,message:this.message})),l.createElement("div",{className:`${R}__footer`},l.createElement("div",{className:`${R}__actions`},l.createElement("div",{className:`${R}__actions-group`},this.canResolve&&!this.props.discussion.resolved&&this.renderReplyButton("reply_resolve"),this.canReopen&&this.props.discussion.resolved&&this.renderReplyButton("reply_reopen"),this.renderReplyButton("reply")))))}renderCancelButton(){return l.createElement("button",{className:`${R}__action ${R}__action--cancel`,disabled:null!=this.posting,onClick:this.onCancelClick},l.createElement("i",{className:"fas fa-times"}))}renderPlaceholder(){const[e,t,s]=null!=o.Z.currentUser?[(0,p.dW)("beatmap_discussions.reply.open.user"),"fas fa-reply",o.Z.currentUser.is_silenced]:[(0,p.dW)("beatmap_discussions.reply.open.guest"),"fas fa-sign-in-alt",!1];return l.createElement("div",{className:`${R} ${R}--reply ${R}--new-reply ${R}--new-reply-placeholder`},l.createElement(j.Z,{disabled:s,icon:t,modifiers:"beatmap-discussion-reply-open",props:{onClick:this.editStart},text:e}))}renderReplyButton(e){return l.createElement("div",{className:`${R}__action`},l.createElement(j.Z,{disabled:!this.validPost||null!=this.posting,icon:M[e],isBusy:this.posting===e,props:{"data-action":e,onClick:this.post},text:(0,p.dW)(`common.buttons.${e}`)}))}setMessage(e){this.message=e,(0,C.W)(this.message)?localStorage.setItem(this.storageKey,this.message):localStorage.removeItem(this.storageKey)}};D([i.LO],L.prototype,"box",void 0),D([i.LO],L.prototype,"editing",void 0),D([i.LO],L.prototype,"message",void 0),D([i.LO],L.prototype,"posting",void 0),D([i.aD],L.prototype,"componentDidUpdate",null),D([i.aD],L.prototype,"editStart",void 0),D([i.aD],L.prototype,"handleKeyDownCallback",void 0),D([i.aD],L.prototype,"onCancelClick",void 0),D([i.aD],L.prototype,"post",void 0),D([i.aD],L.prototype,"setMessage",null),L=D([n.Pi],L);var A=s(5989),$=s(4403),B=s(9696);function U({post:e,user:t}){"resolved"!==e.message.type&&(0,B.Q)(e.message.type);const s=(0,d.sb)("beatmap-discussion-system-post",e.message.type,{deleted:null!=e.deleted_at});return l.createElement("div",{className:s},l.createElement("div",{className:"beatmap-discussion-system-post__content"},l.createElement($.Z,{mappings:{user:l.createElement("a",{className:"beatmap-discussion-system-post__user",href:(0,b.B)("users.show",{user:t.id})},t.username)},pattern:(0,p.dW)(`beatmap_discussions.system.resolved.${e.message.value}`)})))}var F=s(2786),W=function(e,t,s,r){var i,n=arguments.length,a=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(n<3?i(a):n>3?i(t,s,a):i(t,s))||a);return n>3&&a&&Object.defineProperty(t,s,a),a};const Z="beatmap-discussion";function H({type:e}){const t="resolved"===e?"beatmaps.discussions.resolved":`beatmaps.discussions.message_type.${e}`;return l.createElement("span",{className:m.y[e],style:{color:`var(--beatmapset-discussion-colour--${e})`},title:(0,p.dW)(t)})}let G=class extends l.Component{constructor(e){super(e),Object.defineProperty(this,"lastResolvedState",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"handleCollapseClick",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.context.discussionCollapsed.set(this.props.discussion.id,!this.collapsed)}}),Object.defineProperty(this,"handleSetHighlight",{enumerable:!0,configurable:!0,writable:!0,value:e=>{e.defaultPrevented||(this.context.highlightedDiscussionId=this.props.discussion.id)}}),Object.defineProperty(this,"renderReply",{enumerable:!0,configurable:!0,writable:!0,value:e=>{if(!this.isVisible(e))return null;if(e.system&&"resolved"===e.message.type){if(this.lastResolvedState===e.message.value)return null;this.lastResolvedState=e.message.value}return this.renderPost(e,"reply")}}),(0,i.rC)(this)}get canBeRepliedTo(){var e;return!(0,u.wm)(this.props.beatmapset)&&(!this.props.beatmapset.discussion_locked||(0,c.e7)())&&(null==this.props.discussion.beatmap_id||null==(null===(e=this.props.currentBeatmap)||void 0===e?void 0:e.deleted_at))}get collapsed(){var e;return null!==(e=this.context.discussionCollapsed.get(this.props.discussion.id))&&void 0!==e?e:this.context.discussionDefaultCollapsed}get highlighted(){return this.context.highlightedDiscussionId===this.props.discussion.id}get resolvedSystemPostId(){var e;if(this.props.preview)return-1;const t=(0,r.findLast)(this.props.discussion.posts,(e=>null!=e&&e.system&&"resolved"===e.message.type));return null!==(e=null==t?void 0:t.id)&&void 0!==e?e:-1}render(){var e;if(!this.isVisible(this.props.discussion))return null;const t=(0,c.of)(this.props.discussion);if(null==t)return null;const s=(0,d.sb)(`${Z}__line`,{resolved:this.props.discussion.resolved});this.lastResolvedState=!1;const r=null!==(e=this.props.users[this.props.discussion.user_id])&&void 0!==e?e:a.z7,i=(0,c.G2)({beatmapset:this.props.beatmapset,currentBeatmap:this.props.currentBeatmap,discussion:this.props.discussion,user:r}),n=(0,d.sb)(Z,{deleted:null!=this.props.discussion.deleted_at,highlighted:this.highlighted,"horizontal-desktop":"review"!==this.props.discussion.message_type,preview:this.props.preview,review:"review"===this.props.discussion.message_type,timeline:null!=this.props.discussion.timestamp,unread:!this.isRead(t)});return l.createElement("div",{className:`${n}`,onClick:this.handleSetHighlight,style:{"--discussion-colour":`var(--beatmapset-discussion-colour--${this.props.discussion.message_type})`}},l.createElement("div",{className:`${Z}__timestamp hidden-xs`},this.renderTimestamp()),l.createElement("div",{className:`${Z}__discussion js-beatmap-discussion-jump`,"data-id":this.props.discussion.id},l.createElement("div",{className:`${Z}__top`,style:(0,d.$$)(i)},l.createElement("div",{className:`${Z}__top-user`},l.createElement(F.O,{group:i,hideStripe:!0,user:r})),l.createElement("div",{className:`${Z}__top-message`},this.renderPost(t,"discussion")),this.renderPostButtons()),this.postFooter(),l.createElement("div",{className:s})))}isOwner(e){return null!=o.Z.currentUser&&o.Z.currentUser.id===e.user_id}isRead(e){var t;return(null===(t=this.props.readPostIds)||void 0===t?void 0:t.has(e.id))||this.isOwner(e)||this.props.preview}isVisible(e){return null!=e&&(this.props.showDeleted||null==e.deleted_at)}postFooter(){if(this.props.preview)return null;let e=`${Z}__expanded`;return this.collapsed&&(e+=" hidden"),l.createElement("div",{className:e},l.createElement("div",{className:`${Z}__replies`},this.props.discussion.posts.slice(1).map(this.renderReply)),this.canBeRepliedTo&&l.createElement(L,{beatmapset:this.props.beatmapset,currentBeatmap:this.props.currentBeatmap,discussion:this.props.discussion}))}renderPost(e,t){var s;const r=null!==(s=this.props.users[e.user_id])&&void 0!==s?s:a.z7;return e.system?l.createElement(U,{key:e.id,post:e,user:r}):l.createElement(A.Z,{key:e.id,beatmap:this.props.currentBeatmap,beatmapset:this.props.beatmapset,discussion:this.props.discussion,post:e,read:this.isRead(e),readonly:this.props.readonly,resolvedSystemPostId:this.resolvedSystemPostId,type:t,user:r,users:this.props.users})}renderPostButtons(){var e;if(this.props.preview)return null;const t=this.props.users[this.props.discussion.user_id];return l.createElement("div",{className:`${Z}__top-actions`},l.createElement("div",{className:`${Z}__actions`},null!=this.props.parentDiscussion&&l.createElement("a",{className:`${Z}__link-to-parent js-beatmap-discussion--jump`,href:(0,c.bf)({discussion:this.props.parentDiscussion}),title:(0,p.dW)("beatmap_discussions.review.go_to_parent")},l.createElement("i",{className:"fas fa-tasks"})),l.createElement("span",{className:"visible-xs"},l.createElement(H,{type:this.props.discussion.message_type})),l.createElement(O,{cannotVote:this.isOwner(this.props.discussion)||null!==(e=null==t?void 0:t.is_bot)&&void 0!==e&&e||!this.canBeRepliedTo,discussion:this.props.discussion,users:this.props.users}),l.createElement("button",{className:`${Z}__action ${Z}__action--with-line`,onClick:this.handleCollapseClick},l.createElement("div",{className:(0,d.sb)("beatmap-discussion-expand",{expanded:!this.collapsed})},l.createElement("i",{className:"fas fa-chevron-down"})))))}renderTimestamp(){return l.createElement("div",{className:(0,d.sb)("beatmap-discussion-timestamp",{sticky:this.props.isTimelineVisible})},null!=this.props.discussion.timestamp&&this.props.isTimelineVisible&&l.createElement("div",{className:"beatmap-discussion-timestamp__point"}),l.createElement("div",{className:"beatmap-discussion-timestamp__icons-container"},l.createElement("div",{className:"beatmap-discussion-timestamp__icons"},l.createElement(H,{type:this.props.discussion.message_type}),this.props.discussion.resolved&&l.createElement(H,{type:"resolved"})),null!=this.props.discussion.timestamp&&l.createElement("div",{className:"beatmap-discussion-timestamp__text"},(0,c.i$)(this.props.discussion.timestamp))))}};Object.defineProperty(G,"contextType",{enumerable:!0,configurable:!0,writable:!0,value:P.Z}),Object.defineProperty(G,"defaultProps",{enumerable:!0,configurable:!0,writable:!0,value:{preview:!1,readonly:!1}}),W([i.Fl],G.prototype,"canBeRepliedTo",null),W([i.Fl],G.prototype,"collapsed",null),W([i.Fl],G.prototype,"highlighted",null),W([i.Fl],G.prototype,"resolvedSystemPostId",null),W([i.aD],G.prototype,"handleCollapseClick",void 0),W([i.aD],G.prototype,"handleSetHighlight",void 0),G=W([n.Pi],G)},7366:(e,t,s)=>{s.d(t,{n:()=>r});const r=(0,s(7294).createContext)({})},9333:(e,t,s)=>{s.d(t,{Z:()=>n});var r=s(7294),i=s(3578);const n=(0,r.createContext)(new i.Z)},3578:(e,t,s)=>{s.d(t,{Z:()=>n});var r=s(8949),i=function(e,t,s,r){var i,n=arguments.length,a=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(n<3?i(a):n>3?i(t,s,a):i(t,s))||a);return n>3&&a&&Object.defineProperty(t,s,a),a};class n{constructor(){Object.defineProperty(this,"discussionCollapsed",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"discussionDefaultCollapsed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"highlightedDiscussionId",{enumerable:!0,configurable:!0,writable:!0,value:null}),(0,r.rC)(this)}}i([r.LO],n.prototype,"discussionCollapsed",void 0),i([r.LO],n.prototype,"discussionDefaultCollapsed",void 0),i([r.LO],n.prototype,"highlightedDiscussionId",void 0)},7125:(e,t,s)=>{s.d(t,{Z:()=>me});var r=s(7735),i=s(6741),n=s(8156),a=s(3664),o=s(6486),l=s(7181),c=s(7294),u=s(4822),d=s(7645),p=s(8872),m=s(9703),h=s(7629),b=s(41),f=s(6817),v=s(3336),g=s(1270);const y=c.createContext([]);var w=s(2938),_=s(5076),E=s(9434),O=s(1426),P=s(4498);const j=c.createContext(null);class k extends c.Component{constructor(){super(...arguments),Object.defineProperty(this,"renderButton",{enumerable:!0,configurable:!0,writable:!0,value:(e,t,s)=>{var r;const i=null!==(r=this.props.menuOptions.find((e=>e.id===this.props.selected)))&&void 0!==r?r:this.props.menuOptions[0],n=[];return this.props.disabled&&(s=()=>{},n.push("disabled")),c.createElement("div",{ref:t,className:(0,v.sb)("icon-dropdown-menu",n),contentEditable:!1,onClick:s},i.icon,e)}}),Object.defineProperty(this,"renderMenuItem",{enumerable:!0,configurable:!0,writable:!0,value:e=>{var t;return c.createElement("button",{key:e.id,className:(0,v.sb)("simple-menu__item",{active:e.id===this.props.selected}),"data-id":e.id,onClick:this.select},null===(t=e.renderIcon)||void 0===t||t?c.createElement(c.Fragment,null,c.createElement("div",{className:(0,v.sb)("simple-menu__item-icon","icon-dropdown-menu")},e.icon),c.createElement("div",{className:"simple-menu__label"},e.label)):e.label)}}),Object.defineProperty(this,"select",{enumerable:!0,configurable:!0,writable:!0,value:e=>{var t;e.preventDefault();const s=e.currentTarget;null!=s&&this.props.onSelect(null!==(t=s.dataset.id)&&void 0!==t?t:"")}})}render(){return c.createElement(P.Z,{customRender:this.renderButton,direction:"right"},(()=>c.createElement("div",{className:"simple-menu simple-menu--popup-menu-compact"},this.props.menuOptions.map(this.renderMenuItem))))}}Object.defineProperty(k,"contextType",{enumerable:!0,configurable:!0,writable:!0,value:j});const N=k;class S extends c.Component{constructor(){super(...arguments),Object.defineProperty(this,"select",{enumerable:!0,configurable:!0,writable:!0,value:e=>{const t="all"!==e?parseInt(e,10):void 0,s=p.F3.findPath(this.context,this.props.element);u.YR.setNodes(this.context,{beatmapId:t},{at:s})}})}render(){var e;const t=[],s="full-width";return t.push({icon:c.createElement("i",{className:"fas fa-fw fa-star-of-life"}),id:"all",label:c.createElement("div",{className:(0,v.sb)("beatmap-list-item",s)},c.createElement("div",{className:"beatmap-list-item__col beatmap-list-item__col--icon"},c.createElement("i",{className:"fas fa-xs fa-star-of-life"})),c.createElement("div",{className:"beatmap-list-item__col beatmap-list-item__col--main"},(0,g.dW)("beatmaps.discussions.mode.scopes.generalAll"))),renderIcon:!1}),this.props.beatmaps.forEach((e=>{null==e.deleted_at&&t.push({icon:c.createElement(E.p,{beatmap:e}),id:e.id.toString(),label:c.createElement(O.Z,{beatmap:e,mapper:null,modifiers:s}),renderIcon:!1})})),c.createElement(N,{disabled:this.props.disabled,menuOptions:t,onSelect:this.select,selected:null===(e=this.props.element.beatmapId)||void 0===e?void 0:e.toString()})}}Object.defineProperty(S,"contextType",{enumerable:!0,configurable:!0,writable:!0,value:j});const C=S;var T=s(5813);const x=["praise","problem","suggestion"];class D extends c.Component{constructor(){super(...arguments),Object.defineProperty(this,"select",{enumerable:!0,configurable:!0,writable:!0,value:e=>{const t=p.F3.findPath(this.context,this.props.element);u.YR.setNodes(this.context,{discussionType:e},{at:t})}})}render(){const e=x.map((e=>({icon:c.createElement("span",{className:T.y[e],style:{color:`var(--beatmapset-discussion-colour--${e})`}}),id:e,label:(0,g.dW)(`beatmaps.discussions.message_type.${e}`)})));return c.createElement(N,{disabled:this.props.disabled,menuOptions:e,onSelect:this.select,selected:this.props.element.discussionType})}}Object.defineProperty(D,"contextType",{enumerable:!0,configurable:!0,writable:!0,value:j});const R=D;var M=s(3030),I=s(9755);const L="beatmap-discussion-review-post-embed-preview";class A extends c.Component{constructor(){super(...arguments),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"tooltipContent",{enumerable:!0,configurable:!0,writable:!0,value:c.createRef()}),Object.defineProperty(this,"tooltipEl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"componentDidMount",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.editable()&&u.YR.setNodes(this.context,{timestamp:void 0},{at:this.path()})}}),Object.defineProperty(this,"componentDidUpdate",{enumerable:!0,configurable:!0,writable:!0,value:()=>{if(!this.editable())return;const e=this.path();let t=!1;if("embed"===this.props.element.type&&null!=this.props.element.beatmapId){const s=this.props.element.children[0].text,r=b.Xe.exec(s);let i;null!==r&&0===r.index&&(i=r[2]),i!==this.props.element.timestamp&&(t=!0),u.YR.setNodes(this.context,{timestamp:i},{at:e})}else u.YR.setNodes(this.context,{timestamp:void 0},{at:e}),t=!0;t&&(this.cache={},this.destroyTooltip())}}),Object.defineProperty(this,"createTooltip",{enumerable:!0,configurable:!0,writable:!0,value:e=>{const t=this.timestamp();if(null==t)return;const s=e.currentTarget,r=`${this.selectedBeatmap()}-${t}`;this.tooltipEl&&this.tooltipEl._tooltip===r||(this.tooltipEl=s,s._tooltip=r,I(s).qtip({content:{text:()=>{var e;return null===(e=this.tooltipContent.current)||void 0===e?void 0:e.innerHTML}},hide:{delay:200,fixed:!0},position:{at:"top center",my:"bottom center",viewport:I(window)},show:{delay:200,ready:!0},style:{classes:"tooltip-default tooltip-default--interactable"}}),this.tooltipEl=s)}}),Object.defineProperty(this,"delete",{enumerable:!0,configurable:!0,writable:!0,value:()=>{window.setTimeout((()=>u.YR.delete(this.context,{at:this.path()})),0)}}),Object.defineProperty(this,"destroyTooltip",{enumerable:!0,configurable:!0,writable:!0,value:()=>{if(!this.tooltipEl)return;const e=I(this.tooltipEl).qtip("api");null!=e&&(e.destroy(),this.tooltipEl=void 0)}}),Object.defineProperty(this,"discussionType",{enumerable:!0,configurable:!0,writable:!0,value:()=>this.props.element.discussionType}),Object.defineProperty(this,"editable",{enumerable:!0,configurable:!0,writable:!0,value:()=>!(this.props.editMode&&null!=this.props.element.discussionId)}),Object.defineProperty(this,"isRelevantDiscussion",{enumerable:!0,configurable:!0,writable:!0,value:e=>null!=e&&e.beatmap_id===this.selectedBeatmap()}),Object.defineProperty(this,"nearbyDiscussions",{enumerable:!0,configurable:!0,writable:!0,value:()=>{const e=this.timestamp(),t=this.selectedBeatmap();if(null==e||null==t)return[];if(null==this.cache.nearbyDiscussions||this.cache.nearbyDiscussions.timestamp!==e||this.cache.nearbyDiscussions.beatmap_id!==t){const s=(0,o.filter)(this.props.discussions,this.isRelevantDiscussion);this.cache.nearbyDiscussions={beatmap_id:t,discussions:(0,b.Uq)(s,e),timestamp:e}}return this.cache.nearbyDiscussions.discussions}}),Object.defineProperty(this,"nearbyDraftEmbeds",{enumerable:!0,configurable:!0,writable:!0,value:e=>{const t=this.timestamp();if(null!=t&&0!==e.length)return e.filter((e=>{if(null==e.timestamp||e.beatmapId!==this.props.element.beatmapId)return!1;const s=(0,b.ZB)(e.timestamp);return null!=s&&Math.abs(s-t)<=5e3}))}}),Object.defineProperty(this,"nearbyIndicator",{enumerable:!0,configurable:!0,writable:!0,value:e=>{var t;if(!this.editable()||null==this.timestamp()||"praise"===this.discussionType())return null;const s=this.nearbyDiscussions(),r=null!==(t=this.nearbyDraftEmbeds(e))&&void 0!==t?t:[];if(s.length>0||r.length>1){const e=[];s.forEach((t=>{if(null==t.timestamp)return;const s=(0,b.i$)(t.timestamp);e.push(this.props.editMode?s:(0,_.Dz)((0,b.bf)({discussion:t}),s,{classNames:["js-beatmap-discussion--jump"]}))})),r.length>1&&e.push((0,g.dW)("beatmap_discussions.nearby_posts.unsaved",{count:r.length-1}));const t=(0,g.m2)(e),i=(0,g.dW)("beatmap_discussions.nearby_posts.notice",{existing_timestamps:t,timestamp:this.props.element.timestamp});return c.createElement("div",{className:`${L}__indicator ${L}__indicator--warning`,contentEditable:!1,onMouseOver:this.createTooltip,onTouchStart:this.createTooltip},c.createElement("script",{dangerouslySetInnerHTML:{__html:i},ref:this.tooltipContent,type:"text/html"}),c.createElement("i",{className:"fas fa-exclamation-triangle"}))}return null}}),Object.defineProperty(this,"path",{enumerable:!0,configurable:!0,writable:!0,value:()=>p.F3.findPath(this.context,this.props.element)}),Object.defineProperty(this,"selectedBeatmap",{enumerable:!0,configurable:!0,writable:!0,value:()=>this.props.element.beatmapId}),Object.defineProperty(this,"timestamp",{enumerable:!0,configurable:!0,writable:!0,value:()=>(0,b.ZB)(this.props.element.timestamp)})}componentWillUnmount(){this.destroyTooltip()}render(){var e;const t=this.editable(),s=t?[]:["read-only"],r=null!=this.props.element.beatmapId?"diff":"all-diff",i=(0,g.dW)(`beatmaps.discussions.review.embed.timestamp.${r}`,{type:(0,g.dW)(`beatmaps.discussions.message_type.${this.discussionType()}`)}),n=c.createElement("button",{className:`${L}__delete`,contentEditable:!1,disabled:this.props.readOnly,onClick:this.delete,title:(0,g.dW)("beatmaps.discussions.review.embed."+(t?"delete":"unlink"))},c.createElement("i",{className:"fas fa-"+(t?"trash-alt":"link")})),a=c.createElement(y.Consumer,null,(e=>c.createElement(w.Qj,null,(()=>this.nearbyIndicator(e))))),o=this.props.editMode&&t?c.createElement("div",{className:`${L}__indicator`,contentEditable:!1,title:(0,g.dW)("beatmaps.discussions.review.embed.unsaved")},c.createElement("i",{className:"fas fa-pencil-alt"})):null,l=this.props.readOnly||!t,u=null!=this.props.element.discussionId?this.props.discussions[this.props.element.discussionId]:null,d=null!=u?(0,M.m)(u):"praise"===this.discussionType()?"praise":null;return c.createElement("div",Object.assign({className:"beatmap-discussion beatmap-discussion--preview",contentEditable:t,suppressContentEditableWarning:!0},this.props.attributes),c.createElement("div",{className:(0,v.sb)(L,s,d)},c.createElement("div",{className:`${L}__content`},c.createElement("div",{className:`${L}__selectors`,contentEditable:!1},c.createElement(C,Object.assign({},this.props,{disabled:l,element:this.props.element})),c.createElement(R,Object.assign({},this.props,{disabled:l,element:this.props.element})),c.createElement("div",{className:`${L}__timestamp`,contentEditable:!1},c.createElement("span",{title:t?i:""},null!==(e=this.props.element.timestamp)&&void 0!==e?e:(0,g.dW)("beatmap_discussions.timestamp_display.general"))),o,a),c.createElement("div",{className:`${L}__stripe`,contentEditable:!1}),c.createElement("div",{className:`${L}__message-container`},this.props.children),o,a)),n)}}Object.defineProperty(A,"contextType",{enumerable:!0,configurable:!0,writable:!0,value:j});const $=A;var B=s(3924);const U=e=>e.length,F=e=>{const t=Z(e);return null!=t&&("type"in t&&"embed"===t.type)},W=(e,t)=>{const[s]=u.ML.nodes(e,{match:e=>u.xv.isText(e)&&!0===e[t],mode:"all"});return null!=s},Z=e=>{if(e.selection)return u.NB.parent(e,u.e6.start(e.selection).path)},H=(e,t)=>{u.YR.setNodes(e,{[t]:!W(e,t)||null},{match:e=>u.xv.isText(e),split:!0})};function G(e,t){const s=e.trim();if(0===s.length)return;const r=`${t}${s}${t}`;return s===e?r:e.replace(s,r)}function V(e){return e.children.map((e=>{if(""!==e.text){const t=e.text.replace(/([*_\\])/g,"\\$1");return e.bold&&e.italic?G(t,"***"):e.bold?G(t,"**"):e.italic?G(t,"*"):t}})).join("")}const q=e=>{const t=[];e.forEach((e=>{switch(e.type){case"paragraph":t.push({text:V(e),type:"paragraph"});break;case"embed":t.push(function(e){var t;return null!=e.discussionId?{discussion_id:e.discussionId,type:"embed"}:{beatmap_id:null!==(t=e.beatmapId)&&void 0!==t?t:null,discussion_type:e.discussionType,text:e.children[0].text,timestamp:(0,b.ZB)(e.timestamp),type:"embed"}}(e))}}));const s=t[t.length-1];return"paragraph"!==s.type||(0,B.W)(s.text)||t.pop(),JSON.stringify(t)};var z=s(5863),K=s(9139),J=s(9755);class Q extends c.Component{constructor(e){super(e),Object.defineProperty(this,"bn",{enumerable:!0,configurable:!0,writable:!0,value:"beatmap-discussion-editor-insertion-menu"}),Object.defineProperty(this,"eventId",{enumerable:!0,configurable:!0,writable:!0,value:`editor-insertion-menu-${(0,K.d)()}`}),Object.defineProperty(this,"hideInsertMenuTimer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hoveredBlock",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"insertPosition",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"insertRef",{enumerable:!0,configurable:!0,writable:!0,value:c.createRef()}),Object.defineProperty(this,"mouseOver",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"scrollContainer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"throttledContainerMouseExit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"throttledContainerMouseMove",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"throttledMenuMouseEnter",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"throttledMenuMouseExit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"throttledScroll",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"containerMouseMove",{enumerable:!0,configurable:!0,writable:!0,value:e=>{if(!e.originalEvent)return;const t=e.originalEvent.clientY,s=this.scrollContainer.children[0].children;let r=0;for(const n of s){if(t<n.getBoundingClientRect().top){if(r>0){const e=s[r-1];t<e.getBoundingClientRect().top+e.getBoundingClientRect().height/2&&r--}break}r<s.length-1&&r++}this.hoveredBlock=s[r];const i=this.hoveredBlock.getBoundingClientRect();t>i.top+i.height/2?this.insertPosition="below":this.insertPosition="above",this.updatePosition(),this.showMenu(),this.startHideTimer()}}),Object.defineProperty(this,"forceHideMenu",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.mouseOver=!1,this.hideMenu()}}),Object.defineProperty(this,"hideMenu",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.insertRef.current&&!this.mouseOver&&(this.insertRef.current.style.display="none")}}),Object.defineProperty(this,"insertBlock",{enumerable:!0,configurable:!0,writable:!0,value:e=>{var t,s,r,i,n,a;const o=this.context,l=null===(t=this.hoveredBlock)||void 0===t?void 0:t.lastChild,c=e.currentTarget.dataset.discussionType,d=null===(s=this.props.currentBeatmap)||void 0===s?void 0:s.id;let m;switch(c){case"suggestion":case"problem":case"praise":m={beatmapId:d,children:[{text:""}],discussionType:c,type:"embed"};break;case"paragraph":m={children:[{text:""}],type:"paragraph"}}if(!m||!l)return;let h,b=p.F3.toSlateNode(o,l);if(u.xv.isText(b)&&""===b.text||u.W_.isElement(b)&&u.ML.isEmpty(o,b))if("above"===this.insertPosition){const e=null===(i=null===(r=this.hoveredBlock)||void 0===r?void 0:r.previousSibling)||void 0===i?void 0:i.lastChild;null!=e?(b=p.F3.toSlateNode(o,e),h=u.ML.end(o,p.F3.findPath(o,b))):h={offset:0,path:[]}}else{const e=null===(a=null===(n=this.hoveredBlock)||void 0===n?void 0:n.previousSibling)||void 0===a?void 0:a.lastChild;null!=e?(b=p.F3.toSlateNode(o,e),h=u.ML.start(o,p.F3.findPath(o,b))):h=u.ML.end(o,[])}else{const e=p.F3.findPath(o,b);h="above"===this.insertPosition?u.ML.start(o,e):u.ML.end(o,e)}u.YR.insertNodes(o,m,{at:h})}}),Object.defineProperty(this,"insertButton",{enumerable:!0,configurable:!0,writable:!0,value:e=>{let t="fas fa-question";switch(e){case"praise":case"problem":case"suggestion":t=T.y[e];break;case"paragraph":t="fas fa-indent"}return c.createElement("button",{className:`${this.bn}__menu-button ${this.bn}__menu-button--${e}`,"data-discussion-type":e,onClick:this.insertBlock,title:(0,g.dW)(`beatmaps.discussions.review.insert-block.${e}`),type:"button"},c.createElement("i",{className:t}))}}),Object.defineProperty(this,"menuMouseEnter",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.mouseOver=!0}}),Object.defineProperty(this,"menuMouseLeave",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.mouseOver=!1,this.startHideTimer()}}),this.throttledContainerMouseExit=(0,o.throttle)((()=>{setTimeout(this.hideMenu,100)}),10),this.throttledContainerMouseMove=(0,o.throttle)(this.containerMouseMove,10),this.throttledMenuMouseEnter=(0,o.throttle)(this.menuMouseEnter,10),this.throttledMenuMouseExit=(0,o.throttle)(this.menuMouseLeave,10),this.throttledScroll=(0,o.throttle)(this.forceHideMenu,10)}componentDidMount(){this.insertRef.current&&(J(this.insertRef.current).on(`mouseenter.${this.eventId}`,this.throttledMenuMouseEnter),J(this.insertRef.current).on(`mouseleave.${this.eventId}`,this.throttledMenuMouseExit)),J(window).on(`scroll.${this.eventId}`,this.throttledScroll)}componentDidUpdate(){this.forceHideMenu()}componentWillUnmount(){J(window).off(`.${this.eventId}`),this.scrollContainer&&J(this.scrollContainer).off(`.${this.eventId}`),this.insertRef.current&&J(this.insertRef.current).off(`.${this.eventId}`)}render(){return c.createElement(z.Z,null,c.createElement("div",{ref:this.insertRef,className:`${this.bn}`},c.createElement("div",{className:`${this.bn}__body`},c.createElement("i",{className:"fas fa-plus"}),c.createElement("div",{className:`${this.bn}__buttons`},this.insertButton("suggestion"),this.insertButton("problem"),this.insertButton("praise"),this.insertButton("paragraph")))))}setScrollContainer(e){this.scrollContainer&&J(this.scrollContainer).off(`.${this.eventId}`),this.scrollContainer=e,J(this.scrollContainer).on(`mousemove.${this.eventId}`,this.throttledContainerMouseMove),J(this.scrollContainer).on(`mouseleave.${this.eventId}`,this.throttledContainerMouseExit),J(this.scrollContainer).on(`scroll.${this.eventId}`,this.throttledScroll)}showMenu(){this.insertRef.current&&(this.insertRef.current.style.display="flex")}startHideTimer(){window.clearTimeout(this.hideInsertMenuTimer),this.hideInsertMenuTimer=window.setTimeout(this.hideMenu,2e3)}updatePosition(){if(!this.scrollContainer||!this.hoveredBlock||!this.insertRef.current)return;const e=this.hoveredBlock.getBoundingClientRect(),t=this.scrollContainer.getBoundingClientRect();this.insertRef.current.style.left=`${t.left+15}px`,this.insertRef.current.style.width=t.width-30+"px","above"===this.insertPosition?this.insertRef.current.style.top=e.top-10+"px":"below"===this.insertPosition&&(this.insertRef.current.style.top=e.top+e.height-10+"px")}}Object.defineProperty(Q,"contextType",{enumerable:!0,configurable:!0,writable:!0,value:j});const Y=e=>{const t=c.useContext(j),s=c.useCallback((s=>{s.preventDefault(),H(t,e.format)}),[t,e.format]);return c.createElement("button",{className:(0,v.sb)("beatmap-discussion-editor-toolbar__button",{active:W(t,e.format)}),onMouseDown:s},c.createElement("i",{className:`fas fa-${e.format}`}))};var X=s(9755);const ee="beatmap-discussion-editor-toolbar";class te extends c.Component{constructor(){super(...arguments),Object.defineProperty(this,"eventId",{enumerable:!0,configurable:!0,writable:!0,value:`editor-toolbar-${(0,K.d)()}`}),Object.defineProperty(this,"ref",{enumerable:!0,configurable:!0,writable:!0,value:c.createRef()}),Object.defineProperty(this,"scrollContainer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"scrollTimer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"throttledUpdate",{enumerable:!0,configurable:!0,writable:!0,value:(0,o.throttle)((()=>this.updatePosition()),100)})}get selectionRange(){const{selection:e}=this.context;if(!e||!p.F3.isFocused(this.context)||u.e6.isCollapsed(e)||""===u.ML.string(this.context,e))return null;const t=window.getSelection();return null==t?void 0:t.getRangeAt(0)}get visible(){return null!=this.selectionRange}componentDidMount(){X(window).on(`scroll.${this.eventId}`,this.throttledUpdate),this.updatePosition()}componentDidUpdate(){this.updatePosition()}componentWillUnmount(){X(window).off(`.${this.eventId}`),this.scrollContainer&&X(this.scrollContainer).off(`.${this.eventId}`),this.throttledUpdate.cancel()}hide(){const e=this.ref.current;e&&(e.style.display="none")}render(){return null!=this.context&&this.visible?c.createElement(z.Z,null,c.createElement("div",{ref:this.ref,className:ee},c.createElement(Y,{format:"bold"}),c.createElement(Y,{format:"italic"}),c.createElement("div",{className:`${ee}__popup-tail`}))):null}setScrollContainer(e){this.scrollContainer&&X(this.scrollContainer).off(`.${this.eventId}`),this.scrollContainer=e,X(this.scrollContainer).on(`scroll.${this.eventId}`,this.throttledUpdate)}updatePosition(){const e=this.ref.current;e&&null!=this.context&&(window.clearTimeout(this.scrollTimer),this.scrollTimer=window.setTimeout((()=>{var t,s;const r=this.selectionRange;if(null==r)return this.hide();for(const e of u.ML.positions(this.context,{at:null!==(t=this.context.selection)&&void 0!==t?t:void 0,unit:"block"})){const t=u.NB.parent(this.context,e.path);if(u.W_.isElement(t)&&"embed"===t.type)return this.hide()}const i=null===(s=this.scrollContainer)||void 0===s?void 0:s.getBoundingClientRect(),n=r.getBoundingClientRect();if(null!=i&&(n.top<i.top||n.top>i.bottom))return this.hide();e.style.display="block",e.style.left=`${n.left+(window.pageXOffset-e.offsetWidth)/2+n.width/2}px`,e.style.top=n.top-e.clientHeight-10+"px"}),10))}}Object.defineProperty(te,"contextType",{enumerable:!0,configurable:!0,writable:!0,value:j});var se=s(5437),re=s(5305),ie=s(1240);function ne(e,t){let s;try{s=JSON.parse(e)}catch(n){return console.error("error parsing srcDoc"),[]}const r=(0,ie.l)().use(se.Z).use(re.Z,{type:"editor"}),i=[];return s.forEach((e=>{switch(e.type){case"paragraph":if((0,B.W)(e.text.trim())){const t=r.parse(e.text);if(null==t.children||t.children.length<1){console.error("children missing... ?");break}const s=ae(t.children);s.length>0?i.push({children:s,type:"paragraph"}):i.push({children:[{text:""}],type:"paragraph"})}else i.push({children:[{text:""}],type:"paragraph"});break;case"embed":{const r=e,n=t[r.discussion_id];if(null==n){console.error("unknown/external discussion referenced",r.discussion_id);break}if(s=n.message_type,!x.includes(s)){console.error("unsupported embed type",n.message_type);break}const a=(0,b.of)(n);if(a.system){console.error("embed should not have system starting post",r.discussion_id);break}i.push({beatmapId:n.beatmap_id,children:[{text:a.message}],discussionId:n.id,discussionType:n.message_type,timestamp:null!=n.timestamp?(0,b.i$)(n.timestamp):void 0,type:"embed"});break}default:console.error("unknown block encountered",e)}var s})),i}function ae(e,t){let s=[];const r=null!=t?t:{bold:!1,italic:!1};return e.forEach((e=>{const t={bold:r.bold||"strong"===e.type,italic:r.italic||"emphasis"===e.type};var i;"children"in(i=e)&&Array.isArray(i.children)?s=s.concat(ae(e.children,t)):function(e){return"text"===e.type}(e)&&s.push({bold:t.bold,italic:t.italic,text:e.value})})),s}var oe=s(4594),le=s(9755),ce=function(e,t){var s={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(s[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(s[r[i]]=e[r[i]])}return s};const ue=[Object.freeze({children:[{text:""}],type:"paragraph"})];function de(e){return"embed"===e.type&&null==e.discussionId}class pe extends c.Component{get editMode(){return null!=this.props.document}constructor(e){if(super(e),Object.defineProperty(this,"bn",{enumerable:!0,configurable:!0,writable:!0,value:"beatmap-discussion-editor"}),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"insertMenuRef",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"localStorageKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"scrollContainerRef",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"slateEditor",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"toolbarRef",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"initialValue",{enumerable:!0,configurable:!0,writable:!0,value:ue}),Object.defineProperty(this,"xhr",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"blockWrapper",{enumerable:!0,configurable:!0,writable:!0,value:e=>c.createElement("div",{className:`${this.bn}__block`},e)}),Object.defineProperty(this,"decorateTimestamps",{enumerable:!0,configurable:!0,writable:!0,value:e=>{const[t,s]=e,r=[];if(!u.xv.isText(t))return r;const i=RegExp(b.Xe,"g");let n;for(;null!==(n=i.exec(t.text));)r.push({anchor:{offset:n.index,path:s},focus:{offset:n.index+n[0].length,path:s},timestamp:n[0]});return r}}),Object.defineProperty(this,"isCurrentBeatmap",{enumerable:!0,configurable:!0,writable:!0,value:e=>null!=e&&e.beatmapset_id===this.props.beatmapset.id}),Object.defineProperty(this,"onChange",{enumerable:!0,configurable:!0,writable:!0,value:e=>{if(0===e.length&&(console.error("value is empty in Editor.onChange"),e=ue),!this.editMode){const s=JSON.stringify(e);0===(t=e).length||1===t.length&&"paragraph"===t[0].type&&1===t[0].children.length&&""===t[0].children[0].text?localStorage.removeItem(this.localStorageKey):localStorage.setItem(this.localStorageKey,s)}var t;this.setState({blockCount:U(e),value:e},(()=>{var e,t;p.F3.isFocused(this.slateEditor)&&this.props.onFocus&&this.props.onFocus(),null===(t=(e=this.props).onChange)||void 0===t||t.call(e)}))}}),Object.defineProperty(this,"onKeyDown",{enumerable:!0,configurable:!0,writable:!0,value:e=>{const t=e.nativeEvent;(0,n.ZP)("mod+b",t)?(e.preventDefault(),H(this.slateEditor,"bold")):(0,n.ZP)("mod+i",t)?(e.preventDefault(),H(this.slateEditor,"italic")):(0,n.ZP)("shift+enter",t)?F(this.slateEditor)&&(e.preventDefault(),this.slateEditor.insertText("\n")):((0,n.ZP)("delete",t)||(0,n.ZP)("backspace",t))&&(e=>{const t=Z(e);return null!=t&&"type"in t&&u.ML.isEmpty(e,t)})(this.slateEditor)&&(e.preventDefault(),u.YR.removeNodes(this.slateEditor),0===this.slateEditor.children.length&&this.resetEditorValue())}}),Object.defineProperty(this,"post",{enumerable:!0,configurable:!0,writable:!0,value:()=>{null==this.xhr&&this.showConfirmationIfRequired()&&this.setState({posting:!0},(()=>{this.xhr=le.ajax((0,a.B)("beatmapsets.discussion.review",{beatmapset:this.props.beatmapset.id}),{data:{document:this.serialize()},method:"POST"}).done((e=>{le.publish("beatmapsetDiscussions:update",{beatmapset:e}),this.resetInput()})).fail(m.qQ).always((()=>{this.xhr=null,this.setState({posting:!1})}))}))}}),Object.defineProperty(this,"renderBlockCount",{enumerable:!0,configurable:!0,writable:!0,value:e=>c.createElement(r.D,{current:this.state.blockCount,max:this.context.max_blocks,onlyShowAsWarning:!0,theme:e,tooltip:(0,g.dW)("beatmap_discussions.review.block_count",{max:this.context.max_blocks,used:this.state.blockCount})})}),Object.defineProperty(this,"renderElement",{enumerable:!0,configurable:!0,writable:!0,value:e=>{let t;switch(e.element.type){case"embed":{const{element:s}=e,r=ce(e,["element"]);t=c.createElement($,Object.assign({beatmaps:this.sortedBeatmaps(),beatmapset:this.props.beatmapset,discussions:this.props.discussions,editMode:this.editMode,element:s,readOnly:this.state.posting},r));break}default:t=e.children}return this.blockWrapper(t)}}),Object.defineProperty(this,"renderLeaf",{enumerable:!0,configurable:!0,writable:!0,value:e=>{let t=e.children;return e.leaf.bold&&(t=c.createElement("strong",Object.assign({},e.attributes),t)),e.leaf.italic&&(t=c.createElement("em",Object.assign({},e.attributes),t)),null!=e.leaf.timestamp?c.createElement("span",Object.assign({className:"beatmap-discussion-timestamp-decoration"},e.attributes),t):c.createElement("span",Object.assign({},e.attributes),t)}}),Object.defineProperty(this,"resetInput",{enumerable:!0,configurable:!0,writable:!0,value:e=>{e&&(e.preventDefault(),!confirm((0,g.dW)("common.confirmation")))||this.resetEditorValue()}}),Object.defineProperty(this,"scrollSelectionIntoView",{enumerable:!0,configurable:!0,writable:!0,value:(e,t)=>{var s;null===(s=t.startContainer.parentElement)||void 0===s||s.scrollIntoView({block:"nearest",inline:"nearest"})}}),Object.defineProperty(this,"serialize",{enumerable:!0,configurable:!0,writable:!0,value:()=>q(this.state.value)}),Object.defineProperty(this,"showConfirmationIfRequired",{enumerable:!0,configurable:!0,writable:!0,value:()=>{const e=this.state.value.some((e=>"embed"===e.type&&"problem"===e.discussionType&&null==e.discussionId));const t=null!=l.Z.currentUser&&(l.Z.currentUser.is_admin||l.Z.currentUser.is_moderator||l.Z.currentUser.is_full_bn),s="qualified"===this.props.beatmapset.status&&e,r=null!=l.Z.currentUser&&(l.Z.currentUser.is_admin||l.Z.currentUser.is_nat||l.Z.currentUser.is_bng),i="pending"===this.props.beatmapset.status&&this.props.beatmapset.nominations&&(0,f.c0)(this.props.beatmapset.nominations,"current")>0&&e;return t&&s?confirm((0,g.dW)("beatmaps.nominations.reset_confirm.disqualify")):!r||!i||confirm((0,g.dW)("beatmaps.nominations.reset_confirm.nomination_reset"))}}),Object.defineProperty(this,"sortedBeatmaps",{enumerable:!0,configurable:!0,writable:!0,value:()=>{if(null==this.cache.sortedBeatmaps){const e=(0,o.filter)(this.props.beatmaps,this.isCurrentBeatmap);this.cache.sortedBeatmaps=(0,h.UI)(e)}return this.cache.sortedBeatmaps}}),Object.defineProperty(this,"updateDrafts",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.cache.draftEmbeds=this.state.value.filter(de)}}),Object.defineProperty(this,"withNormalization",{enumerable:!0,configurable:!0,writable:!0,value:e=>{const{insertData:t,normalizeNode:s}=e;return e.insertData=s=>{F(this.slateEditor)?e.insertText(s.getData("text/plain")):t(s)},e.normalizeNode=t=>{const[r,i]=t;if(u.W_.isElement(r)&&"embed"===r.type)for(const[s,n]of u.NB.children(e,i)){if(u.W_.isElement(s)&&!e.isInline(s))return void u.YR.unwrapNodes(e,{at:n});if(u.xv.isText(s)&&(s.bold||s.italic))return void u.YR.unsetNodes(e,["bold","italic"],{at:n});if(null!=r.beatmapId){const t=this.props.beatmaps[r.beatmapId];null!=t&&null==t.deleted_at||u.YR.setNodes(e,{beatmapId:void 0},{at:i})}}s(t)},e}}),this.slateEditor=this.withNormalization((0,p.BU)((0,d.VC)((0,u.Jh)()))),this.scrollContainerRef=c.createRef(),this.toolbarRef=c.createRef(),this.insertMenuRef=c.createRef(),this.localStorageKey=`newDiscussion-${this.props.beatmapset.id}`,this.editMode)this.initialValue=this.valueFromProps();else{const e=localStorage.getItem(this.localStorageKey);if(null!=e)try{this.initialValue=JSON.parse(e)}catch(t){console.error("invalid json in localStorage, ignoring"),localStorage.removeItem(this.localStorageKey)}}this.state={blockCount:U(this.initialValue),posting:!1,value:this.initialValue}}get canSave(){return!this.state.posting&&this.state.blockCount<=this.context.max_blocks}componentDidMount(){this.scrollContainerRef.current&&(this.toolbarRef.current&&this.toolbarRef.current.setScrollContainer(this.scrollContainerRef.current),this.insertMenuRef.current&&this.insertMenuRef.current.setScrollContainer(this.scrollContainerRef.current))}componentDidUpdate(e){if(this.props.document!==e.document){const e=this.valueFromProps();this.setState({blockCount:U(e),value:e})}}componentWillUnmount(){var e;null===(e=this.xhr)||void 0===e||e.abort()}render(){this.cache={};const e="beatmap-discussion-editor",t=this.editMode?["edit-mode"]:[];return this.state.posting&&t.push("readonly"),this.updateDrafts(),c.createElement("div",{className:(0,v.sb)(e,t)},c.createElement("div",{className:`${e}__content`},c.createElement(j.Provider,{value:this.slateEditor},c.createElement(p.mH,{editor:this.slateEditor,onChange:this.onChange,value:this.initialValue},c.createElement("div",{ref:this.scrollContainerRef,className:`${e}__input-area`},c.createElement(te,{ref:this.toolbarRef}),c.createElement(Q,{ref:this.insertMenuRef,currentBeatmap:this.props.currentBeatmap}),c.createElement(y.Provider,{value:this.cache.draftEmbeds||[]},c.createElement(p.CX,{decorate:this.decorateTimestamps,onKeyDown:this.onKeyDown,placeholder:(0,g.dW)("beatmaps.discussions.message_placeholder.review"),readOnly:this.state.posting,renderElement:this.renderElement,renderLeaf:this.renderLeaf,scrollSelectionIntoView:this.scrollSelectionIntoView}))),this.editMode&&c.createElement("div",{className:`${e}__inner-block-count`},this.renderBlockCount("lighter")),!this.editMode&&c.createElement("div",{className:`${e}__button-bar`},c.createElement("button",{className:"btn-osu-big btn-osu-big--forum-secondary",disabled:this.state.posting,onClick:this.resetInput,type:"button"},(0,g.dW)("common.buttons.clear")),c.createElement("div",null,c.createElement("span",{className:`${e}__block-count`},this.renderBlockCount()),c.createElement("button",{className:"btn-osu-big btn-osu-big--forum-primary",disabled:!this.canSave,onClick:this.post,type:"submit"},this.state.posting?c.createElement(i.$,null):(0,g.dW)("common.buttons.post"))))))))}resetEditorValue(){u.YR.deselect(this.slateEditor),this.slateEditor.children=ue,this.slateEditor.onChange()}valueFromProps(){return this.props.editing&&null!=this.props.document&&null!=this.props.discussions?ne(this.props.document,this.props.discussions):[]}}Object.defineProperty(pe,"contextType",{enumerable:!0,configurable:!0,writable:!0,value:oe._}),Object.defineProperty(pe,"defaultProps",{enumerable:!0,configurable:!0,writable:!0,value:{editing:!1}});const me=pe},78:(e,t,s)=>{s.d(t,{Z:()=>r});const r=Object.freeze({colour:"hsl(var(--hsl-l1))",has_listing:!1,has_playmodes:!1,id:-1,identifier:"owner",is_probationary:!1,name:"Beatmap Mapper",short_name:"MAPPER"})},4985:(e,t,s)=>{s.d(t,{Z:()=>m});var r=s(3974),i=s(7294),n=s(9469),a=s(3555),o=s(3955),l=s(5305),c=s(41),u=s(3924);const d=Object.freeze({a:function(e){const t=(0,c.cO)(e.href);return null!=t.children?i.createElement("a",Object.assign({},t)):i.createElement(i.Fragment,null,e.children)},code:p,em:p,img:function(e){var t;return i.createElement(i.Fragment,null,null!==(t=(0,u.G)(e.alt))&&void 0!==t?t:"[image]")},p,pre:p,strong:p});function p(e){return i.createElement(i.Fragment,null,(0,r.F8)(e.children))}class m extends i.Component{render(){var e;return i.createElement(n.D,{className:"plain-text-preview",components:d,rehypePlugins:[[a.Z,{maxChars:null!==(e=this.props.maxLength)&&void 0!==e?e:c.g8}]],remarkPlugins:[o.Z,[l.Z,{type:this.props.type}]],transformLinkUri:r.H,unwrapDisallowed:!0},this.props.markdown)}}},5989:(e,t,s)=>{s.d(t,{Z:()=>I});var r=s(6945),i=s(7366),n=s(7125),a=s(7294),o=s(1480),l=s(3030);class c extends a.Component{render(){const e=[];try{JSON.parse(this.props.post.message).forEach(((t,s)=>{switch(t.type){case"paragraph":{const r=""===t.text.trim()?"&nbsp;":t.text;e.push(a.createElement(o.Z,{key:s,markdown:r,type:"reviews"}));break}case"embed":t.discussion_id&&e.push(a.createElement(l.j,{key:s,data:{discussion_id:t.discussion_id}}))}}))}catch(t){e.push(a.createElement("div",{key:null},"[error parsing review]"))}return a.createElement("div",{className:"beatmap-discussion-review-post"},e)}}var u=s(7010),d=s(9240),p=s(2325),m=s(4403),h=s(2163),b=s(12),f=s(6871),v=s(3664),g=s(6486),y=s(8949),w=s(9323),_=s(8125),E=s(7181),O=s(9703),P=s(41),j=s(6817),k=s(3336),N=s(7937),S=s(1270),C=s(5692),T=s(2786),x=s(9755),D=function(e,t,s,r){var i,n=arguments.length,a=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(n<3?i(a):n>3?i(t,s,a):i(t,s))||a);return n>3&&a&&Object.defineProperty(t,s,a),a};const R="beatmap-discussion-post";let M=class extends a.Component{get canEdit(){return"discussion_locked"in this.props.beatmapset&&(this.isAdmin||!(0,j.wm)(this.props.beatmapset)&&this.isOwn&&this.props.post.id>this.props.resolvedSystemPostId&&!this.props.beatmapset.discussion_locked)}get canDelete(){var e;return"discussion"===this.props.type?null===(e=this.props.discussion.current_user_attributes)||void 0===e?void 0:e.can_destroy:this.canModerate||this.canEdit}get canModerate(){return(0,P.e7)()}get canReport(){return null!=E.Z.currentUser&&this.props.post.user_id!==E.Z.currentUser.id}get deleteModel(){return"reply"===this.props.type?this.props.post:this.props.discussion}get isAdmin(){var e,t;return null!==(t=null===(e=E.Z.currentUser)||void 0===e?void 0:e.is_admin)&&void 0!==t&&t}get isOwn(){return null!=E.Z.currentUser&&E.Z.currentUser.id===this.props.post.user_id}get isPosting(){return null!=this.xhr}get isReview(){return"review"===this.props.discussion.message_type&&"discussion"===this.props.type}get isTimeline(){return null!=this.props.discussion.timestamp}constructor(e){super(e),Object.defineProperty(this,"canSave",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"editing",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"handleTextareaKeyDown",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"message",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"messageBodyRef",{enumerable:!0,configurable:!0,writable:!0,value:a.createRef()}),Object.defineProperty(this,"reviewEditorRef",{enumerable:!0,configurable:!0,writable:!0,value:a.createRef()}),Object.defineProperty(this,"textareaMinHeight",{enumerable:!0,configurable:!0,writable:!0,value:"0"}),Object.defineProperty(this,"textareaRef",{enumerable:!0,configurable:!0,writable:!0,value:a.createRef()}),Object.defineProperty(this,"xhr",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"editCancel",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.editing=!1}}),Object.defineProperty(this,"editStart",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.textareaMinHeight=null!=this.messageBodyRef.current?`${this.messageBodyRef.current.getBoundingClientRect().height+50}px`:"0",this.editing=!0,this.message=this.props.post.message}}),Object.defineProperty(this,"handleEditorChange",{enumerable:!0,configurable:!0,writable:!0,value:()=>{var e,t;this.canSave=null!==(t=null===(e=this.reviewEditorRef.current)||void 0===e?void 0:e.canSave)&&void 0!==t&&t}}),Object.defineProperty(this,"handleMarkRead",{enumerable:!0,configurable:!0,writable:!0,value:()=>{x.publish("beatmapDiscussionPost:markRead",{id:this.props.post.id})}}),Object.defineProperty(this,"handleTextareaChange",{enumerable:!0,configurable:!0,writable:!0,value:e=>{this.message=e.target.value,this.canSave=(0,P.Ks)(this.message,this.isTimeline)}}),Object.defineProperty(this,"handleTextareaKeyDownCallback",{enumerable:!0,configurable:!0,writable:!0,value:e=>{e===N.z.Submit&&this.updatePost()}}),Object.defineProperty(this,"updatePost",{enumerable:!0,configurable:!0,writable:!0,value:()=>{if(!this.isPosting){if(this.isReview){if(null==this.reviewEditorRef.current)return void console.error("reviewEditor is missing!");const e=this.reviewEditorRef.current.serialize();if((0,g.isEqual)(JSON.parse(this.props.post.message),JSON.parse(e)))return void(this.editing=!1);if(!this.reviewEditorRef.current.showConfirmationIfRequired())return;this.message=e}this.message!==this.props.post.message?(this.xhr=x.ajax((0,v.B)("beatmapsets.discussions.posts.update",{post:this.props.post.id}),{data:{beatmap_discussion_post:{message:this.message}},method:"PUT"}),this.xhr.done((e=>(0,y.z)((()=>{this.editing=!1,x.publish("beatmapsetDiscussions:update",{beatmapset:e})})))).fail(O.qQ).always((0,y.aD)((()=>this.xhr=null)))):this.editing=!1}}}),(0,y.rC)(this),this.handleTextareaKeyDown=(0,N.k)(this.handleTextareaKeyDownCallback),(0,w.b4)(this,(0,y.EH)((()=>{this.editing&&setTimeout((()=>{var e;return null===(e=this.textareaRef.current)||void 0===e?void 0:e.focus()}),0)})))}componentWillUnmount(){var e;null===(e=this.xhr)||void 0===e||e.abort()}render(){const e=(0,k.sb)(R,this.props.type,{deleted:null!=this.props.post.deleted_at,editing:this.editing,unread:!this.props.read&&"discussion"!==this.props.type});return a.createElement("div",{className:`${e} js-beatmap-discussion-jump`,"data-post-id":this.props.post.id,onClick:this.handleMarkRead},a.createElement("div",{className:`${R}__content`},"reply"===this.props.type&&a.createElement(T.O,{group:(0,P.G2)({beatmapset:this.props.beatmapset,currentBeatmap:this.props.beatmap,discussion:this.props.discussion,user:this.props.user}),user:this.props.user}),this.editing?this.renderMessageEditor():this.renderMessageViewer()))}deleteHref(e){const[t,s]="reply"===this.props.type?["beatmapsets.discussions.posts","post"]:["beatmapsets.discussions","discussion"];return(0,v.B)(`${t}.${e}`,{[s]:this.deleteModel.id})}renderDeletedBy(){var e;if(null==this.deleteModel.deleted_at)return null;const t=null!==(e=null!=this.deleteModel.deleted_by_id?this.props.users[this.deleteModel.deleted_by_id]:null)&&void 0!==e?e:_.ei;return a.createElement("span",{className:`${R}__info`},a.createElement(m.Z,{mappings:{delete_time:a.createElement(b.Z,{dateTime:this.deleteModel.deleted_at,relative:!0}),editor:a.createElement(f.Z,{className:`${R}__info-user`,user:t})},pattern:(0,S.dW)("beatmaps.discussions.deleted")}))}renderEdited(){var e;if(null==this.props.post.last_editor_id||this.props.post.updated_at===this.props.post.created_at)return null;const t=null!==(e=this.props.users[this.props.post.last_editor_id])&&void 0!==e?e:_.z7;return a.createElement("span",{className:`${R}__info`},a.createElement(m.Z,{mappings:{editor:a.createElement(f.Z,{className:`${R}__info-user`,user:t}),update_time:a.createElement(b.Z,{dateTime:this.props.post.updated_at,relative:!0})},pattern:(0,S.dW)("beatmaps.discussions.edited")}))}renderKudosuAction(e){return a.createElement("a",{className:`js-beatmapset-discussion-update ${R}__action ${R}__action--button`,"data-confirm":(0,S.dW)("common.confirmation"),"data-method":"POST","data-remote":!0,href:(0,v.B)(`beatmapsets.discussions.${e}-kudosu`,{discussion:this.props.discussion.id})},(0,S.dW)(`beatmaps.discussions.${e}_kudosu`))}renderMessageEditor(){if(!this.canEdit)return;const e=!this.isPosting&&this.canSave,t=this.props.post.message;return a.createElement("div",{className:`${R}__message-container`},this.isReview?a.createElement(i.n.Consumer,null,(e=>a.createElement(r.g.Consumer,null,(s=>a.createElement(n.Z,{ref:this.reviewEditorRef,beatmaps:s,beatmapset:this.props.beatmapset,currentBeatmap:this.props.beatmap,discussion:this.props.discussion,discussions:e,document:t,editing:this.editing,onChange:this.handleEditorChange}))))):a.createElement(a.Fragment,null,a.createElement(h.Z,{className:`${R}__message ${R}__message--editor`,disabled:this.isPosting,innerRef:this.textareaRef,onChange:this.handleTextareaChange,onKeyDown:this.handleTextareaKeyDown,style:{minHeight:this.textareaMinHeight},value:this.message}),a.createElement(C.Z,{isTimeline:this.isTimeline,message:this.message})),a.createElement("div",{className:`${R}__actions`},a.createElement("div",{className:`${R}__actions-group`},a.createElement("div",{className:`${R}__actions-group`},a.createElement("div",{className:`${R}__action`},a.createElement(u.Z,{disabled:this.isPosting,props:{onClick:this.editCancel},text:(0,S.dW)("common.buttons.cancel")}))),a.createElement("div",{className:`${R}__action`},a.createElement(u.Z,{disabled:!e,props:{onClick:this.updatePost},text:(0,S.dW)("common.buttons.save")})))))}renderMessageViewer(){return a.createElement("div",{className:`${R}__message-container`},this.isReview?a.createElement("div",{className:`${R}__message`},a.createElement(c,{post:this.props.post})):a.createElement("div",{ref:this.messageBodyRef,className:`${R}__message`},a.createElement(o.Z,{markdown:this.props.post.message})),a.createElement("div",{className:`${R}__info-container`},a.createElement("span",{className:`${R}__info`},a.createElement(b.Z,{dateTime:this.props.post.created_at,relative:!0})),this.renderDeletedBy(),this.renderEdited(),"discussion"===this.props.type&&this.props.discussion.kudosu_denied&&a.createElement("span",{className:`${R}__info`},(0,S.dW)("beatmaps.discussions.kudosu_denied"))),this.renderMessageViewerActions())}renderMessageViewerActions(){var e;return a.createElement("div",{className:`${R}__actions`},a.createElement("div",{className:`${R}__actions-group`},a.createElement("span",{className:`${R}__action ${R}__action--button`},a.createElement(d.Z,{label:(0,S.dW)("common.buttons.permalink"),value:(0,P.bf)({discussion:this.props.discussion,post:"reply"===this.props.type?this.props.post:void 0}),valueAsUrl:!0})),!this.props.readonly&&a.createElement(a.Fragment,null,this.canEdit&&a.createElement("button",{className:`${R}__action ${R}__action--button`,onClick:this.editStart},(0,S.dW)("beatmaps.discussions.edit")),null==this.deleteModel.deleted_at&&this.canDelete&&a.createElement("a",{className:`js-beatmapset-discussion-update ${R}__action ${R}__action--button`,"data-confirm":(0,S.dW)("common.confirmation"),"data-method":"DELETE","data-remote":!0,href:this.deleteHref("destroy")},(0,S.dW)("beatmaps.discussions.delete")),null!=this.deleteModel.deleted_at&&this.canModerate&&a.createElement("a",{className:`js-beatmapset-discussion-update ${R}__action ${R}__action--button`,"data-confirm":(0,S.dW)("common.confirmation"),"data-method":"POST","data-remote":!0,href:this.deleteHref("restore")},(0,S.dW)("beatmaps.discussions.restore")),"discussion"===this.props.type&&(null===(e=this.props.discussion.current_user_attributes)||void 0===e?void 0:e.can_moderate_kudosu)&&(this.props.discussion.can_grant_kudosu?this.renderKudosuAction("deny"):this.props.discussion.kudosu_denied&&this.renderKudosuAction("allow"))),this.canReport&&a.createElement(p.c,{className:`${R}__action ${R}__action--button`,reportableId:this.props.post.id.toString(),reportableType:"beatmapset_discussion_post",user:this.props.user})))}};D([y.LO],M.prototype,"canSave",void 0),D([y.LO],M.prototype,"editing",void 0),D([y.LO],M.prototype,"message",void 0),D([y.LO],M.prototype,"textareaMinHeight",void 0),D([y.LO],M.prototype,"xhr",void 0),D([y.Fl],M.prototype,"canEdit",null),D([y.Fl],M.prototype,"canReport",null),D([y.Fl],M.prototype,"deleteModel",null),D([y.Fl],M.prototype,"isAdmin",null),D([y.Fl],M.prototype,"isOwn",null),D([y.Fl],M.prototype,"isPosting",null),D([y.Fl],M.prototype,"isReview",null),D([y.Fl],M.prototype,"isTimeline",null),D([y.aD],M.prototype,"editCancel",void 0),D([y.aD],M.prototype,"editStart",void 0),D([y.aD],M.prototype,"handleEditorChange",void 0),D([y.aD],M.prototype,"handleTextareaChange",void 0),D([y.aD],M.prototype,"updatePost",void 0),M=D([w.Pi],M);const I=M},4594:(e,t,s)=>{s.d(t,{_:()=>r});const r=s(7294).createContext({max_blocks:0})},3030:(e,t,s)=>{s.d(t,{j:()=>m,m:()=>p});var r=s(5813),i=s(9434),n=s(7294),a=s(41),o=s(3336),l=s(1270),c=s(6945),u=s(1480),d=s(7366);function p(e){return{deleted:null!=e.deleted_at,"general-all":null==e.beatmap_id,praise:"praise"===e.message_type,resolved:e.resolved&&"praise"!==e.message_type}}const m=({data:e})=>{const t="beatmap-discussion-review-post-embed-preview",s=n.useContext(d.n),m=n.useContext(c.g),h=s[e.discussion_id];if(!h)return n.createElement("div",{className:(0,o.sb)(t,["deleted","lighter"])},n.createElement("div",{className:`${t}__missing`},(0,l.dW)("beatmaps.discussions.review.embed.missing")));const b=(0,a.of)(h);if(b.system)return console.error("embed should not have system starting post",h.id),null;const f=null==h.beatmap_id?void 0:m[h.beatmap_id],v=()=>{if(null!=h.parent_id)return n.createElement("div",{className:`${t}__link`},n.createElement("a",{className:`${t}__link-text js-beatmap-discussion--jump`,href:(0,a.bf)({discussion:h}),title:(0,l.dW)("beatmap_discussions.review.go_to_child")},n.createElement("i",{className:"fas fa-external-link-alt"})))};return n.createElement("div",{className:(0,o.sb)(t,"lighter",p(h))},n.createElement("div",{className:`${t}__content`},n.createElement("div",{className:`${t}__selectors`},n.createElement("div",{className:"icon-dropdown-menu icon-dropdown-menu--disabled"},null!=f&&n.createElement(i.p,{beatmap:f,withTooltip:!0}),null==h.beatmap_id&&n.createElement("i",{className:"fas fa-fw fa-star-of-life",title:(0,l.dW)("beatmaps.discussions.mode.scopes.generalAll")})),n.createElement("div",{className:"icon-dropdown-menu icon-dropdown-menu--disabled"},(()=>{const e=h.message_type;return n.createElement("div",null,n.createElement("span",{className:r.y[e],style:{color:`var(--beatmapset-discussion-colour--${e})`},title:(0,l.dW)(`beatmaps.discussions.message_type.${e}`)}))})()),n.createElement("div",{className:`${t}__timestamp`},n.createElement("div",{className:`${t}__timestamp-text`},null!==h.timestamp?(0,a.i$)(h.timestamp):(0,l.dW)("beatmap_discussions.timestamp_display.general"))),n.createElement("div",{className:`${t}__stripe`}),v()),n.createElement("div",{className:`${t}__stripe`}),n.createElement("div",{className:`${t}__message-container`},n.createElement("div",{className:`${t}__body`},n.createElement(u.Z,{markdown:b.message}))),v()))}},2786:(e,t,s)=>{s.d(t,{O:()=>u});var r=s(4929),i=s(4318),n=s(3664),a=s(7294),o=s(3336),l=s(1270);const c="beatmap-discussion-user-card";class u extends a.PureComponent{render(){return a.createElement("div",{className:c,style:(0,o.$$)(this.props.group)},a.createElement("div",{className:`${c}__avatar`},this.props.user.is_deleted?a.createElement("span",{className:`${c}__user-link`},a.createElement(r.Z,{modifiers:"full-rounded",user:this.props.user})):a.createElement("a",{className:`${c}__user-link`,href:(0,n.B)("users.show",{user:this.props.user.id})},a.createElement(r.Z,{modifiers:"full-rounded",user:this.props.user}))),a.createElement("div",{className:`${c}__user`},a.createElement("div",{className:`${c}__user-row`},this.props.user.is_deleted?a.createElement("span",{className:`${c}__user-link`},this.renderUsername()):a.createElement("a",{className:`${c}__user-link`,href:(0,n.B)("users.show",{user:this.props.user.id})},this.renderUsername()),!this.props.user.is_bot&&!this.props.user.is_deleted&&a.createElement("a",{className:`${c}__user-modding-history-link`,href:(0,n.B)("users.modding.index",{user:this.props.user.id}),title:(0,l.dW)("beatmap_discussion_posts.item.modding_history_link")},a.createElement("i",{className:"fas fa-align-left"}))),a.createElement("div",{className:`${c}__user-badge`},a.createElement(i.Z,{group:this.props.group}))),!this.props.hideStripe&&a.createElement("div",{className:`${c}__user-stripe`}))}renderUsername(){return a.createElement("span",{className:"u-ellipsis-overflow"},this.props.user.username)}}Object.defineProperty(u,"defaultProps",{enumerable:!0,configurable:!0,writable:!0,value:{hideStripe:!1}})},9119:(e,t,s)=>{s.d(t,{B:()=>R,Z:()=>F});var r=s(4057),i=s(7292),n=s(7735),a=s(4403),o=s(12),l=s(6871),c=s(3664),u=s(6486),d=s(8949),p=s(9323),m=s(7181),h=s(7294),b=s(92),f=s(7629),v=s(6817),g=s(3336),y=s(3775),w=s(1270),_=s(5076),E=s(1426),O=s(5863),P=s(9755),j=function(e,t,s,r){var i,n=arguments.length,a=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(n<3?i(a):n>3?i(t,s,a):i(t,s))||a);return n>3&&a&&Object.defineProperty(t,s,a),a};const k={entered:{opacity:1},entering:{},exited:{},exiting:{},unmounted:{}},N=(0,p.Pi)((({beatmaps:e})=>h.createElement("div",{className:"beatmaps-popup__group"},e.map((e=>h.createElement(S,{key:e.id,beatmap:e})))))),S=(0,p.Pi)((({beatmap:e})=>h.createElement("a",{className:"beatmaps-popup-item",href:(0,c.B)("beatmaps.show",{beatmap:e.id})},h.createElement(E.Z,{beatmap:e,mapper:null}))));let C=class extends h.Component{constructor(e){super(e),Object.defineProperty(this,"contentRef",{enumerable:!0,configurable:!0,writable:!0,value:h.createRef()}),Object.defineProperty(this,"position",{enumerable:!0,configurable:!0,writable:!0,value:{left:"0px",top:"0px",width:"0px"}}),Object.defineProperty(this,"updatePosition",{enumerable:!0,configurable:!0,writable:!0,value:()=>{const e=this.props.parent;if(null==e)return;const t=e.getBoundingClientRect();this.position.top=`${window.scrollY+t.bottom}px`,this.position.left=`${window.scrollX+t.left}px`,this.position.width=`${t.width}px`}}),(0,d.rC)(this)}componentDidMount(){P(window).on("resize",this.updatePosition)}componentWillUnmount(){P(window).off("resize",this.updatePosition)}render(){this.updatePosition();const e=Object.assign(Object.assign({opacity:0,transitionDuration:`${this.props.transitionDuration}ms`},k[this.props.state]),this.position);return h.createElement(O.Z,null,h.createElement("div",{ref:this.contentRef,className:(0,g.sb)("beatmaps-popup",[`size-${m.Z.userPreferences.get("beatmapset_card_size")}`]),onMouseEnter:this.props.onMouseEnter,onMouseLeave:this.props.onMouseLeave,style:e},h.createElement("div",{className:"beatmaps-popup__content"},[...this.props.groupedBeatmaps].map((([e,t])=>t.length>0&&h.createElement(N,{key:e,beatmaps:t}))))))}};j([d.LO],C.prototype,"position",void 0),j([d.aD],C.prototype,"updatePosition",void 0),C=j([p.Pi],C);const T=C;var x=s(9755),D=function(e,t,s,r){var i,n=arguments.length,a=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(n<3?i(a):n>3?i(t,s,a):i(t,s))||a);return n>3&&a&&Object.defineProperty(t,s,a),a};const R=["normal","extra"],M={approved:"ranked_date",graveyard:"last_updated",loved:"ranked_date",pending:"last_updated",qualified:"ranked_date",ranked:"ranked_date",wip:"last_updated"},I=(0,p.Pi)((({beatmap:e})=>h.createElement("div",{className:"beatmapset-panel__beatmap-dot",style:{"--bg":(0,f.yh)(e.difficulty_rating)}}))),L=(0,p.Pi)((({compact:e,beatmaps:t,mode:s})=>h.createElement("div",{className:"beatmapset-panel__extra-item beatmapset-panel__extra-item--dots"},h.createElement("div",{className:"beatmapset-panel__beatmap-icon"},h.createElement("i",{className:`fal fa-extra-mode-${s}`})),e?h.createElement("div",{className:"beatmapset-panel__beatmap-count"},t.length):t.map((e=>h.createElement(I,{key:e.id,beatmap:e})))))),A=(0,p.Pi)((({beatmapset:e})=>h.createElement(l.Z,{className:"beatmapset-panel__mapper-link u-hover",user:{id:e.user_id,username:e.creator}}))),$=({icon:e,titleVariant:t})=>h.createElement("div",{className:"beatmapset-panel__play-icon",title:(0,w.dW)(`beatmapsets.show.info.${t}`)},h.createElement("i",{className:e})),B=({icon:e,title:t,type:s,value:r})=>h.createElement("div",{className:`beatmapset-panel__stats-item beatmapset-panel__stats-item--${s}`,title:t},h.createElement("span",{className:"beatmapset-panel__stats-item-icon"},h.createElement("i",{className:`fa-fw ${e}`})),h.createElement("span",null,(0,y.Eu)(r)));let U=class extends h.Component{get beatmapDotsCompact(){return null!=this.props.beatmapset.beatmaps&&this.props.beatmapset.beatmaps.length>12}get displayDate(){const e=M[this.props.beatmapset.status],t=this.props.beatmapset[e];if(null==t)throw Error("trying to display null date");return t}get downloadLink(){var e;if(null==m.Z.currentUser)return{title:(0,w.dW)("beatmapsets.show.details.logged-out")};if(null===(e=this.props.beatmapset.availability)||void 0===e?void 0:e.download_disabled)return{title:(0,w.dW)("beatmapsets.availability.disabled")};let t,s,r=m.Z.userPreferences.get("beatmapset_download");if("direct"!==r||m.Z.currentUser.is_supporter||(r="all"),"direct"===r)t=(0,_.vU)(this.props.beatmapset.id),s="direct";else{const e={beatmapset:this.props.beatmapset.id};this.props.beatmapset.video?"no_video"===r?(e.noVideo=1,s="no_video"):s="video":s="all",t=(0,c.B)("beatmapsets.download",e)}return{title:(0,w.dW)(`beatmapsets.panel.download.${s}`),url:t}}get favourite(){return this.props.beatmapset.has_favourited?{icon:"fas fa-heart",toggleTitleVariant:"unfavourite"}:{icon:"far fa-heart",toggleTitleVariant:"favourite"}}get groupedBeatmaps(){return(0,f.ru)(this.props.beatmapset.beatmaps)}get isBeatmapsPopupVisible(){return this.beatmapsPopupHover||this.mobileExpanded}get nominations(){return null!=this.props.beatmapset.nominations_summary?this.props.beatmapset.nominations_summary:null!=this.props.beatmapset.nominations?this.props.beatmapset.nominations.legacy_mode?this.props.beatmapset.nominations:{current:(0,u.sum)((0,u.values)(this.props.beatmapset.nominations.current)),required:(0,u.sum)((0,u.values)(this.props.beatmapset.nominations.required))}:void 0}get showHypeCounts(){return null!=this.props.beatmapset.hype}get showVisual(){return(0,v.uX)(this.props.beatmapset)}get url(){return(0,c.B)("beatmapsets.show",{beatmapset:this.props.beatmapset.id})}constructor(e){super(e),Object.defineProperty(this,"beatmapsPopupHover",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"beatmapsPopupRef",{enumerable:!0,configurable:!0,writable:!0,value:h.createRef()}),Object.defineProperty(this,"blockRef",{enumerable:!0,configurable:!0,writable:!0,value:h.createRef()}),Object.defineProperty(this,"mobileExpanded",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"timeouts",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"beatmapsPopupDelayedHide",{enumerable:!0,configurable:!0,writable:!0,value:()=>{window.clearTimeout(this.timeouts.beatmapsPopup),this.beatmapsPopupHover&&(this.timeouts.beatmapsPopup=window.setTimeout((0,d.aD)((()=>{this.beatmapsPopupHover=!1})),500))}}),Object.defineProperty(this,"beatmapsPopupDelayedShow",{enumerable:!0,configurable:!0,writable:!0,value:()=>{window.clearTimeout(this.timeouts.beatmapsPopup),this.beatmapsPopupHover||(this.timeouts.beatmapsPopup=window.setTimeout((0,d.aD)((()=>{this.beatmapsPopupHover=!0})),100))}}),Object.defineProperty(this,"beatmapsPopupHide",{enumerable:!0,configurable:!0,writable:!0,value:()=>{window.clearTimeout(this.timeouts.beatmapsPopup),this.beatmapsPopupHover=!1}}),Object.defineProperty(this,"beatmapsPopupKeep",{enumerable:!0,configurable:!0,writable:!0,value:()=>{window.clearTimeout(this.timeouts.beatmapsPopup),this.beatmapsPopupHover=!0}}),Object.defineProperty(this,"onBeatmapsPopupEnter",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.beatmapsPopupKeep()}}),Object.defineProperty(this,"onBeatmapsPopupLeave",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.beatmapsPopupDelayedHide()}}),Object.defineProperty(this,"onDocumentClick",{enumerable:!0,configurable:!0,writable:!0,value:e=>{var t,s,r;this.mobileExpanded&&((null===(t=this.blockRef.current)||void 0===t?void 0:t.contains(e.target))||(null===(r=null===(s=this.beatmapsPopupRef.current)||void 0===s?void 0:s.contentRef.current)||void 0===r?void 0:r.contains(e.target))||(x(document).off("click",this.onDocumentClick),this.mobileExpanded=!1))}}),Object.defineProperty(this,"onExtraRowEnter",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.beatmapsPopupDelayedShow()}}),Object.defineProperty(this,"onExtraRowLeave",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.beatmapsPopupDelayedHide()}}),Object.defineProperty(this,"onMobileExpandToggleClick",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.mobileExpanded=!this.mobileExpanded,this.mobileExpanded&&x(document).on("click",this.onDocumentClick)}}),Object.defineProperty(this,"toggleFavourite",{enumerable:!0,configurable:!0,writable:!0,value:()=>{(0,v.F)(this.props.beatmapset)}}),(0,d.rC)(this)}componentWillUnmount(){x(document).off("click",this.onDocumentClick),Object.values(this.timeouts).forEach((e=>{window.clearTimeout(e)}))}render(){let e=(0,g.sb)("beatmapset-panel",{"beatmaps-popup-visible":this.isBeatmapsPopupVisible,"mobile-expanded":this.mobileExpanded,[`size-${m.Z.userPreferences.get("beatmapset_card_size")}`]:!0,"with-hype-counts":this.showHypeCounts});return this.showVisual&&(e+=" js-audio--player"),h.createElement("div",{ref:this.blockRef,className:e,"data-audio-url":this.props.beatmapset.preview_url,onMouseLeave:this.beatmapsPopupHide,style:{"--beatmaps-popup-transition-duration":"150ms"}},this.renderBeatmapsPopup(),this.renderCover(),h.createElement("div",{className:"beatmapset-panel__content"},this.renderPlayArea(),this.renderInfoArea(),this.renderMenuArea()),h.createElement("button",{className:"beatmapset-panel__mobile-expand",onClick:this.onMobileExpandToggleClick,type:"button"},h.createElement("span",{className:"fas fa-angle-"+(this.mobileExpanded?"up":"down")})))}renderBeatmapsPopup(){return h.createElement(b.ZP,{in:this.isBeatmapsPopupVisible,mountOnEnter:!0,timeout:{enter:0,exit:150},unmountOnExit:!0},(e=>h.createElement(T,{ref:this.beatmapsPopupRef,groupedBeatmaps:this.groupedBeatmaps,onMouseEnter:this.onBeatmapsPopupEnter,onMouseLeave:this.onBeatmapsPopupLeave,parent:this.blockRef.current,state:e,transitionDuration:150})))}renderCover(){return h.createElement("a",{className:"beatmapset-panel__cover-container",href:this.url},h.createElement("div",{className:"beatmapset-panel__cover-col beatmapset-panel__cover-col--play"},h.createElement(i.Z,{beatmapset:this.props.beatmapset,modifiers:"full",size:"list"})),h.createElement("div",{className:"beatmapset-panel__cover-col beatmapset-panel__cover-col--info"},m.Z.windowSize.isDesktop&&h.createElement(i.Z,{beatmapset:this.props.beatmapset,modifiers:"full",size:"card"})))}renderInfoArea(){return h.createElement("div",{className:"beatmapset-panel__info"},h.createElement("div",{className:"beatmapset-panel__info-row beatmapset-panel__info-row--title"},h.createElement("a",{className:"beatmapset-panel__main-link u-ellipsis-overflow",href:this.url},(0,v.YQ)(this.props.beatmapset)),h.createElement("div",{className:"beatmapset-panel__badge-container"},h.createElement(r.Z,{beatmapset:this.props.beatmapset,type:"nsfw"}),h.createElement(r.Z,{beatmapset:this.props.beatmapset,type:"spotlight"}))),h.createElement("div",{className:"beatmapset-panel__info-row beatmapset-panel__info-row--artist"},h.createElement("a",{className:"beatmapset-panel__main-link u-ellipsis-overflow",href:this.url},(0,w.dW)("beatmapsets.show.details.by_artist",{artist:(0,v.aU)(this.props.beatmapset)})),h.createElement("div",{className:"beatmapset-panel__badge-container"},h.createElement(r.Z,{beatmapset:this.props.beatmapset,type:"featured_artist"}))),h.createElement("div",{className:"beatmapset-panel__info-row beatmapset-panel__info-row--source"},h.createElement("div",{className:"u-ellipsis-overflow"},this.props.beatmapset.source)),h.createElement("div",{className:"beatmapset-panel__info-row beatmapset-panel__info-row--mapper"},h.createElement("div",{className:"u-ellipsis-overflow"},h.createElement(a.Z,{mappings:{mapper:h.createElement(A,{beatmapset:this.props.beatmapset})},pattern:(0,w.dW)("beatmapsets.show.details.mapped_by")}))),h.createElement("div",{className:"beatmapset-panel__info-row beatmapset-panel__info-row--stats"},this.showHypeCounts&&null!=this.props.beatmapset.hype&&h.createElement(B,{icon:"fas fa-bullhorn",title:(0,w.dW)("beatmaps.hype.required_text",{current:(0,y.uf)(this.props.beatmapset.hype.current),required:(0,y.uf)(this.props.beatmapset.hype.required)}),type:"hype",value:this.props.beatmapset.hype.current}),this.showHypeCounts&&null!=this.nominations&&h.createElement(B,{icon:"fas fa-thumbs-up",title:(0,w.dW)("beatmaps.nominations.required_text",{current:(0,y.uf)(this.nominations.current),required:(0,y.uf)(this.nominations.required)}),type:"nominations",value:this.nominations.current}),h.createElement(B,{icon:this.favourite.icon,title:(0,w.dW)("beatmaps.panel.favourites",{count:(0,y.uf)(this.props.beatmapset.favourite_count)}),type:"favourite-count",value:this.props.beatmapset.favourite_count}),h.createElement(B,{icon:"fas fa-play-circle",title:(0,w.dW)("beatmaps.panel.playcount",{count:(0,y.uf)(this.props.beatmapset.play_count)}),type:"play-count",value:this.props.beatmapset.play_count}),h.createElement("div",{className:"beatmapset-panel__stats-item beatmapset-panel__stats-item--date"},h.createElement("span",{className:"beatmapset-panel__stats-item-icon"},h.createElement("i",{className:"fa-fw fas fa-check-circle"})),h.createElement(o.Z,{dateTime:this.displayDate}))),h.createElement("a",{className:"beatmapset-panel__info-row beatmapset-panel__info-row--extra",href:this.url,onMouseEnter:this.onExtraRowEnter,onMouseLeave:this.onExtraRowLeave},h.createElement("div",{className:"beatmapset-panel__extra-item"},h.createElement("div",{className:"beatmapset-status beatmapset-status--panel",style:{"--bg-hsl":`var(--beatmapset-${this.props.beatmapset.status}-bg-hsl)`,"--colour":`var(--beatmapset-${this.props.beatmapset.status}-colour)`}},(0,w.dW)(`beatmapsets.show.status.${this.props.beatmapset.status}`))),[...this.groupedBeatmaps].map((([e,t])=>t.length>0&&h.createElement(L,{key:e,beatmaps:t,compact:this.beatmapDotsCompact,mode:e})))))}renderMenuArea(){return h.createElement("div",{className:"beatmapset-panel__menu-container"},h.createElement("div",{className:"beatmapset-panel__menu"},null==m.Z.currentUser?h.createElement("span",{className:"beatmapset-panel__menu-item beatmapset-panel__menu-item--disabled",title:(0,w.dW)("beatmapsets.show.details.favourite_login")},h.createElement("span",{className:this.favourite.icon})):h.createElement("button",{className:"beatmapset-panel__menu-item",onClick:this.toggleFavourite,title:(0,w.dW)(`beatmapsets.show.details.${this.favourite.toggleTitleVariant}`),type:"button"},h.createElement("span",{className:this.favourite.icon})),null==this.downloadLink.url?h.createElement("span",{className:"beatmapset-panel__menu-item beatmapset-panel__menu-item--disabled",title:this.downloadLink.title},h.createElement("span",{className:"fas fa-file-download"})):h.createElement("a",{className:"beatmapset-panel__menu-item","data-turbolinks":"false",href:this.downloadLink.url,title:this.downloadLink.title},h.createElement("span",{className:"fas fa-file-download"}))))}renderPlayArea(){return h.createElement("div",{className:"beatmapset-panel__play-container"},this.showVisual&&h.createElement("button",{className:"beatmapset-panel__play js-audio--play",type:"button"},h.createElement("span",{className:"play-button"})),h.createElement("div",{className:"beatmapset-panel__play-progress"},h.createElement(n.D,{current:0,ignoreProgress:!0,max:1,onlyShowAsWarning:!1,theme:"beatmapset-panel"})),h.createElement("div",{className:"beatmapset-panel__play-icons"},this.props.beatmapset.video&&h.createElement($,{icon:"fas fa-film",titleVariant:"video"}),this.props.beatmapset.storyboard&&h.createElement($,{icon:"fas fa-image",titleVariant:"storyboard"})))}};D([d.LO],U.prototype,"beatmapsPopupHover",void 0),D([d.LO],U.prototype,"mobileExpanded",void 0),D([d.Fl],U.prototype,"beatmapDotsCompact",null),D([d.Fl],U.prototype,"displayDate",null),D([d.Fl],U.prototype,"downloadLink",null),D([d.Fl],U.prototype,"favourite",null),D([d.Fl],U.prototype,"groupedBeatmaps",null),D([d.Fl],U.prototype,"isBeatmapsPopupVisible",null),D([d.Fl],U.prototype,"nominations",null),D([d.Fl],U.prototype,"showHypeCounts",null),D([d.Fl],U.prototype,"showVisual",null),D([d.Fl],U.prototype,"url",null),D([d.aD],U.prototype,"beatmapsPopupHide",void 0),D([d.aD],U.prototype,"beatmapsPopupKeep",void 0),D([d.aD],U.prototype,"onDocumentClick",void 0),D([d.aD],U.prototype,"onMobileExpandToggleClick",void 0),U=D([p.Pi],U);const F=U},434:(e,t,s)=>{s.d(t,{Z:()=>l});var r=s(3664),i=s(1270),n=s(9696);const a=["show","discussions"];function o(e,t){switch(e){case"discussions":return(0,r.B)("beatmapsets.discussion",{beatmapset:t.id});case"show":if(null==t)throw new Error("can't make show url without beatmapset");return(0,r.B)("beatmapsets.show",{beatmapset:t.id});default:return(0,n.Q)(e),""}}function l(e,t){return a.map((s=>({active:s===e,title:(0,i.dW)(`layout.header.beatmapsets.${s}`),url:o(s,t)})))}},849:(e,t,s)=>{s.d(t,{C4:()=>p,C8:()=>c,IQ:()=>b,In:()=>l,Ki:()=>h,_U:()=>d,bG:()=>f,mr:()=>u,zJ:()=>m});var r=s(3664),i=s(8949),n=s(9603),a=s(7181),o=s(9755);function l(e,t){return o.post((0,r.B)("chat.ack"),{history_since:t,since:e})}function c(e){return o.post((0,r.B)("chat.channels.store"),e)}function u(e){return o.get((0,r.B)("chat.channels.show",{channel:e})).then((0,i.aD)((e=>(a.Z.dataStore.userStore.updateMany(e.users),e.channel))))}function d(e,t){return o.get((0,r.B)("chat.channels.messages.index",Object.assign({channel:e,return_object:1},t))).then((0,i.aD)((e=>(a.Z.dataStore.userStore.updateMany(e.users),e.messages.map((e=>n.Z.fromJson(e)))))))}function p(e,t){return o.get((0,r.B)("chat.updates"),{history_since:t,includes:["presence","silences"],since:e})}function m(e,t){return o.ajax({type:"PUT",url:(0,r.B)("chat.channels.mark-as-read",{channel:e,message:t})})}function h(e,t){return o.post((0,r.B)("chat.new"),{is_action:t.isAction,message:t.content,target_id:e,uuid:t.uuid})}function b(e,t){return o.ajax((0,r.B)("chat.channels.part",{channel:e,user:t}),{method:"DELETE"})}function f(e){return o.post((0,r.B)("chat.channels.messages.store",{channel:e.channelId}),{is_action:e.isAction,message:e.content,target_id:e.channelId,target_type:"channel",uuid:e.uuid})}},6699:(e,t,s)=>{s.d(t,{Z:()=>a});var r=s(7181),i=s(7294),n=s(9139);class a extends i.PureComponent{constructor(){super(...arguments),Object.defineProperty(this,"eventId",{enumerable:!0,configurable:!0,writable:!0,value:`admin-menu-${(0,n.d)()}`})}render(){var e;if(!(null===(e=r.Z.currentUser)||void 0===e?void 0:e.is_admin))return null;const t=this.props.items.map((e=>i.createElement(e.component,Object.assign({key:`${e.icon}-${e.text}`,className:"admin-menu-item"},e.props),i.createElement("span",{className:"admin-menu-item__content"},i.createElement("span",{className:"admin-menu-item__label admin-menu-item__label--icon"},i.createElement("span",{className:e.icon})),i.createElement("span",{className:"admin-menu-item__label admin-menu-item__label--text"},e.text)))));return i.createElement("div",{className:"admin-menu"},i.createElement("button",{className:"admin-menu__button js-menu","data-menu-target":`admin-menu-${this.eventId}`},i.createElement("span",{className:"fas fa-angle-up"}),i.createElement("span",{className:"admin-menu__button-icon fas fa-tools"})),i.createElement("div",{className:"admin-menu__menu js-menu","data-menu-id":`admin-menu-${this.eventId}`,"data-visibility":"hidden"},t))}}},8079:(e,t,s)=>{s.d(t,{Z:()=>u});var r=s(8949),i=s(9323),n=s(7294),a=s(1270),o=s(9755),l=function(e,t,s,r){var i,n=arguments.length,a=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(n<3?i(a):n>3?i(t,s,a):i(t,s))||a);return n>3&&a&&Object.defineProperty(t,s,a),a};let c=class extends n.Component{constructor(e){super(e),Object.defineProperty(this,"lastScrollY",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"observer",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"reset",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.lastScrollY=null}}),Object.defineProperty(this,"onClick",{enumerable:!0,configurable:!0,writable:!0,value:()=>{var e,t,s;if(null==this.lastScrollY){const r=null==(null===(e=this.props.anchor)||void 0===e?void 0:e.current)?0:null!==(s=null===(t=o(this.props.anchor.current).offset())||void 0===t?void 0:t.top)&&void 0!==s?s:0;window.pageYOffset>r&&(this.lastScrollY=window.pageYOffset,window.scrollTo(window.pageXOffset,r),this.mountObserver())}else window.scrollTo(window.pageXOffset,this.lastScrollY),this.lastScrollY=null}}),Object.defineProperty(this,"onScroll",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.lastScrollY=null,document.removeEventListener("scroll",this.onScroll),this.removeObserver()}}),(0,r.rC)(this)}componentWillUnmount(){document.removeEventListener("scroll",this.onScroll),this.removeObserver()}render(){return n.createElement("button",{className:"back-to-top","data-tooltip-float":"fixed",onClick:this.onClick,title:(0,a.dW)(null==this.lastScrollY?"common.buttons.back_to_top":"common.buttons.back_to_previous")},n.createElement("span",{className:null==this.lastScrollY?"fas fa-angle-up":"fas fa-angle-down"}))}mountObserver(){var e,t;const s=null!==(t=null===(e=this.props.anchor)||void 0===e?void 0:e.current)&&void 0!==t?t:document.body;this.observer=new IntersectionObserver((e=>{for(const t of e)if(t.target===s&&0===t.boundingClientRect.top){document.addEventListener("scroll",this.onScroll);break}})),this.observer.observe(s)}removeObserver(){null!=this.observer&&(this.observer.disconnect(),this.observer=null)}};l([r.LO],c.prototype,"lastScrollY",void 0),l([r.aD],c.prototype,"reset",void 0),l([r.aD],c.prototype,"onClick",void 0),l([r.aD],c.prototype,"onScroll",void 0),c=l([i.Pi],c);const u=c},7868:(e,t,s)=>{s.d(t,{Z:()=>o});var r=s(6486),i=s(7294),n=s(3336),a=s(3775);function o(e){let t=0===e.total?0:e.current/e.total;return t=(0,r.clamp)(t,0,1),i.createElement("div",{className:(0,n.sb)("bar",e.modifiers),style:{"--fill":100*t+"%"},title:e.title},i.createElement("div",{className:"bar__fill"}),null!=e.textPrecision&&i.createElement("div",{className:"bar__text"},(0,a.uf)(t,e.textPrecision,{style:"percent"})))}},9006:(e,t,s)=>{s.d(t,{Z:()=>c});var r=s(6486),i=s(7294),n=s(3336),a=s(1270),o=s(5076);class l extends i.Component{constructor(){super(...arguments),Object.defineProperty(this,"bodyRef",{enumerable:!0,configurable:!0,writable:!0,value:i.createRef()}),Object.defineProperty(this,"sizeSelectRef",{enumerable:!0,configurable:!0,writable:!0,value:i.createRef()}),Object.defineProperty(this,"cancel",{enumerable:!0,configurable:!0,writable:!0,value:e=>{var t;((null===(t=this.bodyRef.current)||void 0===t?void 0:t.value)===this.props.rawValue||confirm((0,a.dW)("common.confirmation_unsaved")))&&(null!=this.bodyRef.current&&(this.bodyRef.current.value=this.props.rawValue),this.sendOnChange({event:e,type:"cancel"}))}}),Object.defineProperty(this,"onKeyDown",{enumerable:!0,configurable:!0,writable:!0,value:e=>{this.props.ignoreEsc||"Escape"!==e.key||this.cancel()}}),Object.defineProperty(this,"save",{enumerable:!0,configurable:!0,writable:!0,value:e=>{this.sendOnChange({event:e,type:"save"})}})}componentDidMount(){null!=this.sizeSelectRef.current&&(this.sizeSelectRef.current.value=""),null!=this.bodyRef.current&&(this.bodyRef.current.selectionEnd=0,this.bodyRef.current.focus())}render(){let e=(0,n.sb)("bbcode-editor",this.props.modifiers);return e+=" js-bbcode-preview--form",i.createElement("form",{className:e,"data-state":"write"},i.createElement("div",{className:"bbcode-editor__content"},i.createElement("textarea",{ref:this.bodyRef,className:"bbcode-editor__body js-bbcode-preview--body",defaultValue:this.props.rawValue,disabled:this.props.disabled,name:"body",onKeyDown:this.onKeyDown,placeholder:this.props.placeholder}),i.createElement("div",{className:"bbcode-editor__preview"},i.createElement("div",{className:"forum-post-content js-bbcode-preview--preview"})),i.createElement("div",{className:"bbcode-editor__buttons-bar"},i.createElement("div",{className:"bbcode-editor__buttons bbcode-editor__buttons--toolbar"},this.renderToolbar()),i.createElement("div",{className:"bbcode-editor__buttons bbcode-editor__buttons--actions"},i.createElement("div",{className:"bbcode-editor__button bbcode-editor__button--cancel"},this.actionButton(this.cancel,(0,a.dW)("common.buttons.cancel"))),i.createElement("div",{className:"bbcode-editor__button bbcode-editor__button--hide-on-write"},this.renderPreviewHideButton()),i.createElement("div",{className:"bbcode-editor__button bbcode-editor__button--hide-on-preview"},this.renderPreviewShowButton()),i.createElement("div",{className:"bbcode-editor__button"},this.actionButton(this.save,(0,a.dW)("common.buttons.save"),"forum-primary"))))))}actionButton(e,t,s="forum-secondary"){return i.createElement("button",{className:(0,n.sb)("btn-osu-big",s),disabled:this.props.disabled,onClick:e,type:"button"},t)}renderPreviewHideButton(){return i.createElement("button",{className:"js-bbcode-preview--hide btn-osu-big btn-osu-big--forum-secondary",disabled:this.props.disabled,type:"button"},(0,a.dW)("forum.topic.create.preview_hide"))}renderPreviewShowButton(){return i.createElement("button",{className:"js-bbcode-preview--show btn-osu-big btn-osu-big--forum-secondary",disabled:this.props.disabled,type:"button"},(0,a.dW)("forum.topic.create.preview"))}renderToolbar(){return i.createElement("div",{className:"post-box-toolbar"},this.toolbarButton("bold","fas fa-bold"),this.toolbarButton("italic","fas fa-italic"),this.toolbarButton("strikethrough","fas fa-strikethrough"),this.toolbarButton("heading","fas fa-heading"),this.toolbarButton("link","fas fa-link"),this.toolbarButton("spoilerbox","fas fa-barcode"),this.toolbarButton("list-numbered","fas fa-list-ol"),this.toolbarButton("list","fas fa-list"),this.toolbarButton("image","fas fa-image"),this.toolbarButton("imagemap","fas fa-map"),this.toolbarSizeSelect(),i.createElement("a",{className:"post-box-toolbar__help",href:(0,o.dP)("BBCode"),rel:"noreferrer",target:"_blank"},(0,a.dW)("bbcode.help")))}sendOnChange({event:e,type:t}){var s,r;this.props.onChange({event:e,hasChanged:(null===(s=this.bodyRef.current)||void 0===s?void 0:s.value)!==this.props.rawValue,type:t,value:null===(r=this.bodyRef.current)||void 0===r?void 0:r.value})}toolbarButton(e,t){return i.createElement("button",{className:`btn-circle btn-circle--bbcode js-bbcode-btn--${e}`,disabled:this.props.disabled,title:(0,a.dW)(`bbcode.${(0,r.snakeCase)(e)}`),type:"button"},i.createElement("span",{className:"btn-circle__content"},i.createElement("span",{className:t})))}toolbarSizeSelect(){return i.createElement("label",{className:"bbcode-size-select",title:(0,a.dW)("bbcode.size._")},i.createElement("span",{className:"bbcode-size-select__label"},(0,a.dW)("bbcode.size._")),i.createElement("i",{className:"fas fa-chevron-down"}),i.createElement("select",{ref:this.sizeSelectRef,className:"bbcode-size-select__select js-bbcode-btn--size",disabled:this.props.disabled},i.createElement("option",{value:"50"},(0,a.dW)("bbcode.size.tiny")),i.createElement("option",{value:"85"},(0,a.dW)("bbcode.size.small")),i.createElement("option",{value:"100"},(0,a.dW)("bbcode.size.normal")),i.createElement("option",{value:"150"},(0,a.dW)("bbcode.size.large"))))}}Object.defineProperty(l,"defaultProps",{enumerable:!0,configurable:!0,writable:!0,value:{disabled:!1,ignoreEsc:!1}});const c=l},152:(e,t,s)=>{s.d(t,{Z:()=>d});var r=s(9323),i=s(7294),n=s(3775),a=s(1270),o=function(e,t,s,r){var i,n=arguments.length,a=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(n<3?i(a):n>3?i(t,s,a):i(t,s))||a);return n>3&&a&&Object.defineProperty(t,s,a),a};const l="beatmap-basic-stats",c=["total_length","bpm","count_circles","count_sliders"];let u=class extends i.Component{constructor(){super(...arguments),Object.defineProperty(this,"renderEntry",{enumerable:!0,configurable:!0,writable:!0,value:e=>{const t={};let s="";const r=this.props.beatmap[e];let o;switch(e){case"bpm":{r>1e3&&(o="∞");const e=this.props.beatmapset.offset;0!==e&&(s+=` (${(0,a.dW)("beatmapsets.show.stats.offset",{offset:(0,n.uf)(e)})})`);break}case"total_length":o=(0,n.LU)(this.props.beatmap[e]),t.hit_length=(0,n.LU)(this.props.beatmap.hit_length)}return null!=o||(o=(0,n.uf)(r)),i.createElement("div",{key:e,className:`${l}__entry`,title:`${(0,a.dW)(`beatmapsets.show.stats.${e}`,t)}${s}`},i.createElement("div",{className:`${l}__entry-icon`,style:{backgroundImage:`url(/images/layout/beatmapset-page/${e}.svg)`}}),i.createElement("span",null,o))}})}render(){return i.createElement("div",{className:l},c.map(this.renderEntry))}};u=o([r.Pi],u);const d=u},9434:(e,t,s)=>{s.d(t,{p:()=>u});var r=s(7294),i=s(7762),n=s(7629),a=s(3336),o=s(9139),l=s(6793),c=s(9755);class u extends r.Component{constructor(){super(...arguments),Object.defineProperty(this,"tooltipId",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"handleMouseOver",{enumerable:!0,configurable:!0,writable:!0,value:e=>{if(!this.props.withTooltip)return;const t=e.currentTarget;if(t._tooltip===this.tooltipId)return;const s=c((0,i.renderToStaticMarkup)(r.createElement("div",{className:"tooltip-beatmap"},r.createElement("div",{className:"tooltip-beatmap__content"},r.createElement("div",null,this.props.beatmap.version),r.createElement(l.Z,{rating:this.props.beatmap.difficulty_rating})))));if(null!=t._tooltip)return t._tooltip=this.tooltipId,void c(t).qtip("set",{"content.text":s});t._tooltip=this.tooltipId;const n={content:s,hide:"touchstart"===e.type?{event:"touchstart unfocus",inactive:3e3}:{event:"click mouseleave"},overwrite:!1,position:{at:"top center",my:"bottom center",viewport:c(window)},show:{event:e.type,ready:!0},style:{classes:"qtip qtip--tooltip-beatmap",tip:{height:9,width:10}}};c(t).qtip(n,e)}})}render(){this.tooltipId=`beatmap-icon-${this.props.beatmap.id}-${(0,o.d)()}`;const e=this.props.beatmap.convert&&!this.props.showConvertMode?"osu":this.props.beatmap.mode,t=(0,a.sb)("beatmap-icon",this.props.modifiers,{"with-hover":this.props.withTooltip}),s={"--diff":(0,n.yh)(this.props.beatmap.difficulty_rating)};return r.createElement("div",{className:t,onMouseOver:this.handleMouseOver,onTouchStart:this.handleMouseOver,style:s},r.createElement("i",{className:`fal fa-extra-mode-${e}`}))}}Object.defineProperty(u,"defaultProps",{enumerable:!0,configurable:!0,writable:!0,value:{showConvertMode:!1,withTooltip:!1}})},1426:(e,t,s)=>{s.d(t,{Z:()=>c});var r=s(6793),i=s(6871),n=s(7294),a=s(3336),o=s(1270),l=s(4403);class c extends n.PureComponent{render(){const e="deleted_at"in this.props.beatmap&&null!==this.props.beatmap.deleted_at,t=`${this.props.beatmap.version}${e?` [${(0,o.dW)("beatmap_discussions.index.deleted_beatmap")}]`:""}`;return n.createElement("div",{className:(0,a.sb)("beatmap-list-item",{deleted:e,inline:this.props.inline},this.props.modifiers)},n.createElement("div",{className:"beatmap-list-item__col beatmap-list-item__col--icon"},n.createElement("span",{className:`fal fa-extra-mode-${this.props.beatmap.mode}`})),n.createElement("div",{className:"beatmap-list-item__col"},n.createElement(r.Z,{rating:this.props.beatmap.difficulty_rating})),n.createElement("div",{className:"beatmap-list-item__col beatmap-list-item__col--main"},n.createElement("div",{className:"beatmap-list-item__version "+(this.props.inline?"":"u-ellipsis-overflow")},null!=this.props.beatmapUrl?n.createElement("a",{className:"beatmap-list-item__version-link",href:this.props.beatmapUrl},t):t," ",n.createElement("span",{className:"beatmap-list-item__mapper"},this.renderMapper()))))}renderMapper(){if(null==this.props.mapper)return null;const e=this.props.beatmapset.user_id!==this.props.beatmap.user_id;if(!e&&!this.props.showNonGuestMapper)return null;const t=e?"mapped_by_guest":"mapped_by",s=e?this.props.mapper:{id:this.props.beatmapset.user_id,username:this.props.beatmapset.creator};return n.createElement(l.Z,{mappings:{mapper:n.createElement(i.Z,{user:s})},pattern:(0,o.dW)(`beatmapsets.show.details.${t}`)})}}},4057:(e,t,s)=>{s.d(t,{Z:()=>l});var r=s(3664),i=s(7294),n=s(3336),a=s(1270),o=s(5076);function l(e){let t;switch(e.type){case"featured_artist":if(null==e.beatmapset.track_id)return null;t=(0,r.B)("tracks.show",{track:e.beatmapset.track_id});break;case"nsfw":if(!e.beatmapset.nsfw)return null;break;case"spotlight":if(!e.beatmapset.spotlight)return null;t=(0,o.dP)("Beatmap_Spotlights")}const s=(0,a.dW)(`beatmapsets.${e.type}_badge.label`),l=(0,n.sb)("beatmapset-badge",e.modifiers,e.type);return null==t?i.createElement("span",{className:l},s):i.createElement("a",{className:l,href:t},s)}},7292:(e,t,s)=>{s.d(t,{Z:()=>l});var r=s(7294),i=s(6817),n=s(3336),a=s(3775),o=s(1270);function l(e){var t;const s=(0,n.sb)("beatmapset-cover",e.modifiers);if(null!==(t=e.isDeleted)&&void 0!==t&&t)return r.createElement("div",{className:s,title:(0,o.dW)("beatmapsets.cover.deleted")},r.createElement("span",{className:"fas fa-trash"}));const l=null!=e.beatmapset&&(e.forceShowVisual||(0,i.uX)(e.beatmapset))?(0,a.ib)(e.beatmapset.covers[e.size]):void 0;return r.createElement("div",{className:s,style:l})}},9394:(e,t,s)=>{s.d(t,{Z:()=>v});var r=s(4985),i=s(7292),n=s(12),a=s(3664),o=s(6486),l=s(8125),c=s(7294),u=s(41),d=s(3336),p=s(3775),m=s(1270),h=s(4403),b=s(6871);function f(e){return"string"==typeof e?e.toLowerCase().replace(/ /g,"-"):""}class v extends c.PureComponent{get beatmapsetId(){var e;return null===(e=this.props.event.beatmapset)||void 0===e?void 0:e.id}get discussionId(){const e=this.props.event.comment;if(null!=e&&"object"==typeof e&&"beatmap_discussion_id"in e)return e.beatmap_discussion_id}get discussion(){var e,t,s;return null!==(e=this.props.event.discussion)&&void 0!==e?e:null===(t=this.props.discussions)||void 0===t?void 0:t[null!==(s=this.discussionId)&&void 0!==s?s:""]}get firstPost(){var e,t,s,r;const i=null!==(t=null===(e=this.discussion)||void 0===e?void 0:e.starting_post)&&void 0!==t?t:null===(r=null===(s=this.discussion)||void 0===s?void 0:s.posts)||void 0===r?void 0:r[0];return(null==i?void 0:i.system)?null:i}render(){return"discussions"===this.props.mode?this.renderDiscussionsVersion():this.renderProfileVersion()}renderDiscussionsVersion(){var e;const t=null!==(e=this.props.time)&&void 0!==e?e:this.props.event.created_at;return c.createElement("div",{className:"beatmapset-event"},c.createElement("div",{className:"beatmapset-event__icon",style:this.iconStyle()}),c.createElement("div",{className:"beatmapset-event__time"},c.createElement(n.Z,{dateTime:t,format:"LT"})),c.createElement("div",{className:"beatmapset-event__content"},this.content()))}renderProfileVersion(){let e;return null!=this.beatmapsetId&&(e=(0,a.B)("beatmapsets.discussion",{beatmapset:this.beatmapsetId}),null!=this.discussionId&&(e=`${e}#/${this.discussionId}`)),c.createElement("div",{className:"beatmapset-event"},null!=e?c.createElement("a",{href:e},c.createElement(i.Z,{beatmapset:this.props.event.beatmapset,size:"list"})):c.createElement(i.Z,{isDeleted:!0}),c.createElement("div",{className:(0,d.sb)("beatmapset-event__icon",["beatmapset-activities"]),style:this.iconStyle()}),c.createElement("div",null,c.createElement("div",{className:"beatmapset-event__content"},this.content()),c.createElement("div",{className:"beatmap-discussion-post__info"},c.createElement(n.Z,{dateTime:this.props.event.created_at,relative:!0}))))}content(){var e,t,s;let i,n="",o="[unknown user]",d="",v="";if(null!=this.discussionId){if(null==this.discussion)v=(0,a.B)("beatmapsets.discussions.show",{discussion:this.discussionId}),d=(0,m.dW)("beatmapset_events.item.discussion_deleted");else{const t=null===(e=this.firstPost)||void 0===e?void 0:e.message;v=(0,u.bf)({discussion:this.discussion}),d=null!=t?c.createElement(r.Z,{markdown:t}):"[no preview]";const s=this.props.users[this.discussion.user_id];null!=s&&(o=c.createElement(b.Z,{user:s}))}n=c.createElement("a",{className:"js-beatmap-discussion--jump",href:v},`#${this.discussionId}`)}else"string"==typeof this.props.event.comment&&(d=this.props.event.comment);if("discussion_lock"!==this.props.event.type&&"remove_from_loved"!==this.props.event.type||(d=this.props.event.comment.reason),null!=this.props.event.user_id){const e=this.props.users[this.props.event.user_id];i=null!=e?c.createElement(b.Z,{user:e}):l.ei.username}const g={discussion:n,discussion_user:o,text:d,user:i};if(null!=this.props.event.comment&&"object"==typeof this.props.event.comment)for(const[r,a]of Object.entries(this.props.event.comment))"number"!=typeof a&&"string"!=typeof a||(g[r]=a);let y=this.props.event.type;switch(this.props.event.type){case"disqualify":"string"==typeof this.props.event.comment&&(y="disqualify_legacy");break;case"genre_edit":g.new=(0,m.dW)(`beatmaps.genre.${f(this.props.event.comment.new)}`),g.old=(0,m.dW)(`beatmaps.genre.${f(this.props.event.comment.old)}`);break;case"language_edit":g.new=(0,m.dW)(`beatmaps.language.${f(this.props.event.comment.new)}`),g.old=(0,m.dW)(`beatmaps.language.${f(this.props.event.comment.old)}`);break;case"nominate":{const e=null===(t=this.props.event.comment)||void 0===t?void 0:t.modes;if(null!=e&&e.length>0){y="nominate_modes";const t=e.map((e=>(0,m.dW)(`beatmaps.mode.${e}`)));g.modes=(0,m.m2)(t)}break}case"nsfw_toggle":y+=`.${(null===(s=this.props.event.comment)||void 0===s?void 0:s.new)?"to_1":"to_0"}`;break;case"beatmap_owner_change":{const e=this.props.event.comment;g.new_user=c.createElement("a",{href:(0,a.B)("users.show",{user:e.new_user_id})},e.new_user_username),g.beatmap=c.createElement("a",{href:(0,a.B)("beatmaps.show",{beatmap:e.beatmap_id})},e.beatmap_version);break}case"nomination_reset_received":{const e=this.props.event.comment;"profile"===this.props.mode?(y+="_profile",g.user=c.createElement("a",{href:(0,a.B)("users.show",{user:e.source_user_id})},e.source_user_username)):g.source_user=c.createElement("a",{href:(0,a.B)("users.show",{user:e.source_user_id})},e.source_user_username);break}case"offset_edit":g.new=(0,p.uf)(this.props.event.comment.new),g.old=(0,p.uf)(this.props.event.comment.old)}const w=`beatmapset_events.event.${y}`;let _=(0,m.dW)(w);return null==i||(0,m.dW)(w).includes(":user")||(_+=" (:user)"),c.createElement(h.Z,{mappings:g,pattern:_})}iconStyle(){return{"--bg":`var(--bg-${(0,o.kebabCase)(this.props.event.type)})`}}}},714:(e,t,s)=>{s.d(t,{Z:()=>n});var r=s(9394),i=s(7294);class n extends i.PureComponent{render(){return this.props.events.map((e=>i.createElement(r.Z,{key:e.id,event:e,mode:this.props.mode,users:this.props.users})))}}},5855:(e,t,s)=>{s.d(t,{Z:()=>d});var r=s(4403),i=s(12),n=s(4929),a=s(6871),o=s(381),l=s(7294),c=s(1270);const u="beatmapset-mapping";class d extends l.PureComponent{render(){var e;const t={username:this.props.beatmapset.creator},s=null!==(e=this.props.user)&&void 0!==e?e:this.props.beatmapset.user;return null!=s&&(t.id=s.id,t.avatar_url=s.avatar_url),l.createElement("div",{className:u},l.createElement(a.Z,{user:t},l.createElement(n.Z,{modifiers:"beatmapset",user:t})),l.createElement("div",{className:`${u}__content`},l.createElement("div",{className:`${u}__mapper`},l.createElement(r.Z,{mappings:{mapper:l.createElement(a.Z,{className:`${u}__user`,user:t})},pattern:(0,c.dW)("beatmapsets.show.details.mapped_by")})),this.renderDate("submitted","submitted_date"),this.props.beatmapset.ranked>0?this.renderDate(this.props.beatmapset.status,"ranked_date"):this.renderDate("updated","last_updated")))}renderDate(e,t){const s=this.props.beatmapset[t];if(null==s)throw new Error(`beatmapset data is missing the expected date attribute: ${t}`);const n=Math.abs(o().diff(o(s),"weeks"))<4;return l.createElement("div",null,l.createElement(r.Z,{mappings:{timeago:l.createElement("strong",null,l.createElement(i.Z,{dateTime:s,relative:n}))},pattern:(0,c.dW)(`beatmapsets.show.details_date.${e}`)}))}}},7010:(e,t,s)=>{s.d(t,{Z:()=>l});var r=s(7294),i=s(3336),n=s(3924),a=s(6741);class o extends r.Component{get disabled(){return this.props.disabled||this.props.isBusy}get text(){return null==this.props.text?null:"string"==typeof this.props.text?{top:this.props.text}:this.props.text}render(){let e=(0,i.sb)("btn-osu-big",this.props.modifiers,{disabled:this.disabled});return null!=this.props.extraClasses&&(e+=` ${this.props.extraClasses.join(" ")}`),this.disabled?r.createElement("span",Object.assign({className:e},this.props.props,{onClick:void 0}),this.renderChildren()):(0,n.W)(this.props.href)?r.createElement("a",Object.assign({className:e,href:this.props.href},this.props.props),this.renderChildren()):r.createElement("button",Object.assign({className:e,type:this.props.isSubmit?"submit":"button"},this.props.props),this.renderChildren())}renderChildren(){const e=this.text;return r.createElement("span",{className:(0,i.sb)("btn-osu-big__content",{center:null==e||null==this.props.icon})},null!=e&&r.createElement("span",{className:"btn-osu-big__left"},r.createElement("span",{className:"btn-osu-big__text-top"},e.top),"bottom"in e&&null!=e.bottom&&r.createElement("span",{className:"btn-osu-big__text-bottom"},e.bottom)),null!=this.props.icon&&r.createElement("span",{className:"btn-osu-big__icon"},r.createElement("span",{className:"fa fa-fw"},this.props.isBusy?r.createElement(a.$,{modifiers:"center-inline"}):r.createElement("span",{className:this.props.icon}))))}}Object.defineProperty(o,"defaultProps",{enumerable:!0,configurable:!0,writable:!0,value:{disabled:!1,extraClasses:[],isBusy:!1,isSubmit:!1,props:{}}});const l=o},5069:(e,t,s)=>{s.d(t,{Z:()=>f});var r=s(3664),i=s(8949),n=s(9323),a=s(7181),o=s(7294),l=s(9703),c=s(3336),u=s(1270),d=s(6741),p=s(9755),m=function(e,t,s,r){var i,n=arguments.length,a=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(n<3?i(a):n>3?i(t,s,a):i(t,s))||a);return n>3&&a&&Object.defineProperty(t,s,a),a};const h="textual-button";let b=class extends o.Component{get block(){var e;return null===(e=a.Z.currentUser)||void 0===e?void 0:e.blocks.find((e=>e.target_id===this.props.userId))}constructor(e){super(e),Object.defineProperty(this,"loading",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"xhr",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clicked",{enumerable:!0,configurable:!0,writable:!0,value:()=>{var e,t;confirm((0,u.dW)("common.confirmation"))?this.toggleBlock():null===(t=(e=this.props).onClick)||void 0===t||t.call(e)}}),Object.defineProperty(this,"toggleBlock",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.loading=!0,null==this.block?this.xhr=p.ajax((0,r.B)("blocks.store",{target:this.props.userId}),{type:"POST"}):this.xhr=p.ajax((0,r.B)("blocks.destroy",{block:this.props.userId}),{type:"DELETE"}),this.xhr.done(this.updateBlocks).fail((0,l.Gi)(this.toggleBlock)).always((0,i.aD)((()=>this.loading=!1)))}}),Object.defineProperty(this,"updateBlocks",{enumerable:!0,configurable:!0,writable:!0,value:e=>{var t,s;null!=a.Z.currentUser&&(a.Z.currentUser.blocks=e.filter((e=>"block"===e.relation_type)),a.Z.currentUser.friends=e.filter((e=>"friend"===e.relation_type)),p.publish("user:update",a.Z.currentUser)),null===(s=(t=this.props).onClick)||void 0===s||s.call(t)}}),(0,i.rC)(this)}get isVisible(){return null!=a.Z.currentUser&&Number.isFinite(this.props.userId)&&this.props.userId!==a.Z.currentUser.id}componentWillUnmount(){var e;null===(e=this.xhr)||void 0===e||e.abort()}render(){if(!this.isVisible)return null;const e=(0,c.sb)(h,this.props.modifiers,"block");let t,s;return null==this.props.wrapperClass?s=e:(t=e,s=this.props.wrapperClass),o.createElement("button",{className:s,disabled:this.loading,onClick:this.clicked,type:"button"},o.createElement("span",{className:t},this.loading?o.createElement("span",{className:`${h}__icon fa-fw`},o.createElement(d.$,null)):o.createElement("span",{className:`${h}__icon fas fa-ban fa-fw`})," ",null==this.block?(0,u.dW)("users.blocks.button.block"):(0,u.dW)("users.blocks.button.unblock")))}};m([i.LO],b.prototype,"loading",void 0),m([i.Fl],b.prototype,"block",null),m([i.Fl],b.prototype,"isVisible",null),m([i.aD],b.prototype,"toggleBlock",void 0),m([i.aD],b.prototype,"updateBlocks",void 0),b=m([n.Pi],b);const f=b},7735:(e,t,s)=>{s.d(t,{D:()=>a});var r=s(7294),i=s(3336),n=s(3924);class a extends r.PureComponent{constructor(){super(...arguments),Object.defineProperty(this,"bn",{enumerable:!0,configurable:!0,writable:!0,value:"circular-progress"})}render(){var e;const t=this.bn,s=Math.min(1,this.props.current/this.props.max);if(this.props.onlyShowAsWarning&&s<.75)return null;const a=this.props.ignoreProgress?void 0:{transform:`rotate(${s}turn)`};return r.createElement("div",{className:(0,i.sb)(t,{over:1===s,over50:s>.5,warn:s>=.75&&s<1,[this.props.theme]:(0,n.W)(this.props.theme)}),title:null!==(e=this.props.tooltip)&&void 0!==e?e:`${this.props.current} / ${this.props.max}`},r.createElement("div",{className:`${t}__label`},this.props.max-this.props.current),r.createElement("div",{className:`${t}__slice`},r.createElement("div",{className:`${t}__circle`,style:a}),r.createElement("div",{className:`${t}__circle ${t}__circle--fill`})))}}Object.defineProperty(a,"defaultProps",{enumerable:!0,configurable:!0,writable:!0,value:{ignoreProgress:!1,onlyShowAsWarning:!1,theme:""}})},9240:(e,t,s)=>{s.d(t,{Z:()=>c});var r=s(5859),i=s(7294),n=s(1270),a=s(9755);const o="click-to-copy";class l extends i.Component{constructor(){super(...arguments),Object.defineProperty(this,"linkRef",{enumerable:!0,configurable:!0,writable:!0,value:i.createRef()}),Object.defineProperty(this,"timer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"titles",{enumerable:!0,configurable:!0,writable:!0,value:{default:(0,n.dW)("common.buttons.click_to_copy"),onClick:(0,n.dW)("common.buttons.click_to_copy_copied")}}),Object.defineProperty(this,"onClick",{enumerable:!0,configurable:!0,writable:!0,value:e=>{e.preventDefault(),r.writeText(this.props.value);const t=this.api;null!=t&&(t.set("content.text",this.titles.onClick),window.clearTimeout(this.timer),this.timer=window.setTimeout(this.resetTooltip,1e3))}}),Object.defineProperty(this,"onMouseLeave",{enumerable:!0,configurable:!0,writable:!0,value:()=>{window.clearTimeout(this.timer),this.resetTooltip()}}),Object.defineProperty(this,"resetTooltip",{enumerable:!0,configurable:!0,writable:!0,value:()=>{const e=this.api;null!=e&&(e.hide(),this.timer=window.setTimeout((()=>{e.set("content.text",this.titles.default)}),100))}})}get api(){if(null!=this.linkRef.current)return a(this.linkRef.current).qtip("api")}componentWillUnmount(){window.clearTimeout(this.timer)}render(){var e;return this.props.value?i.createElement("a",{ref:this.linkRef,className:o,"data-tooltip-hide-events":"mouseleave","data-tooltip-pin-position":!0,"data-tooltip-position":"bottom center",href:this.props.valueAsUrl?this.props.value:"#",onClick:this.onClick,onMouseLeave:this.onMouseLeave,title:this.titles.default},null!==(e=this.props.label)&&void 0!==e?e:this.props.value,this.props.showIcon&&i.createElement("i",{className:`fas fa-paste ${o}__icon`})):i.createElement("span",null)}}Object.defineProperty(l,"defaultProps",{enumerable:!0,configurable:!0,writable:!0,value:{showIcon:!1,valueAsUrl:!1}});const c=l},1581:(e,t,s)=>{s.d(t,{Z:()=>g});var r=s(2163),i=s(8949),n=s(9323),a=s(7181),o=s(7294),l=s(3336),c=s(7937),u=s(1270),d=s(7010),p=s(6741),m=s(4929),h=function(e,t,s,r){var i,n=arguments.length,a=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(n<3?i(a):n>3?i(t,s,a):i(t,s))||a);return n>3&&a&&Object.defineProperty(t,s,a),a};const b="comment-editor",f={edit:"save",new:"post",reply:"reply"};let v=class extends o.Component{get canComment(){return null!=a.Z.currentUser&&("edit"===this.mode||null==this.canNewCommentReason)}get canNewCommentReason(){return null==this.props.commentableMeta?null:"current_user_attributes"in this.props.commentableMeta?this.props.commentableMeta.current_user_attributes.can_new_comment_reason:(0,u.dW)("authorization.comment.store.disabled")}get isValid(){return this.message.length>0}get initialMessage(){var e;return null!==(e=this.props.message)&&void 0!==e?e:""}get mode(){return null!=this.props.parent?"reply":null!=this.props.id?"edit":"new"}get placeholder(){var e;return this.canComment?(0,u.dW)(`comments.placeholder.${this.mode}`):null!==(e=this.canNewCommentReason)&&void 0!==e?e:void 0}constructor(e){super(e),Object.defineProperty(this,"handleKeyDown",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"message",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"posting",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"textarea",{enumerable:!0,configurable:!0,writable:!0,value:o.createRef()}),Object.defineProperty(this,"xhr",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"close",{enumerable:!0,configurable:!0,writable:!0,value:()=>{null!=this.props.close&&(this.initialMessage===this.message||confirm((0,u.dW)("common.confirmation_unsaved")))&&this.props.close()}}),Object.defineProperty(this,"handleKeyDownCallback",{enumerable:!0,configurable:!0,writable:!0,value:e=>{e===c.z.Cancel?this.close():e===c.z.Submit&&this.post()}}),Object.defineProperty(this,"onChange",{enumerable:!0,configurable:!0,writable:!0,value:e=>{this.message=e.currentTarget.value}}),Object.defineProperty(this,"post",{enumerable:!0,configurable:!0,writable:!0,value:()=>{var e,t,s,r;const n={commentableMeta:this.props.commentableMeta,id:this.props.id,message:this.message,mode:this.mode,parentId:null===(e=this.props.parent)||void 0===e?void 0:e.id};this.props.controller.isPosting(n)||("edit"!==this.mode||this.message!==(null!==(t=this.props.message)&&void 0!==t?t:"")?this.props.controller.apiPost(n,(0,i.aD)((()=>{var e,t,s,r;this.message="",null===(t=(e=this.props).onPosted)||void 0===t||t.call(e,this.mode),null===(r=(s=this.props).close)||void 0===r||r.call(s)}))):null===(r=(s=this.props).close)||void 0===r||r.call(s))}}),this.handleKeyDown=(0,c.k)(this.handleKeyDownCallback),this.message=this.initialMessage,(0,i.rC)(this)}componentDidMount(){var e;null!==(e=this.props.focus)&&void 0!==e&&!e||null==this.textarea.current||(this.textarea.current.selectionStart=-1,this.textarea.current.focus())}componentWillUnmount(){var e;null===(e=this.xhr)||void 0===e||e.abort()}render(){const e=(0,l.sb)(b,this.props.modifiers,{fancy:"new"===this.mode});return o.createElement("div",{className:e},"new"===this.mode&&o.createElement("div",{className:`${b}__avatar`},o.createElement(m.Z,{modifiers:"full-circle",user:a.Z.currentUser})),o.createElement(r.Z,{className:`${b}__message`,disabled:!this.canComment||this.posting,innerRef:this.textarea,onChange:this.onChange,onKeyDown:this.handleKeyDown,placeholder:this.placeholder,value:this.message}),o.createElement("div",{className:`${b}__footer`},o.createElement("div",{className:`${b}__footer-item ${b}__footer-item--notice hidden-xs`},this.canComment&&(0,u.dW)("comments.editor.textarea_hint._",{action:(0,u.dW)(`comments.editor.textarea_hint.${this.mode}`)})),null!=this.props.close&&o.createElement("div",{className:`${b}__footer-item`},o.createElement(d.Z,{disabled:this.posting,modifiers:"comment-editor",props:{onClick:this.props.close},text:(0,u.dW)("common.buttons.cancel")})),null!=a.Z.currentUser?o.createElement("div",{className:`${b}__footer-item`},o.createElement(d.Z,{disabled:!this.isValid,isBusy:this.posting,modifiers:"comment-editor",props:{onClick:this.post},text:{top:this.posting?o.createElement(p.$,{modifiers:"center-inline"}):(0,u.dW)(`common.buttons.${f[this.mode]}`)}})):o.createElement("div",{className:`${b}__footer-item`},o.createElement(d.Z,{extraClasses:["js-user-link"],modifiers:"comment-editor",text:(0,u.dW)(`comments.guest_button.${this.mode}`)}))))}};h([i.LO],v.prototype,"message",void 0),h([i.LO],v.prototype,"posting",void 0),h([i.Fl],v.prototype,"canComment",null),h([i.Fl],v.prototype,"mode",null),h([i.Fl],v.prototype,"placeholder",null),h([i.aD],v.prototype,"onChange",void 0),h([i.aD],v.prototype,"post",void 0),v=h([n.Pi],v);const g=v},8573:(e,t,s)=>{s.d(t,{Z:()=>p});var r=s(9323),i=s(7294),n=s(3336),a=s(1270),o=s(3890),l=s(6741),c=function(e,t,s,r){var i,n=arguments.length,a=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(n<3?i(a):n>3?i(t,s,a):i(t,s))||a);return n>3&&a&&Object.defineProperty(t,s,a),a};const u="comment-show-more";let d=class extends i.Component{constructor(){super(...arguments),Object.defineProperty(this,"load",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.props.controller.apiLoadMore(this.props.parent)}})}get loading(){return this.props.controller.isLoading(this.props.parent)}get hasMoreComments(){var e;return null==this.props.parent||null===(e=this.props.controller.state.hasMore[this.props.parent.id])||void 0===e||e}render(){var e,t;return this.props.comments.length>=this.props.total?null:this.hasMoreComments?null!==(e=this.props.top)&&void 0!==e&&e?i.createElement(o.Z,{callback:this.load,hasMore:!0,loading:this.loading,modifiers:"comments",remaining:this.props.total-this.props.comments.length}):i.createElement("div",{className:(0,n.sb)(u,this.props.modifiers)},this.loading?i.createElement(l.$,null):i.createElement("button",{className:`${u}__link`,onClick:this.load},null!==(t=this.props.label)&&void 0!==t?t:(0,a.dW)("common.buttons.show_more"))):null}};d=c([r.Pi],d);const p=d},8462:(e,t,s)=>{s.d(t,{Z:()=>C});var r=s(3664),i=s(6486),n=s(8949),a=s(9323),o=s(8125),l=s(7181),c=s(7294),u=s(3336);let d=null;function p(e){const t=function(){if(null==d&&(d=document.querySelector(".js-estimate-min-lines"),null==d))throw new Error("js-estimate-min-lines placeholder element is missing!");return d}();t.innerHTML=e;const s=t.firstChild;let r=t;s instanceof HTMLElement&&(r=s);const i=parseFloat(window.getComputedStyle(r).getPropertyValue("line-height")),n=t.scrollHeight;return{count:Math.ceil(n/i),height:n,lineHeight:i}}var m,h=s(3775),b=s(1270),f=s(9240),v=s(1581),g=s(8573),y=s(3635),w=s(2325),_=s(3890),E=s(6741),O=s(4403),P=s(12),j=s(4929),k=s(6871),N=function(e,t,s,r){var i,n=arguments.length,a=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(n<3?i(a):n>3?i(t,s,a):i(t,s))||a);return n>3&&a&&Object.defineProperty(t,s,a),a};let S=m=class extends c.Component{get hasVoted(){return this.props.controller.state.votedCommentIds.has(this.props.comment.id)}get isBlocked(){return null!=this.props.comment.userId&&l.Z.currentUserModel.blocks.has(this.props.comment.userId)}get isLongContent(){return null!=this.lines&&this.lines.count>=9}get lines(){var e;return p(null!==(e=this.props.comment.messageHtml)&&void 0!==e?e:"")}get meta(){return this.props.controller.getCommentableMeta(this.props.comment)}get parentComment(){return null==this.props.comment.parentId?void 0:this.props.controller.state.comments[this.props.comment.parentId]}get parentPreview(){var e;const t=this.parentComment;if(null==t)throw new Error("trying to render parent preview without parent");return t.isDeleted?(0,b.dW)("comments.deleted"):null!=t.userId&&l.Z.currentUserModel.blocks.has(t.userId)?(0,b.dW)("users.blocks.comment_text"):(0,i.truncate)((0,h.oN)(null!==(e=t.messageHtml)&&void 0!==e?e:""),{length:100})}get postingVote(){return this.props.controller.isVoting(this.props.comment)}get replies(){const e=this.props.controller.state.commentIdsByParentId[this.props.comment.id];return this.props.controller.getComments(e)}get user(){return this.getCommentUser(this.props.comment)}constructor(e){if(super(e),Object.defineProperty(this,"clipped",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"editing",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"expandReplies",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"forceShow",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"showMoreRef",{enumerable:!0,configurable:!0,writable:!0,value:c.createRef()}),Object.defineProperty(this,"showNewReply",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"onCloseEdit",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.editing=!1}}),Object.defineProperty(this,"onCloseReplyBox",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.showNewReply=!1}}),Object.defineProperty(this,"onDelete",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.props.controller.apiDelete(this.props.comment)}}),Object.defineProperty(this,"onLoadReplies",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.props.controller.apiLoadMore(this.props.comment),this.onToggleReplies()}}),Object.defineProperty(this,"onReplyPosted",{enumerable:!0,configurable:!0,writable:!0,value:e=>{this.expandReplies="reply"===e}}),Object.defineProperty(this,"onRestore",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.props.controller.apiRestore(this.props.comment)}}),Object.defineProperty(this,"onShowDeletedToggleClick",{enumerable:!0,configurable:!0,writable:!0,value:()=>{l.Z.userPreferences.set("comments_show_deleted",!l.Z.userPreferences.get("comments_show_deleted"))}}),Object.defineProperty(this,"onToggleClip",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.clipped=!this.clipped}}),Object.defineProperty(this,"onToggleEdit",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.editing=!this.editing}}),Object.defineProperty(this,"onToggleForceShow",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.forceShow=!this.forceShow}}),Object.defineProperty(this,"onToggleNewReply",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.showNewReply=!this.showNewReply}}),Object.defineProperty(this,"onTogglePinned",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.props.controller.apiTogglePin(this.props.comment)}}),Object.defineProperty(this,"onToggleReplies",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.expandReplies=!this.expandReplies}}),Object.defineProperty(this,"onToggleVote",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.props.controller.apiToggleVote(this.props.comment)}}),Object.defineProperty(this,"renderComment",{enumerable:!0,configurable:!0,writable:!0,value:e=>{if(null!=e&&(!e.isDeleted||l.Z.userPreferences.get("comments_show_deleted")))return c.createElement(m,{key:e.id,comment:e,controller:this.props.controller,depth:this.props.depth+1,expandReplies:this.props.expandReplies,modifiers:this.props.modifiers})}}),l.Z.windowSize.isMobile)this.expandReplies=!1;else if(this.props.comment.isDeleted)this.expandReplies=!1;else if(null!=this.props.expandReplies)this.expandReplies=this.props.expandReplies;else{const e=this.replies;this.expandReplies=!this.isBlocked&&(null==e?void 0:e.length)>0&&this.props.depth<6}(0,n.rC)(this)}render(){return c.createElement("div",{className:(0,u.sb)("comment",this.props.modifiers,{top:0===this.props.depth})},this.props.comment.isDeleted||!this.isBlocked||this.forceShow?this.renderMain():this.renderBlocked())}getCommentUser(e){var t;return null!==(t=this.getUser(e.userId))&&void 0!==t?t:null==e.legacyName?o.z7:{username:e.legacyName}}getUser(e){return this.props.controller.getUser(e)}renderBlocked(){return c.createElement("div",{className:(0,u.sb)("comment__main","deleted")},c.createElement("span",{className:this.props.depth>0?"comment__avatar":void 0,style:{height:"auto"}}),c.createElement("div",{className:"comment__container"},c.createElement("div",{className:"comment__message"},c.createElement("p",{className:"osu-md osu-md--comment osu-md__paragraph"},(0,b.dW)("users.blocks.comment_text")," ",this.renderForceShowButton()))))}renderCommentableMeta(){if(!this.props.showCommentableMeta)return;const e=this.meta;return null!=e?c.createElement("div",{className:"comment__commentable-meta"},null!=this.props.comment.commentableType&&c.createElement("span",{className:"comment__commentable-meta-type"},c.createElement("span",{className:"comment__commentable-meta-icon fas fa-comment"})," ",(0,b.dW)(`comments.commentable_name.${this.props.comment.commentableType}`)),"url"in e?c.createElement("a",{className:"comment__link",href:e.url},e.title):c.createElement("span",null,e.title)):void 0}renderDelete(){if(!this.props.comment.isDeleted&&this.props.comment.canDelete)return c.createElement("div",{className:"comment__row-item"},c.createElement("button",{className:"comment__action",onClick:this.onDelete,type:"button"},(0,b.dW)("common.buttons.delete")))}renderDeletedBy(){var e;if(null!=this.props.comment.deletedAt&&this.props.comment.canModerate)return c.createElement("div",{className:"comment__row-item comment__row-item--info"},c.createElement(O.Z,{mappings:{timeago:c.createElement(P.Z,{dateTime:this.props.comment.deletedAt,relative:!0}),user:null==this.props.comment.deletedById?(0,b.dW)("comments.deleted_by_system"):c.createElement(k.Z,{user:null!==(e=this.getUser(this.props.comment.deletedById))&&void 0!==e?e:o.z7})},pattern:(0,b.dW)("comments.deleted_by")}))}renderEdit(){if(this.props.comment.canEdit)return c.createElement("div",{className:"comment__row-item"},c.createElement("button",{className:(0,u.sb)("comment__action",{active:this.editing}),onClick:this.onToggleEdit,type:"button"},(0,b.dW)("common.buttons.edit")))}renderEditedBy(){var e;if(null!=this.props.comment.editedAt&&!this.props.comment.isDeleted)return c.createElement("div",{className:"comment__row-item comment__row-item--info"},c.createElement(O.Z,{mappings:{timeago:c.createElement(P.Z,{dateTime:this.props.comment.editedAt,relative:!0}),user:c.createElement(k.Z,{user:null!==(e=this.getUser(this.props.comment.editedById))&&void 0!==e?e:o.z7})},pattern:(0,b.dW)("comments.edited")}))}renderFooter(){return c.createElement("div",{className:"comment__row comment__row--footer"},this.props.comment.canHaveVote&&c.createElement("div",{className:"comment__row-item visible-xs"},this.renderVoteButton(!0)),c.createElement("div",{className:"comment__row-item comment__row-item--info"},c.createElement(P.Z,{dateTime:this.props.comment.createdAt,relative:!0})),this.renderPermalink(),this.renderReplyButton(),this.renderEdit(),this.renderRestore(),this.renderDelete(),this.renderPin(),this.renderReport(),this.renderEditedBy(),this.renderDeletedBy(),this.renderForceShow(),this.renderRepliesText())}renderForceShow(){if(this.isBlocked&&!this.props.comment.isDeleted)return c.createElement("div",{className:"comment__row-item"},this.renderForceShowButton())}renderForceShowButton(){return c.createElement("button",{className:"comment__action",onClick:this.onToggleForceShow,type:"button"},this.forceShow?(0,b.dW)("users.blocks.hide_comment"):(0,b.dW)("users.blocks.show_comment"))}renderMain(){return c.createElement(c.Fragment,null,this.renderRepliesToggle(),this.renderCommentableMeta(),this.renderToolbar(),c.createElement("div",{className:(0,u.sb)("comment__main",{clip:this.clipped&&this.isLongContent,deleted:this.props.comment.isDeleted||this.isBlocked}),style:{"--clip-lines":7,"--line-height":null==this.lines?void 0:`${this.lines.lineHeight}px`}},this.props.comment.canHaveVote&&c.createElement("div",{className:"comment__float-container comment__float-container--left hidden-xs"},this.renderVoteButton(!1)),this.renderUserAvatar(),c.createElement("div",{className:"comment__container"},c.createElement("div",{className:"comment__row comment__row--header"},c.createElement(k.Z,{className:"comment__row-item",user:this.user}),this.renderOwnerBadge(),this.props.comment.pinned&&c.createElement("span",{className:"comment__row-item  comment__row-item--pinned"},c.createElement("span",{className:"fa fa-thumbtack"})," ",(0,b.dW)("comments.pinned")),this.renderParentLink(),this.props.comment.isDeleted&&c.createElement("span",{className:"comment__row-item comment__row-item--deleted"},(0,b.dW)("comments.deleted"))),this.editing?c.createElement("div",{className:"comment__editor"},c.createElement(v.Z,{close:this.onCloseEdit,controller:this.props.controller,id:this.props.comment.id,message:this.props.comment.message,modifiers:this.props.modifiers})):null!=this.props.comment.messageHtml&&c.createElement(c.Fragment,null,c.createElement("div",{className:"comment__message",dangerouslySetInnerHTML:{__html:this.props.comment.messageHtml}}),this.isLongContent&&this.renderToggleClipButton()),this.renderFooter(),this.renderReplyBox())),this.props.comment.repliesCount>0&&c.createElement("div",{className:(0,u.sb)("comment__replies",{hidden:!this.expandReplies,indented:this.props.depth<6})},this.replies.map(this.renderComment),c.createElement(y.Z,{comments:this.replies}),c.createElement(g.Z,{ref:this.showMoreRef,comments:this.replies,controller:this.props.controller,label:0===this.replies.length?(0,b.dW)("comments.load_replies"):void 0,modifiers:this.props.modifiers,parent:this.props.comment,total:this.props.comment.repliesCount})))}renderOwnerBadge(){const e=this.meta;if(null!=e&&"owner_id"in e&&null!=e.owner_id&&this.props.comment.userId===e.owner_id)return c.createElement("div",{className:"comment__row-item"},c.createElement("div",{className:"comment__owner-badge"},e.owner_title))}renderParentLink(){const e=this.parentComment;if(null==e)return;const t=this.getCommentUser(e),s=c.createElement(c.Fragment,null,c.createElement("span",{className:"fas fa-reply"}),` ${t.username}`);return c.createElement("span",{className:"comment__row-item comment__row-item--parent"},this.props.linkParent?c.createElement("a",{className:"comment__link",href:(0,r.B)("comments.show",{comment:e.id}),title:this.parentPreview},s):c.createElement("span",{title:this.parentPreview},s))}renderPermalink(){return c.createElement("div",{className:"comment__row-item"},c.createElement("span",{className:"comment__action comment__action--permalink"},c.createElement(f.Z,{label:(0,b.dW)("common.buttons.permalink"),value:(0,r.B)("comments.show",{comment:this.props.comment.id}),valueAsUrl:!0})))}renderPin(){if(this.props.comment.canPin)return c.createElement("div",{className:"comment__row-item"},c.createElement("button",{className:"comment__action",onClick:this.onTogglePinned,type:"button"},(0,b.dW)("common.buttons."+(this.props.comment.pinned?"unpin":"pin"))))}renderRepliesText(){if(0===this.props.comment.repliesCount)return;let e,t;return this.expandReplies||0!==this.replies.length?(t=this.onToggleReplies,e=(0,b.jn)("comments.replies_count",this.props.comment.repliesCount)):(t=this.onLoadReplies,e=(0,b.dW)("comments.load_replies")),c.createElement("div",{className:"comment__row-item comment__row-item--replies"},c.createElement(_.Z,{callback:t,direction:this.expandReplies?"up":"down",hasMore:!0,label:e,modifiers:"comment-replies"}))}renderRepliesToggle(){if(!(this.props.depth>0||0===this.replies.length))return c.createElement("div",{className:"comment__float-container comment__float-container--right"},c.createElement("button",{className:"comment__top-show-replies",onClick:this.onToggleReplies,type:"button"},c.createElement("span",{className:"fas "+(this.expandReplies?"fa-angle-up":"fa-angle-down")})))}renderReplyBox(){if(this.showNewReply)return c.createElement("div",{className:"comment__reply-box"},c.createElement(v.Z,{close:this.onCloseReplyBox,commentableMeta:this.meta,controller:this.props.controller,modifiers:this.props.modifiers,onPosted:this.onReplyPosted,parent:this.props.comment}))}renderReplyButton(){if(!this.props.comment.isDeleted)return c.createElement("div",{className:"comment__row-item"},c.createElement("button",{className:(0,u.sb)("comment__action",{active:this.showNewReply}),onClick:this.onToggleNewReply,type:"button"},(0,b.dW)("common.buttons.reply")))}renderReport(){if(this.props.comment.canReport)return c.createElement("div",{className:"comment__row-item"},c.createElement(w.c,{className:"comment__action",reportableId:this.props.comment.id.toString(),reportableType:"comment",user:this.user}))}renderRestore(){if(this.props.comment.isDeleted&&this.props.comment.canRestore)return c.createElement("div",{className:"comment__row-item"},c.createElement("button",{className:"comment__action",onClick:this.onRestore,type:"button"},(0,b.dW)("common.buttons.restore")))}renderToggleClipButton(){return c.createElement("button",{className:"comment__toggle-clip",onClick:this.onToggleClip,type:"button"},(0,b.dW)("common.buttons."+(this.clipped?"read_more":"show_less")))}renderToolbar(){if(this.props.showToolbar)return c.createElement("div",{className:"comment__toolbar"},c.createElement("div",{className:"sort"},c.createElement("div",{className:"sort__items"},c.createElement("button",{className:"sort__item sort__item--button",onClick:this.onShowDeletedToggleClick,type:"button"},c.createElement("span",{className:"sort__item-icon"},c.createElement("span",{className:l.Z.userPreferences.get("comments_show_deleted")?"fas fa-check-square":"far fa-square"})),(0,b.dW)("common.buttons.show_deleted")))))}renderUserAvatar(){const e=this.user;return"id"in e?c.createElement("a",{className:"comment__avatar js-usercard","data-user-id":e.id,href:(0,r.B)("users.show",{user:e.id})},c.createElement(j.Z,{modifiers:"full-circle",user:e})):c.createElement("span",{className:"comment__avatar"},c.createElement(j.Z,{modifiers:"full-circle",user:Object.assign({avatar_url:void 0},e)}))}renderVoteButton(e){const t=this.hasVoted,s=(0,u.sb)("comment-vote",this.props.modifiers,{disabled:!this.props.comment.canVote,inline:e,on:t,posting:this.postingVote}),r=e||t?null:c.createElement("div",{className:"comment-vote__hover"},"+1");return c.createElement("button",{className:s,disabled:this.postingVote||!this.props.comment.canVote,onClick:this.onToggleVote,type:"button"},c.createElement("span",{className:"comment-vote__text"},"+",(0,h.Eu)(this.props.comment.votesCount)),this.postingVote&&c.createElement("span",{className:"comment-vote__spinner"},c.createElement(E.$,null)),r)}};Object.defineProperty(S,"defaultProps",{enumerable:!0,configurable:!0,writable:!0,value:{linkParent:!1,showCommentableMeta:!1,showToolbar:!1}}),N([n.LO],S.prototype,"clipped",void 0),N([n.LO],S.prototype,"editing",void 0),N([n.LO],S.prototype,"expandReplies",void 0),N([n.LO],S.prototype,"forceShow",void 0),N([n.LO],S.prototype,"showNewReply",void 0),N([n.Fl],S.prototype,"isBlocked",null),N([n.Fl],S.prototype,"lines",null),N([n.Fl],S.prototype,"meta",null),N([n.Fl],S.prototype,"parentComment",null),N([n.Fl],S.prototype,"parentPreview",null),N([n.Fl],S.prototype,"user",null),N([n.aD],S.prototype,"onCloseEdit",void 0),N([n.aD],S.prototype,"onCloseReplyBox",void 0),N([n.aD],S.prototype,"onReplyPosted",void 0),N([n.aD],S.prototype,"onToggleClip",void 0),N([n.aD],S.prototype,"onToggleEdit",void 0),N([n.aD],S.prototype,"onToggleForceShow",void 0),N([n.aD],S.prototype,"onToggleNewReply",void 0),N([n.aD],S.prototype,"onToggleReplies",void 0),S=m=N([a.Pi],S);const C=S},3619:(e,t,s)=>{s.d(t,{Z:()=>g});var r=s(3664),i=s(6486),n=s(8949),a=s(7181),o=function(e,t,s,r){var i,n=arguments.length,a=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(n<3?i(a):n>3?i(t,s,a):i(t,s))||a);return n>3&&a&&Object.defineProperty(t,s,a),a};class l{constructor(e,t){Object.defineProperty(this,"controller",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"commentableId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"commentableType",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"createdAt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"deletedAt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"deletedById",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"editedAt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"editedById",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"legacyName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"message",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"messageHtml",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parentId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"pinned",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"repliesCount",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"updatedAt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"userId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"votesCount",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.commentableId=e.commentable_id,this.commentableType=e.commentable_type,this.createdAt=e.created_at,this.deletedAt=e.deleted_at,this.deletedById=e.deleted_by_id,this.editedAt=e.edited_at,this.editedById=e.edited_by_id,this.id=e.id,this.legacyName=e.legacy_name,this.message=e.message,this.messageHtml=e.message_html,this.parentId=e.parent_id,this.pinned=e.pinned,this.repliesCount=e.replies_count,this.updatedAt=e.updated_at,this.userId=e.user_id,this.votesCount=e.votes_count,(0,n.rC)(this)}get canDelete(){return this.canModerate||this.isOwner}get canEdit(){return this.canModerate||this.isOwner&&!this.isDeleted}get canHaveVote(){return!this.isDeleted}get canModerate(){return null!=a.Z.currentUser&&(a.Z.currentUser.is_admin||a.Z.currentUser.is_moderator)}get canPin(){if(null==a.Z.currentUser||null!=this.parentId&&!this.pinned)return!1;if(a.Z.currentUser.is_admin)return!0;if("beatmapset"!==this.commentableType||!this.pinned&&this.controller.state.pinnedCommentIds.length>0)return!1;if(this.canModerate)return!0;if(!this.isOwner)return!1;const e=this.controller.getCommentableMeta(this);return null!=e&&"owner_id"in e&&e.owner_id===a.Z.currentUser.id}get canReport(){return null!=a.Z.currentUser&&this.userId!==a.Z.currentUser.id}get canRestore(){return this.canModerate}get canVote(){return!this.isOwner}get isDeleted(){return null!=this.deletedAt}get isEdited(){return null!=this.editedAt}get isOwner(){return null!=a.Z.currentUser&&this.userId===a.Z.currentUser.id}toJson(){return{commentable_id:this.commentableId,commentable_type:this.commentableType,created_at:this.createdAt,deleted_at:this.deletedAt,deleted_by_id:this.deletedById,edited_at:this.editedAt,edited_by_id:this.editedById,id:this.id,legacy_name:this.legacyName,message:this.message,message_html:this.messageHtml,parent_id:this.parentId,pinned:this.pinned,replies_count:this.repliesCount,updated_at:this.updatedAt,user_id:this.userId,votes_count:this.votesCount}}}o([n.Fl],l.prototype,"canDelete",null),o([n.Fl],l.prototype,"canEdit",null),o([n.Fl],l.prototype,"canHaveVote",null),o([n.Fl],l.prototype,"canModerate",null),o([n.Fl],l.prototype,"canPin",null),o([n.Fl],l.prototype,"canReport",null),o([n.Fl],l.prototype,"canRestore",null),o([n.Fl],l.prototype,"canVote",null),o([n.Fl],l.prototype,"isDeleted",null),o([n.Fl],l.prototype,"isEdited",null),o([n.Fl],l.prototype,"isOwner",null);var c=s(9703),u=s(1270),d=s(9696),p=s(9755),m=function(e,t,s,r){var i,n=arguments.length,a=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(n<3?i(a):n>3?i(t,s,a):i(t,s))||a);return n>3&&a&&Object.defineProperty(t,s,a),a};function h(e){Object.values(e).forEach((e=>null==e?void 0:e.abort()))}function b(){return{commentableMetaItems:{},commentIdsByParentId:{},comments:{},hasMore:{},isFollowing:!1,pinnedCommentIds:[],sort:"new",topLevelCount:0,total:0,users:{},votedCommentIds:new Set}}function f(e){return null!=e&&"id"in e?`${e.type}-${e.id}`:"null"}function v(e){var t,s;switch(e.mode){case"edit":return null!==(t=e.id)&&void 0!==t?t:0;case"new":return f(e.commentableMeta);case"reply":return null!==(s=e.parentId)&&void 0!==s?s:0;default:throw(0,d.Q)(e.mode),new Error("unsupported mode")}}class g{get commentableMeta(){return this.state.commentableMetaItems[f(this.baseCommentableMeta)]}get pinnedComments(){return this.getComments(this.state.pinnedCommentIds)}get stateEl(){var e;const t=(null!==(e=window.newBody)&&void 0!==e?e:document.body).querySelector(this.stateSelector);if(t instanceof HTMLScriptElement)return t;throw new Error("missing state element")}get topLevelComments(){var e;return this.getComments(null!==(e=this.state.commentIdsByParentId[0])&&void 0!==e?e:[])}constructor(e,t){Object.defineProperty(this,"stateSelector",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"baseCommentableMeta",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"nextState",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"destroyed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"xhr",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"destroy",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.destroyed||(document.removeEventListener("turbolinks:before-cache",this.destroy),h(this.xhr),this.stateStore(),this.destroyed=!0)}});const s=this.stateEl,r=s.dataset.savedState;if(null!=r)this.state=this.stateFromJson(JSON.parse(r));else{this.state=b();const e=JSON.parse(s.text);this.loadBundle(e,!1,!0)}(0,n.rC)(this),document.addEventListener("turbolinks:before-cache",this.destroy)}apiDelete(e){var t;if(this.isDeleting(e)||!confirm((0,u.dW)("common.confirmation")))return;const s=`delete-${e.id}`;this.xhr[s]=p.ajax((0,r.B)("comments.destroy",{comment:e.id}),{method:"DELETE"}),null===(t=this.xhr[s])||void 0===t||t.done((e=>this.loadBundle(e))).fail(c.qQ).always((0,n.aD)((()=>{delete this.xhr[s]})))}apiLoadMore(e){var t,s,a;if(this.isLoading(e))return;const o=null!==(t=null==e?void 0:e.id)&&void 0!==t?t:0,l={parent_id:o,sort:this.state.sort};null==e?null!=this.baseCommentableMeta&&(l.commentable_id=this.baseCommentableMeta.id,l.commentable_type=this.baseCommentableMeta.type):(l.commentable_id=e.commentableId,l.commentable_type=e.commentableType);const c=(0,i.last)(null!==(s=this.state.commentIdsByParentId[o])&&void 0!==s?s:[]);null!=c&&(l.after=c);const u=`load-${o}`;this.xhr[u]=p.ajax((0,r.B)("comments.index"),{data:l,dataType:"json"}),null===(a=this.xhr[u])||void 0===a||a.done((e=>this.loadBundle(e))).always((0,n.aD)((()=>{delete this.xhr[u]})))}apiPost(e,t){var s;if(this.isPosting(e))return;if(a.Z.userLogin.showIfGuest((()=>this.apiPost(e,t))))return;const i={comment:{message:e.message}};let o=(0,r.B)("comments.store"),l="POST";switch(e.mode){case"edit":if(null==e.id)throw new Error("missing post id in edit mode");o=(0,r.B)("comments.update",{comment:e.id}),l="PUT";break;case"new":if(null==e.commentableMeta||!("id"in e.commentableMeta))throw new Error("missing commentable meta in new mode");i.comment.commentable_type=e.commentableMeta.type,i.comment.commentable_id=e.commentableMeta.id;break;case"reply":if(null==e.parentId)throw new Error("missing parent in reply mode");i.comment.parent_id=e.parentId;break;default:throw(0,d.Q)(e.mode),new Error("unsupported mode")}const u=`${e.mode}-${v(e)}`;this.xhr[u]=p.ajax(o,{data:i,method:l}),null===(s=this.xhr[u])||void 0===s||s.always((0,n.aD)((()=>{delete this.xhr[u]}))).done((e=>(0,n.z)((()=>{t(),this.loadBundle(e,!1)})))).fail(c.qQ)}apiRestore(e){var t;if(this.isDeleting(e)||!confirm((0,u.dW)("common.confirmation")))return;const s=`delete-${e.id}`;this.xhr[s]=p.ajax((0,r.B)("comments.restore",{comment:e.id}),{method:"POST"}),null===(t=this.xhr[s])||void 0===t||t.done((e=>this.loadBundle(e))).fail(c.qQ).always((0,n.aD)((()=>{delete this.xhr[s]})))}apiSetSort(e){if(null!=this.xhr.sort)return;this.nextState.sort=e;const t={parent_id:0,sort:e};null!=this.commentableMeta&&"id"in this.commentableMeta&&(t.commentable_id=this.commentableMeta.id,t.commentable_type=this.commentableMeta.type),this.xhr.sort=p.ajax((0,r.B)("comments.index"),{data:t,dataType:"json"}),this.xhr.sort.done((e=>(0,n.z)((()=>{h(this.xhr),this.state=b(),this.nextState={},this.xhr={},this.loadBundle(e,!1,!0),a.Z.userPreferences.set("comments_sort",this.state.sort)}))))}apiToggleFollow(){if(null!=this.nextState.isFollowing)return;const e=this.commentableMeta;if(null==e||!("id"in e))return;const t=this.nextState.isFollowing=!this.state.isFollowing;this.xhr.follow=p.ajax((0,r.B)("follows.store"),{data:{follow:{notifiable_id:e.id,notifiable_type:e.type,subtype:"comment"}},dataType:"json",method:this.nextState.isFollowing?"POST":"DELETE"}),this.xhr.follow.always((0,n.aD)((()=>{delete this.xhr.follow,this.nextState.isFollowing=void 0}))).done((0,n.aD)((()=>{this.state.isFollowing=t}))).fail(c.qQ)}apiTogglePin(e){var t;const s=`pin-${e.id}`;null==this.xhr[s]&&e.canPin&&(this.xhr[s]=p.ajax((0,r.B)("comments.pin",{comment:e.id}),{method:e.pinned?"DELETE":"POST"}),null===(t=this.xhr[s])||void 0===t||t.done((e=>this.loadBundle(e))).fail(c.qQ).always((0,n.aD)((()=>{delete this.xhr[s]}))))}apiToggleVote(e){var t;if(this.isVoting(e))return;if(a.Z.userLogin.showIfGuest((()=>this.apiToggleVote(e))))return;let s,i;this.state.votedCommentIds.has(e.id)?(s="DELETE",i="delete"):(s="POST",i="add");const o=`vote-${e.id}`;this.xhr[o]=p.ajax((0,r.B)("comments.vote",{comment:e.id}),{method:s}),null===(t=this.xhr[o])||void 0===t||t.done((t=>(0,n.z)((()=>{this.loadBundle(t),this.state.votedCommentIds[i](e.id)})))).fail(c.qQ).always((0,n.aD)((()=>{delete this.xhr[o]})))}getCommentableMeta(e){var t;return null!==(t=this.state.commentableMetaItems[`${e.commentableType}-${e.commentableId}`])&&void 0!==t?t:{title:""}}getComments(e){const t=[];for(const s of null!=e?e:[]){const e=this.state.comments[s];null!=e&&t.push(e)}return t}getUser(e){return null==e?void 0:this.state.users[e]}isLoading(e){var t;return null!=this.xhr[`load-${null!==(t=null==e?void 0:e.id)&&void 0!==t?t:0}`]}isPosting(e){return null!=this.xhr[`${e.mode}-${v(e)}`]}isVoting(e){return null!=this.xhr[`vote-${e.id}`]}addComment(e){var t;const s=e.id;(null===(t=this.state.comments[s])||void 0===t?void 0:t.updatedAt)!==e.updated_at&&(this.state.comments[s]=new l(e,this))}addCommentId(e,t){var s,r,i,n;const a=null!==(s=e.parent_id)&&void 0!==s?s:0;null!==(r=(n=this.state.commentIdsByParentId)[a])&&void 0!==r||(n[a]=[]);const o=null!==(i=this.state.commentIdsByParentId[a])&&void 0!==i?i:[],l=e.id;o.includes(l)||(t?o.push(l):o.unshift(l))}isDeleting(e){return null!=this.xhr[`delete-${e.id}`]}loadBundle(e,t=!0,s=!1){var r;if(s){this.state.commentIdsByParentId[0]=[];const t=this.state.commentIdsByParentId[0];e.comments.forEach((e=>{t.push(e.id),this.addComment(e)})),this.state.sort=e.sort}else e.comments.forEach((e=>{this.addCommentId(e,t),this.addComment(e)}));e.included_comments.forEach((e=>{this.addCommentId(e,!0),this.addComment(e)})),this.state.pinnedCommentIds=[],(null!==(r=e.pinned_comments)&&void 0!==r?r:[]).forEach((e=>{this.state.pinnedCommentIds.push(e.id),this.addComment(e)})),e.user_votes.forEach((e=>this.state.votedCommentIds.add(e))),this.state.isFollowing=e.user_follow,this.state.hasMore[e.has_more_id]=e.has_more,null!=e.top_level_count&&null!=e.total&&(this.state.topLevelCount=e.top_level_count,this.state.total=e.total);for(const n of e.users){const e=n.id;(0,i.isEqual)(this.state.users[e],n)||(this.state.users[e]=n)}for(const n of e.commentable_meta){const e=f(n);(0,i.isEqual)(this.state.commentableMetaItems[e],n)||(this.state.commentableMetaItems[e]=n)}}stateFromJson(e){const t={};for(const s of e.comments)t[s.id]=new l(s,this);return{commentableMetaItems:e.commentableMetaItems,commentIdsByParentId:e.commentIdsByParentId,comments:t,hasMore:e.hasMore,isFollowing:e.isFollowing,pinnedCommentIds:e.pinnedCommentIds,sort:e.sort,topLevelCount:e.topLevelCount,total:e.total,users:e.users,votedCommentIds:new Set(e.votedCommentIds)}}stateStore(){const e=[];for(const s of Object.values(this.state.comments))null!=s&&e.push(s.toJson());const t={commentableMetaItems:this.state.commentableMetaItems,commentIdsByParentId:this.state.commentIdsByParentId,comments:e,hasMore:this.state.hasMore,isFollowing:this.state.isFollowing,pinnedCommentIds:this.state.pinnedCommentIds,sort:this.state.sort,topLevelCount:this.state.topLevelCount,total:this.state.total,users:this.state.users,votedCommentIds:[...this.state.votedCommentIds]};this.stateEl.dataset.savedState=JSON.stringify(t)}}m([n.LO],g.prototype,"nextState",void 0),m([n.LO],g.prototype,"state",void 0),m([n.LO],g.prototype,"xhr",void 0),m([n.aD],g.prototype,"apiDelete",null),m([n.aD],g.prototype,"apiLoadMore",null),m([n.aD],g.prototype,"apiPost",null),m([n.aD],g.prototype,"apiRestore",null),m([n.aD],g.prototype,"apiSetSort",null),m([n.aD],g.prototype,"apiToggleFollow",null),m([n.aD],g.prototype,"apiTogglePin",null),m([n.aD],g.prototype,"apiToggleVote",null),m([n.aD],g.prototype,"loadBundle",null),m([n.aD],g.prototype,"stateFromJson",null),m([n.aD],g.prototype,"stateStore",null)},8134:(e,t,s)=>{s.d(t,{Z:()=>_});var r=s(9323),i=s(7181),n=s(7294),a=s(3336),o=s(3775),l=s(1270),c=s(8462),u=s(1581),d=s(8573),p=s(3619),m=s(2873),h=function(e,t,s,r){var i,n=arguments.length,a=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(n<3?i(a):n>3?i(t,s,a):i(t,s))||a);return n>3&&a&&Object.defineProperty(t,s,a),a};let b=class extends n.Component{constructor(){super(...arguments),Object.defineProperty(this,"handleChange",{enumerable:!0,configurable:!0,writable:!0,value:e=>{var t;this.props.controller.apiSetSort(null!==(t=e.currentTarget.dataset.value)&&void 0!==t?t:"")}})}render(){var e;return n.createElement(m.P,{currentValue:null!==(e=this.props.controller.nextState.sort)&&void 0!==e?e:this.props.controller.state.sort,modifiers:this.props.modifiers,onChange:this.handleChange,values:["new","old","top"]})}};b=h([r.Pi],b);const f=b;var v=s(3635),g=s(6741),y=function(e,t,s,r){var i,n=arguments.length,a=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(n<3?i(a):n>3?i(t,s,a):i(t,s))||a);return n>3&&a&&Object.defineProperty(t,s,a),a};let w=class extends n.Component{constructor(e){super(e),Object.defineProperty(this,"controller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onToggleFollow",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.controller.apiToggleFollow()}}),this.controller=new p.Z(this.props.controllerStateSelector,this.props.baseCommentableMeta)}componentWillUnmount(){this.controller.destroy()}render(){const e=this.controller.topLevelComments,t=e.filter((e=>!e.pinned)),s=this.controller.pinnedComments;return n.createElement("div",{className:(0,a.sb)("comments",this.props.modifiers),id:"comments"},n.createElement("h2",{className:"comments__title"},(0,l.dW)("comments.title"),n.createElement("span",{className:"comments__count"},(0,o.uf)(this.controller.state.total))),s.length>0&&n.createElement("div",{className:"comments__items comments__items--pinned"},this.renderComments(s,!0)),n.createElement("div",{className:"comments__new"},n.createElement(u.Z,{commentableMeta:this.controller.commentableMeta,controller:this.controller,focus:!1,modifiers:this.props.modifiers})),n.createElement("div",{className:"comments__items comments__items--toolbar"},n.createElement(f,{controller:this.controller,modifiers:this.props.modifiers}),n.createElement("div",{className:(0,a.sb)("sort",this.props.modifiers)},n.createElement("div",{className:"sort__items"},this.renderFollowToggle(),this.renderShowDeletedToggle()))),0===t.length?n.createElement("div",{className:"comments__items comments__items--empty"},0===s.length?(0,l.dW)("comments.empty"):(0,l.dW)("comments.empty_other")):n.createElement("div",{className:(0,a.sb)("comments__items",{loading:null!=this.controller.nextState.sort})},this.renderComments(t,!1),n.createElement(v.Z,{comments:e,modifiers:"top"}),n.createElement(d.Z,{comments:e,controller:this.controller,modifiers:(0,a.sw)("top",this.props.modifiers),top:!0,total:this.controller.state.topLevelCount})))}onToggleShowDeleted(){i.Z.userPreferences.set("comments_show_deleted",!i.Z.userPreferences.get("comments_show_deleted"))}renderComment(e,t){if(!e.isDeleted||i.Z.userPreferences.get("comments_show_deleted"))return n.createElement(c.Z,{key:e.id,comment:e,controller:this.controller,depth:0,expandReplies:t,modifiers:this.props.modifiers})}renderComments(e,t){const s=!t&&void 0;return e.map((e=>this.renderComment(e,s)))}renderFollowToggle(){let e,t;return null!=this.controller.nextState.isFollowing&&(e=n.createElement(g.$,{modifiers:"center-inline"})),this.controller.state.isFollowing?(null!=e||(e=n.createElement("span",{className:"fas fa-eye-slash"})),t=(0,l.dW)("common.buttons.watch.to_0")):(null!=e||(e=n.createElement("span",{className:"fas fa-eye"})),t=(0,l.dW)("common.buttons.watch.to_1")),n.createElement("button",{className:"sort__item sort__item--button",disabled:null!=this.controller.nextState.isFollowing,onClick:this.onToggleFollow,type:"button"},n.createElement("span",{className:"sort__item-icon"},e),t)}renderShowDeletedToggle(){const e=i.Z.userPreferences.get("comments_show_deleted")?"fas fa-check-square":"far fa-square";return n.createElement("button",{className:"sort__item sort__item--button",onClick:this.onToggleShowDeleted,type:"button"},n.createElement("span",{className:"sort__item-icon"},n.createElement("span",{className:e})),(0,l.dW)("common.buttons.show_deleted"))}};w=y([r.Pi],w);const _=w},3635:(e,t,s)=>{s.d(t,{Z:()=>a});var r=s(7294),i=s(3336),n=s(1270);class a extends r.Component{render(){const e=this.props.comments.filter((e=>null!=e.deletedAt)).length;return 0===e?null:r.createElement("div",{className:(0,i.sb)("deleted-comments-count",this.props.modifiers)},r.createElement("span",{className:"deleted-comments-count__icon"},r.createElement("span",{className:"far fa-trash-alt"})),(0,n.jn)("comments.deleted_count",e))}}},6793:(e,t,s)=>{s.d(t,{Z:()=>o});var r=s(7294),i=s(7629),n=s(3336),a=s(3775);function o(e){return r.createElement("div",{className:(0,n.sb)("difficulty-badge",{"expert-plus":e.rating>=6.5}),style:{"--bg":(0,i.yh)(e.rating)}},r.createElement("span",{className:"difficulty-badge__icon"},r.createElement("span",{className:"fas fa-star"})),r.createElement("span",{className:"difficulty-badge__rating"},(0,a.uf)(e.rating,2)))}},1185:(e,t,s)=>{s.d(t,{Z:()=>a});var r=s(6486),i=s(7294),n=s(3336);function a(e){const t=Math.max(0,e.current),s=Math.max(1,e.total);return i.createElement("div",{className:(0,n.sb)("discrete-bar",e.modifiers)},(0,r.times)(s,(s=>i.createElement("div",{key:s,className:(0,n.sb)("discrete-bar__item",{on:s<t})},e.label))))}},5523:(e,t,s)=>{s.d(t,{Z:()=>a});var r=s(7294),i=s(3336);const n=e=>`/assets/images/flags/${e.split("").map((e=>(e.charCodeAt(0)+127397).toString(16))).join("-")}.svg`;function a({country:e,modifiers:t}){return null==e||null==e.code?null:r.createElement("span",{className:(0,i.sb)("flag-country",t),style:{backgroundImage:`url('${n(e.code)}')`},title:e.name})}},542:(e,t,s)=>{s.d(t,{Z:()=>d});var r=s(3664),i=s(7181),n=s(7294),a=s(3336),o=s(9139),l=s(6741),c=s(9755);class u extends n.PureComponent{constructor(e){super(e),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"eventId",{enumerable:!0,configurable:!0,writable:!0,value:`follow-toggle-${(0,o.d)()}`}),Object.defineProperty(this,"toggleXhr",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"onClick",{enumerable:!0,configurable:!0,writable:!0,value:()=>{var e;const t={follow:{notifiable_id:this.props.follow.notifiable_id,notifiable_type:this.props.follow.notifiable_type,subtype:this.props.follow.subtype}},s=this.state.following?"DELETE":"POST";null===(e=this.toggleXhr)||void 0===e||e.abort(),this.setState({toggling:!0},(()=>{this.toggleXhr=c.ajax((0,r.B)("follows.store"),{data:t,method:s}).done((()=>{"mapping"===this.props.follow.subtype?c.publish("user:followUserMapping:update",{following:!this.state.following,userId:this.props.follow.notifiable_id}):this.setState({following:!this.state.following})})).always((()=>{this.setState({toggling:!1})}))}))}}),Object.defineProperty(this,"refresh",{enumerable:!0,configurable:!0,writable:!0,value:()=>{"mapping"===this.props.follow.subtype&&this.setState({following:null!=i.Z.currentUser&&i.Z.currentUser.follow_user_mapping.includes(this.props.follow.notifiable_id)})}}),this.state={following:this.props.following,toggling:!1}}componentDidMount(){"mapping"===this.props.follow.subtype&&c.subscribe(`user:followUserMapping:refresh.${this.eventId}`,this.refresh)}componentWillUnmount(){c.unsubscribe(`.${this.eventId}`)}render(){return n.createElement("button",{className:(0,a.sb)("btn-circle",this.props.modifiers),disabled:this.state.toggling,onClick:this.onClick,type:"button"},n.createElement("span",{className:"btn-circle__content"},this.renderToggleIcon()))}renderToggleIcon(){if(this.state.toggling)return n.createElement("span",{className:"btn-circle__icon"},n.createElement(l.$,null));let e,t;return this.state.following?(t="fas fa-bell",e="fas fa-bell-slash"):(t="far fa-bell",e="fas fa-bell"),n.createElement(n.Fragment,null,n.createElement("span",{className:"btn-circle__icon btn-circle__icon--hover-show"},n.createElement("span",{className:e})),n.createElement("span",{className:"btn-circle__icon btn-circle__icon--hover-hide"},n.createElement("span",{className:t})))}}Object.defineProperty(u,"defaultProps",{enumerable:!0,configurable:!0,writable:!0,value:{following:!0}});const d=u},7454:(e,t,s)=>{s.d(t,{Z:()=>h});var r=s(3664),i=s(7181),n=s(7294),a=s(9703),o=s(3336),l=s(3775),c=s(1270),u=s(9139),d=s(6741),p=s(9755);const m="user-action-button";class h extends n.Component{constructor(e){var t,s,o;super(e),Object.defineProperty(this,"buttonRef",{enumerable:!0,configurable:!0,writable:!0,value:n.createRef()}),Object.defineProperty(this,"eventId",{enumerable:!0,configurable:!0,writable:!0,value:`follow-user-mapping-button-${(0,u.d)()}`}),Object.defineProperty(this,"xhr",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onClick",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.setState({loading:!0},(()=>{const e={data:{follow:{notifiable_id:this.props.userId,notifiable_type:"user",subtype:"mapping"}}};this.state.following?(e.type="DELETE",e.url=(0,r.B)("follows.destroy")):(e.type="POST",e.url=(0,r.B)("follows.store")),this.xhr=p.ajax(e).done(this.updateData).fail((0,a.f$)(this.buttonRef.current)).always((()=>this.setState({loading:!1})))}))}}),Object.defineProperty(this,"refresh",{enumerable:!0,configurable:!0,writable:!0,value:()=>{var e,t;this.setState({following:null!==(t=null===(e=i.Z.currentUser)||void 0===e?void 0:e.follow_user_mapping.includes(this.props.userId))&&void 0!==t&&t})}}),Object.defineProperty(this,"updateData",{enumerable:!0,configurable:!0,writable:!0,value:()=>{p.publish("user:followUserMapping:update",{following:!this.state.following,userId:this.props.userId})}});const l=null!==(s=null===(t=i.Z.currentUser)||void 0===t?void 0:t.follow_user_mapping.includes(this.props.userId))&&void 0!==s&&s;let c=null!==(o=this.props.followers)&&void 0!==o?o:0;!1!==l&&(c-=1),this.state={followersWithoutSelf:c,following:l,loading:!1}}componentDidMount(){p.subscribe(`user:followUserMapping:refresh.${this.eventId}`,this.refresh)}componentWillUnmount(){var e;p.unsubscribe(`.${this.eventId}`),null===(e=this.xhr)||void 0===e||e.abort()}render(){const e=!(null==i.Z.currentUser||i.Z.currentUser.id===this.props.userId);if(!e&&!this.props.alwaysVisible)return null;const t=e?(0,c.dW)("follows.mapping."+(this.state.following?"to_0":"to_1")):(0,c.dW)("follows.mapping.followers"),s=(0,o.sb)(m,this.props.modifiers,{friend:this.state.following}),r=this.state.loading||!e;return n.createElement("div",{title:t},n.createElement("button",{ref:this.buttonRef,className:s,disabled:r,onClick:this.onClick},this.renderIcon(),this.renderCounter()))}followers(){return this.state.followersWithoutSelf+(this.state.following?1:0)}renderCounter(){if(null!=this.props.showFollowerCounter&&null!=this.props.followers)return n.createElement("span",{className:`${m}__counter`},(0,l.uf)(this.followers()))}renderIcon(){const e=this.state.loading?n.createElement(d.$,null):n.createElement("i",{className:"fas fa-bell"});return n.createElement("span",{className:`${m}__icon-container`},e)}}},7863:(e,t,s)=>{s.d(t,{Z:()=>o});var r=s(3664),i=s(7294),n=s(3336),a=s(1270);function o(e){return i.createElement("div",{className:"page-tabs page-tabs--follows"},["comment","forum_topic","mapping","modding"].map((t=>i.createElement("a",{key:t,className:(0,n.sb)("page-tabs__tab",{active:t===e.currentSubtype}),href:(0,r.B)("follows.index",{subtype:t})},(0,a.dW)(`follows.${t}.title`)))))}},1759:(e,t,s)=>{s.d(t,{Z:()=>y});var r=s(789),i=s(1723),n=s(3664),a=s(8949),o=s(9323),l=s(7181),c=s(7294),u=s(9703),d=s(3336),p=s(3775),m=s(1270),h=s(6741),b=s(9755),f=function(e,t,s,r){var i,n=arguments.length,a=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(n<3?i(a):n>3?i(t,s,a):i(t,s))||a);return n>3&&a&&Object.defineProperty(t,s,a),a};const v="user-action-button";let g=class extends c.Component{get followers(){return this.followersWithoutSelf+(null==this.friend?0:1)}get friend(){return l.Z.currentUserModel.friends.get(this.props.userId)}get isFriendLimit(){return null==l.Z.currentUser||l.Z.currentUser.friends.length>=l.Z.currentUser.max_friends}get isVisible(){return null!=l.Z.currentUser&&Number.isFinite(this.props.userId)&&this.props.userId!==l.Z.currentUser.id&&!l.Z.currentUser.blocks.some((e=>e.target_id===this.props.userId))}get loading(){return null!=this.xhr}get showFollowerCounter(){return null!=this.props.followers}get title(){return this.isVisible?null!=this.friend?(0,m.dW)("friends.buttons.remove"):this.isFriendLimit?(0,m.dW)("friends.too_many"):(0,m.dW)("friends.buttons.add"):(0,m.dW)("friends.buttons.disabled")}constructor(e){var t;super(e),Object.defineProperty(this,"followersWithoutSelf",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"xhr",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clicked",{enumerable:!0,configurable:!0,writable:!0,value:()=>{null==this.xhr&&(this.xhr=null==this.friend?b.ajax((0,n.B)("friends.store",{target:this.props.userId}),{type:"POST"}):b.ajax((0,n.B)("friends.destroy",{friend:this.props.userId}),{type:"DELETE"}),this.xhr.done(this.updateFriends).fail((0,u.Gi)(this.clicked)).always((0,a.aD)((()=>this.xhr=void 0))))}}),Object.defineProperty(this,"updateFriends",{enumerable:!0,configurable:!0,writable:!0,value:e=>{null!=l.Z.currentUser&&(l.Z.currentUser.friends=e,b.publish("user:update",l.Z.currentUser),(0,i.WI)(new r.Z(this.props.userId)))}}),this.followersWithoutSelf=null!==(t=this.props.followers)&&void 0!==t?t:0,(0,a.rC)(this),(0,a.z)((()=>{null!=this.friend&&(this.followersWithoutSelf-=1)}))}componentWillUnmount(){var e;null===(e=this.xhr)||void 0===e||e.abort()}render(){if(!this.props.alwaysVisible&&!this.isVisible)return null;const e=null==this.friend||this.loading?null:this.friend.mutual?"mutual":"friend",t=(0,d.sb)(v,this.props.modifiers,e),s=!this.isVisible||this.loading||this.isFriendLimit&&null==this.friend;return c.createElement("div",{title:this.title},c.createElement("button",{className:t,disabled:s,onClick:this.clicked,type:"button"},c.createElement("span",{className:`${v}__icon-container`},this.renderIcon()),this.renderCounter()))}renderCounter(){if(this.showFollowerCounter)return c.createElement("span",{className:`${v}__counter`},(0,p.uf)(this.followers))}renderIcon(){return this.loading?c.createElement(h.$,null):this.isVisible?null!=this.friend?c.createElement(c.Fragment,null,c.createElement("span",{className:`${v}__icon ${v}__icon--hover-visible`},c.createElement("span",{className:"fas fa-user-times"})),this.friend.mutual?c.createElement("span",{className:`${v}__icon ${v}__icon--hover-hidden`},c.createElement("span",{className:"fas fa-user-friends"})):c.createElement("span",{className:`${v}__icon ${v}__icon--hover-hidden`},c.createElement("span",{className:"fas fa-user"}))):c.createElement("span",{className:this.isFriendLimit?"fas fa-user":"fas fa-user-plus"}):c.createElement("span",{className:"fas fa-user"})}};Object.defineProperty(g,"defaultProps",{enumerable:!0,configurable:!0,writable:!0,value:{alwaysVisible:!1}}),f([a.LO],g.prototype,"followersWithoutSelf",void 0),f([a.LO],g.prototype,"xhr",void 0),f([a.Fl],g.prototype,"followers",null),f([a.Fl],g.prototype,"friend",null),f([a.Fl],g.prototype,"isFriendLimit",null),f([a.Fl],g.prototype,"isVisible",null),f([a.Fl],g.prototype,"title",null),f([a.aD],g.prototype,"clicked",void 0),f([a.aD],g.prototype,"updateFriends",void 0),g=f([o.Pi],g);const y=g},5112:(e,t,s)=>{s.d(t,{Z:()=>p});var r=s(7181),i=s(7294),n=s(3336),a=s(8278),o=s(1270),l=s(3924),c=s(9755);const u={actionKey:{"forum.topic_watches_controller.index":"main.home_controller.index","main.account_controller.edit":"main.home_controller.index","main.beatmapset_watches_controller.index":"main.home_controller.index","main.follows_controller.index":"main.home_controller.index","main.friends_controller.index":"main.home_controller.index"},controllerKey:{"main.artist_tracks_controller._":"main.artists_controller._","main.store_controller._":"store._","multiplayer.rooms_controller._":"main.ranking_controller._"},namespaceKey:{"admin_forum._":"admin._"}};class d extends i.Component{constructor(){super(...arguments),Object.defineProperty(this,"cancelSyncHeight",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}componentDidMount(){this.cancelSyncHeight=r.Z.reactTurbolinks.runAfterPageLoad((()=>{c.publish("sync-height:force")}))}componentWillUnmount(){var e;null===(e=this.cancelSyncHeight)||void 0===e||e.call(this)}render(){const e=(0,n.sb)("header-v4",(0,l.G)(this.props.theme),this.props.modifiers);return i.createElement("div",{className:e},i.createElement("div",{className:"header-v4__container header-v4__container--main"},i.createElement("div",{className:"header-v4__bg-container"},i.createElement("div",{className:"header-v4__bg",style:{backgroundImage:(0,n.eF)(this.props.backgroundImage)}})),i.createElement("div",{className:"hidden-xs js-sync-height--target","data-sync-height-id":"notification-banners"}),i.createElement("div",{className:"header-v4__content"},this.props.contentPrepend,i.createElement("div",{className:"header-v4__row header-v4__row--title"},i.createElement("div",{className:"header-v4__icon"}),i.createElement("div",{className:"header-v4__title"},this.title())),this.props.contentAppend)),this.props.links.length>0&&i.createElement("div",{className:"header-v4__container"},i.createElement("div",{className:"header-v4__content"},i.createElement("div",{className:"header-v4__row header-v4__row--bar"},this.renderLinks(),this.renderLinksMobile(),this.props.linksAppend))))}renderLinks(){const e=this.props.links.map((e=>{const t=[];return e.active&&t.push("active"),i.createElement("li",{key:`${e.url}-${e.title}`,className:"header-nav-v4__item"},i.createElement("a",Object.assign({className:(0,n.sb)("header-nav-v4__link",t),href:e.url,onClick:this.props.onLinkClick},e.data),i.createElement("span",{className:"fake-bold","data-content":e.title},e.title)))})),t=this.props.linksBreadcrumb?"ol":"ul",s=[];return s.push(this.props.linksBreadcrumb?"breadcrumb":"list"),i.createElement(t,{className:(0,n.sb)("header-nav-v4",s)},e)}renderLinksMobile(){if(this.props.linksBreadcrumb)return null;if(0===this.props.links.length)return null;let e=this.props.links[0];const t=this.props.links.map((t=>{const s=[];return t.active&&(s.push("active"),e=t),i.createElement("li",{key:`${t.url}-${t.title}`},i.createElement("a",Object.assign({className:"header-nav-mobile__item js-click-menu--close",href:t.url,onClick:this.props.onLinkClick},t.data),t.title))}));return i.createElement("div",{className:"header-nav-mobile"},i.createElement("a",{className:"header-nav-mobile__toggle js-click-menu","data-click-menu-target":"header-nav-mobile",href:e.url},e.title,i.createElement("span",{className:"header-nav-mobile__toggle-icon"},i.createElement("span",{className:"fas fa-chevron-down"}))),i.createElement("ul",{className:"header-nav-mobile__menu js-click-menu","data-click-menu-id":"header-nav-mobile","data-visibility":"hidden"},t))}title(){var e,t,s;const r=(0,a.Mo)("json-route-section");let i=`${r.namespace}.${r.controller}.${r.action}`;i=null!==(e=u.actionKey[i])&&void 0!==e?e:i;let n=`${r.namespace}.${r.controller}._`;n=null!==(t=u.controllerKey[n])&&void 0!==t?t:n;let l=`${r.namespace}._`;l=null!==(s=u.namespaceKey[l])&&void 0!==s?s:l;const c=[`page_title.${i}`,`page_title.${n}`,`page_title.${l}`];for(const a of c)if((0,o.Xl)(a,fallbackLocale))return(0,o.dW)(a);return"unknown"}}Object.defineProperty(d,"defaultProps",{enumerable:!0,configurable:!0,writable:!0,value:{links:[],linksBreadcrumb:!1}});const p=d},4001:(e,t,s)=>{s.d(t,{Z:()=>a});var r=s(7294),i=s(3775),n=function(e,t){var s={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(s[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(s[r[i]]=e[r[i]])}return s};function a(e){const{className:t="",src2x:s}=e,a=n(e,["className","src2x"]);return null==a.src?r.createElement("img",Object.assign({},a,{className:`${t} u-hidden`})):r.createElement("img",Object.assign({className:t,srcSet:`${a.src} 1x, ${null!=s?s:(0,i.bG)(a.src)} 2x`},a))}},1646:(e,t,s)=>{s.d(t,{Z:()=>l});var r=s(9323),i=s(7294),n=s(3336),a=s(1270),o=s(5050);const l=(0,r.Pi)((e=>{const t=null!=e.model&&e.model.errors[e.name]&&e.model.showError[e.name];return i.createElement("label",{className:(0,n.sb)("input-container",{error:t},e.modifiers),htmlFor:e.for},null!=e.labelKey&&i.createElement("div",{className:"input-container__label"},(0,a.dW)(e.labelKey),null!=e.model&&null!=e.maxLength&&i.createElement(o.Z,{maxLength:e.maxLength,message:e.model.inputs[e.name]})),e.children)}))},5788:(e,t,s)=>{s.d(t,{Z:()=>r});const r=(0,s(7294).createContext)(null)},2105:(e,t,s)=>{s.d(t,{Z:()=>p});var r=s(6741),i=s(8949),n=s(9323),a=s(7294),o=s(3336),l=s(1270),c=s(5788),u=function(e,t,s,r){var i,n=arguments.length,a=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(n<3?i(a):n>3?i(t,s,a):i(t,s))||a);return n>3&&a&&Object.defineProperty(t,s,a),a};let d=class extends a.Component{get ready(){var e,t;return this.hasUpdated||this.skipLazyLoad||this.loaded&&!(null!==(t=null===(e=this.context)||void 0===e?void 0:e.scrolling)&&void 0!==t&&t)}constructor(e){var t;super(e),Object.defineProperty(this,"error",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"hasUpdated",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"loaded",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"observer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ref",{enumerable:!0,configurable:!0,writable:!0,value:a.createRef()}),Object.defineProperty(this,"skipLazyLoad",{enumerable:!0,configurable:!0,writable:!0,value:null!==(t=this.props.hasData)&&void 0!==t&&t}),Object.defineProperty(this,"load",{enumerable:!0,configurable:!0,writable:!0,value:()=>{var e;this.error=!1,null===(e=this.observer)||void 0===e||e.disconnect(),this.props.onLoad().then((0,i.aD)((()=>{this.loaded=!0,this.error=!1}))).catch((0,i.aD)((()=>this.error=!0)))}}),this.loaded=this.skipLazyLoad,this.skipLazyLoad||(this.observer=new IntersectionObserver((e=>{e.some((e=>e.isIntersecting))&&this.load()}),{rootMargin:"400px 0px 400px 0px"})),(0,i.rC)(this)}componentDidMount(){var e;this.skipLazyLoad||null==this.ref.current||null===(e=this.observer)||void 0===e||e.observe(this.ref.current)}componentDidUpdate(e,t,s){if(!this.hasUpdated&&!this.skipLazyLoad&&this.loaded&&null!=s){if(null==this.context)throw new Error("LazyLoadContext is missing.");this.hasUpdated=!0,this.context.done(this.props.name,s)}}componentWillUnmount(){var e;null===(e=this.observer)||void 0===e||e.disconnect()}getSnapshotBeforeUpdate(){var e,t;return null!==(t=null===(e=this.context)||void 0===e?void 0:e.getSnapshot(this.props.name))&&void 0!==t?t:null}render(){return a.createElement("div",{ref:this.ref,className:(0,o.sb)("lazy-load",{loading:!this.ready})},this.ready?this.renderLoaded():this.renderNotLoaded())}renderLoaded(){if(!this.skipLazyLoad&&null==this.context)throw new Error("LazyLoadContext is missing.");return this.props.children}renderNotLoaded(){return this.error?a.createElement("div",{className:"lazy-load__error"},a.createElement("p",null,(0,l.dW)("errors.load_failed")),a.createElement("div",{className:"lazy-load__button"},a.createElement("button",{className:"btn-osu-big btn-osu-big--rounded-thin",onClick:this.load,type:"button"},(0,l.dW)("common.buttons.retry")))):a.createElement(r.$,null)}};Object.defineProperty(d,"contextType",{enumerable:!0,configurable:!0,writable:!0,value:c.Z}),u([i.LO],d.prototype,"error",void 0),u([i.LO],d.prototype,"loaded",void 0),u([i.LO],d.prototype,"skipLazyLoad",void 0),u([i.Fl],d.prototype,"ready",null),u([i.aD],d.prototype,"load",void 0),d=u([n.Pi],d);const p=d},5050:(e,t,s)=>{s.d(t,{Z:()=>a});var r=s(7294),i=s(3336);function n(e,t){return e.length>t?"over":e.length>.95*t?"almost-over":null}function a({maxLength:e,message:t,modifiers:s}){return r.createElement("div",{className:(0,i.sb)("message-length-counter",n(t,e),s)},`${t.length} / ${e}`)}},3439:(e,t,s)=>{s.d(t,{Z:()=>c});const r=JSON.parse('{"EZ":{"acronym":"EZ","name":"Easy","setting_labels":{"retries":"Extra Lives"},"type":"DifficultyReduction"},"NF":{"acronym":"NF","name":"No Fail","setting_labels":{},"type":"DifficultyReduction"},"HT":{"acronym":"HT","name":"Half Time","setting_labels":{"speed_change":"Speed decrease","adjust_pitch":"Adjust pitch"},"type":"DifficultyReduction"},"DC":{"acronym":"DC","name":"Daycore","setting_labels":{"speed_change":"Speed decrease"},"type":"DifficultyReduction"},"HR":{"acronym":"HR","name":"Hard Rock","setting_labels":{},"type":"DifficultyIncrease"},"SD":{"acronym":"SD","name":"Sudden Death","setting_labels":{"restart":"Restart on fail"},"type":"DifficultyIncrease"},"PF":{"acronym":"PF","name":"Perfect","setting_labels":{"restart":"Restart on fail"},"type":"DifficultyIncrease"},"DT":{"acronym":"DT","name":"Double Time","setting_labels":{"speed_change":"Speed increase","adjust_pitch":"Adjust pitch"},"type":"DifficultyIncrease"},"NC":{"acronym":"NC","name":"Nightcore","setting_labels":{"speed_change":"Speed increase"},"type":"DifficultyIncrease"},"HD":{"acronym":"HD","name":"Hidden","setting_labels":{"only_fade_approach_circles":"Only fade approach circles","coverage":"Coverage"},"type":"DifficultyIncrease"},"FL":{"acronym":"FL","name":"Flashlight","setting_labels":{"follow_delay":"Follow delay","size_multiplier":"Flashlight size","combo_based_size":"Change size based on combo"},"type":"DifficultyIncrease"},"BL":{"acronym":"BL","name":"Blinds","setting_labels":{},"type":"DifficultyIncrease"},"ST":{"acronym":"ST","name":"Strict Tracking","setting_labels":{},"type":"DifficultyIncrease"},"AC":{"acronym":"AC","name":"Accuracy Challenge","setting_labels":{"minimum_accuracy":"Minimum accuracy","accuracy_judge_mode":"Accuracy mode","restart":"Restart on fail"},"type":"DifficultyIncrease"},"TP":{"acronym":"TP","name":"Target Practice","setting_labels":{"seed":"Seed","metronome":"Metronome ticks"},"type":"Conversion"},"DA":{"acronym":"DA","name":"Difficulty Adjust","setting_labels":{"circle_size":"Circle Size","approach_rate":"Approach Rate","drain_rate":"HP Drain","overall_difficulty":"Accuracy","extended_limits":"Extended Limits","scroll_speed":"Scroll Speed","hard_rock_offsets":"Spicy Patterns"},"type":"Conversion"},"CL":{"acronym":"CL","name":"Classic","setting_labels":{"no_slider_head_accuracy":"No slider head accuracy requirement","classic_note_lock":"Apply classic note lock","always_play_tail_sample":"Always play a slider\'s tail sample","fade_hit_circle_early":"Fade out hit circles earlier","classic_health":"Classic health"},"type":"Conversion"},"RD":{"acronym":"RD","name":"Random","setting_labels":{"angle_sharpness":"Angle sharpness","seed":"Seed"},"type":"Conversion"},"MR":{"acronym":"MR","name":"Mirror","setting_labels":{"reflection":"Mirrored axes"},"type":"Conversion"},"AL":{"acronym":"AL","name":"Alternate","setting_labels":{},"type":"Conversion"},"SG":{"acronym":"SG","name":"Single Tap","setting_labels":{},"type":"Conversion"},"AT":{"acronym":"AT","name":"Autoplay","setting_labels":{},"type":"Automation"},"CN":{"acronym":"CN","name":"Cinema","setting_labels":{},"type":"Automation"},"RX":{"acronym":"RX","name":"Relax","setting_labels":{},"type":"Automation"},"AP":{"acronym":"AP","name":"Autopilot","setting_labels":{},"type":"Automation"},"SO":{"acronym":"SO","name":"Spun Out","setting_labels":{},"type":"Automation"},"TR":{"acronym":"TR","name":"Transform","setting_labels":{},"type":"Fun"},"WG":{"acronym":"WG","name":"Wiggle","setting_labels":{"strength":"Strength"},"type":"Fun"},"SI":{"acronym":"SI","name":"Spin In","setting_labels":{},"type":"Fun"},"GR":{"acronym":"GR","name":"Grow","setting_labels":{"start_scale":"Starting Size"},"type":"Fun"},"DF":{"acronym":"DF","name":"Deflate","setting_labels":{"start_scale":"Starting Size"},"type":"Fun"},"WU":{"acronym":"WU","name":"Wind Up","setting_labels":{"initial_rate":"Initial rate","final_rate":"Final rate","adjust_pitch":"Adjust pitch"},"type":"Fun"},"WD":{"acronym":"WD","name":"Wind Down","setting_labels":{"initial_rate":"Initial rate","final_rate":"Final rate","adjust_pitch":"Adjust pitch"},"type":"Fun"},"TC":{"acronym":"TC","name":"Traceable","setting_labels":{},"type":"Fun"},"BR":{"acronym":"BR","name":"Barrel Roll","setting_labels":{"spin_speed":"Roll speed","direction":"Direction"},"type":"Fun"},"AD":{"acronym":"AD","name":"Approach Different","setting_labels":{"scale":"Initial size","style":"Style"},"type":"Fun"},"MU":{"acronym":"MU","name":"Muted","setting_labels":{"inverse_muting":"Start muted","enable_metronome":"Enable metronome","mute_combo_count":"Final volume at combo","affects_hit_sounds":"Mute hit sounds"},"type":"Fun"},"NS":{"acronym":"NS","name":"No Scope","setting_labels":{"hidden_combo_count":"Hidden at combo"},"type":"Fun"},"MG":{"acronym":"MG","name":"Magnetised","setting_labels":{"attraction_strength":"Attraction strength"},"type":"Fun"},"RP":{"acronym":"RP","name":"Repel","setting_labels":{"repulsion_strength":"Repulsion strength"},"type":"Fun"},"AS":{"acronym":"AS","name":"Adaptive Speed","setting_labels":{"initial_rate":"Initial rate","adjust_pitch":"Adjust pitch"},"type":"Fun"},"FR":{"acronym":"FR","name":"Freeze Frame","setting_labels":{},"type":"Fun"},"BU":{"acronym":"BU","name":"Bubbles","setting_labels":{},"type":"Fun"},"SY":{"acronym":"SY","name":"Synesthesia","setting_labels":{},"type":"Fun"},"TD":{"acronym":"TD","name":"Touch Device","setting_labels":{},"type":"System"},"SV2":{"acronym":"SV2","name":"Score V2","setting_labels":{},"type":"System"},"SW":{"acronym":"SW","name":"Swap","setting_labels":{},"type":"Conversion"},"FF":{"acronym":"FF","name":"Floating Fruits","setting_labels":{},"type":"Fun"},"FI":{"acronym":"FI","name":"Fade In","setting_labels":{"coverage":"Coverage"},"type":"DifficultyIncrease"},"DS":{"acronym":"DS","name":"Dual Stages","setting_labels":{},"type":"Conversion"},"IN":{"acronym":"IN","name":"Invert","setting_labels":{},"type":"Conversion"},"CS":{"acronym":"CS","name":"Constant Speed","setting_labels":{},"type":"Conversion"},"HO":{"acronym":"HO","name":"Hold Off","setting_labels":{},"type":"Conversion"},"1K":{"acronym":"1K","name":"One Key","setting_labels":{},"type":"Conversion"},"2K":{"acronym":"2K","name":"Two Keys","setting_labels":{},"type":"Conversion"},"3K":{"acronym":"3K","name":"Three Keys","setting_labels":{},"type":"Conversion"},"4K":{"acronym":"4K","name":"Four Keys","setting_labels":{},"type":"Conversion"},"5K":{"acronym":"5K","name":"Five Keys","setting_labels":{},"type":"Conversion"},"6K":{"acronym":"6K","name":"Six Keys","setting_labels":{},"type":"Conversion"},"7K":{"acronym":"7K","name":"Seven Keys","setting_labels":{},"type":"Conversion"},"8K":{"acronym":"8K","name":"Eight Keys","setting_labels":{},"type":"Conversion"},"9K":{"acronym":"9K","name":"Nine Keys","setting_labels":{},"type":"Conversion"},"10K":{"acronym":"10K","name":"Ten Keys","setting_labels":{},"type":"Conversion"},"V2":{"acronym":"V2","name":"Score V2","setting_labels":{},"type":"Conversion"},"NM":{"acronym":"NM","name":"No Mod","setting_labels":{},"type":"Conversion"}}');var i=s(7294),n=s(3336);const a=new Intl.NumberFormat("en");function o(e){return"boolean"==typeof e?e?"on":"off":"number"==typeof e?a.format(e):String(e)}function l(e,t){var s;const r=[];for(const[i,n]of Object.entries(null!==(s=t.settings)&&void 0!==s?s:{}))if("speed_change"===i)r.push(`${o(n)}×`);else{const t=e.setting_labels[i];null!=t&&r.push(`${t}: ${o(n)}`)}return 0===r.length?"":` (${r.join(", ")})`}function c({mod:e}){var t;const s=null!==(t=r[e.acronym])&&void 0!==t?t:{acronym:e.acronym,name:"",setting_labels:{},type:"Fun"};return i.createElement("div",{className:(0,n.sb)("mod",s.acronym,`type-${s.type}`),"data-acronym":s.acronym,title:`${s.name}${l(s,e)}`})}},9003:(e,t,s)=>{s.d(t,{Z:()=>c,g:()=>o});var r=s(7294),i=s(3857),n=s(5863),a=s(9755);const o=()=>0!==l.size,l=new Set;class c extends r.PureComponent{constructor(){super(...arguments),Object.defineProperty(this,"clickEndTarget",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clickStartTarget",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ref",{enumerable:!0,configurable:!0,writable:!0,value:r.createRef()}),Object.defineProperty(this,"close",{enumerable:!0,configurable:!0,writable:!0,value:()=>{l.delete(this),0===l.size&&(0,i.z4)(!1)}}),Object.defineProperty(this,"handleBeforeCache",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.close()}}),Object.defineProperty(this,"handleEsc",{enumerable:!0,configurable:!0,writable:!0,value:e=>{null!=this.props.onClose&&"Escape"===e.key&&this.props.onClose()}}),Object.defineProperty(this,"handleMouseDown",{enumerable:!0,configurable:!0,writable:!0,value:e=>{this.clickStartTarget=e.target}}),Object.defineProperty(this,"handleMouseUp",{enumerable:!0,configurable:!0,writable:!0,value:e=>{this.clickEndTarget=e.target}}),Object.defineProperty(this,"hideModal",{enumerable:!0,configurable:!0,writable:!0,value:e=>{null!=this.props.onClose&&0===e.button&&e.target===this.ref.current&&this.clickEndTarget===this.clickStartTarget&&this.props.onClose()}}),Object.defineProperty(this,"open",{enumerable:!0,configurable:!0,writable:!0,value:()=>{l.add(this),(0,i.z4)(!0,.5)}})}componentDidMount(){document.addEventListener("keydown",this.handleEsc),a(document).on("turbolinks:before-cache",this.handleBeforeCache),this.open()}componentWillUnmount(){this.close(),document.removeEventListener("keydown",this.handleEsc),a(document).off("turbolinks:before-cache",this.handleBeforeCache)}render(){return r.createElement(n.Z,null,r.createElement("div",{ref:this.ref,className:"js-react-modal",onClick:this.hideModal,onMouseDown:this.handleMouseDown,onMouseUp:this.handleMouseUp},this.props.children))}}},9045:(e,t,s)=>{s.d(t,{Z:()=>o});var r=s(3664),i=s(7294),n=s(1270),a=s(5112);function o(e){const t=[{active:"index"===e.section,title:(0,n.dW)("news.index.title.info"),url:(0,r.B)("news.index")}];return"show"===e.section&&null!=e.post&&t.push({active:!0,title:e.post.title,url:(0,r.B)("news.show",{news:e.post.slug})}),i.createElement(a.Z,{links:t,linksBreadcrumb:!0,theme:"news"})}},3430:(e,t,s)=>{s.d(t,{Z:()=>o});var r=s(7294),i=s(5863),n=s(9755);const a="notification-banner-v2";class o extends r.PureComponent{constructor(e){var t;super(e),Object.defineProperty(this,"portalRoot",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const s=(null!==(t=window.newBody)&&void 0!==t?t:document.body).querySelector(".js-notification-banners");if(null==s)throw new Error("Notification banner container is missing");this.portalRoot=s}componentDidMount(){this.notifySyncHeight()}componentWillUnmount(){window.setTimeout(this.notifySyncHeight)}render(){return r.createElement(i.Z,{root:this.portalRoot},r.createElement("div",{className:`${a} ${a}--${this.props.type}`},r.createElement("div",{className:`${a}__col ${a}__col--icon`}),r.createElement("div",{className:`${a}__col ${a}__col--label`},r.createElement("div",{className:`${a}__type`},this.props.type),r.createElement("div",{className:`${a}__text`},this.props.title)),r.createElement("div",{className:`${a}__col`},r.createElement("div",{className:`${a}__text`},this.props.message))))}notifySyncHeight(){n.publish("sync-height:force")}}},2500:(e,t,s)=>{s.d(t,{H:()=>m});var r=s(1956),i=s(9323),n=s(7181),a=s(7294),o=s(7629),l=s(1270),c=s(3684),u=s(596),d=s(2325),p=function(e,t,s,r){var i,n=arguments.length,a=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(n<3?i(a):n>3?i(t,s,a):i(t,s))||a);return n>3&&a&&Object.defineProperty(t,s,a),a};let m=class extends a.Component{render(){const{score:e,user:t}=this.props,s=(0,o.Dd)(e.ruleset_id);return a.createElement(u.Y,null,(i=>{var o;return a.createElement("div",{className:"simple-menu"},n.Z.scorePins.canBePinned(e)&&a.createElement(r.Z,{className:"simple-menu__item",onUpdate:i,score:e}),(0,c.O0)(e)&&a.createElement("a",{className:"simple-menu__item",href:(0,c.JP)(e)},(0,l.dW)("users.show.extra.top_ranks.view_details")),(0,c.sQ)(e)&&a.createElement("a",{className:"simple-menu__item js-login-required--click","data-turbolinks":!1,href:(0,c.M8)(e),onClick:i},(0,l.dW)("users.show.extra.top_ranks.download_replay")),(0,c.aG)(e)&&a.createElement(d.c,{className:"simple-menu__item",onFormOpen:i,reportableId:(null!==(o=e.best_id)&&void 0!==o?o:e.id).toString(),reportableType:"solo_score"===e.type?e.type:`score_best_${s}`,user:t}))}))}};m=p([i.Pi],m)},9473:(e,t,s)=>{s.d(t,{Z:()=>a});var r=s(7294),i=s(3336),n=s(1270);class a extends r.Component{constructor(){super(...arguments),Object.defineProperty(this,"onClick",{enumerable:!0,configurable:!0,writable:!0,value:e=>{var t,s;const r=e.currentTarget.dataset.mode;this.props.currentMode===r?e.preventDefault():null===(s=(t=this.props).onClick)||void 0===s||s.call(t,e,r)}}),Object.defineProperty(this,"renderLink",{enumerable:!0,configurable:!0,writable:!0,value:e=>{var t;const s=r.createElement(r.Fragment,null,r.createElement("span",{className:`fal fa-extra-mode-${e.mode}`,title:e.disabled?void 0:(0,n.dW)(`beatmaps.mode.${e.mode}`)}),e.mode===this.props.defaultMode&&r.createElement("span",{className:"game-mode-link__icon",title:(0,n.dW)("users.show.edit.default_playmode.is_default_tooltip")},r.createElement("span",{className:"fas fa-star"})),null!=e.count&&r.createElement("span",{className:"game-mode-link__badge"},e.count)),a=(0,i.sb)("game-mode-link",{active:e.mode===this.props.currentMode,disabled:e.disabled});return r.createElement("li",{key:e.mode},e.disabled?r.createElement("span",{className:a},s):r.createElement("a",{className:a,"data-mode":e.mode,href:null!==(t=e.href)&&void 0!==t?t:"#",onClick:this.onClick},s))}})}render(){return r.createElement("ul",{className:(0,i.sb)("game-mode",this.props.modifiers)},this.props.entries.map(this.renderLink))}}},596:(e,t,s)=>{s.d(t,{Y:()=>a});var r=s(4498),i=s(7294),n=s(8259);function a(e){const t=i.useContext(n.Xl),s=i.useContext(n.XI),a=i.useCallback((()=>t.activeKeyDidChange(null)),[t]),o=i.useCallback((()=>t.activeKeyDidChange(s)),[t,s]);return i.useEffect((()=>()=>t.activeKeyDidChange(null)),[t]),i.createElement(r.Z,Object.assign({onHide:a,onShow:o},e))}},4498:(e,t,s)=>{s.d(t,{Z:()=>u});var r=s(7294),i=s(2094),n=s(6122),a=s(9139),o=s(5863),l=s(9755);class c extends r.PureComponent{constructor(){super(...arguments),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:{active:!1}}),Object.defineProperty(this,"buttonRef",{enumerable:!0,configurable:!0,writable:!0,value:r.createRef()}),Object.defineProperty(this,"eventId",{enumerable:!0,configurable:!0,writable:!0,value:`popup-menu-${(0,a.d)()}`}),Object.defineProperty(this,"menuRef",{enumerable:!0,configurable:!0,writable:!0,value:r.createRef()}),Object.defineProperty(this,"menuRootRef",{enumerable:!0,configurable:!0,writable:!0,value:r.createRef()}),Object.defineProperty(this,"tooltipHideEvent",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dismiss",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.setState({active:!1})}}),Object.defineProperty(this,"hide",{enumerable:!0,configurable:!0,writable:!0,value:e=>{if(!this.state.active||(0,n.u)())return;const t=e.originalEvent;null!=t&&("key"in t&&"Escape"===t.key||"button"in t&&0===t.button&&!this.isMenuInPath(t.composedPath()))&&this.setState({active:!1})}}),Object.defineProperty(this,"resize",{enumerable:!0,configurable:!0,writable:!0,value:()=>{if(!this.state.active)return;const e=this.buttonRef.current,t=this.menuRef.current,s=this.menuRootRef.current;if(null==e||null==t||null==s)throw new Error("missing button and/or menu element");if(null==e.offsetParent)return void(s.style.display="none");const r=e.getBoundingClientRect(),i=t.getBoundingClientRect(),{scrollX:n,scrollY:a}=window;let o=n+r.right;("right"===this.props.direction||r.x-i.width<0)&&(o+=i.width-r.width),s.style.display="block",s.style.position="absolute",s.style.top=`${Math.floor(a+r.bottom+5)}px`,s.style.left=`${Math.floor(o)}px`;const l=this.tooltipElement;null!=l&&(s.style.zIndex=getComputedStyle(l).zIndex)}}),Object.defineProperty(this,"toggle",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.setState({active:!this.state.active})}})}get $tooltipElement(){const e=this.tooltipElement;return null==e?null:l(e)}get tooltipElement(){var e;return null===(e=this.context)||void 0===e?void 0:e.closest(".qtip")}componentDidMount(){var e;this.tooltipHideEvent=null===(e=this.$tooltipElement)||void 0===e?void 0:e.qtip("option","hide.event"),l(window).on(`resize.${this.eventId}`,this.resize)}componentDidUpdate(e,t){var s,r,i,n,a;if(t.active!==this.state.active)if(this.state.active){this.resize();const e=this.$tooltipElement;null!=e&&(this.tooltipHideEvent=e.qtip("option","hide.event"),e.qtip("option","hide.event",!1)),l(document).on(`click.${this.eventId} keydown.${this.eventId}`,this.hide),null===(r=(s=this.props).onShow)||void 0===r||r.call(s)}else null===(i=this.$tooltipElement)||void 0===i||i.qtip("option","hide.event",this.tooltipHideEvent),l(document).off(`click.${this.eventId} keydown.${this.eventId}`,this.hide),null===(a=(n=this.props).onHide)||void 0===a||a.call(n)}componentWillUnmount(){l(document).off(`.${this.eventId}`),l(window).off(`.${this.eventId}`)}render(){return this.props.customRender?this.props.customRender(this.renderMenu(),this.buttonRef,this.toggle):r.createElement(r.Fragment,null,r.createElement("button",{ref:this.buttonRef,className:"popup-menu",onClick:this.toggle,type:"button"},r.createElement("span",{className:"fas fa-ellipsis-v"})),this.renderMenu())}isMenuInPath(e){for(const t of["menuRootRef","buttonRef"]){const s=this[t].current;if(null!=s&&e.includes(s))return!0}return!1}renderMenu(){return this.state.active?r.createElement(o.Z,null,r.createElement("div",{ref:this.menuRootRef},r.createElement("div",{ref:this.menuRef,className:"popup-menu-float"},this.props.children(this.dismiss)))):null}}Object.defineProperty(c,"contextType",{enumerable:!0,configurable:!0,writable:!0,value:i.d}),Object.defineProperty(c,"defaultProps",{enumerable:!0,configurable:!0,writable:!0,value:{children:()=>null,direction:"left"}});const u=c},5863:(e,t,s)=>{s.d(t,{Z:()=>o,w:()=>a});var r=s(7294),i=s(3935);const n="js-portal";function a(){var e;for(const t of(null!==(e=window.newBody)&&void 0!==e?e:document.body).querySelectorAll(`.${n}`))t.remove()}class o extends r.PureComponent{constructor(e){super(e),Object.defineProperty(this,"container",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.container=document.createElement("div"),this.container.className=n}componentDidMount(){var e,t;(null!==(t=null!==(e=this.props.root)&&void 0!==e?e:window.newBody)&&void 0!==t?t:document.body).appendChild(this.container)}componentWillUnmount(){this.container.remove()}render(){return(0,i.createPortal)(this.props.children,this.container)}}},1237:(e,t,s)=>{s.d(t,{Z:()=>a});var r=s(7294),i=s(3775),n=s(1270);function a(e){return r.createElement("h3",{className:"title title--page-extra-small"},(0,n.dW)(e.titleKey),null!=e.count&&r.createElement("span",{className:"title__count"},(0,i.uf)(e.count)))}},6140:(e,t,s)=>{s.d(t,{Z:()=>a});var r=s(7294),i=s(3336),n=s(1270);function a(e){const t=(0,i.sb)("page-mode-link","profile-page",{"is-active":e.page===e.currentPage}),s=(0,n.dW)(`users.show.extra.${e.page}.title`);return r.createElement("span",{className:t},r.createElement("span",{className:"fake-bold","data-content":s},s))}},2477:(e,t,s)=>{s.d(t,{Z:()=>E});var r=s(8949),i=s(9323),n=s(8082),a=s(2992),o=s(7294),l=s(3775),c=s(8278),u=s(1270),d=s(7563),p=s(5076),m=s(2105),h=s(3890),b=s(4403),f=s(12),v=s(7048),g=function(e,t,s,r){var i,n=arguments.length,a=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(n<3?i(a):n>3?i(t,s,a):i(t,s))||a);return n>3&&a&&Object.defineProperty(t,s,a),a};const y="json-kudosu";function w({kudosu:e}){const t={amount:o.createElement("strong",{className:"profile-extra-entries__kudosu-amount"},(0,u.dW)("users.show.extra.kudosu.entry.amount",{amount:(0,l.uf)(Math.abs(e.amount))})),giver:null==e.giver?(0,u.dW)("users.deleted"):o.createElement("a",{href:e.giver.url},e.giver.username),post:null==e.post.url?e.post.title:o.createElement("a",{href:e.post.url},e.post.title)};return o.createElement("li",{className:"profile-extra-entries__item"},o.createElement("div",{className:"profile-extra-entries__detail"},o.createElement("div",{className:"profile-extra-entries__text"},o.createElement(b.Z,{mappings:t,pattern:(0,u.dW)(`users.show.extra.kudosu.entry.${e.model}.${e.action}`)}))),o.createElement("div",{className:"profile-extra-entries__time"},o.createElement(f.Z,{dateTime:e.created_at,relative:!0})))}let _=class extends o.Component{get hasData(){return null!=this.kudosu}constructor(e){var t;super(e),Object.defineProperty(this,"kudosu",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"showMoreXhr",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"xhr",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"handleOnLoad",{enumerable:!0,configurable:!0,writable:!0,value:()=>(this.xhr=(0,a.Z)({id:this.props.userId},"kudosu"),this.xhr.done((e=>(0,r.z)((()=>{this.kudosu=e,this.saveState()})))),this.xhr)}),Object.defineProperty(this,"handleShowMore",{enumerable:!0,configurable:!0,writable:!0,value:()=>{null!=this.kudosu&&(this.showMoreXhr=(0,d.Af)(this.kudosu,this.props.userId).done(this.saveState))}}),Object.defineProperty(this,"saveState",{enumerable:!0,configurable:!0,writable:!0,value:()=>{(0,c.Cw)(y,this.kudosu)}}),this.kudosu=null!==(t=(0,c.Um)(y))&&void 0!==t?t:e.kudosu,(0,r.rC)(this)}componentWillUnmount(){var e,t;null===(e=this.xhr)||void 0===e||e.abort(),null===(t=this.showMoreXhr)||void 0===t||t.abort()}render(){return o.createElement("div",{className:"page-extra"},o.createElement(n.Z,{name:this.props.name,withEdit:this.props.withEdit}),o.createElement(m.Z,{hasData:this.hasData,name:this.props.name,onLoad:this.handleOnLoad},o.createElement("div",{className:"kudosu-box"},o.createElement(v.Z,{description:o.createElement(b.Z,{mappings:{link:o.createElement("a",{href:(0,p.dP)("Kudosu")},(0,u.dW)("users.show.extra.kudosu.total_info.link"))},pattern:(0,u.dW)("users.show.extra.kudosu.total_info._")}),label:(0,u.dW)("users.show.extra.kudosu.total"),modifiers:"kudosu",value:(0,l.uf)(this.props.total)})),this.renderEntries()))}renderEntries(){return null==this.kudosu?null:0===this.kudosu.items.length?o.createElement("div",{className:"profile-extra-entries profile-extra-entries--kudosu"},(0,u.dW)("users.show.extra.kudosu.entry.empty")):o.createElement("ul",{className:"profile-extra-entries profile-extra-entries--kudosu"},this.kudosu.items.map((e=>o.createElement(w,{key:e.id,kudosu:e}))),o.createElement("li",{className:"profile-extra-entries__item u-contents"},o.createElement(h.Z,Object.assign({},this.kudosu.pagination,{callback:this.handleShowMore,modifiers:"profile-page"}))))}};g([r.LO],_.prototype,"kudosu",void 0),g([r.Fl],_.prototype,"hasData",null),g([r.aD],_.prototype,"handleOnLoad",void 0),g([r.aD],_.prototype,"handleShowMore",void 0),_=g([i.Pi],_);const E=_},6018:(e,t,s)=>{s.d(t,{Z:()=>a});var r=s(4001),i=s(3664),n=s(7294);function a({banner:e}){return null==e.image?null:n.createElement("a",{className:"profile-tournament-banner",href:(0,i.B)("tournaments.show",{tournament:e.tournament_id})},n.createElement(r.Z,{className:"profile-tournament-banner__image",src:e.image,src2x:e["image@2x"]}))}},7275:(e,t,s)=>{s.d(t,{Z:()=>o});var r=s(7018),i=s(3664),n=s(7294),a=s(9014);class o extends n.PureComponent{constructor(){super(...arguments),Object.defineProperty(this,"handleChange",{enumerable:!0,configurable:!0,writable:!0,value:e=>{(0,a.c4)(this.href(e.id))}}),Object.defineProperty(this,"renderOption",{enumerable:!0,configurable:!0,writable:!0,value:e=>n.createElement("a",{key:e.option.id,className:e.cssClasses,href:this.href(e.option.id),onClick:e.onClick},e.children)})}render(){return n.createElement(r.Z,{modifiers:"spotlight",onChange:this.handleChange,options:this.props.items,renderOption:this.renderOption,selected:this.props.currentItem})}href(e){switch(this.props.type){case"multiplayer":return(0,i.B)("multiplayer.rooms.show",{room:null!=e?e:"latest"});case"seasons":return(0,i.B)("seasons.show",{season:null!=e?e:"latest"})}}}},3518:(e,t,s)=>{s.d(t,{Hd:()=>v,Y1:()=>f});var r=s(7018),i=s(3664),n=s(8949),a=s(9323),o=s(7294),l=s(3935),c=s(9703),u=s(1270),d=s(9003),p=s(4403),m=s(9755),h=function(e,t,s,r){var i,n=arguments.length,a=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(n<3?i(a):n>3?i(t,s,a):i(t,s))||a);return n>3&&a&&Object.defineProperty(t,s,a),a};const b="report-form";function f(e){const t=document.createElement("div");(0,l.render)(o.createElement(w,{reportableId:e.reportableId,reportableType:e.reportableType,root:t,username:e.username}),t)}const v={beatmapset:"beatmapset",beatmapset_discussion_post:"beatmapset_discussion_post",comment:"comment",forum_post:"forum_post",score_best_fruits:"scores",score_best_mania:"scores",score_best_osu:"scores",score_best_taiko:"scores",solo_score:"scores",user:"user"},g={Cheating:(0,u.dW)("users.report.options.cheating"),MultipleAccounts:(0,u.dW)("users.report.options.multiple_accounts"),Insults:(0,u.dW)("users.report.options.insults"),Spam:(0,u.dW)("users.report.options.spam"),UnwantedContent:(0,u.dW)("users.report.options.unwanted_content"),Nonsense:(0,u.dW)("users.report.options.nonsense"),Other:(0,u.dW)("users.report.options.other")},y={beatmapset:["UnwantedContent","Other"],beatmapset_discussion_post:["Insults","Spam","UnwantedContent","Nonsense","Other"],comment:["Insults","Spam","UnwantedContent","Nonsense","Other"],forum_post:["Insults","Spam","UnwantedContent","Nonsense","Other"],scores:["Cheating","MultipleAccounts","Other"]};let w=class extends o.Component{get canSubmit(){return!this.disabled&&this.comments.length>0}get groupKey(){return v[this.props.reportableType]}get options(){var e;return(null!==(e=y[this.groupKey])&&void 0!==e?e:Object.keys(g)).map((e=>({id:e,text:g[e]})))}constructor(e){super(e),Object.defineProperty(this,"comments",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"completed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"disabled",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"selectedReason",{enumerable:!0,configurable:!0,writable:!0,value:this.options[0]}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"handleClose",{enumerable:!0,configurable:!0,writable:!0,value:()=>{(0,l.unmountComponentAtNode)(this.props.root)}}),Object.defineProperty(this,"handleCommentsChange",{enumerable:!0,configurable:!0,writable:!0,value:e=>{this.comments=e.target.value}}),Object.defineProperty(this,"handleReasonChange",{enumerable:!0,configurable:!0,writable:!0,value:e=>{this.selectedReason=e}}),Object.defineProperty(this,"handleSubmit",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.disabled=!0;const e={data:{comments:this.comments,reason:this.selectedReason.id,reportable_id:this.props.reportableId,reportable_type:this.props.reportableType},dataType:"json",type:"POST",url:(0,i.B)("reports.store")};m.ajax(e).done((0,n.aD)((()=>{this.timeout=window.setTimeout(this.handleClose,1e3),this.completed=!0}))).fail((0,n.aD)((e=>{(0,c.qQ)(e),this.disabled=!1})))}}),(0,n.rC)(this)}componentDidMount(){m(document).on("turbolinks:before-cache",this.handleClose)}componentWillUnmount(){m(document).off("turbolinks:before-cache",this.handleClose),window.clearTimeout(this.timeout)}render(){return o.createElement(d.Z,{onClose:this.handleClose},o.createElement("div",{className:b},o.createElement("div",{className:`${b}__header`},o.createElement("div",{className:`${b}__row ${b}__row--exclamation`},o.createElement("i",{className:"fas fa-exclamation-triangle"})),o.createElement("div",{className:`${b}__row ${b}__row--title`},o.createElement("span",null,this.renderTitle()))),!this.completed&&this.renderFormContent()))}renderFormContent(){return o.createElement("div",null,0!==this.options.length&&o.createElement(o.Fragment,null,o.createElement("div",{className:`${b}__row`},(0,u.dW)("users.report.reason")),o.createElement("div",{className:`${b}__row`},o.createElement(r.Z,{blackout:!1,modifiers:"report",onChange:this.handleReasonChange,options:this.options,selected:this.selectedReason}))),o.createElement("div",{className:`${b}__row`},(0,u.dW)("users.report.comments")),o.createElement("div",{className:`${b}__row`},o.createElement("textarea",{className:`${b}__textarea`,maxLength:2e3,onChange:this.handleCommentsChange,placeholder:(0,u.dW)("users.report.placeholder"),value:this.comments})),o.createElement("div",{className:`${b}__row ${b}__row--buttons`},o.createElement("button",{className:`${b}__button ${b}__button--report`,disabled:!this.canSubmit,onClick:this.handleSubmit,type:"button"},(0,u.dW)("users.report.actions.send")),o.createElement("button",{className:`${b}__button`,disabled:this.disabled,onClick:this.handleClose,type:"button"},(0,u.dW)("users.report.actions.cancel"))))}renderTitle(){return this.completed?(0,u.dW)("users.report.thanks"):o.createElement(p.Z,{mappings:{username:o.createElement("strong",null,this.props.username)},pattern:(0,u.dW)(`report.${this.groupKey}.title`)})}};h([n.LO],w.prototype,"comments",void 0),h([n.LO],w.prototype,"completed",void 0),h([n.LO],w.prototype,"disabled",void 0),h([n.LO],w.prototype,"selectedReason",void 0),h([n.Fl],w.prototype,"options",null),h([n.aD],w.prototype,"handleCommentsChange",void 0),h([n.aD],w.prototype,"handleReasonChange",void 0),h([n.aD],w.prototype,"handleSubmit",void 0),w=h([a.Pi],w)},2325:(e,t,s)=>{s.d(t,{c:()=>o});var r=s(7294),i=s(1270),n=s(3518),a=function(e,t){var s={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(s[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(s[r[i]]=e[r[i]])}return s};class o extends r.PureComponent{constructor(){super(...arguments),Object.defineProperty(this,"onShowFormButtonClick",{enumerable:!0,configurable:!0,writable:!0,value:e=>{0===e.button&&(this.props.onFormOpen(),(0,n.Y1)({reportableId:this.props.reportableId,reportableType:this.props.reportableType,username:this.props.user.username}))}})}render(){const e=this.props,{icon:t,onFormOpen:s,reportableId:o,reportableType:l,user:c}=e,u=a(e,["icon","onFormOpen","reportableId","reportableType","user"]),d=n.Hd[this.props.reportableType],p=(0,i.dW)(`report.${d}.button`);return r.createElement("button",Object.assign({onClick:this.onShowFormButtonClick,type:"button"},u),t?r.createElement("span",{className:"textual-button textual-button--inline"},r.createElement("i",{className:"textual-button__icon fas fa-exclamation-triangle"})," ",p):p)}}Object.defineProperty(o,"defaultProps",{enumerable:!0,configurable:!0,writable:!0,value:{icon:!1,onFormOpen:()=>{}}})},6625:(e,t,s)=>{s.d(t,{Z:()=>E});var r=s(3890),i=s(8949),n=s(9323),a=s(7294),o=s(1270),l=s(7292),c=s(6793),u=s(4403),d=s(6871),p=s(3664),m=s(381),h=s(7629),b=s(3336),f=function(e,t,s,r){var i,n=arguments.length,a=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(n<3?i(a):n>3?i(t,s,a):i(t,s))||a);return n>3&&a&&Object.defineProperty(t,s,a),a};let v=class extends a.Component{get playlistItemCount(){return this.props.room.active?this.props.room.playlist_item_stats.count_active:this.props.room.playlist_item_stats.count_total}get status(){if(!this.props.room.active)return"ended";if(null==this.props.room.ends_at)return"active";return new Date(this.props.room.ends_at).getTime()-(new Date).getTime()<36e5?"soon":"active"}constructor(e){super(e),(0,i.rC)(this)}render(){const e=this.props.room.ends_at;return a.createElement("div",{className:"multiplayer-room"},this.renderCover(),a.createElement("div",{className:"multiplayer-room__content"},a.createElement("div",{className:"multiplayer-room__badge-container"},a.createElement("div",{className:(0,b.sb)("multiplayer-room__badge",[this.status])},(0,o.dW)(`multiplayer.room.status.${this.status}`)),null!=e&&a.createElement("time",{className:"js-tooltip-time u-hover",title:e},"ended"===this.status?m(e).fromNow():(0,o.dW)("multiplayer.room.time_left",{time:m(e).fromNow(!0)}))),a.createElement("div",{className:"multiplayer-room__details"},a.createElement("div",{className:"multiplayer-room__name"},this.props.room.name),this.renderMembers()),a.createElement("div",{className:"multiplayer-room__badge-container multiplayer-room__badge-container--bottom"},a.createElement("div",{className:(0,b.sb)("multiplayer-room__badge",["map-count"])},(0,o.jn)("multiplayer.room.map_count",this.playlistItemCount)),a.createElement("div",{className:"multiplayer-room__difficulty",style:{"--max-difficulty":(0,h.yh)(this.props.room.difficulty_range.max),"--min-difficulty":(0,h.yh)(this.props.room.difficulty_range.min)}},a.createElement(c.Z,{rating:this.props.room.difficulty_range.min}),this.props.room.difficulty_range.max!==this.props.room.difficulty_range.min&&a.createElement(c.Z,{rating:this.props.room.difficulty_range.max})))))}renderCover(){var e,t;return a.createElement("a",{className:"multiplayer-room__cover-container",href:(0,p.B)("multiplayer.rooms.show",{room:this.props.room.id})},a.createElement(l.Z,{beatmapset:null===(t=null===(e=this.props.room.current_playlist_item)||void 0===e?void 0:e.beatmap)||void 0===t?void 0:t.beatmapset,modifiers:"full",size:"cover"}))}renderHost(){return a.createElement("div",{className:"multiplayer-room__host"},a.createElement(u.Z,{mappings:{user:a.createElement(d.Z,{className:"u-hover",user:this.props.room.host})},pattern:(0,o.dW)("multiplayer.room.hosted_by")}))}renderMembers(){return a.createElement("div",{className:"multiplayer-room__members"},this.renderHost(),this.renderParticipants())}renderParticipants(){return a.createElement("div",{className:"multiplayer-room__participants"},(0,o.jn)("multiplayer.room.player_count",this.props.room.participant_count))}};f([i.Fl],v.prototype,"status",null),v=f([n.Pi],v);const g=v;var y=s(9755),w=function(e,t,s,r){var i,n=arguments.length,a=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(n<3?i(a):n>3?i(t,s,a):i(t,s))||a);return n>3&&a&&Object.defineProperty(t,s,a),a};let _=class extends a.Component{get hasMore(){return null!=this.props.store.cursorString}constructor(e){super(e),Object.defineProperty(this,"loading",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"handleShowMore",{enumerable:!0,configurable:!0,writable:!0,value:()=>{if(this.loading)return;this.loading=!0;const e=this.props.showMoreUrl;y.getJSON(e,{cursor_string:this.props.store.cursorString}).done((0,i.aD)((e=>{this.props.store.updateWithJson(e)}))).always((0,i.aD)((()=>{this.loading=!1})))}}),(0,i.rC)(this)}render(){const e=null!=this.props.typeGroup?(0,o.dW)("multiplayer.empty._",{type_group:(0,o.dW)(`multiplayer.empty.${this.props.typeGroup}`)}):(0,o.dW)("rankings.seasons.empty");return 0===this.props.store.rooms.length?a.createElement("div",{className:"room-list"},e):a.createElement("div",{className:"room-list"},this.props.store.rooms.map((e=>a.createElement(g,{key:e.id,room:e}))),a.createElement(r.Z,{callback:this.handleShowMore,hasMore:this.hasMore,loading:this.loading}))}};w([i.LO],_.prototype,"loading",void 0),w([i.Fl],_.prototype,"hasMore",null),w([i.aD],_.prototype,"handleShowMore",void 0),_=w([n.Pi],_);const E=_},1956:(e,t,s)=>{s.d(t,{Z:()=>p});var r=s(8949),i=s(9323),n=s(7181),a=s(7294),o=s(9703),l=s(1270),c=s(3599),u=function(e,t,s,r){var i,n=arguments.length,a=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(n<3?i(a):n>3?i(t,s,a):i(t,s))||a);return n>3&&a&&Object.defineProperty(t,s,a),a};let d=class extends a.Component{get isPinned(){return n.Z.scorePins.isPinned(this.props.score)}get label(){const e=this.isPinned?"0":"1";return(0,l.dW)(`users.show.extra.top_ranks.pin.to_${e}`)}constructor(e){super(e),Object.defineProperty(this,"onUpdateCallbacks",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"onClick",{enumerable:!0,configurable:!0,writable:!0,value:()=>{const e=this.isPinned?"0":"1";this.onUpdateCallbacks={done:this.props.onUpdate,fail:(0,o.Gi)(this.onClick)},n.Z.scorePins.apiPin(this.props.score,!this.isPinned).done((()=>{var t,s;(0,c.g)((0,l.dW)(`users.show.extra.top_ranks.pin.to_${e}_done`),"info"),null===(s=null===(t=this.onUpdateCallbacks)||void 0===t?void 0:t.done)||void 0===s||s.call(t)})).fail(((e,t)=>{var s;return null===(s=this.onUpdateCallbacks)||void 0===s?void 0:s.fail(e,t)}))}}),(0,r.rC)(this)}componentWillUnmount(){this.onUpdateCallbacks=null}render(){return a.createElement("button",{className:this.props.className,onClick:this.onClick,type:"button"},this.label)}};u([r.Fl],d.prototype,"isPinned",null),u([r.Fl],d.prototype,"label",null),d=u([i.Pi],d);const p=d},7018:(e,t,s)=>{s.d(t,{Z:()=>d});var r=s(8949),i=s(9323),n=s(7294),a=s(3857),o=s(3336),l=function(e,t,s,r){var i,n=arguments.length,a=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(n<3?i(a):n>3?i(t,s,a):i(t,s))||a);return n>3&&a&&Object.defineProperty(t,s,a),a};const c="select-options";let u=class extends n.Component{constructor(e){super(e),Object.defineProperty(this,"ref",{enumerable:!0,configurable:!0,writable:!0,value:n.createRef()}),Object.defineProperty(this,"showingSelector",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"hideSelector",{enumerable:!0,configurable:!0,writable:!0,value:e=>{0!==e.button||null==this.ref.current||e.composedPath().includes(this.ref.current)||(this.showingSelector=!1)}}),Object.defineProperty(this,"optionSelected",{enumerable:!0,configurable:!0,writable:!0,value:(e,t)=>{var s,r;0===e.button&&(e.preventDefault(),this.showingSelector=!1,null===(r=(s=this.props).onChange)||void 0===r||r.call(s,t))}}),Object.defineProperty(this,"toggleSelector",{enumerable:!0,configurable:!0,writable:!0,value:e=>{0===e.button&&(e.preventDefault(),this.showingSelector=!this.showingSelector)}}),(0,r.rC)(this),(0,i.b4)(this,(0,r.EH)((()=>{(0,a.z4)(this.props.blackout&&this.showingSelector,.5)})))}componentDidMount(){document.addEventListener("click",this.hideSelector)}componentWillUnmount(){document.removeEventListener("click",this.hideSelector)}render(){var e;const t=(0,o.sb)(c,{selecting:this.showingSelector},this.props.modifiers);return n.createElement("div",{ref:this.ref,className:t},n.createElement("div",{className:`${c}__select`},this.renderOption({children:n.createElement(n.Fragment,null,n.createElement("div",{className:"u-ellipsis-overflow"},null===(e=this.props.selected)||void 0===e?void 0:e.text),n.createElement("div",{className:`${c}__decoration`},n.createElement("span",{className:"fas fa-chevron-down"}))),onClick:this.toggleSelector,option:this.props.selected})),n.createElement("div",{className:`${c}__selector`},this.renderOptions()))}renderOption({children:e,onClick:t,option:s,selected:r=!1}){const i=(0,o.sb)(`${c}__option`,{selected:r});return null!=this.props.renderOption?this.props.renderOption({children:e,cssClasses:i,onClick:t,option:s}):n.createElement("a",{key:s.id,className:i,href:"#",onClick:t},e)}renderOptions(){return this.props.options.map((e=>{var t;return this.renderOption({children:n.createElement("div",{className:"u-ellipsis-overflow"},e.text),onClick:t=>{this.optionSelected(t,e)},option:e,selected:(null===(t=this.props.selected)||void 0===t?void 0:t.id)===e.id})}))}};Object.defineProperty(u,"defaultProps",{enumerable:!0,configurable:!0,writable:!0,value:{blackout:!0}}),l([r.LO],u.prototype,"showingSelector",void 0),l([r.aD],u.prototype,"hideSelector",void 0),l([r.aD],u.prototype,"optionSelected",void 0),l([r.aD],u.prototype,"toggleSelector",void 0),u=l([i.Pi],u);const d=u},3890:(e,t,s)=>{s.d(t,{Z:()=>u});var r=s(7294),i=s(3336),n=s(1270),a=s(6741),o=s(9755);const l="show-more-link";class c extends r.PureComponent{constructor(){super(...arguments),Object.defineProperty(this,"onClick",{enumerable:!0,configurable:!0,writable:!0,value:()=>{null==this.props.callback?null==this.props.url&&null!=this.props.event&&o.publish(this.props.event,this.props.data):this.props.callback(this.props.data)}})}render(){if(!this.props.hasMore&&!this.props.loading)return null;const e={children:this.children(),className:(0,i.sb)(l,this.props.modifiers)};return this.props.loading?r.createElement("span",Object.assign({"data-disabled":"1"},e)):null==this.props.url?r.createElement("button",Object.assign({onClick:this.onClick,type:"button"},e)):r.createElement("a",Object.assign({href:this.props.url,onClick:this.onClick},e))}children(){var e,t;const s=r.createElement("span",{className:`fas fa-angle-${null!==(e=this.props.direction)&&void 0!==e?e:"down"}`});return r.createElement(r.Fragment,null,r.createElement("span",{className:`${l}__spinner`},r.createElement(a.$,null)),r.createElement("span",{className:`${l}__label`},r.createElement("span",{className:`${l}__label-icon ${l}__label-icon--left`},s),r.createElement("span",{className:`${l}__label-text`},null!==(t=this.props.label)&&void 0!==t?t:(0,n.dW)("common.buttons.show_more"),null!=this.props.remaining&&` (${this.props.remaining})`),r.createElement("span",{className:`${l}__label-icon ${l}__label-icon--right`},s)))}}Object.defineProperty(c,"defaultProps",{enumerable:!0,configurable:!0,writable:!0,value:{hasMore:!1,loading:!1}});const u=c},2873:(e,t,s)=>{s.d(t,{P:()=>o});var r=s(7181),i=s(7294),n=s(3336),a=s(1270);class o extends i.PureComponent{render(){var e;const t=this.props.values.map((e=>{var t,s;let n="sort__item sort__item--button";return this.props.currentValue===e&&(n+=" sort__item--active"),i.createElement("button",{key:e,className:n,"data-value":e,onClick:this.props.onChange},"rank"===e?i.createElement("span",null,i.createElement("i",{className:`fas fa-extra-mode-${null!==(s=null===(t=r.Z.currentUser)||void 0===t?void 0:t.playmode)&&void 0!==s?s:"osu"}`})," ",(0,a.dW)("sort.rank")):(0,a.dW)(`${this.props.transPrefix}${e}`))}));return i.createElement("div",{className:(0,n.sb)("sort",this.props.modifiers)},i.createElement("div",{className:"sort__items"},this.props.showTitle&&i.createElement("span",{className:"sort__item sort__item--title"},null!==(e=this.props.title)&&void 0!==e?e:(0,a.dW)("sort._")),t))}}Object.defineProperty(o,"defaultProps",{enumerable:!0,configurable:!0,writable:!0,value:{showTitle:!0,transPrefix:"sort."}})},6741:(e,t,s)=>{s.d(t,{$:()=>n});var r=s(7294),i=s(3336);function n(e){return r.createElement("span",{className:(0,i.sb)("la-ball-clip-rotate",e.modifiers)})}},4403:(e,t,s)=>{s.d(t,{Z:()=>i});var r=s(7294);function i(e){const t=Object.keys(e.mappings).sort(((e,t)=>e<t?1:-1));if(0===t.length)return r.createElement(r.Fragment,null,e.pattern);const s=new RegExp(`(:${t.join("|:")})`),i=e.pattern.split(s);return r.createElement(r.Fragment,null,i.map((t=>{const s=":"===t[0]?t.slice(1):null,i=null==s||null==e.mappings[s]?t:e.mappings[s];return"string"==typeof i?i:r.createElement(r.Fragment,{key:t},i)})))}},6568:(e,t,s)=>{s.d(t,{_:()=>o});var r=s(6486),i=s(7294),n=s(3336),a=s(1270);const o=e=>{var t;const s=(0,n.sb)("supporter-icon",e.modifiers);return i.createElement("span",{className:s,title:(0,a.dW)("users.show.is_supporter")},(0,r.times)(null!==(t=e.level)&&void 0!==t?t:1,(e=>i.createElement("span",{key:e,className:"fas fa-heart"}))))}},2163:(e,t,s)=>{s.d(t,{Z:()=>l});var r=s(3682),i=s(7294),n=s(3924),a=function(e,t){var s={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(s[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(s[r[i]]=e[r[i]])}return s};class o extends i.PureComponent{get maxHeight(){return null!=this.props.maxRows&&null!=this.state.lineHeight?this.state.lineHeight*(this.props.maxRows+1):null}constructor(e){var t;super(e),Object.defineProperty(this,"ref",{enumerable:!0,configurable:!0,writable:!0,value:null!==(t=this.props.innerRef)&&void 0!==t?t:i.createRef()}),Object.defineProperty(this,"shouldUpdate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"handleInput",{enumerable:!0,configurable:!0,writable:!0,value:e=>{var t,s;this.shouldUpdate=!1,null===(s=(t=this.props).onInput)||void 0===s||s.call(t,e)}}),this.state={}}componentDidMount(){var e;null!=this.ref.current&&(null!=this.props.maxRows||(0,n.W)(null===(e=this.props.value)||void 0===e?void 0:e.toString())?window.setTimeout((()=>{if(null!=this.ref.current){if(null!=this.props.maxRows){const e=Math.ceil(parseFloat(window.getComputedStyle(this.ref.current).getPropertyValue("line-height")));this.setState({lineHeight:e})}(0,r.Z)(this.ref.current)}}),0):(0,r.Z)(this.ref.current))}componentDidUpdate(){null!=this.ref.current&&("hidden"!==this.ref.current.style.overflowX&&(this.ref.current.style.overflowX="hidden"),this.shouldUpdate?r.Z.update(this.ref.current):this.shouldUpdate=!0)}componentWillUnmount(){null!=this.ref.current&&r.Z.destroy(this.ref.current)}render(){const e=this.props,{innerRef:t,onInput:s,maxRows:r,style:n}=e,o=a(e,["innerRef","onInput","maxRows","style"]),l=this.maxHeight;return i.createElement("textarea",Object.assign({ref:this.ref,onInput:this.handleInput,style:null!=l?Object.assign(Object.assign({},n),{maxHeight:l}):n},o))}}Object.defineProperty(o,"defaultProps",{enumerable:!0,configurable:!0,writable:!0,value:{async:!1,rows:1}});const l=o},12:(e,t,s)=>{s.d(t,{Z:()=>a});var r=s(381),i=s(7294),n=function(e,t){var s={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(s[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(s[r[i]]=e[r[i]])}return s};function a(e){const{dateTime:t,format:s="ll",relative:a=!1}=e,o=n(e,["dateTime","format","relative"]),l="string"==typeof t?t:t.format();let c,u=l;if(a)c="js-timeago";else{c="js-tooltip-time";u=("string"==typeof t?r(t):t).format(s)}return i.createElement("time",Object.assign({className:c,dateTime:l,title:l},o),u)}},9270:(e,t,s)=>{s.d(t,{Z:()=>u});var r=s(3664),i=s(7294),n=s(3336),a=s(3775),o=s(1270),l=s(3924);class c extends i.PureComponent{get artist(){var e;return"artist"in this.props?null!==(e=this.props.track.artist)&&void 0!==e?e:this.props.artist:this.props.track.artist}render(){let e=(0,n.sb)("artist-track",{original:this.props.track.exclusive},this.props.modifiers);return e+=" js-audio--player",i.createElement("div",{className:e,"data-audio-url":this.props.track.preview},i.createElement("div",{className:"artist-track__col artist-track__col--preview",style:{backgroundImage:(0,n.eF)(this.props.track.cover_url)}},i.createElement("button",{className:"artist-track__button artist-track__button--play js-audio--play"},i.createElement("span",{className:"fa-fw play-button"}))),i.createElement("div",{className:"artist-track__col artist-track__col--names"},i.createElement("div",{className:"artist-track__title u-ellipsis-overflow"},this.props.track.title,(0,l.W)(this.props.track.version)&&i.createElement(i.Fragment,null," ",i.createElement("span",{className:"artist-track__version"},this.props.track.version))),i.createElement("div",{className:"artist-track__info"},i.createElement("a",{href:(0,r.B)("artists.show",{artist:this.artist.id})},this.artist.name)),this.props.showAlbum&&null!=this.props.track.album&&i.createElement("div",{className:"artist-track__info"},i.createElement("a",{href:`${(0,r.B)("artists.show",{artist:this.artist.id})}#album-${this.props.track.album_id}`},this.props.track.album.title))),i.createElement("div",{className:"artist-track__col artist-track__col--badges"},this.props.track.exclusive&&i.createElement("span",{className:"pill-badge pill-badge--pink pill-badge--with-shadow",title:(0,o.dW)("artist.songs.original")},(0,o.dW)("artist.songs.original_badge")),this.props.track.is_new&&i.createElement("span",{className:"pill-badge pill-badge--yellow pill-badge--with-shadow"},(0,o.dW)("common.badges.new"))),i.createElement("div",{className:"artist-track__col artist-track__col--details"},i.createElement("div",{className:"u-ellipsis-overflow artist-track__detail artist-track__detail--genre"},this.props.track.genre),i.createElement("div",{className:"artist-track__detail artist-track__detail--bpm"},(0,a.uf)(this.props.track.bpm),"bpm"),i.createElement("div",{className:"artist-track__detail artist-track__detail--length"},this.props.track.length)),i.createElement("div",{className:"artist-track__col artist-track__col--buttons"},i.createElement("a",{className:"artist-track__button",href:this.props.track.osz,title:(0,o.dW)("artist.beatmaps.download")},i.createElement("span",{className:"fas fa-fw fa-download"}))))}}Object.defineProperty(c,"defaultProps",{enumerable:!0,configurable:!0,writable:!0,value:{showAlbum:!1}});const u=c},4929:(e,t,s)=>{s.d(t,{Z:()=>n});var r=s(7294),i=s(3336);function n(e){var t;return r.createElement("span",{className:(0,i.sb)("avatar","guest",e.modifiers),style:{backgroundImage:(0,i.eF)(null===(t=e.user)||void 0===t?void 0:t.avatar_url)}})}},9815:(e,t,s)=>{s.d(t,{Z:()=>m});var r=s(3664),i=s(8949),n=s(9323),a=s(7181),o=s(7294),l=s(5225),c=s(3336),u=s(9755),d=function(e,t,s,r){var i,n=arguments.length,a=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(n<3?i(a):n>3?i(t,s,a):i(t,s))||a);return n>3&&a&&Object.defineProperty(t,s,a),a};let p=class extends o.Component{get friendModifier(){var e;if(null==(null===(e=a.Z.currentUser)||void 0===e?void 0:e.friends))return;const t=a.Z.currentUser.friends.find((e=>e.target_id===this.props.user.id));if(null!=t){if(t.mutual)return"mutual";if(!this.context.isFriendsPage)return"friend"}}constructor(e){super(e),Object.defineProperty(this,"ref",{enumerable:!0,configurable:!0,writable:!0,value:o.createRef()}),Object.defineProperty(this,"handleRemoveClick",{enumerable:!0,configurable:!0,writable:!0,value:()=>{var e,t;null===(t=(e=this.props).onRemoveClick)||void 0===t||t.call(e,this.props.user)}}),(0,i.rC)(this)}componentWillUnmount(){u.publish("user-card:remove",this.ref.current)}render(){const e=(0,c.sb)("user-card-brick",this.props.modifiers,this.friendModifier),t=null!=this.props.user.groups&&this.props.user.groups.length>0?this.props.user.groups[0]:void 0;return o.createElement("div",{ref:this.ref,className:`js-usercard ${e}`,"data-user-id":this.props.user.id},o.createElement("a",{className:"user-card-brick__link",href:(0,r.B)("users.show",{user:this.props.user.id})},o.createElement("div",{className:"user-card-brick__group-bar",style:(0,c.$$)(t),title:null==t?void 0:t.name}),o.createElement("div",{className:"user-card-brick__username u-ellipsis-overflow"},this.props.user.username)),null!=this.props.onRemoveClick&&o.createElement("button",{className:"user-card-brick__remove",onClick:this.handleRemoveClick},o.createElement("span",{className:"fas fa-times"})))}};Object.defineProperty(p,"contextType",{enumerable:!0,configurable:!0,writable:!0,value:l.Z}),d([i.Fl],p.prototype,"friendModifier",null),p=d([n.Pi],p);const m=p},4888:(e,t,s)=>{s.d(t,{O:()=>P,o:()=>O});var r=s(5069),i=s(1759),n=s(3664),a=s(6486),o=s(7181),l=s(7294),c=s(3336),u=s(1270),d=s(3924),p=s(5076),m=s(5523),h=s(7454),b=s(596),f=s(2325),v=s(6741),g=s(4403),y=s(6568),w=s(12),_=s(9815),E=s(6407);const O=["card","list","brick"];class P extends l.PureComponent{constructor(){super(...arguments),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:{avatarLoaded:!1,backgroundLoaded:!1}}),Object.defineProperty(this,"url",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onAvatarLoad",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.setState({avatarLoaded:!0})}}),Object.defineProperty(this,"onBackgroundLoad",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.setState({backgroundLoaded:!0})}})}get canMessage(){var e,t;return!this.isSelf&&null==a.find(null!==(t=null===(e=o.Z.currentUser)||void 0===e?void 0:e.blocks)&&void 0!==t?t:[],{target_id:this.user.id})}get isOnline(){return this.user.is_online}get isSelf(){return null!=o.Z.currentUser&&o.Z.currentUser.id===this.user.id}get isUserLoaded(){return Number.isFinite(this.user.id)&&this.user.id>0}get isUserNotFound(){return-1===this.user.id}get isUserVisible(){return this.isUserLoaded&&!this.user.is_deleted}get user(){return this.props.user||P.userLoading}render(){if("brick"===this.props.mode)return null==this.props.user?null:l.createElement(_.Z,Object.assign({},this.props,{user:this.props.user}));const e=(0,c.sb)("user-card",this.props.modifiers,this.props.mode,this.props.activated?"active":"highlightable");return this.url=this.isUserVisible?(0,n.B)("users.show",{user:this.user.id}):void 0,l.createElement("div",{className:e},this.renderBackground(),l.createElement("div",{className:"user-card__card"},l.createElement("div",{className:"user-card__content user-card__content--details"},l.createElement("div",{className:"user-card__user"},this.renderAvatar()),l.createElement("div",{className:"user-card__details"},this.renderIcons(),l.createElement("div",{className:"user-card__username-row"},this.renderUsername(),l.createElement("div",{className:"user-card__group-badges"},l.createElement(E.Z,{groups:this.user.groups,short:!0,wrapper:"user-card__group-badge"}))),this.renderListModeIcons())),this.renderStatusBar()))}renderAvatar(){const e={loaded:this.state.avatarLoaded},t=(0,d.W)(this.user.avatar_url)&&!this.isUserNotFound;return l.createElement("div",{className:"user-card__avatar-space"},l.createElement("div",{className:(0,c.sb)("user-card__avatar-spinner",e)},t&&l.createElement(v.$,{modifiers:e})),this.isUserLoaded&&t&&l.createElement("img",{className:(0,c.sb)("user-card__avatar",e),onError:this.onAvatarLoad,onLoad:this.onAvatarLoad,src:this.user.avatar_url}))}renderBackground(){var e;let t,s;const r=(0,c.sb)("user-card__background-overlay",this.isOnline?["online"]:[]);if(null!=(null===(e=this.user.cover)||void 0===e?void 0:e.url)){let e="user-card__background";this.state.backgroundLoaded||(e+=" user-card__background--loading"),t=l.createElement(l.Fragment,null,l.createElement("img",{className:e,onLoad:this.onBackgroundLoad,src:this.user.cover.url}),l.createElement("div",{className:r}))}else t=l.createElement("div",{className:r});return s=this.isUserVisible?l.createElement("a",{className:"user-card__background-container",href:this.url},t):t,s}renderIcons(){return this.isUserVisible?l.createElement("div",{className:"user-card__icons user-card__icons--card"},l.createElement("a",{className:"user-card__icon user-card__icon--flag",href:(0,n.B)("rankings",{country:this.user.country_code,mode:"osu",type:"performance"})},l.createElement(m.Z,{country:this.user.country})),"card"===this.props.mode&&l.createElement(l.Fragment,null,this.user.is_supporter&&l.createElement("a",{className:"user-card__icon",href:(0,n.B)("support-the-game")},l.createElement(y._,{modifiers:["user-card"]})),l.createElement("div",{className:"user-card__icon"},l.createElement(i.Z,{modifiers:"user-card",userId:this.user.id})),!this.user.is_bot&&l.createElement("div",{className:"user-card__icon"},l.createElement(h.Z,{modifiers:["user-card"],userId:this.user.id})))):null}renderListModeIcons(){return"list"===this.props.mode&&this.isUserVisible?l.createElement("div",{className:"user-card__icons"},this.user.is_supporter&&l.createElement("a",{className:"user-card__icon",href:(0,n.B)("support-the-game")},l.createElement(y._,{level:this.user.support_level,modifiers:["user-list"]})),l.createElement("div",{className:"user-card__icon"},l.createElement(i.Z,{modifiers:"user-list",userId:this.user.id})),!this.user.is_bot&&l.createElement("div",{className:"user-card__icon"},l.createElement(h.Z,{modifiers:["user-list"],userId:this.user.id}))):null}renderMenuButton(){if(this.isSelf)return null;return l.createElement("div",{className:"user-card__icon user-card__icon--menu"},l.createElement(b.Y,null,(e=>l.createElement("div",{className:"simple-menu"},this.canMessage&&l.createElement("a",{className:"simple-menu__item js-login-required--click",href:(0,n.B)("messages.users.show",{user:this.user.id}),onClick:e},l.createElement("span",{className:"fas fa-envelope"}),` ${(0,u.dW)("users.card.send_message")}`),l.createElement("a",{className:"simple-menu__item",href:(0,p.tB)(this.user),onClick:e},l.createElement("span",{className:"fas fa-gift"}),` ${(0,u.dW)("users.card.gift_supporter")}`),l.createElement(r.Z,{modifiers:"inline",onClick:e,userId:this.user.id,wrapperClass:"simple-menu__item"}),l.createElement(f.c,{className:"simple-menu__item",icon:!0,onFormOpen:e,reportableId:this.user.id.toString(),reportableType:"user",user:this.user})))))}renderStatusBar(){if(!this.isUserVisible)return null;const e=this.isOnline?(0,u.dW)("users.status.online"):(0,u.dW)("users.status.offline");return l.createElement("div",{className:"user-card__content user-card__content--status"},l.createElement("div",{className:"user-card__status"},this.renderStatusIcon(),l.createElement("div",{className:"user-card__status-messages"},l.createElement("span",{className:"user-card__status-message user-card__status-message--sub u-ellipsis-overflow"},!this.isOnline&&null!=this.user.last_visit&&l.createElement(g.Z,{mappings:{date:l.createElement(w.Z,{dateTime:this.user.last_visit,relative:!0})},pattern:(0,u.dW)("users.show.lastvisit")})),l.createElement("span",{className:"user-card__status-message u-ellipsis-overflow"},e))),l.createElement("div",{className:"user-card__icons user-card__icons--menu"},this.renderMenuButton()))}renderStatusIcon(){return this.isUserVisible?l.createElement("div",{className:"user-card__status-icon-container"},l.createElement("div",{className:"user-card__status-icon user-card__status-icon--"+(this.isOnline?"online":"offline")})):null}renderUsername(){const e=this.user.is_deleted?(0,u.dW)("users.deleted"):this.user.username;return null==this.url?l.createElement("div",{className:"user-card__username u-ellipsis-pre-overflow"},e):l.createElement("a",{className:"user-card__username u-ellipsis-pre-overflow",href:this.url},e)}}Object.defineProperty(P,"defaultProps",{enumerable:!0,configurable:!0,writable:!0,value:{activated:!1,mode:"card"}}),Object.defineProperty(P,"userLoading",{enumerable:!0,configurable:!0,writable:!0,value:{avatar_url:"",country_code:"",cover:{custom_url:null,id:null,url:null},default_group:"",id:0,is_active:!1,is_bot:!1,is_deleted:!1,is_online:!1,is_supporter:!1,last_visit:"",pm_friends_only:!0,profile_colour:"",username:(0,u.dW)("users.card.loading")}})},8293:(e,t,s)=>{s.d(t,{G:()=>o});var r=s(7294),i=s(8259),n=s(3336),a=s(4888);class o extends r.PureComponent{constructor(){super(...arguments),Object.defineProperty(this,"activeKeyDidChange",{enumerable:!0,configurable:!0,writable:!0,value:i.Gw.bind(this)}),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:{}})}render(){const e={"menu-active":null!=this.state.activeKey,[this.props.viewMode]:!0};return r.createElement(i.Xl.Provider,{value:{activeKeyDidChange:this.activeKeyDidChange}},r.createElement("div",{className:(0,n.sb)("user-cards",e)},this.props.users.map((e=>{const t=this.state.activeKey===e.id;return r.createElement(i.XI.Provider,{key:e.id,value:e.id},r.createElement(a.O,{activated:t,mode:this.props.viewMode,modifiers:(0,n.sw)("has-outline",this.props.modifiers),user:e}))}))))}}},4318:(e,t,s)=>{s.d(t,{Z:()=>o});var r=s(3664),i=s(7294),n=s(3336),a=s(1270);function o({group:e,modifiers:t}){if(null==e)return null;let s,o=e.name;if(null!=e.playmodes&&e.playmodes.length>0){s=i.createElement("div",{className:"user-group-badge__modes"},e.playmodes.map((e=>i.createElement("i",{key:e,className:`fal fa-extra-mode-${e}`}))));o+=` (${e.playmodes.map((e=>(0,a.dW)(`beatmaps.mode.${e}`))).join(", ")})`}const l={children:s,className:(0,n.sb)("user-group-badge",{probationary:e.is_probationary},e.identifier,t),"data-label":e.short_name,style:(0,n.$$)(e),title:o};return e.has_listing?i.createElement("a",Object.assign({},l,{href:(0,r.B)("groups.show",{group:e.id})})):i.createElement("div",Object.assign({},l))}},6407:(e,t,s)=>{s.d(t,{Z:()=>n});var r=s(7294),i=s(4318);function n(e){const{groups:t=[],modifiers:s,short:n=!1,wrapper:a}=e;let o=!1;return r.createElement(r.Fragment,null,t.map((e=>{const t=n&&o?`${a} u-hidden-narrow`:a;return o=!0,r.createElement("span",{key:e.identifier,className:t},r.createElement(i.Z,{group:e,modifiers:s}))})))}},6871:(e,t,s)=>{s.d(t,{Z:()=>n});var r=s(3664),i=s(7294);class n extends i.PureComponent{render(){var e,t;let s="js-usercard";null!=this.props.className&&(s+=` ${this.props.className}`);const n=(null!==(e=this.props.user.id)&&void 0!==e?e:-1)>0?(0,r.B)("users.show",{mode:this.props.mode,user:this.props.user.id}):void 0;return i.createElement("a",{className:s,"data-tooltip-position":this.props.tooltipPosition,"data-user-id":this.props.user.id,href:n},null!==(t=this.props.children)&&void 0!==t?t:this.props.user.username)}}},2009:(e,t,s)=>{s.d(t,{N:()=>c,Z:()=>u});var r=s(4929),i=s(6871),n=s(7294),a=s(1270),o=s(9755);const l={"right center":"left center","top center":"bottom center"};function c(e,t,s){if("1"!==e._tooltip)return e._tooltip="1",o(e).qtip({content:{text:s},hide:{delay:500,effect(){o(this).fadeTo(250,0)},fixed:!0},position:{at:t,my:l[t],viewport:o(window)},show:{delay:100,effect(){o(this).fadeTo(110,1)},ready:!0},style:{classes:"qtip qtip--user-list",def:!1,tip:!1}})}function u(e){return n.createElement("div",{className:"user-list-popup"},e.title,e.users.length>0&&n.createElement("div",{className:"user-list-popup__users"},e.users.map((e=>n.createElement(i.Z,{key:e.id,className:"user-list-popup__user",tooltipPosition:"top right",user:e},n.createElement(r.Z,{modifiers:"full",user:e}))))),e.count>e.users.length&&n.createElement("div",{className:"user-list-popup__remainder-count"},(0,a.jn)("common.count.plus_others",e.count-e.users.length)))}},5629:(e,t,s)=>{s.d(t,{Z:()=>y});var r=s(8125),i=s(381),n=s(7181),a=s(7294),o=s(3336),l=s(1270),c=s(9014),u=s(5076),d=s(2873),p=s(4888),m=s(8293),h=s(2918);const b=["all","online","offline"],f=["all","osu","taiko","fruits","mania"],v=["last_visit","rank","username"];function g(e,t){var s,r,i,n;return(null!==(r=null===(s=e.statistics)||void 0===s?void 0:s.global_rank)&&void 0!==r?r:Number.MAX_VALUE)-(null!==(n=null===(i=t.statistics)||void 0===i?void 0:i.global_rank)&&void 0!==n?n:Number.MAX_VALUE)}class y extends a.PureComponent{constructor(){super(...arguments),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:{filter:this.filterFromUrl,playMode:this.playmodeFromUrl,sortMode:this.sortFromUrl,viewMode:this.viewFromUrl}}),Object.defineProperty(this,"handleSortChange",{enumerable:!0,configurable:!0,writable:!0,value:e=>{const t=e.currentTarget.dataset.value,s=(0,u.bj)(null,{sort:t});h.controller.advanceHistory(s),this.setState({sortMode:t},(()=>{n.Z.userPreferences.set("user_list_sort",this.state.sortMode)}))}}),Object.defineProperty(this,"onViewSelected",{enumerable:!0,configurable:!0,writable:!0,value:e=>{const t=e.currentTarget.dataset.value,s=(0,u.bj)(null,{view:t});h.controller.advanceHistory(s),this.setState({viewMode:t},(()=>{n.Z.userPreferences.set("user_list_view",this.state.viewMode)}))}}),Object.defineProperty(this,"optionSelected",{enumerable:!0,configurable:!0,writable:!0,value:e=>{e.preventDefault();const t=e.currentTarget.dataset.key,s=(0,u.bj)(null,{filter:t});h.controller.advanceHistory(s),this.setState({filter:t},(()=>{n.Z.userPreferences.set("user_list_filter",this.state.filter)}))}}),Object.defineProperty(this,"playmodeSelected",{enumerable:!0,configurable:!0,writable:!0,value:e=>{const t=e.currentTarget.dataset.value,s=(0,u.bj)(null,{mode:t});h.controller.advanceHistory(s),this.setState({playMode:t})}})}get filterFromUrl(){return this.getAllowedQueryStringValue(b,(0,c.Kn)().get("filter"),n.Z.userPreferences.get("user_list_filter"))}get playmodeFromUrl(){return this.getAllowedQueryStringValue(f,(0,c.Kn)().get("mode"),"all")}get sortedUsers(){const e=this.getFilteredUsers(this.state.filter).slice();switch(this.state.sortMode){case"rank":return e.sort(g);case"username":return e.sort(r.gm);default:return e.sort(((e,t)=>{var s,n;return e.is_online&&t.is_online?(0,r.gm)(e,t):e.is_online||t.is_online?e.is_online?-1:1:i(null!==(s=t.last_visit)&&void 0!==s?s:0).diff(i(null!==(n=e.last_visit)&&void 0!==n?n:0))}))}}get sortFromUrl(){return this.getAllowedQueryStringValue(v,(0,c.Kn)().get("sort"),n.Z.userPreferences.get("user_list_sort"))}get viewFromUrl(){return this.getAllowedQueryStringValue(p.o,(0,c.Kn)().get("view"),n.Z.userPreferences.get("user_list_view"))}render(){var e,t;return a.createElement(a.Fragment,null,this.renderSelections(),a.createElement("div",{className:"user-list"},null!=this.props.group&&a.createElement("h1",{className:"user-list__title"},this.props.group.name),null!=(null===(e=this.props.group)||void 0===e?void 0:e.description)&&a.createElement("div",{dangerouslySetInnerHTML:{__html:this.props.group.description.html},className:"user-list__description"}),a.createElement("div",{className:"user-list__toolbar"},(null===(t=this.props.group)||void 0===t?void 0:t.has_playmodes)&&a.createElement("div",{className:"user-list__toolbar-row"},a.createElement("div",{className:"user-list__toolbar-item"},this.renderPlaymodeFilter())),a.createElement("div",{className:"user-list__toolbar-row"},a.createElement("div",{className:"user-list__toolbar-item"},this.renderSorter()),a.createElement("div",{className:"user-list__toolbar-item"},this.renderViewMode()))),a.createElement("div",{className:"user-list__items"},a.createElement(m.G,{users:this.sortedUsers,viewMode:this.state.viewMode}))))}renderOption(e,t,s=!1){const r=s?["active"]:[];let i=(0,o.sb)("update-streams-v2__item",r);return i+=` t-changelog-stream--${e}`,a.createElement("a",{key:e,className:i,"data-key":e,href:(0,u.bj)(null,{filter:e}),onClick:this.optionSelected},a.createElement("div",{className:"update-streams-v2__bar u-changelog-stream--bg"}),a.createElement("p",{className:"update-streams-v2__row update-streams-v2__row--name"},(0,l.dW)(`users.status.${e}`)),a.createElement("p",{className:"update-streams-v2__row update-streams-v2__row--version"},t))}renderSelections(){return a.createElement("div",{className:"update-streams-v2 update-streams-v2--with-active update-streams-v2--user-list"},a.createElement("div",{className:"update-streams-v2__container"},b.map((e=>this.renderOption(e,this.getFilteredUsers(e).length,e===this.state.filter)))))}renderSorter(){return a.createElement(d.P,{currentValue:this.state.sortMode,modifiers:["user-list"],onChange:this.handleSortChange,values:v})}renderViewMode(){return a.createElement("div",{className:"user-list__view-modes"},a.createElement("button",{className:(0,o.sb)("user-list__view-mode","card"===this.state.viewMode?["active"]:[]),"data-value":"card",onClick:this.onViewSelected,title:(0,l.dW)("users.view_mode.card")},a.createElement("span",{className:"fas fa-square"})),a.createElement("button",{className:(0,o.sb)("user-list__view-mode","list"===this.state.viewMode?["active"]:[]),"data-value":"list",onClick:this.onViewSelected,title:(0,l.dW)("users.view_mode.list")},a.createElement("span",{className:"fas fa-bars"})),a.createElement("button",{className:(0,o.sb)("user-list__view-mode","brick"===this.state.viewMode?["active"]:[]),"data-value":"brick",onClick:this.onViewSelected,title:(0,l.dW)("users.view_mode.brick")},a.createElement("span",{className:"fas fa-th"})))}getAllowedQueryStringValue(e,t,s){const r=t;if(e.indexOf(r)>-1)return r;const i=s;return e.indexOf(i)>-1?i:e[0]}getFilteredUsers(e){var t;let s=this.props.users.slice();const r=this.state.playMode;if("all"!==r&&(null===(t=this.props.group)||void 0===t?void 0:t.has_playmodes)){const e=this.props.group.id;s=s.filter((t=>{var s,i,n;return null===(n=null===(i=null===(s=t.groups)||void 0===s?void 0:s.find((t=>t.id===e)))||void 0===i?void 0:i.playmodes)||void 0===n?void 0:n.includes(r)}))}switch(e){case"online":return s.filter((e=>e.is_online));case"offline":return s.filter((e=>!e.is_online));default:return s}}renderPlaymodeFilter(){const e=f.map((e=>a.createElement("button",{key:e,className:(0,o.sb)("user-list__view-mode",this.state.playMode===e?["active"]:[]),"data-value":e,onClick:this.playmodeSelected,title:(0,l.dW)(`beatmaps.mode.${e}`)},"all"===e?a.createElement("span",null,(0,l.dW)("beatmaps.mode.all")):a.createElement("span",{className:`fal fa-extra-mode-${e}`}))));return a.createElement("div",{className:"user-list__view-modes"},a.createElement("span",{className:"user-list__view-mode-title"},(0,l.dW)("users.filtering.by_game_mode"))," ",e)}}},4737:(e,t,s)=>{s.d(t,{Z:()=>m});var r=s(5069),i=s(3430),n=s(8949),a=s(9323),o=s(7181),l=s(7294),c=s(3336),u=s(1270),d=function(e,t,s,r){var i,n=arguments.length,a=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(n<3?i(a):n>3?i(t,s,a):i(t,s))||a);return n>3&&a&&Object.defineProperty(t,s,a),a};let p=class extends l.Component{get isBlocked(){return o.Z.currentUserModel.blocks.has(this.props.user.id)}constructor(e){super(e),Object.defineProperty(this,"forceShow",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"handleClick",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.forceShow=!this.forceShow}}),(0,n.rC)(this)}render(){const e=this.isBlocked&&!this.forceShow;return l.createElement("div",{className:e?"osu-layout__no-scroll":void 0},this.isBlocked&&this.renderBanner(),l.createElement("div",{className:(0,c.sb)("osu-layout","full",{masked:e})},this.props.children))}renderBanner(){const e=l.createElement("div",{className:"grid-items grid-items--notification-banner-buttons"},l.createElement("div",null,l.createElement(r.Z,{userId:this.props.user.id})),l.createElement("div",null,l.createElement("button",{className:"textual-button",onClick:this.handleClick,type:"button"},l.createElement("span",null,l.createElement("i",{className:"textual-button__icon fas fa-low-vision"})," ",this.forceShow?(0,u.dW)("users.blocks.hide_profile"):(0,u.dW)("users.blocks.show_profile")))));return l.createElement("div",{className:"osu-page"},l.createElement(i.Z,{message:e,title:(0,u.dW)("users.blocks.banner_text"),type:"info"}))}};d([n.LO],p.prototype,"forceShow",void 0),d([n.Fl],p.prototype,"isBlocked",null),d([n.aD],p.prototype,"handleClick",void 0),p=d([a.Pi],p);const m=p},7048:(e,t,s)=>{s.d(t,{Z:()=>a});var r=s(7294),i=s(3336);const n="value-display";function a({description:e,label:t,modifiers:s,value:a}){return r.createElement("div",{className:(0,i.sb)(n,s)},r.createElement("div",{className:`${n}__label`},t),r.createElement("div",{className:`${n}__value`},a),null!=e&&r.createElement("div",{className:`${n}__description`},e))}},1689:(e,t,s)=>{s.d(t,{Z:()=>n});var r=s(3664),i=s(1270);function n(e){return[{active:"home"===e,title:(0,i.dW)("home.user.title"),url:(0,r.B)("home")},{active:"friends.index"===e,title:(0,i.dW)("friends.title_compact"),url:(0,r.B)("friends.index")},{active:"follows.index"===e,title:(0,i.dW)("follows.index.title_compact"),url:(0,r.B)("follows.index",{subtype:"forum_topic"})},{active:"account.edit"===e,title:(0,i.dW)("accounts.edit.title_compact"),url:(0,r.B)("account.edit")}]}},6192:(e,t,s)=>{s.d(t,{N:()=>n,R9:()=>r,Uj:()=>i});const r=["ANNOUNCE","PUBLIC","GROUP","PM"],i=new Set(r);function n(e){return e.filter((e=>i.has(e.type)))}},8152:(e,t,s)=>{s.d(t,{U:()=>i,z:()=>r});const r=["osu","taiko","fruits","mania"];function i(e){if(r.includes(e))return e}},3664:(e,t,s)=>{s.d(t,{B:()=>M});var r=s(9014);const i={url:"https://osu.ppy.sh",port:null,defaults:{},routes:{"oauth.passport.token":{uri:"oauth/token",methods:["POST"]},"oauth.authorizations.authorize":{uri:"oauth/authorize",methods:["GET","HEAD"]},"oauth.":{uri:"oauth/authorize",methods:["DELETE"]},"admin.beatmapsets.covers":{uri:"admin/beatmapsets/{beatmapset}/covers",methods:["GET","HEAD"]},"admin.beatmapsets.covers.regenerate":{uri:"admin/beatmapsets/{beatmapset}/covers/regenerate",methods:["POST"]},"admin.beatmapsets.covers.remove":{uri:"admin/beatmapsets/{beatmapset}/covers/remove",methods:["POST"]},"admin.beatmapsets.show":{uri:"admin/beatmapsets/{beatmapset}",methods:["GET","HEAD"]},"admin.beatmapsets.update":{uri:"admin/beatmapsets/{beatmapset}",methods:["PUT","PATCH"]},"admin.contests.get-zip":{uri:"admin/contests/{contest}/zip",methods:["POST"]},"admin.contests.index":{uri:"admin/contests",methods:["GET","HEAD"]},"admin.contests.show":{uri:"admin/contests/{contest}",methods:["GET","HEAD"]},"admin.user-contest-entries.destroy":{uri:"admin/user-contest-entries/{user_contest_entry}",methods:["DELETE"]},"admin.user-contest-entries.restore":{uri:"admin/user-contest-entries/{user_contest_entry}/restore",methods:["POST"]},"admin.logs.index":{uri:"admin/logs",methods:["GET","HEAD"]},"admin.root":{uri:"admin",methods:["GET","HEAD"]},"admin.forum.forum-covers.index":{uri:"admin/forum/forum-covers",methods:["GET","HEAD"]},"admin.forum.forum-covers.store":{uri:"admin/forum/forum-covers",methods:["POST"]},"admin.forum.forum-covers.update":{uri:"admin/forum/forum-covers/{forum_cover}",methods:["PUT","PATCH"]},"artists.tracks.index":{uri:"beatmaps/artists/tracks",methods:["GET","HEAD"]},"artists.index":{uri:"beatmaps/artists",methods:["GET","HEAD"]},"artists.show":{uri:"beatmaps/artists/{artist}",methods:["GET","HEAD"]},"tracks.show":{uri:"beatmaps/artists/tracks/{track}",methods:["GET","HEAD"]},"packs.index":{uri:"beatmaps/packs",methods:["GET","HEAD"]},"packs.show":{uri:"beatmaps/packs/{pack}",methods:["GET","HEAD"]},"beatmaps.":{uri:"beatmaps/{beatmap}/scores/users/{user}",methods:["GET","HEAD"]},"beatmaps.scores":{uri:"beatmaps/{beatmap}/scores",methods:["GET","HEAD"]},"beatmaps.solo-scores":{uri:"beatmaps/{beatmap}/solo-scores",methods:["GET","HEAD"]},"beatmaps.update-owner":{uri:"beatmaps/{beatmap}/update-owner",methods:["PUT"]},"beatmaps.show":{uri:"beatmaps/{beatmap}",methods:["GET","HEAD"]},"redirect:beatmapsets.discussions.index":{uri:"beatmapsets/beatmap-discussions",methods:["GET","HEAD"]},"redirect:beatmapsets.discussions.destroy":{uri:"beatmapsets/beatmap-discussions/{beatmap_discussion}",methods:["DELETE"]},"redirect:beatmapsets.discussions.show":{uri:"beatmapsets/beatmap-discussions/{beatmap_discussion}",methods:["GET","HEAD"]},"redirect:beatmapsets.discussions.vote":{uri:"beatmapsets/beatmap-discussions/{beatmap_discussion}/vote",methods:["PUT"]},"redirect:beatmapsets.discussions.restore":{uri:"beatmapsets/beatmap-discussions/{beatmap_discussion}/restore",methods:["POST"]},"redirect:beatmapsets.discussions.deny-kudosu":{uri:"beatmapsets/beatmap-discussions/{beatmap_discussion}/deny-kudosu",methods:["POST"]},"redirect:beatmapsets.discussions.allow-kudosu":{uri:"beatmapsets/beatmap-discussions/{beatmap_discussion}/allow-kudosu",methods:["POST"]},"redirect:beatmapsets.discussions.posts.destroy":{uri:"beatmapsets/beatmap-discussion-posts/{beatmap_discussion_post}",methods:["DELETE"]},"redirect:beatmapsets.discussions.posts.store":{uri:"beatmapsets/beatmap-discussion-posts/{beatmap_discussion_post}",methods:["POST"]},"redirect:beatmapsets.discussions.posts.update":{uri:"beatmapsets/beatmap-discussion-posts/{beatmap_discussion_post}",methods:["PUT"]},"redirect:beatmapsets.discussions.posts.restore":{uri:"beatmapsets/beatmap-discussion-posts/{beatmap_discussion_post}/restore",methods:["POST"]},"redirect:beatmapsets.discussions.posts.index":{uri:"beatmapsets/beatmap-discussion-posts",methods:["GET","HEAD"]},"beatmapsets.events.index":{uri:"beatmapsets/events",methods:["GET","HEAD"]},"beatmapsets.redirect:follows.index":{uri:"beatmapsets/watches",methods:["GET","HEAD"]},"beatmapsets.watches.update":{uri:"beatmapsets/watches/{watch}",methods:["PUT","PATCH"]},"beatmapsets.watches.destroy":{uri:"beatmapsets/watches/{watch}",methods:["DELETE"]},"beatmapsets.discussions.media-url":{uri:"beatmapsets/discussions/media-url",methods:["GET","HEAD"]},"beatmapsets.discussions.vote":{uri:"beatmapsets/discussions/{discussion}/vote",methods:["PUT"]},"beatmapsets.discussions.restore":{uri:"beatmapsets/discussions/{discussion}/restore",methods:["POST"]},"beatmapsets.discussions.deny-kudosu":{uri:"beatmapsets/discussions/{discussion}/deny-kudosu",methods:["POST"]},"beatmapsets.discussions.allow-kudosu":{uri:"beatmapsets/discussions/{discussion}/allow-kudosu",methods:["POST"]},"beatmapsets.discussions.posts.restore":{uri:"beatmapsets/discussions/posts/{post}/restore",methods:["POST"]},"beatmapsets.discussions.posts.index":{uri:"beatmapsets/discussions/posts",methods:["GET","HEAD"]},"beatmapsets.discussions.posts.store":{uri:"beatmapsets/discussions/posts",methods:["POST"]},"beatmapsets.discussions.posts.show":{uri:"beatmapsets/discussions/posts/{post}",methods:["GET","HEAD"]},"beatmapsets.discussions.posts.update":{uri:"beatmapsets/discussions/posts/{post}",methods:["PUT","PATCH"]},"beatmapsets.discussions.posts.destroy":{uri:"beatmapsets/discussions/posts/{post}",methods:["DELETE"]},"beatmapsets.discussions.votes.index":{uri:"beatmapsets/discussions/votes",methods:["GET","HEAD"]},"beatmapsets.discussions.index":{uri:"beatmapsets/discussions",methods:["GET","HEAD"]},"beatmapsets.discussions.show":{uri:"beatmapsets/discussions/{discussion}",methods:["GET","HEAD"]},"beatmapsets.discussions.destroy":{uri:"beatmapsets/discussions/{discussion}",methods:["DELETE"]},"beatmapsets.favourites.store":{uri:"beatmapsets/{beatmapset}/favourites",methods:["POST"]},"beatmapsets.search":{uri:"beatmapsets/search",methods:["GET","HEAD"]},"beatmapsets.discussion":{uri:"beatmapsets/{beatmapset}/discussion/{beatmap?}/{mode?}/{filter?}",methods:["GET","HEAD"]},"beatmapsets.discussion.review":{uri:"beatmapsets/{beatmapset}/discussion/review",methods:["POST"]},"beatmapsets.discussion-lock":{uri:"beatmapsets/{beatmapset}/discussion-lock",methods:["POST"]},"beatmapsets.discussion-unlock":{uri:"beatmapsets/{beatmapset}/discussion-unlock",methods:["POST"]},"beatmapsets.download":{uri:"beatmapsets/{beatmapset}/download",methods:["GET","HEAD"]},"beatmapsets.love":{uri:"beatmapsets/{beatmapset}/love",methods:["PUT"]},"beatmapsets.remove-from-loved":{uri:"beatmapsets/{beatmapset}/love",methods:["DELETE"]},"beatmapsets.nominate":{uri:"beatmapsets/{beatmapset}/nominate",methods:["PUT"]},"beatmapsets.index":{uri:"beatmapsets",methods:["GET","HEAD"]},"beatmapsets.show":{uri:"beatmapsets/{beatmapset}",methods:["GET","HEAD"]},"beatmapsets.update":{uri:"beatmapsets/{beatmapset}",methods:["PUT","PATCH"]},"beatmapsets.destroy":{uri:"beatmapsets/{beatmapset}",methods:["DELETE"]},"scores.download":{uri:"scores/{score}/download",methods:["GET","HEAD"]},"scores.download-legacy":{uri:"scores/{rulesetOrScore}/{score}/download",methods:["GET","HEAD"]},"scores.show":{uri:"scores/{rulesetOrScore}/{score?}",methods:["GET","HEAD"]},"score-pins.destroy":{uri:"score-pins",methods:["DELETE"]},"score-pins.reorder":{uri:"score-pins",methods:["PUT"]},"score-pins.store":{uri:"score-pins",methods:["POST"]},"client-verifications.create":{uri:"client-verifications/create",methods:["GET","HEAD"]},"client-verifications.store":{uri:"client-verifications",methods:["POST"]},"comments.index":{uri:"comments",methods:["GET","HEAD"]},"comments.store":{uri:"comments",methods:["POST"]},"comments.show":{uri:"comments/{comment}",methods:["GET","HEAD"]},"comments.update":{uri:"comments/{comment}",methods:["PUT","PATCH"]},"comments.destroy":{uri:"comments/{comment}",methods:["DELETE"]},"comments.pin":{uri:"comments/{comment}/pin",methods:["POST"]},"comments.restore":{uri:"comments/{comment}/restore",methods:["POST"]},"comments.vote":{uri:"comments/{comment}/vote",methods:["POST"]},"contests.index":{uri:"community/contests",methods:["GET","HEAD"]},"contests.show":{uri:"community/contests/{contest}",methods:["GET","HEAD"]},"contest-entries.vote":{uri:"community/contest-entries/{contest_entry}/vote",methods:["PUT"]},"contest-entries.store":{uri:"community/contest-entries",methods:["POST"]},"contest-entries.destroy":{uri:"community/contest-entries/{contest_entry}",methods:["DELETE"]},"livestreams.promote":{uri:"community/livestreams/promote",methods:["POST"]},"livestreams.index":{uri:"community/livestreams",methods:["GET","HEAD"]},"matches.show":{uri:"community/matches/{match}",methods:["GET","HEAD"]},"tournaments.unregister":{uri:"community/tournaments/{tournament}/unregister",methods:["POST"]},"tournaments.register":{uri:"community/tournaments/{tournament}/register",methods:["POST"]},"tournaments.index":{uri:"community/tournaments",methods:["GET","HEAD"]},"tournaments.show":{uri:"community/tournaments/{tournament}",methods:["GET","HEAD"]},"forum.forum-covers.store":{uri:"community/forums/forum-covers",methods:["POST"]},"forum.forum-covers.update":{uri:"community/forums/forum-covers/{forum_cover}",methods:["PUT","PATCH"]},"forum.forum-covers.destroy":{uri:"community/forums/forum-covers/{forum_cover}",methods:["DELETE"]},"forum.posts.raw":{uri:"community/forums/posts/{post}/raw",methods:["GET","HEAD"]},"forum.posts.restore":{uri:"community/forums/posts/{post}/restore",methods:["POST"]},"forum.posts.show":{uri:"community/forums/posts/{post}",methods:["GET","HEAD"]},"forum.posts.edit":{uri:"community/forums/posts/{post}/edit",methods:["GET","HEAD"]},"forum.posts.update":{uri:"community/forums/posts/{post}",methods:["PUT","PATCH"]},"forum.posts.destroy":{uri:"community/forums/posts/{post}",methods:["DELETE"]},"forum.topics.logs.index":{uri:"community/forums/topics/{topic}/logs",methods:["GET","HEAD"]},"forum.topics.edit-poll.store":{uri:"community/forums/topics/{topic}/edit-poll",methods:["POST"]},"forum.topics.edit-poll":{uri:"community/forums/topics/{topic}/edit-poll",methods:["GET","HEAD"]},"forum.topics.issue-tag":{uri:"community/forums/topics/{topic}/issue-tag",methods:["POST"]},"forum.topics.lock":{uri:"community/forums/topics/{topic}/lock",methods:["POST"]},"forum.topics.move":{uri:"community/forums/topics/{topic}/move",methods:["POST"]},"forum.topics.pin":{uri:"community/forums/topics/{topic}/pin",methods:["POST"]},"forum.topics.reply":{uri:"community/forums/topics/{topic}/reply",methods:["POST"]},"forum.topics.restore":{uri:"community/forums/topics/{topic}/restore",methods:["POST"]},"forum.topics.vote":{uri:"community/forums/topics/{topic}/vote",methods:["POST"]},"forum.topics.vote-feature":{uri:"community/forums/topics/{topic}/vote-feature",methods:["POST"]},"forum.preview":{uri:"community/forums/topics/preview",methods:["POST"]},"forum.topics.create":{uri:"community/forums/topics/create",methods:["GET","HEAD"]},"forum.topics.store":{uri:"community/forums/topics",methods:["POST"]},"forum.topics.show":{uri:"community/forums/topics/{topic}",methods:["GET","HEAD"]},"forum.topics.update":{uri:"community/forums/topics/{topic}",methods:["PUT","PATCH"]},"forum.topics.destroy":{uri:"community/forums/topics/{topic}",methods:["DELETE"]},"forum.topic-covers.store":{uri:"community/forums/topic-covers",methods:["POST"]},"forum.topic-covers.update":{uri:"community/forums/topic-covers/{topic_cover}",methods:["PUT","PATCH"]},"forum.topic-covers.destroy":{uri:"community/forums/topic-covers/{topic_cover}",methods:["DELETE"]},"forum.redirect:follows.index":{uri:"community/forums/topic-watches",methods:["GET","HEAD"]},"forum.topic-watches.update":{uri:"community/forums/topic-watches/{topic_watch}",methods:["PUT","PATCH"]},"forum.forums.mark-as-read":{uri:"community/forums/mark-as-read",methods:["POST"]},"forum.forums.index":{uri:"community/forums",methods:["GET","HEAD"]},"forum.forums.show":{uri:"community/forums/{forum}",methods:["GET","HEAD"]},"chat.ack":{uri:"community/chat/ack",methods:["POST"]},"chat.new":{uri:"community/chat/new",methods:["POST"]},"chat.presence":{uri:"community/chat/presence",methods:["GET","HEAD"]},"chat.updates":{uri:"community/chat/updates",methods:["GET","HEAD"]},"chat.channels.messages.index":{uri:"community/chat/channels/{channel}/messages",methods:["GET","HEAD"]},"chat.channels.messages.store":{uri:"community/chat/channels/{channel}/messages",methods:["POST"]},"chat.channels.join":{uri:"community/chat/channels/{channel}/users/{user}",methods:["PUT"]},"chat.channels.part":{uri:"community/chat/channels/{channel}/users/{user}",methods:["DELETE"]},"chat.channels.mark-as-read":{uri:"community/chat/channels/{channel}/mark-as-read/{message}",methods:["PUT"]},"chat.channels.index":{uri:"community/chat/channels",methods:["GET","HEAD"]},"chat.channels.store":{uri:"community/chat/channels",methods:["POST"]},"chat.channels.show":{uri:"community/chat/channels/{channel}",methods:["GET","HEAD"]},"chat.users.index":{uri:"community/chat/users",methods:["GET","HEAD"]},"chat.index":{uri:"community/chat",methods:["GET","HEAD"]},"group-history.index":{uri:"groups/history",methods:["GET","HEAD"]},"groups.show":{uri:"groups/{group}",methods:["GET","HEAD"]},"account.edit":{uri:"home/account/edit",methods:["GET","HEAD"]},"account.avatar":{uri:"home/account/avatar",methods:["POST"]},"account.country":{uri:"home/account/country",methods:["PUT"]},"account.cover":{uri:"home/account/cover",methods:["POST"]},"account.email":{uri:"home/account/email",methods:["PUT"]},"account.notification-options":{uri:"home/account/notification-options",methods:["PUT"]},"account.options":{uri:"home/account/options",methods:["PUT"]},"account.password":{uri:"home/account/password",methods:["PUT"]},"account.reissue-code":{uri:"home/account/reissue-code",methods:["POST"]},"account.sessions.destroy":{uri:"home/account/sessions/{session}",methods:["DELETE"]},"account.":{uri:"home/account/verify",methods:["GET","HEAD"]},"account.verify":{uri:"home/account/verify",methods:["POST"]},"account.update":{uri:"home/account",methods:["PUT"]},"account.github-users.callback":{uri:"home/account/github-users/callback",methods:["GET","HEAD"]},"account.github-users.create":{uri:"home/account/github-users/create",methods:["GET","HEAD"]},"account.github-users.destroy":{uri:"home/account/github-users",methods:["DELETE"]},"quick-search":{uri:"home/quick-search",methods:["GET","HEAD"]},search:{uri:"home/search",methods:["GET","HEAD"]},"bbcode-preview":{uri:"home/bbcode-preview",methods:["POST"]},"changelog.build":{uri:"home/changelog/{stream}/{build}",methods:["GET","HEAD"]},"changelog.index":{uri:"home/changelog",methods:["GET","HEAD"]},"changelog.show":{uri:"home/changelog/{changelog}",methods:["GET","HEAD"]},download:{uri:"home/download",methods:["GET","HEAD"]},"set-locale":{uri:"home/set-locale",methods:["POST"]},"support-the-game":{uri:"home/support",methods:["GET","HEAD"]},testflight:{uri:"home/testflight",methods:["GET","HEAD"]},"password-reset":{uri:"home/password-reset",methods:["GET","HEAD"]},"password-reset.reset":{uri:"home/password-reset/reset",methods:["GET","HEAD"]},"password-reset.resend-mail":{uri:"home/password-reset/resend-mail",methods:["POST"]},"download-quota-check":{uri:"home/download-quota-check",methods:["GET","HEAD"]},"blocks.store":{uri:"home/blocks",methods:["POST"]},"blocks.destroy":{uri:"home/blocks/{block}",methods:["DELETE"]},"friends.index":{uri:"home/friends",methods:["GET","HEAD"]},"friends.store":{uri:"home/friends",methods:["POST"]},"friends.destroy":{uri:"home/friends/{friend}",methods:["DELETE"]},"news.index":{uri:"home/news",methods:["GET","HEAD"]},"news.store":{uri:"home/news",methods:["POST"]},"news.show":{uri:"home/news/{news}",methods:["GET","HEAD"]},"news.update":{uri:"home/news/{news}",methods:["PUT","PATCH"]},"messages.users.show":{uri:"home/messages/users/{user}",methods:["GET","HEAD"]},"follows.store":{uri:"home/follows",methods:["POST"]},"follows.index":{uri:"home/follows/{subtype?}",methods:["GET","HEAD"]},"follows.destroy":{uri:"home/follows",methods:["DELETE"]},"legacy-api-key.store":{uri:"legacy-api-key",methods:["POST"]},"legacy-api-key.destroy":{uri:"legacy-api-key",methods:["DELETE"]},"legacy-irc-key.store":{uri:"legacy-irc-key",methods:["POST"]},"legacy-irc-key.destroy":{uri:"legacy-irc-key",methods:["DELETE"]},"notifications.index":{uri:"notifications",methods:["GET","HEAD"]},"notifications.endpoint":{uri:"notifications/endpoint",methods:["GET","HEAD"]},"notifications.mark-read":{uri:"notifications/mark-read",methods:["POST"]},legal:{uri:"legal/{locale?}/{path?}",methods:["GET","HEAD"]},"multiplayer.rooms.show":{uri:"multiplayer/rooms/{room}",methods:["GET","HEAD"]},"oauth.authorized-clients.destroy":{uri:"oauth/authorized-clients/{authorized_client}",methods:["DELETE"]},"oauth.clients.index":{uri:"oauth/clients",methods:["GET","HEAD"]},"oauth.clients.store":{uri:"oauth/clients",methods:["POST"]},"oauth.clients.update":{uri:"oauth/clients/{client}",methods:["PUT","PATCH"]},"oauth.clients.destroy":{uri:"oauth/clients/{client}",methods:["DELETE"]},"oauth.clients.reset-secret":{uri:"oauth/clients/{client}/reset-secret",methods:["POST"]},"rankings.kudosu":{uri:"rankings/kudosu",methods:["GET","HEAD"]},rankings:{uri:"rankings/{mode?}/{type?}",methods:["GET","HEAD"]},"reports.store":{uri:"reports",methods:["POST"]},"seasons.show":{uri:"seasons/{season}",methods:["GET","HEAD"]},"seasons.rooms":{uri:"seasons/{season}/rooms",methods:["GET","HEAD"]},login:{uri:"session",methods:["POST"]},logout:{uri:"session",methods:["DELETE"]},"users.check-username-availability":{uri:"users/check-username-availability",methods:["POST"]},"users.check-username-exists":{uri:"users/check-username-exists",methods:["POST"]},"users.disabled":{uri:"users/disabled",methods:["GET","HEAD"]},"users.create":{uri:"users/create",methods:["GET","HEAD"]},"users.store-web":{uri:"users/store-web",methods:["POST"]},"users.card":{uri:"users/{user}/card",methods:["GET","HEAD"]},"users.extra-page":{uri:"users/{user}/extra-pages/{page}",methods:["GET","HEAD"]},"users.page":{uri:"users/{user}/page",methods:["PUT"]},"users.multiplayer.index":{uri:"users/{user}/{typeGroup}",methods:["GET","HEAD"],wheres:{typeGroup:"multiplayer|playlists|realtime"}},"users.modding.index":{uri:"users/{user}/modding",methods:["GET","HEAD"]},"users.modding.posts":{uri:"users/{user}/modding/posts",methods:["GET","HEAD"]},"users.modding.votes-given":{uri:"users/{user}/modding/votes-given",methods:["GET","HEAD"]},"users.modding.votes-received":{uri:"users/{user}/modding/votes-received",methods:["GET","HEAD"]},"users.kudosu":{uri:"users/{user}/kudosu",methods:["GET","HEAD"]},"users.recent-activity":{uri:"users/{user}/recent_activity",methods:["GET","HEAD"]},"users.scores":{uri:"users/{user}/scores/{type}",methods:["GET","HEAD"]},"users.beatmapsets":{uri:"users/{user}/beatmapsets/{type}",methods:["GET","HEAD"]},"users.posts":{uri:"users/{user}/posts",methods:["GET","HEAD"]},"users.show":{uri:"users/{user}/{mode?}",methods:["GET","HEAD"]},"users.store":{uri:"users",methods:["POST"]},"wiki.sitemap":{uri:"wiki/{locale}/Sitemap",methods:["GET","HEAD"]},"wiki.image":{uri:"wiki/images/{path}",methods:["GET","HEAD"],wheres:{path:".+"}},"wiki.show":{uri:"wiki/{locale?}/{path?}",methods:["GET","HEAD"],wheres:{path:".+"}},"wiki-suggestions":{uri:"wiki-suggestions",methods:["GET","HEAD"]},"store.redirect:store.products.index":{uri:"store",methods:["GET","HEAD"]},"store.products.index":{uri:"store/listing",methods:["GET","HEAD"]},"store.invoice.show":{uri:"store/invoice/{invoice}",methods:["GET","HEAD"]},"store.notification-request":{uri:"store/products/{product}/notification-request",methods:["POST"]},"store.":{uri:"store/products/{product}/notification-request",methods:["DELETE"]},"store.cart.show":{uri:"store/cart",methods:["GET","HEAD"]},"store.cart.empty":{uri:"store/cart",methods:["DELETE"]},"store.cart.store":{uri:"store/cart",methods:["POST"]},"store.checkout.store":{uri:"store/checkout",methods:["POST"]},"store.checkout.show":{uri:"store/checkout/{checkout}",methods:["GET","HEAD"]},"store.orders.index":{uri:"store/orders",methods:["GET","HEAD"]},"store.orders.destroy":{uri:"store/orders/{order}",methods:["DELETE"]},"store.redirect:store.products.show":{uri:"store/product/{product}",methods:["GET","HEAD"]},"store.products.show":{uri:"store/products/{product}",methods:["GET","HEAD"]},"payments.paypal.approved":{uri:"payments/paypal/approved",methods:["GET","HEAD"]},"payments.paypal.declined":{uri:"payments/paypal/declined",methods:["GET","HEAD"]},"payments.paypal.create":{uri:"payments/paypal/create",methods:["POST"]},"payments.paypal.completed":{uri:"payments/paypal/completed",methods:["GET","HEAD"]},"payments.paypal.ipn":{uri:"payments/paypal/ipn",methods:["POST"]},"payments.xsolla.completed":{uri:"payments/xsolla/completed",methods:["GET","HEAD"]},"payments.xsolla.token":{uri:"payments/xsolla/token",methods:["POST"]},"payments.xsolla.callback":{uri:"payments/xsolla/callback",methods:["POST"]},"payments.centili.callback":{uri:"payments/centili/callback",methods:["POST","GET","HEAD"]},"payments.centili.completed":{uri:"payments/centili/completed",methods:["GET","HEAD"]},"payments.centili.failed":{uri:"payments/centili/failed",methods:["GET","HEAD"]},"payments.shopify.callback":{uri:"payments/shopify/callback",methods:["POST"]},home:{uri:"home",methods:["GET","HEAD"]},"redirect:home":{uri:"/",methods:["GET","HEAD"]},"redirect:forum.posts.show":{uri:"forum/p/{post}",methods:["GET","HEAD"]},"redirect:forum.posts.show:":{uri:"po/{post}",methods:["GET","HEAD"]},"redirect:forum.topics.show":{uri:"forum/t/{topic}",methods:["GET","HEAD"]},"redirect:forum.forums.show":{uri:"forum/{forum}",methods:["GET","HEAD"]},"redirect:beatmaps.show":{uri:"b/{beatmap}",methods:["GET","HEAD"]},"redirect:groups.show":{uri:"g/{group}",methods:["GET","HEAD"]},"redirect:beatmapsets.show":{uri:"s/{beatmapset}",methods:["GET","HEAD"]},"redirect:users.show":{uri:"u/{user}",methods:["GET","HEAD"]},"redirect:forum.forums.index":{uri:"forum",methods:["GET","HEAD"]},"redirect:matches.show":{uri:"mp/{match}",methods:["GET","HEAD"]},"redirect:wiki.show":{uri:"help/wiki/{path?}",methods:["GET","HEAD"],wheres:{path:".+"}},"api.beatmaps.lookup":{uri:"api/v2/beatmaps/lookup",methods:["GET","HEAD"]},"api.beatmaps.packs.index":{uri:"api/v2/beatmaps/packs",methods:["GET","HEAD"]},"api.beatmaps.packs.show":{uri:"api/v2/beatmaps/packs/{pack}",methods:["GET","HEAD"]},"api.beatmaps.":{uri:"api/v2/beatmaps/{beatmap}/scores/users/{user}/all",methods:["GET","HEAD"]},"api.beatmaps.scores":{uri:"api/v2/beatmaps/{beatmap}/scores",methods:["GET","HEAD"]},"api.beatmaps.solo-scores":{uri:"api/v2/beatmaps/{beatmap}/solo-scores",methods:["GET","HEAD"]},"api.beatmaps.solo.score-tokens.store":{uri:"api/v2/beatmaps/{beatmap}/solo/scores",methods:["POST"]},"api.beatmaps.solo.scores.store":{uri:"api/v2/beatmaps/{beatmap}/solo/scores/{token}",methods:["PUT"]},"api.beatmaps.index":{uri:"api/v2/beatmaps",methods:["GET","HEAD"]},"api.beatmaps.show":{uri:"api/v2/beatmaps/{beatmap}",methods:["GET","HEAD"]},"api.beatmaps.attributes":{uri:"api/v2/beatmaps/{beatmap}/attributes",methods:["POST"]},"api.beatmapsets.events.index":{uri:"api/v2/beatmapsets/events",methods:["GET","HEAD"]},"api.beatmapsets.discussions.posts.index":{uri:"api/v2/beatmapsets/discussions/posts",methods:["GET","HEAD"]},"api.beatmapsets.discussions.votes.index":{uri:"api/v2/beatmapsets/discussions/votes",methods:["GET","HEAD"]},"api.beatmapsets.discussions.index":{uri:"api/v2/beatmapsets/discussions",methods:["GET","HEAD"]},"api.beatmapsets.favourites.store":{uri:"api/v2/beatmapsets/{beatmapset}/favourites",methods:["POST"]},"api.comments.index":{uri:"api/v2/comments",methods:["GET","HEAD"]},"api.comments.store":{uri:"api/v2/comments",methods:["POST"]},"api.comments.show":{uri:"api/v2/comments/{comment}",methods:["GET","HEAD"]},"api.comments.update":{uri:"api/v2/comments/{comment}",methods:["PUT","PATCH"]},"api.comments.destroy":{uri:"api/v2/comments/{comment}",methods:["DELETE"]},"api.comments.vote":{uri:"api/v2/comments/{comment}/vote",methods:["POST"]},"api.":{uri:"api/v2/beatmapsets/{beatmapset}/download",methods:["GET","HEAD"]},"api.chat.ack":{uri:"api/v2/chat/ack",methods:["POST"]},"api.chat.new":{uri:"api/v2/chat/new",methods:["POST"]},"api.chat.updates":{uri:"api/v2/chat/updates",methods:["GET","HEAD"]},"api.chat.presence":{uri:"api/v2/chat/presence",methods:["GET","HEAD"]},"api.chat.channels.messages.index":{uri:"api/v2/chat/channels/{channel}/messages",methods:["GET","HEAD"]},"api.chat.channels.messages.store":{uri:"api/v2/chat/channels/{channel}/messages",methods:["POST"]},"api.chat.channels.join":{uri:"api/v2/chat/channels/{channel}/users/{user}",methods:["PUT"]},"api.chat.channels.part":{uri:"api/v2/chat/channels/{channel}/users/{user}",methods:["DELETE"]},"api.chat.channels.mark-as-read":{uri:"api/v2/chat/channels/{channel}/mark-as-read/{message}",methods:["PUT"]},"api.chat.channels.index":{uri:"api/v2/chat/channels",methods:["GET","HEAD"]},"api.chat.channels.store":{uri:"api/v2/chat/channels",methods:["POST"]},"api.chat.channels.show":{uri:"api/v2/chat/channels/{channel}",methods:["GET","HEAD"]},"api.changelog.build":{uri:"api/v2/changelog/{stream}/{build}",methods:["GET","HEAD"]},"api.changelog.index":{uri:"api/v2/changelog",methods:["GET","HEAD"]},"api.changelog.show":{uri:"api/v2/changelog/{changelog}",methods:["GET","HEAD"]},"api.events.index":{uri:"api/v2/events",methods:["GET","HEAD"]},"api.forum.topics.reply":{uri:"api/v2/forums/topics/{topic}/reply",methods:["POST"]},"api.forum.topics.store":{uri:"api/v2/forums/topics",methods:["POST"]},"api.forum.topics.show":{uri:"api/v2/forums/topics/{topic}",methods:["GET","HEAD"]},"api.forum.topics.update":{uri:"api/v2/forums/topics/{topic}",methods:["PUT","PATCH"]},"api.forum.posts.update":{uri:"api/v2/forums/posts/{post}",methods:["PUT","PATCH"]},"api.matches.index":{uri:"api/v2/matches",methods:["GET","HEAD"]},"api.matches.show":{uri:"api/v2/matches/{match}",methods:["GET","HEAD"]},"api.reports.store":{uri:"api/v2/reports",methods:["POST"]},"api.rooms.join":{uri:"api/v2/rooms/{room}/users/{user}",methods:["PUT"]},"api.rooms.part":{uri:"api/v2/rooms/{room}/users/{user}",methods:["DELETE"]},"api.rooms.":{uri:"api/v2/rooms/{room}/leaderboard",methods:["GET","HEAD"]},"api.rooms.playlist.":{uri:"api/v2/rooms/{room}/playlist/{playlist}/scores/users/{user}",methods:["GET","HEAD"]},"api.rooms.playlist.scores.index":{uri:"api/v2/rooms/{room}/playlist/{playlist}/scores",methods:["GET","HEAD"]},"api.rooms.playlist.scores.store":{uri:"api/v2/rooms/{room}/playlist/{playlist}/scores",methods:["POST"]},"api.rooms.playlist.scores.show":{uri:"api/v2/rooms/{room}/playlist/{playlist}/scores/{score}",methods:["GET","HEAD"]},"api.rooms.playlist.scores.update":{uri:"api/v2/rooms/{room}/playlist/{playlist}/scores/{score}",methods:["PUT","PATCH"]},"api.rooms.index":{uri:"api/v2/rooms",methods:["GET","HEAD"]},"api.rooms.store":{uri:"api/v2/rooms",methods:["POST"]},"api.rooms.show":{uri:"api/v2/rooms/{room}",methods:["GET","HEAD"]},"api.seasonal-backgrounds.index":{uri:"api/v2/seasonal-backgrounds",methods:["GET","HEAD"]},"api.scores.download":{uri:"api/v2/scores/{score}/download",methods:["GET","HEAD"]},"api.scores.download-legacy":{uri:"api/v2/scores/{rulesetOrScore}/{score}/download",methods:["GET","HEAD"]},"api.scores.show":{uri:"api/v2/scores/{rulesetOrScore}/{score?}",methods:["GET","HEAD"]},"api.beatmapsets.show":{uri:"api/v2/beatmapsets/{beatmapset}",methods:["GET","HEAD"]},"api.friends.index":{uri:"api/v2/friends",methods:["GET","HEAD"]},"api.download-quota-check":{uri:"api/v2/me/download-quota-check",methods:["GET","HEAD"]},"api.me":{uri:"api/v2/me/{mode?}",methods:["GET","HEAD"]},"api.oauth.tokens.current":{uri:"api/v2/oauth/tokens/current",methods:["DELETE"]},"api.news.index":{uri:"api/v2/news",methods:["GET","HEAD"]},"api.news.show":{uri:"api/v2/news/{news}",methods:["GET","HEAD"]},"api.notifications.index":{uri:"api/v2/notifications",methods:["GET","HEAD"]},"api.notifications.mark-read":{uri:"api/v2/notifications/mark-read",methods:["POST"]},"api.spotlights.index":{uri:"api/v2/spotlights",methods:["GET","HEAD"]},"api.users.show":{uri:"api/v2/users/{user}/{mode?}",methods:["GET","HEAD"]},"api.users.index":{uri:"api/v2/users",methods:["GET","HEAD"]},"api.wiki.show":{uri:"api/v2/wiki/{locale}/{path}",methods:["GET","HEAD"],wheres:{path:".+"}},"interop.":{uri:"_lio/artist-tracks/reindex-all",methods:["POST"]},"interop.beatmapsets.broadcast-new":{uri:"_lio/beatmapsets/{beatmapset}/broadcast-new",methods:["POST"]},"interop.beatmapsets.broadcast-revive":{uri:"_lio/beatmapsets/{beatmapset}/broadcast-revive",methods:["POST"]},"interop.beatmapsets.disqualify":{uri:"_lio/beatmapsets/{beatmapset}/disqualify",methods:["POST"]},"interop.beatmapsets.destroy":{uri:"_lio/beatmapsets/{beatmapset}",methods:["DELETE"]},"interop.indexing.bulk.store":{uri:"_lio/indexing/bulk",methods:["POST"]},"interop.users.achievement":{uri:"_lio/user-achievement/{user}/{achievement}/{beatmap?}",methods:["POST"]},"interop.user-group.update":{uri:"_lio/users/{user}/groups/{group}",methods:["PUT"]},"interop.user-group.destroy":{uri:"_lio/users/{user}/groups/{group}",methods:["DELETE"]},"interop.user-group.set-default":{uri:"_lio/users/{user}/groups/{group}/default",methods:["POST"]},"interop.users.store":{uri:"_lio/users",methods:["POST"]}}};function n(){return n=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(e[r]=s[r])}return e},n.apply(this,arguments)}"undefined"!=typeof window&&void 0!==window.Ziggy&&Object.assign(i.routes,window.Ziggy.routes);var a=String.prototype.replace,o=/%20/g,l={default:"RFC3986",formatters:{RFC1738:function(e){return a.call(e,o,"+")},RFC3986:function(e){return String(e)}},RFC1738:"RFC1738",RFC3986:"RFC3986"},c=Object.prototype.hasOwnProperty,u=Array.isArray,d=function(){for(var e=[],t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e}(),p=function(e,t){for(var s=t&&t.plainObjects?Object.create(null):{},r=0;r<e.length;++r)void 0!==e[r]&&(s[r]=e[r]);return s},m={arrayToObject:p,assign:function(e,t){return Object.keys(t).reduce((function(e,s){return e[s]=t[s],e}),e)},combine:function(e,t){return[].concat(e,t)},compact:function(e){for(var t=[{obj:{o:e},prop:"o"}],s=[],r=0;r<t.length;++r)for(var i=t[r],n=i.obj[i.prop],a=Object.keys(n),o=0;o<a.length;++o){var l=a[o],c=n[l];"object"==typeof c&&null!==c&&-1===s.indexOf(c)&&(t.push({obj:n,prop:l}),s.push(c))}return function(e){for(;e.length>1;){var t=e.pop(),s=t.obj[t.prop];if(u(s)){for(var r=[],i=0;i<s.length;++i)void 0!==s[i]&&r.push(s[i]);t.obj[t.prop]=r}}}(t),e},decode:function(e,t,s){var r=e.replace(/\+/g," ");if("iso-8859-1"===s)return r.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(r)}catch(e){return r}},encode:function(e,t,s,r,i){if(0===e.length)return e;var n=e;if("symbol"==typeof e?n=Symbol.prototype.toString.call(e):"string"!=typeof e&&(n=String(e)),"iso-8859-1"===s)return escape(n).replace(/%u[0-9a-f]{4}/gi,(function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"}));for(var a="",o=0;o<n.length;++o){var c=n.charCodeAt(o);45===c||46===c||95===c||126===c||c>=48&&c<=57||c>=65&&c<=90||c>=97&&c<=122||i===l.RFC1738&&(40===c||41===c)?a+=n.charAt(o):c<128?a+=d[c]:c<2048?a+=d[192|c>>6]+d[128|63&c]:c<55296||c>=57344?a+=d[224|c>>12]+d[128|c>>6&63]+d[128|63&c]:(c=65536+((1023&c)<<10|1023&n.charCodeAt(o+=1)),a+=d[240|c>>18]+d[128|c>>12&63]+d[128|c>>6&63]+d[128|63&c])}return a},isBuffer:function(e){return!(!e||"object"!=typeof e||!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e)))},isRegExp:function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},maybeMap:function(e,t){if(u(e)){for(var s=[],r=0;r<e.length;r+=1)s.push(t(e[r]));return s}return t(e)},merge:function e(t,s,r){if(!s)return t;if("object"!=typeof s){if(u(t))t.push(s);else{if(!t||"object"!=typeof t)return[t,s];(r&&(r.plainObjects||r.allowPrototypes)||!c.call(Object.prototype,s))&&(t[s]=!0)}return t}if(!t||"object"!=typeof t)return[t].concat(s);var i=t;return u(t)&&!u(s)&&(i=p(t,r)),u(t)&&u(s)?(s.forEach((function(s,i){if(c.call(t,i)){var n=t[i];n&&"object"==typeof n&&s&&"object"==typeof s?t[i]=e(n,s,r):t.push(s)}else t[i]=s})),t):Object.keys(s).reduce((function(t,i){var n=s[i];return t[i]=c.call(t,i)?e(t[i],n,r):n,t}),i)}},h=Object.prototype.hasOwnProperty,b={brackets:function(e){return e+"[]"},comma:"comma",indices:function(e,t){return e+"["+t+"]"},repeat:function(e){return e}},f=Array.isArray,v=String.prototype.split,g=Array.prototype.push,y=function(e,t){g.apply(e,f(t)?t:[t])},w=Date.prototype.toISOString,_=l.default,E={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:m.encode,encodeValuesOnly:!1,format:_,formatter:l.formatters[_],indices:!1,serializeDate:function(e){return w.call(e)},skipNulls:!1,strictNullHandling:!1},O=function e(t,s,r,i,n,a,o,l,c,u,d,p,h,b){var g,w=t;if("function"==typeof o?w=o(s,w):w instanceof Date?w=u(w):"comma"===r&&f(w)&&(w=m.maybeMap(w,(function(e){return e instanceof Date?u(e):e}))),null===w){if(i)return a&&!h?a(s,E.encoder,b,"key",d):s;w=""}if("string"==typeof(g=w)||"number"==typeof g||"boolean"==typeof g||"symbol"==typeof g||"bigint"==typeof g||m.isBuffer(w)){if(a){var _=h?s:a(s,E.encoder,b,"key",d);if("comma"===r&&h){for(var O=v.call(String(w),","),P="",j=0;j<O.length;++j)P+=(0===j?"":",")+p(a(O[j],E.encoder,b,"value",d));return[p(_)+"="+P]}return[p(_)+"="+p(a(w,E.encoder,b,"value",d))]}return[p(s)+"="+p(String(w))]}var k,N=[];if(void 0===w)return N;if("comma"===r&&f(w))k=[{value:w.length>0?w.join(",")||null:void 0}];else if(f(o))k=o;else{var S=Object.keys(w);k=l?S.sort(l):S}for(var C=0;C<k.length;++C){var T=k[C],x="object"==typeof T&&void 0!==T.value?T.value:w[T];if(!n||null!==x){var D=f(w)?"function"==typeof r?r(s,T):s:s+(c?"."+T:"["+T+"]");y(N,e(x,D,r,i,n,a,o,l,c,u,d,p,h,b))}}return N},P=Object.prototype.hasOwnProperty,j=Array.isArray,k={allowDots:!1,allowPrototypes:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decoder:m.decode,delimiter:"&",depth:5,ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},N=function(e){return e.replace(/&#(\d+);/g,(function(e,t){return String.fromCharCode(parseInt(t,10))}))},S=function(e,t){return e&&"string"==typeof e&&t.comma&&e.indexOf(",")>-1?e.split(","):e},C=function(e,t,s,r){if(e){var i=s.allowDots?e.replace(/\.([^.[]+)/g,"[$1]"):e,n=/(\[[^[\]]*])/g,a=s.depth>0&&/(\[[^[\]]*])/.exec(i),o=a?i.slice(0,a.index):i,l=[];if(o){if(!s.plainObjects&&P.call(Object.prototype,o)&&!s.allowPrototypes)return;l.push(o)}for(var c=0;s.depth>0&&null!==(a=n.exec(i))&&c<s.depth;){if(c+=1,!s.plainObjects&&P.call(Object.prototype,a[1].slice(1,-1))&&!s.allowPrototypes)return;l.push(a[1])}return a&&l.push("["+i.slice(a.index)+"]"),function(e,t,s,r){for(var i=r?t:S(t,s),n=e.length-1;n>=0;--n){var a,o=e[n];if("[]"===o&&s.parseArrays)a=[].concat(i);else{a=s.plainObjects?Object.create(null):{};var l="["===o.charAt(0)&&"]"===o.charAt(o.length-1)?o.slice(1,-1):o,c=parseInt(l,10);s.parseArrays||""!==l?!isNaN(c)&&o!==l&&String(c)===l&&c>=0&&s.parseArrays&&c<=s.arrayLimit?(a=[])[c]=i:"__proto__"!==l&&(a[l]=i):a={0:i}}i=a}return i}(l,t,s,r)}},T=function(e,t){var s=function(e){if(!e)return k;if(null!=e.decoder&&"function"!=typeof e.decoder)throw new TypeError("Decoder has to be a function.");if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");return{allowDots:void 0===e.allowDots?k.allowDots:!!e.allowDots,allowPrototypes:"boolean"==typeof e.allowPrototypes?e.allowPrototypes:k.allowPrototypes,arrayLimit:"number"==typeof e.arrayLimit?e.arrayLimit:k.arrayLimit,charset:void 0===e.charset?k.charset:e.charset,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:k.charsetSentinel,comma:"boolean"==typeof e.comma?e.comma:k.comma,decoder:"function"==typeof e.decoder?e.decoder:k.decoder,delimiter:"string"==typeof e.delimiter||m.isRegExp(e.delimiter)?e.delimiter:k.delimiter,depth:"number"==typeof e.depth||!1===e.depth?+e.depth:k.depth,ignoreQueryPrefix:!0===e.ignoreQueryPrefix,interpretNumericEntities:"boolean"==typeof e.interpretNumericEntities?e.interpretNumericEntities:k.interpretNumericEntities,parameterLimit:"number"==typeof e.parameterLimit?e.parameterLimit:k.parameterLimit,parseArrays:!1!==e.parseArrays,plainObjects:"boolean"==typeof e.plainObjects?e.plainObjects:k.plainObjects,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:k.strictNullHandling}}(t);if(""===e||null==e)return s.plainObjects?Object.create(null):{};for(var r="string"==typeof e?function(e,t){var s,r={},i=(t.ignoreQueryPrefix?e.replace(/^\?/,""):e).split(t.delimiter,1/0===t.parameterLimit?void 0:t.parameterLimit),n=-1,a=t.charset;if(t.charsetSentinel)for(s=0;s<i.length;++s)0===i[s].indexOf("utf8=")&&("utf8=%E2%9C%93"===i[s]?a="utf-8":"utf8=%26%2310003%3B"===i[s]&&(a="iso-8859-1"),n=s,s=i.length);for(s=0;s<i.length;++s)if(s!==n){var o,l,c=i[s],u=c.indexOf("]="),d=-1===u?c.indexOf("="):u+1;-1===d?(o=t.decoder(c,k.decoder,a,"key"),l=t.strictNullHandling?null:""):(o=t.decoder(c.slice(0,d),k.decoder,a,"key"),l=m.maybeMap(S(c.slice(d+1),t),(function(e){return t.decoder(e,k.decoder,a,"value")}))),l&&t.interpretNumericEntities&&"iso-8859-1"===a&&(l=N(l)),c.indexOf("[]=")>-1&&(l=j(l)?[l]:l),r[o]=P.call(r,o)?m.combine(r[o],l):l}return r}(e,s):e,i=s.plainObjects?Object.create(null):{},n=Object.keys(r),a=0;a<n.length;++a){var o=n[a],l=C(o,r[o],s,"string"==typeof e);i=m.merge(i,l,s)}return m.compact(i)};class x{constructor(e,t,s){var r,i;this.name=e,this.definition=t,this.bindings=null!=(r=t.bindings)?r:{},this.wheres=null!=(i=t.wheres)?i:{},this.config=s}get template(){return`${this.origin}/${this.definition.uri}`.replace(/\/+$/,"")}get origin(){return this.config.absolute?this.definition.domain?`${this.config.url.match(/^\w+:\/\//)[0]}${this.definition.domain}${this.config.port?`:${this.config.port}`:""}`:this.config.url:""}get parameterSegments(){var e,t;return null!=(e=null==(t=this.template.match(/{[^}?]+\??}/g))?void 0:t.map((e=>({name:e.replace(/{|\??}/g,""),required:!/\?}$/.test(e)}))))?e:[]}matchesUrl(e){if(!this.definition.methods.includes("GET"))return!1;const t=this.template.replace(/(\/?){([^}?]*)(\??)}/g,((e,t,s,r)=>{var i;const n=`(?<${s}>${(null==(i=this.wheres[s])?void 0:i.replace(/(^\^)|(\$$)/g,""))||"[^/?]+"})`;return r?`(${t}${n})?`:`${t}${n}`})).replace(/^\w+:\/\//,""),[s,r]=e.replace(/^\w+:\/\//,"").split("?"),i=new RegExp(`^${t}/?$`).exec(s);if(i){for(const e in i.groups)i.groups[e]="string"==typeof i.groups[e]?decodeURIComponent(i.groups[e]):i.groups[e];return{params:i.groups,query:T(r)}}return!1}compile(e){const t=this.parameterSegments;return t.length?this.template.replace(/{([^}?]+)(\??)}/g,((s,r,i)=>{var n,a,o;if(!i&&[null,void 0].includes(e[r]))throw new Error(`Ziggy error: '${r}' parameter is required for route '${this.name}'.`);if(t[t.length-1].name===r&&".*"===this.wheres[r])return encodeURIComponent(null!=(o=e[r])?o:"").replace(/%2F/g,"/");if(this.wheres[r]&&!new RegExp(`^${i?`(${this.wheres[r]})?`:this.wheres[r]}$`).test(null!=(n=e[r])?n:""))throw new Error(`Ziggy error: '${r}' parameter does not match required format '${this.wheres[r]}' for route '${this.name}'.`);return encodeURIComponent(null!=(a=e[r])?a:"")})).replace(`${this.origin}//`,`${this.origin}/`).replace(/\/+$/,""):this.template}}class D extends String{constructor(e,t,s=!0,r){if(super(),this.t=null!=r?r:"undefined"!=typeof Ziggy?Ziggy:null==globalThis?void 0:globalThis.Ziggy,this.t=n({},this.t,{absolute:s}),e){if(!this.t.routes[e])throw new Error(`Ziggy error: route '${e}' is not in the route list.`);this.i=new x(e,this.t.routes[e],this.t),this.u=this.l(t)}}toString(){const e=Object.keys(this.u).filter((e=>!this.i.parameterSegments.some((({name:t})=>t===e)))).filter((e=>"_query"!==e)).reduce(((e,t)=>n({},e,{[t]:this.u[t]})),{});return this.i.compile(this.u)+function(e,t){var s,r=e,i=function(e){if(!e)return E;if(null!=e.encoder&&"function"!=typeof e.encoder)throw new TypeError("Encoder has to be a function.");var t=e.charset||E.charset;if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var s=l.default;if(void 0!==e.format){if(!h.call(l.formatters,e.format))throw new TypeError("Unknown format option provided.");s=e.format}var r=l.formatters[s],i=E.filter;return("function"==typeof e.filter||f(e.filter))&&(i=e.filter),{addQueryPrefix:"boolean"==typeof e.addQueryPrefix?e.addQueryPrefix:E.addQueryPrefix,allowDots:void 0===e.allowDots?E.allowDots:!!e.allowDots,charset:t,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:E.charsetSentinel,delimiter:void 0===e.delimiter?E.delimiter:e.delimiter,encode:"boolean"==typeof e.encode?e.encode:E.encode,encoder:"function"==typeof e.encoder?e.encoder:E.encoder,encodeValuesOnly:"boolean"==typeof e.encodeValuesOnly?e.encodeValuesOnly:E.encodeValuesOnly,filter:i,format:s,formatter:r,serializeDate:"function"==typeof e.serializeDate?e.serializeDate:E.serializeDate,skipNulls:"boolean"==typeof e.skipNulls?e.skipNulls:E.skipNulls,sort:"function"==typeof e.sort?e.sort:null,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:E.strictNullHandling}}(t);"function"==typeof i.filter?r=(0,i.filter)("",r):f(i.filter)&&(s=i.filter);var n=[];if("object"!=typeof r||null===r)return"";var a=b[t&&t.arrayFormat in b?t.arrayFormat:t&&"indices"in t?t.indices?"indices":"repeat":"indices"];s||(s=Object.keys(r)),i.sort&&s.sort(i.sort);for(var o=0;o<s.length;++o){var c=s[o];i.skipNulls&&null===r[c]||y(n,O(r[c],c,a,i.strictNullHandling,i.skipNulls,i.encode?i.encoder:null,i.filter,i.sort,i.allowDots,i.serializeDate,i.format,i.formatter,i.encodeValuesOnly,i.charset))}var u=n.join(i.delimiter),d=!0===i.addQueryPrefix?"?":"";return i.charsetSentinel&&(d+="iso-8859-1"===i.charset?"utf8=%26%2310003%3B&":"utf8=%E2%9C%93&"),u.length>0?d+u:""}(n({},e,this.u._query),{addQueryPrefix:!0,arrayFormat:"indices",encodeValuesOnly:!0,skipNulls:!0,encoder:(e,t)=>"boolean"==typeof e?Number(e):t(e)})}p(e){e?this.t.absolute&&e.startsWith("/")&&(e=this.h().host+e):e=this.v();let t={};const[s,r]=Object.entries(this.t.routes).find((([s,r])=>t=new x(s,r,this.t).matchesUrl(e)))||[void 0,void 0];return n({name:s},t,{route:r})}v(){const{host:e,pathname:t,search:s}=this.h();return(this.t.absolute?e+t:t.replace(this.t.url.replace(/^\w*:\/\/[^/]+/,""),"").replace(/^\/+/,"/"))+s}current(e,t){const{name:s,params:r,query:i,route:a}=this.p();if(!e)return s;const o=new RegExp(`^${e.replace(/\./g,"\\.").replace(/\*/g,".*")}$`).test(s);if([null,void 0].includes(t)||!o)return o;const l=new x(s,a,this.t);t=this.l(t,l);const c=n({},r,i);return!(!Object.values(t).every((e=>!e))||Object.values(c).some((e=>void 0!==e)))||Object.entries(t).every((([e,t])=>c[e]==t))}h(){var e,t,s,r,i,n;const{host:a="",pathname:o="",search:l=""}="undefined"!=typeof window?window.location:{};return{host:null!=(e=null==(t=this.t.location)?void 0:t.host)?e:a,pathname:null!=(s=null==(r=this.t.location)?void 0:r.pathname)?s:o,search:null!=(i=null==(n=this.t.location)?void 0:n.search)?i:l}}get params(){const{params:e,query:t}=this.p();return n({},e,t)}has(e){return Object.keys(this.t.routes).includes(e)}l(e={},t=this.i){null!=e||(e={}),e=["string","number"].includes(typeof e)?[e]:e;const s=t.parameterSegments.filter((({name:e})=>!this.t.defaults[e]));return Array.isArray(e)?e=e.reduce(((e,t,r)=>n({},e,s[r]?{[s[r].name]:t}:"object"==typeof t?t:{[t]:""})),{}):1!==s.length||e[s[0].name]||!e.hasOwnProperty(Object.values(t.bindings)[0])&&!e.hasOwnProperty("id")||(e={[s[0].name]:e}),n({},this.m(t),this.g(e,t))}m(e){return e.parameterSegments.filter((({name:e})=>this.t.defaults[e])).reduce(((e,{name:t},s)=>n({},e,{[t]:this.t.defaults[t]})),{})}g(e,{bindings:t,parameterSegments:s}){return Object.entries(e).reduce(((e,[r,i])=>{if(!i||"object"!=typeof i||Array.isArray(i)||!s.some((({name:e})=>e===r)))return n({},e,{[r]:i});if(!i.hasOwnProperty(t[r])){if(!i.hasOwnProperty("id"))throw new Error(`Ziggy error: object passed as '${r}' parameter is missing route model binding key '${t[r]}'.`);t[r]="id"}return n({},e,{[r]:i[t[r]]})}),{})}valueOf(){return this.toString()}check(e){return this.has(e)}}const R=(0,r.JJ)();function M(e,t,s){return function(e,t,s,r){const i=new D(e,t,s,r);return e?i.toString():i}(e,null!=t?t:{},s,i).toString()}i.port=+R.port||null,i.url=R.origin},3974:(e,t,s)=>{s.d(t,{F8:()=>u,FU:()=>o,H:()=>d,Us:()=>l,fv:()=>c});var r=s(7294),i=s(9567),n=s(41),a=s(5076);const o=r.createContext({inLink:!1});function l(e){return function(t){return r.createElement(e,null,u(t.children))}}function c(e){const t=(0,n.cO)(e.href),s=(0,a.pc)(t.href),i=null==t.children||e.children instanceof Array&&e.children.length>0&&e.children[0]!==e.href?e.children:t.children;return r.createElement(o.Consumer,null,(({inLink:e})=>r.createElement(o.Provider,{value:{inLink:!0}},e?i:r.createElement("a",Object.assign({},t,{href:s}),i))))}function u(e){var t;if("string"==typeof e){const s=[...e.matchAll(n.Qq)];if(s.length>0){let i=0;const n=[];for(const o of s){const s=null!==(t=o.index)&&void 0!==t?t:0,l=e.substring(i,s);n.push(l);const[,,,c,u,d,p]=o,m=`${c}:${u}:${d}${null!=p?p:""}`;n.push(r.createElement("a",{key:`timestamp-${s}`,className:"beatmap-discussion-timestamp-decoration",href:(0,a.ri)(m)},m)),i=s+o[0].length}return n.push(e.substring(i,e.length)),n}}else if(Array.isArray(e))return e.map(u);return e}function d(e){return e.startsWith("osu://edit/")?e:(0,i.A)(e)}},7595:(e,t,s)=>{s.d(t,{$:()=>m,Z:()=>b});var r=s(849),i=s(6192),n=s(6486),a=s(8949),o=s(8125),l=s(7181),c=s(9603),u=function(e,t,s,r){var i,n=arguments.length,a=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(n<3?i(a):n>3?i(t,s,a):i(t,s))||a);return n>3&&a&&Object.defineProperty(t,s,a),a},d=function(e,t,s,r){return new(s||(s=Promise))((function(i,n){function a(e){try{l(r.next(e))}catch(t){n(t)}}function o(e){try{l(r.throw(e))}catch(t){n(t)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(a,o)}l((r=r.apply(e,t||[])).next())}))};const p=new Set(["ANNOUNCE","PM"]),m=1024;class h{get announcementUsers(){return this.usersLoaded?this.userIds.map((e=>l.Z.dataStore.userStore.get(e))).filter((e=>null!=e)).sort(o.gm):null}get canMessage(){return null==this.canMessageError}get firstMessage(){return this.messages.length>0?this.messages[0]:void 0}get hasEarlierMessages(){return this.firstMessageId!==this.minMessageId}get isDisplayable(){return this.name.length>0&&null!=this.icon}get isHideable(){return p.has(this.type)}get isUnread(){return null!=this.lastReadId?this.lastMessageId>this.lastReadId:this.lastMessageId>-1}get lastMessage(){return this.messages[this.messages.length-1]}get lastMessageId(){var e;for(let t=this.messages.length-1;t>=0;t--)if("number"==typeof this.messages[t].messageId)return this.messages[t].messageId;return null!==(e=this.serverLastMessageId)&&void 0!==e?e:-1}get messages(){return(0,n.sortBy)([...this.messagesMap.values()],["timestamp","channelId"])}get minMessageId(){const e=this.messages.length>0?this.messages[0].messageId:void 0;return"number"==typeof e?e:-1}get pmTarget(){if("PM"===this.type)return this.userIds.find((e=>e!==l.Z.currentUserOrFail.id))}get supportedType(){return i.Uj.has(this.type)?this.type:null}constructor(e){Object.defineProperty(this,"canMessageError",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"channelId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstMessageId",{enumerable:!0,configurable:!0,writable:!0,value:-1}),Object.defineProperty(this,"icon",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputText",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"lastReadId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"loadingEarlierMessages",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"loadingMessages",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"messageLengthLimit",{enumerable:!0,configurable:!0,writable:!0,value:m}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"needsRefresh",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"newPmChannel",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"throttledSendMarkAsRead",{enumerable:!0,configurable:!0,writable:!0,value:(0,n.throttle)((()=>this.sendMarkAsRead()),1e3)}),Object.defineProperty(this,"type",{enumerable:!0,configurable:!0,writable:!0,value:"TEMPORARY"}),Object.defineProperty(this,"uiState",{enumerable:!0,configurable:!0,writable:!0,value:{autoScroll:!0,scrollY:0}}),Object.defineProperty(this,"userIds",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"markAsReadLastSent",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"messagesMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"serverLastMessageId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"usersLoaded",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.channelId=e,(0,a.rC)(this)}static newPM(e,t){const s=new h(null!=t?t:-1);return s.newPmChannel=null==t,s.type="PM",s.name=e.username,s.icon=e.avatarUrl,s.userIds=[l.Z.currentUserOrFail.id,e.id],s}addMessage(e){var t;if(null!=e.uuid&&e.sender_id===(null===(t=l.Z.currentUser)||void 0===t?void 0:t.id)){const t=this.messagesMap.get(e.uuid);if(null!=t)return this.persistMessage(t,e)}const s=c.Z.fromJson(e);this.messagesMap.set(s.messageId,s)}addMessages(e){e.forEach((e=>this.messagesMap.set(e.messageId,e)))}addSendingMessage(e){this.messagesMap.set(e.messageId,e),this.moveMarkAsReadMarker()}afterSendMesssage(e,t){null!=t?(this.persistMessage(e,t),this.setLastReadId(t.message_id)):e.errored=!0}load(){this.newPmChannel||("ANNOUNCE"!==this.type||this.usersLoaded||this.loadMetadata(),this.loadRecentMessages())}loadEarlierMessages(){return d(this,void 0,void 0,(function*(){if(!this.hasEarlierMessages||this.loadingEarlierMessages)return;let e;this.loadingEarlierMessages=!0,this.minMessageId>0&&(e=this.minMessageId);try{const t=yield(0,r._U)(this.channelId,{until:e});(0,a.z)((()=>{this.addMessages(t),0===t.length&&(this.firstMessageId=this.minMessageId)}))}finally{(0,a.z)((()=>{this.loadingEarlierMessages=!1}))}}))}loadMetadata(){(0,r.mr)(this.channelId).done((e=>{(0,a.z)((()=>{this.updateWithJson(e),this.usersLoaded=!0}))}))}moveMarkAsReadMarker(){this.setLastReadId(this.lastMessageId)}removeMessagesFromUserIds(e){for(const[,t]of this.messagesMap)e.has(t.senderId)&&this.messagesMap.delete(t.messageId)}setInputText(e){this.inputText=e}updateWithJson(e){var t,s,r;if(this.name=e.name,this.description=e.description,this.type=e.type,this.icon=null!==(t=e.icon)&&void 0!==t?t:h.defaultIcon,this.messageLengthLimit=e.message_length_limit,this.userIds=null!==(s=e.users)&&void 0!==s?s:this.userIds,this.serverLastMessageId=e.last_message_id,null!=e.current_user_attributes){this.canMessageError=e.current_user_attributes.can_message_error;const t=null!==(r=e.current_user_attributes.last_read_id)&&void 0!==r?r:0;this.setLastReadId(t),t>this.markAsReadLastSent&&(this.markAsReadLastSent=t)}}loadRecentMessages(){return d(this,void 0,void 0,(function*(){if(!this.needsRefresh||this.loadingMessages)return;let e;this.loadingMessages=!0,this.messages.length>0&&this.lastMessageId>0&&(e=this.lastMessageId);try{const t=yield(0,r._U)(this.channelId);(0,a.z)((()=>{const s=function(e){let t;for(const s of e)"number"==typeof s.messageId&&(null==t||s.messageId<t)&&(t=s.messageId);return null!=t?t:-1}(t);s>this.lastMessageId&&this.messagesMap.clear(),this.addMessages(t),this.needsRefresh=!1,this.loadingMessages=!1,0!==t.length||null!=e||(this.firstMessageId=this.minMessageId)}))}catch(t){(0,a.z)((()=>this.loadingMessages=!1))}}))}persistMessage(e,t){null!=t.uuid&&this.messagesMap.delete(t.uuid),e.persist(t),this.messagesMap.set(e.messageId,e)}sendMarkAsRead(){var e;const t=null!==(e=this.lastReadId)&&void 0!==e?e:0;this.markAsReadLastSent>=t||(this.markAsReadLastSent=t,(0,r.zJ)(this.channelId,t))}setLastReadId(e){var t;e>(null!==(t=this.lastReadId)&&void 0!==t?t:0)&&(this.lastReadId=e)}}Object.defineProperty(h,"defaultIcon",{enumerable:!0,configurable:!0,writable:!0,value:"/images/layout/chat/channel-default.png"});const b=h;u([a.LO],h.prototype,"canMessageError",void 0),u([a.LO],h.prototype,"channelId",void 0),u([a.LO],h.prototype,"description",void 0),u([a.LO],h.prototype,"firstMessageId",void 0),u([a.LO],h.prototype,"icon",void 0),u([a.LO],h.prototype,"inputText",void 0),u([a.LO],h.prototype,"lastReadId",void 0),u([a.LO],h.prototype,"loadingEarlierMessages",void 0),u([a.LO],h.prototype,"loadingMessages",void 0),u([a.LO],h.prototype,"messageLengthLimit",void 0),u([a.LO],h.prototype,"name",void 0),u([a.LO],h.prototype,"newPmChannel",void 0),u([a.LO],h.prototype,"type",void 0),u([a.LO],h.prototype,"uiState",void 0),u([a.LO],h.prototype,"userIds",void 0),u([a.LO],h.prototype,"messagesMap",void 0),u([a.LO],h.prototype,"usersLoaded",void 0),u([a.Fl],h.prototype,"announcementUsers",null),u([a.Fl],h.prototype,"canMessage",null),u([a.Fl],h.prototype,"firstMessage",null),u([a.Fl],h.prototype,"hasEarlierMessages",null),u([a.Fl],h.prototype,"isDisplayable",null),u([a.Fl],h.prototype,"isUnread",null),u([a.Fl],h.prototype,"lastMessage",null),u([a.Fl],h.prototype,"lastMessageId",null),u([a.Fl],h.prototype,"messages",null),u([a.Fl],h.prototype,"minMessageId",null),u([a.Fl],h.prototype,"pmTarget",null),u([a.Fl],h.prototype,"supportedType",null),u([a.aD],h.prototype,"addMessage",null),u([a.aD],h.prototype,"addMessages",null),u([a.aD],h.prototype,"addSendingMessage",null),u([a.aD],h.prototype,"afterSendMesssage",null),u([a.aD],h.prototype,"load",null),u([a.aD],h.prototype,"loadEarlierMessages",null),u([a.aD],h.prototype,"loadMetadata",null),u([a.aD],h.prototype,"moveMarkAsReadMarker",null),u([a.aD],h.prototype,"removeMessagesFromUserIds",null),u([a.aD],h.prototype,"setInputText",null),u([a.aD],h.prototype,"updateWithJson",null),u([a.aD],h.prototype,"loadRecentMessages",null),u([a.aD],h.prototype,"persistMessage",null),u([a.aD],h.prototype,"sendMarkAsRead",null),u([a.aD],h.prototype,"setLastReadId",null)},8256:(e,t,s)=>{s.d(t,{CI:()=>f,Gw:()=>v,ZP:()=>g});var r=s(3664),i=s(6486),n=s(8949),a=s(7181),o=s(9703),l=s(9139),c=s(3924),u=s(7595),d=s(9755),p=function(e,t,s,r){var i,n=arguments.length,a=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(n<3?i(a):n>3?i(t,s,a):i(t,s))||a);return n>3&&a&&Object.defineProperty(t,s,a),a},m=function(e,t,s,r){return new(s||(s=Promise))((function(i,n){function a(e){try{l(r.next(e))}catch(t){n(t)}}function o(e){try{l(r.throw(e))}catch(t){n(t)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(a,o)}l((r=r.apply(e,t||[])).next())}))};const h=["description","message","name","users"],b="createAnnouncement",f=Object.freeze({description:255,message:u.$,name:50});function v(e){return h.includes(e)}class g{get errors(){return{description:!this.isValidLength("description",!0),message:!this.isValidLength("message"),name:!this.isValidLength("name"),users:0===this.validUsers.size||(0,c.W)(this.inputs.users.trim())}}get isValid(){return!Object.values(this.errors).some(Boolean)}constructor(){Object.defineProperty(this,"inputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lookingUpUsers",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"showError",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"validUsers",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"debouncedLookupUsers",{enumerable:!0,configurable:!0,writable:!0,value:(0,i.debounce)((()=>this.lookupUsers()),1e3)}),Object.defineProperty(this,"initialized",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"uuid",{enumerable:!0,configurable:!0,writable:!0,value:(0,l.V)()}),Object.defineProperty(this,"xhrLookupUsers",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.inputs=this.resetInputs(),this.showError=this.resetErrors(),(0,n.rC)(this)}clear(){var e;null===(e=this.xhrLookupUsers)||void 0===e||e.abort(),this.lookingUpUsers=!1,this.resetErrors(),this.resetInputs(),this.validUsers.clear()}initialize(){if(this.initialized)return;const e=localStorage.getItem(b);if(null!=e)try{const t=JSON.parse(e),s=[];t.validUsers.length>0&&s.push(...t.validUsers),(0,c.W)(t.users.trim())&&s.push(...t.users.split(",")),this.inputs.description=t.description,this.inputs.message=t.message,this.inputs.name=t.name,s.length>0&&this.updateUsers(s.join(","),!0)}catch(t){console.error("invalid json in localStorage"),localStorage.removeItem(b)}(0,n.EH)((()=>{const e=Object.assign(Object.assign({},this.inputs),{validUsers:[...this.validUsers.keys()]});localStorage.setItem(b,JSON.stringify(e))})),this.initialized=!0}toJson(){const{description:e,message:t,name:s}=this.inputs;return{channel:{description:e,name:s},message:t,target_ids:[...this.validUsers.keys()],type:"ANNOUNCE",uuid:this.uuid}}updateUsers(e,t){var s;if(this.debouncedLookupUsers.cancel(),this.inputs.users=e,0===e.trim().length)return null===(s=this.xhrLookupUsers)||void 0===s||s.abort(),void(this.lookingUpUsers=!1);this.lookingUpUsers=!0,this.debouncedLookupUsers(),t&&this.debouncedLookupUsers.flush()}extractValidUsers(e){const t=this.inputs.users.split(",");for(const r of e)this.validUsers.set(r.id,r);const s=[];for(const r of t){const e=(0,c.G)(r.trim());this.validUsersContains(e)||s.push(r)}this.inputs.users=s.join(","),this.validUsers.delete(a.Z.currentUserOrFail.id)}isValidLength(e,t=!1){return(t||(0,c.W)(this.inputs[e]))&&this.inputs[e].length<=f[e]}lookupUsers(){var e;return m(this,void 0,void 0,(function*(){null===(e=this.xhrLookupUsers)||void 0===e||e.abort(),this.debouncedLookupUsers.cancel();const t=this.inputs.users.split(",").map((e=>(0,c.G)(e.trim()))).filter(Boolean);if(0!==t.length)try{this.xhrLookupUsers=d.getJSON((0,r.B)("chat.users.index"),{ids:t});const e=yield this.xhrLookupUsers;this.extractValidUsers(e.users)}catch(s){(0,o.qQ)(s)}finally{(0,n.z)((()=>this.lookingUpUsers=!1))}else this.lookingUpUsers=!1}))}resetErrors(){return this.showError={description:!1,message:!1,name:!1,users:!1}}resetInputs(){return this.inputs={description:"",message:"",name:"",users:""}}validUsersContains(e){return null!=e&&(this.validUsers.has(Number(e))||[...this.validUsers.values()].some((t=>t.username.toLowerCase()===e.toLowerCase())))}}p([n.LO],g.prototype,"inputs",void 0),p([n.LO],g.prototype,"lookingUpUsers",void 0),p([n.LO],g.prototype,"showError",void 0),p([n.LO],g.prototype,"validUsers",void 0),p([n.Fl],g.prototype,"errors",null),p([n.Fl],g.prototype,"isValid",null),p([n.aD],g.prototype,"clear",null),p([n.aD],g.prototype,"initialize",null),p([n.aD],g.prototype,"updateUsers",null),p([n.aD],g.prototype,"extractValidUsers",null),p([n.aD],g.prototype,"lookupUsers",null),p([n.aD],g.prototype,"resetErrors",null),p([n.aD],g.prototype,"resetInputs",null)},9603:(e,t,s)=>{s.d(t,{Z:()=>c});var r=s(8949),i=s(8125),n=s(381),a=s(7181),o=s(9139),l=function(e,t,s,r){var i,n=arguments.length,a=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(n<3?i(a):n>3?i(t,s,a):i(t,s))||a);return n>3&&a&&Object.defineProperty(t,s,a),a};class c{get sender(){var e;return null!==(e=a.Z.dataStore.userStore.get(this.senderId))&&void 0!==e?e:new i.ZP(-1)}constructor(){Object.defineProperty(this,"channelId",{enumerable:!0,configurable:!0,writable:!0,value:-1}),Object.defineProperty(this,"content",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"errored",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"isAction",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"messageId",{enumerable:!0,configurable:!0,writable:!0,value:(0,o.V)()}),Object.defineProperty(this,"persisted",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"senderId",{enumerable:!0,configurable:!0,writable:!0,value:-1}),Object.defineProperty(this,"timestamp",{enumerable:!0,configurable:!0,writable:!0,value:n().toISOString()}),Object.defineProperty(this,"type",{enumerable:!0,configurable:!0,writable:!0,value:"plain"}),Object.defineProperty(this,"uuid",{enumerable:!0,configurable:!0,writable:!0,value:this.messageId}),(0,r.rC)(this)}static fromJson(e){var t;const s=new c;return s.channelId=e.channel_id,s.content=e.content,s.isAction=e.is_action,s.messageId=e.message_id,s.persisted=!0,s.senderId=e.sender_id,s.timestamp=e.timestamp,s.type=e.type,s.uuid=null!==(t=e.uuid)&&void 0!==t?t:s.uuid,s}persist(e){this.persisted||(this.messageId=e.message_id,this.timestamp=e.timestamp,this.persisted=!0)}}l([r.LO],c.prototype,"channelId",void 0),l([r.LO],c.prototype,"content",void 0),l([r.LO],c.prototype,"errored",void 0),l([r.LO],c.prototype,"isAction",void 0),l([r.LO],c.prototype,"messageId",void 0),l([r.LO],c.prototype,"persisted",void 0),l([r.LO],c.prototype,"senderId",void 0),l([r.LO],c.prototype,"timestamp",void 0),l([r.LO],c.prototype,"type",void 0),l([r.LO],c.prototype,"uuid",void 0),l([r.Fl],c.prototype,"sender",null),l([r.aD],c.prototype,"persist",null)},7581:(e,t,s)=>{s.d(t,{O3:()=>n,ZP:()=>o,kK:()=>a});var r=s(8949),i=function(e,t,s,r){var i,n=arguments.length,a=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(n<3?i(a):n>3?i(t,s,a):i(t,s))||a);return n>3&&a&&Object.defineProperty(t,s,a),a};const n=[null,"user","beatmapset","forum_topic","news_post","build","channel"];function a(e){const t=e;return n.indexOf(t)>-1?t:n[0]}class o{get hasMore(){return null!==this.cursor&&this.stackNotificationCount<this.total}get hasVisibleNotifications(){return this.total>0&&this.stacks.size>0}get identity(){return{objectType:this.name}}get isEmpty(){return this.total<=0}get stackNotificationCount(){return[...this.stacks.values()].reduce(((e,t)=>e+t.total),0)}constructor(e,t){Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"resolver",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"cursor",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"isDeleting",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"isLoading",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"isMarkingAsRead",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"stacks",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"total",{enumerable:!0,configurable:!0,writable:!0,value:0}),(0,r.rC)(this)}static fromJson(e,t){const s=new o(e.name,t);return s.updateWithJson(e),s}delete(){this.resolver.delete(this)}loadMore(e){null!==this.cursor&&(this.isLoading=!0,this.resolver.loadMore(this.identity,e,this.cursor).always((0,r.aD)((()=>{this.isLoading=!1}))))}markTypeAsRead(){this.resolver.queueMarkAsRead(this)}removeStack(e){const t=this.stacks.delete(e.id);return t&&(this.total-=e.total),t}updateWithJson(e){this.cursor=e.cursor,this.total=e.total}}i([r.LO],o.prototype,"cursor",void 0),i([r.LO],o.prototype,"isDeleting",void 0),i([r.LO],o.prototype,"isLoading",void 0),i([r.LO],o.prototype,"isMarkingAsRead",void 0),i([r.LO],o.prototype,"stacks",void 0),i([r.LO],o.prototype,"total",void 0),i([r.Fl],o.prototype,"hasMore",null),i([r.Fl],o.prototype,"hasVisibleNotifications",null),i([r.Fl],o.prototype,"isEmpty",null),i([r.Fl],o.prototype,"stackNotificationCount",null),i([r.aD],o.prototype,"delete",null),i([r.aD],o.prototype,"loadMore",null),i([r.aD],o.prototype,"markTypeAsRead",null),i([r.aD],o.prototype,"removeStack",null),i([r.aD],o.prototype,"updateWithJson",null)},1882:(e,t,s)=>{s.d(t,{Z:()=>c});var r=s(6486),i=s(8949);var n=s(4927);var a=s(7181),o=s(3924),l=function(e,t,s,r){var i,n=arguments.length,a=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(n<3?i(a):n>3?i(t,s,a):i(t,s))||a);return n>3&&a&&Object.defineProperty(t,s,a),a};class c{get canMarkRead(){return this.id>0&&!this.isRead}get category(){var e;return(0,n.Yg)(null!==(e=this.name)&&void 0!==e?e:"")}get categoryGroupKey(){return(0,n.wl)(this)}get displayType(){return function(e){if(null!=e.objectType&&null!=e.objectId)return"user_achievement_unlock"===e.name?"user_achievement":e.objectType}(this)}get identity(){return{category:this.category,id:this.id,objectId:this.objectId,objectType:this.objectType}}get stackId(){return`${this.objectType}-${this.objectId}-${this.category}`}get title(){var e;return a.Z.userPreferences.get("beatmapset_title_show_original")&&null!==(e=(0,o.G)(this.details.titleUnicode))&&void 0!==e?e:this.details.title}constructor(e,t){Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"objectType",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"createdAtJson",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:{coverUrl:null,title:""}}),Object.defineProperty(this,"isDeleting",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"isMarkingAsRead",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"isRead",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"objectId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sourceUserId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"updateFromJson",{enumerable:!0,configurable:!0,writable:!0,value:e=>{var t,s;return this.createdAtJson=e.created_at,this.isRead=e.is_read,this.name=e.name,this.objectId=e.object_id,this.sourceUserId=e.source_user_id,this.details={coverUrl:null,title:""},"object"==typeof e.details&&((0,r.forEach)(e.details,((e,t)=>{this.details[(0,r.camelCase)(t)]=e})),"comment_new"===e.name&&(null===(t=e.details.reply_to)||void 0===t?void 0:t.user_id)===(null===(s=a.Z.currentUser)||void 0===s?void 0:s.id)&&(this.name="comment_reply")),this}}),(0,i.rC)(this)}static fromJson(e){return new c(e.id,e.object_type).updateFromJson(e)}}l([i.LO],c.prototype,"isDeleting",void 0),l([i.LO],c.prototype,"isMarkingAsRead",void 0),l([i.LO],c.prototype,"isRead",void 0),l([i.Fl],c.prototype,"canMarkRead",null),l([i.Fl],c.prototype,"category",null),l([i.Fl],c.prototype,"categoryGroupKey",null),l([i.Fl],c.prototype,"displayType",null),l([i.Fl],c.prototype,"stackId",null),l([i.Fl],c.prototype,"title",null)},8125:(e,t,s)=>{s.d(t,{Mm:()=>a,ZP:()=>l,ei:()=>c,gm:()=>o,z7:()=>u});var r=s(8949),i=s(1270),n=function(e,t,s,r){var i,n=arguments.length,a=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(n<3?i(a):n>3?i(t,s,a):i(t,s))||a);return n>3&&a&&Object.defineProperty(t,s,a),a};function a(e){return e.trim().toLowerCase()}function o(e,t){return e.username.localeCompare(t.username)}class l{constructor(e){Object.defineProperty(this,"avatarUrl",{enumerable:!0,configurable:!0,writable:!0,value:"/images/layout/avatar-guest.png"}),Object.defineProperty(this,"countryCode",{enumerable:!0,configurable:!0,writable:!0,value:"XX"}),Object.defineProperty(this,"defaultGroup",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"groups",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"isActive",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"isBot",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"isDeleted",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"isOnline",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"isSupporter",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lastVisit",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"pmFriendsOnly",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"profileColour",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"username",{enumerable:!0,configurable:!0,writable:!0,value:""}),this.id=e,(0,r.rC)(this)}is(e){return null!=e&&e.id===this.id}toJson(){return{avatar_url:this.avatarUrl,country_code:this.countryCode,default_group:this.defaultGroup,groups:this.groups,id:this.id,is_active:this.isActive,is_bot:this.isBot,is_deleted:this.isDeleted,is_online:this.isOnline,is_supporter:this.isSupporter,last_visit:this.lastVisit,pm_friends_only:this.pmFriendsOnly,profile_colour:this.profileColour,username:this.username}}updateWithJson(e){var t,s;this.avatarUrl=e.avatar_url,this.countryCode=e.country_code,this.defaultGroup=null!==(t=e.default_group)&&void 0!==t?t:"",this.isActive=e.is_active,this.isBot=e.is_bot,this.isOnline=e.is_online,this.isSupporter=e.is_supporter,this.pmFriendsOnly=e.pm_friends_only,this.profileColour=null!==(s=e.profile_colour)&&void 0!==s?s:"",this.username=e.username,null!=e.groups&&(this.groups=e.groups)}}n([r.LO],l.prototype,"avatarUrl",void 0),n([r.LO],l.prototype,"countryCode",void 0),n([r.LO],l.prototype,"defaultGroup",void 0),n([r.LO],l.prototype,"groups",void 0),n([r.LO],l.prototype,"id",void 0),n([r.LO],l.prototype,"isActive",void 0),n([r.LO],l.prototype,"isBot",void 0),n([r.LO],l.prototype,"isDeleted",void 0),n([r.LO],l.prototype,"isOnline",void 0),n([r.LO],l.prototype,"isSupporter",void 0),n([r.LO],l.prototype,"lastVisit",void 0),n([r.LO],l.prototype,"pmFriendsOnly",void 0),n([r.LO],l.prototype,"profileColour",void 0),n([r.LO],l.prototype,"username",void 0),n([r.aD],l.prototype,"updateWithJson",null);const c=new l(-1);c.isDeleted=!0,c.username=(0,i.dW)("users.deleted");const u=c.toJson()},6244:(e,t,s)=>{s.d(t,{Z:()=>c});var r=s(4403),i=s(3664),n=s(381),a=s(7294),o=s(3336),l=s(1270);function c({modifiers:e,post:t}){let s;null!=t.first_image&&(s=a.createElement("img",{className:"news-card__cover",src:t.first_image}));let c=t.preview;return null==c&&(c=""),a.createElement("a",{className:(0,o.sb)("news-card",null!=e?e:["index","hover"]),href:(0,i.B)("news.show",{news:t.slug})},a.createElement("div",{className:"news-card__cover-container"},s,a.createElement("div",{className:"news-card__time js-tooltip-time",title:t.published_at},n.utc(t.published_at).format("ll"))),a.createElement("div",{className:"news-card__main"},a.createElement("div",{className:"news-card__row news-card__row--title"},t.title),a.createElement("div",{dangerouslySetInnerHTML:{__html:c},className:"news-card__row news-card__row--preview"}),a.createElement("div",{className:"news-card__row news-card__row--author"},a.createElement(r.Z,{mappings:{user:a.createElement("strong",null,t.author)},pattern:(0,l.dW)("news.show.by")}))))}},3858:(e,t,s)=>{s.d(t,{Z:()=>u});var r=s(381),i=s(7294),n=s(1270),a=s(3664),o=s(7181);class l extends i.Component{get stateRecordKey(){return this.props.date.format("YYYYMM")}get stateRecordValue(){return this.stateRecord instanceof HTMLElement&&null!=this.stateRecord.dataset[this.stateRecordKey]?"1"===this.stateRecord.dataset[this.stateRecordKey]:null}constructor(e){if(super(e),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:{expanded:!1}}),Object.defineProperty(this,"stateRecord",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"recordState",{enumerable:!0,configurable:!0,writable:!0,value:()=>{null!=this.stateRecord&&(this.stateRecord.dataset[this.stateRecordKey]=this.state.expanded?"1":"")}}),Object.defineProperty(this,"renderPost",{enumerable:!0,configurable:!0,writable:!0,value:e=>{let t="news-sidebar-month__item";return null!=this.props.currentPost&&this.props.currentPost.id===e.id&&(t+=" news-sidebar-month__item--active"),i.createElement("li",{key:e.id},i.createElement("a",{className:t,href:(0,a.B)("news.show",{news:e.slug})},e.title))}}),Object.defineProperty(this,"toggleExpand",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.setState({expanded:!this.state.expanded},this.recordState)}}),o.Z.windowSize.isMobile)this.state.expanded=!1;else if(null==e.currentPost)this.state.expanded=e.initialExpand;else{const t=r.utc(e.currentPost.published_at);this.state.expanded=t.year()===e.date.year()&&t.month()===e.date.month()}const t=document.querySelector(".js-news-sidebar-record");t instanceof HTMLElement&&(this.stateRecord=t),null==this.stateRecordValue?this.recordState():this.state.expanded=this.stateRecordValue}render(){return i.createElement("div",{className:"news-sidebar-month"},i.createElement("button",{className:"news-sidebar-month__toggle",onClick:this.toggleExpand,type:"button"},this.props.date.format((0,n.dW)("common.datetime.year_month_short.moment")),i.createElement("span",{className:"news-sidebar-month__toggle-icon"},i.createElement("i",{className:this.state.expanded?"fas fa-chevron-up":"fas fa-chevron-down"}))),i.createElement("ul",{className:"news-sidebar-month__items "+(this.state.expanded?"":"hidden")},this.props.posts.map(this.renderPost)))}}function c(e){return i.createElement("div",{className:"news-sidebar-years"},e.years.map((t=>i.createElement("a",{key:t,className:"news-sidebar-years__item "+(t===e.currentYear?"news-sidebar-years__item--active":""),href:(0,a.B)("news.index",{year:t})},t))))}function u(e){var t;const s={},a={},o=new Set;for(const i of e.data.news_posts){const e=r.utc(i.published_at),n=e.format("YYYY-MM");(s[n]=null!==(t=s[n])&&void 0!==t?t:[]).push(i),a[n]=e,o.add(n)}const u=[...o].sort().reverse();let d=!0;return i.createElement("div",{className:"sidebar"},i.createElement("button",{className:"sidebar__mobile-toggle sidebar__mobile-toggle--mobile-only js-mobile-toggle","data-mobile-toggle-target":"news-archive",type:"button"},i.createElement("h2",{className:"sidebar__title"},(0,n.dW)("news.sidebar.archive")),i.createElement("div",{className:"sidebar__mobile-toggle-icon"},i.createElement("i",{className:"fas fa-chevron-down"}))),i.createElement("div",{className:"sidebar__content hidden-xs js-mobile-toggle","data-mobile-toggle-id":"news-archive"},i.createElement(c,{currentYear:e.data.current_year,years:e.data.years}),u.map((t=>{const r=a[t],n=s[t];if(null==n||null==r)return;const o=d;return d=!1,i.createElement(l,{key:t,currentPost:e.currentPost,date:r,initialExpand:o,posts:n})}))))}},4927:(e,t,s)=>{function r(e){return null==e.objectId||null==e.name||null==e.category?null:"user_achievement_unlock"===e.name?`achievement:${e.id}`:`${e.category}:${e.objectId}`}function i(e){var t;return null!==(t=n[e])&&void 0!==t?t:e}s.d(t,{Yg:()=>i,wl:()=>r});const n={beatmap_owner_change:"beatmap_owner_change",beatmapset_discussion_lock:"beatmapset_discussion",beatmapset_discussion_post_new:"beatmapset_discussion",beatmapset_discussion_qualified_problem:"beatmapset_problem",beatmapset_discussion_review_new:"beatmapset_discussion",beatmapset_discussion_unlock:"beatmapset_discussion",beatmapset_disqualify:"beatmapset_state",beatmapset_love:"beatmapset_state",beatmapset_nominate:"beatmapset_state",beatmapset_qualify:"beatmapset_state",beatmapset_rank:"beatmapset_state",beatmapset_remove_from_loved:"beatmapset_state",beatmapset_reset_nominations:"beatmapset_state",channel_announcement:"announcement",channel_message:"channel",comment_new:"comment",comment_reply:"comment",forum_topic_reply:"forum_topic_reply",user_achievement_unlock:"user_achievement_unlock",user_beatmapset_new:"user_beatmapset_new",user_beatmapset_revive:"user_beatmapset_new"}},8035:(e,t,s)=>{s.d(t,{Z:()=>A});var r=s(9323),i=s(7294),n=s(3890);const a={announcement:["fas fa-bullhorn"],beatmap_owner_change:["fas fa-drafting-compass","fas fa-user-friends"],beatmapset_discussion:["fas fa-drafting-compass","fas fa-comment"],beatmapset_problem:["fas fa-drafting-compass","fas fa-exclamation-circle"],beatmapset_state:["fas fa-drafting-compass"],channel:["fas fa-comments"],comment:["fas fa-comment"],forum_topic_reply:["fas fa-comment-medical"],user_achievement_unlock:["fas fa-medal"],user_beatmapset_new:["fas fa-music"]},o={beatmap_owner_change:["fas fa-drafting-compass","fas fa-user-friends"],beatmapset_discussion_lock:["fas fa-drafting-compass","fas fa-lock"],beatmapset_discussion_post_new:["fas fa-drafting-compass","fas fa-comment-medical"],beatmapset_discussion_qualified_problem:["fas fa-drafting-compass","fas fa-exclamation-circle"],beatmapset_discussion_unlock:["fas fa-drafting-compass","fas fa-unlock"],beatmapset_disqualify:["fas fa-drafting-compass","far fa-times-circle"],beatmapset_love:["fas fa-drafting-compass","fas fa-heart"],beatmapset_nominate:["fas fa-drafting-compass","fas fa-vote-yea"],beatmapset_qualify:["fas fa-drafting-compass","fas fa-check"],beatmapset_rank:["fas fa-drafting-compass","fas fa-check-double"],beatmapset_remove_from_loved:["fas fa-drafting-compass","fas fa-heart-broken"],beatmapset_reset_nominations:["fas fa-drafting-compass","fas fa-undo"],channel_announcement:["fas fa-bullhorn"],channel_message:["fas fa-comments"],comment_new:["fas fa-comment"],comment_reply:["fas fa-reply"],forum_topic_reply:["fas fa-comment-medical"],user_achievement_unlock:["fas fa-trophy"],user_beatmapset_new:["fas fa-music"],user_beatmapset_revive:["fas fa-trash-restore"]},l={beatmap_owner_change:["fas fa-user-edit"],beatmapset_discussion_lock:["fas fa-lock"],beatmapset_discussion_post_new:["fas fa-comment-medical"],beatmapset_discussion_qualified_problem:["fas fa-exclamation-circle"],beatmapset_discussion_unlock:["fas fa-unlock"],beatmapset_disqualify:["far fa-times-circle"],beatmapset_love:["fas fa-heart"],beatmapset_nominate:["fas fa-vote-yea"],beatmapset_qualify:["fas fa-check"],beatmapset_rank:["fas fa-check-double"],beatmapset_remove_from_loved:["fas fa-heart-broken"],beatmapset_reset_nominations:["fas fa-undo"],channel_announcement:["fas fa-bullhorn"],channel_message:["fas fa-comments"],comment_new:["fas fa-comment"],comment_reply:["fas fa-reply"],forum_topic_reply:["fas fa-comment-medical"],user_beatmapset_new:["fas fa-music"],user_beatmapset_revive:["fas fa-trash-restore"]};s(1882);function c(e){return"beatmap_owner_change"===e.name}var u=s(1270);function d(e,t=!1){const s={content:e.details.content,title:e.title,username:e.details.username};c(e)&&(s.beatmap=e.details.version),"beatmapset_discussion_review_new"===e.name&&null!=e.details.embeds&&function(e,t){const s=[];for(const r of["praises","problems","suggestions"]){const i=e[r];i>0&&s.push((0,u.jn)(`notifications.item.beatmapset.beatmapset_discussion.review_count.${r}`,i)),t[r]=i}0===s.length&&s.push((0,u.jn)("notifications.item.beatmapset.beatmapset_discussion.review_count.problems",0)),t.review_counts=(0,u.m2)(s)}(e.details.embeds,s);let r=`notifications.item.${e.displayType}.${e.category}`;"channel"===e.objectType&&(r+=`.${e.details.type}`),r+=`.${e.name}`,t&&(r+="_compact");const i=`${r}_empty`;return null==e.details.content&&(0,u.Xl)(i,window.fallbackLocale)&&(r=i),(0,u.dW)(r,s)}function p(e){if("channel"===e.objectType){const t={title:e.title,username:e.details.username},s=`notifications.item.${e.objectType}.${e.category}.${e.details.type}.${e.name}_group`;return(0,u.dW)(s,t)}if("user_achievement_unlock"===e.name){const t={username:e.details.username};return(0,u.dW)(`notifications.item.${e.displayType}.${e.category}.${e.name}_group`,t)}if("user_beatmapset_new"===e.category){const t={username:e.details.username};return(0,u.dW)(`notifications.item.${e.displayType}.${e.category}.${e.category}_group`,t)}return e.title}var m=s(3664),h=s(41);function b(e){if(c(e))return(0,m.B)("beatmapsets.discussion",{beatmap:"-",beatmapset:e.objectId,mode:"events"});if("comment_new"===e.name||"comment_reply"===e.name)switch(e.objectType){case"beatmapset":return(0,m.B)("beatmapsets.show",{beatmapset:e.objectId});case"build":return(0,m.B)("changelog.show",{changelog:e.objectId,key:"id"});case"news_post":return(0,m.B)("news.show",{key:"id",news:e.objectId})}else{if("user_achievement_unlock"===e.name)return v(e);if("user_beatmapset_new"===e.category)return`${(0,m.B)("users.show",{user:e.objectId})}#beatmaps`}switch(e.objectType){case"beatmapset":return(0,m.B)("beatmapsets.discussion",{beatmapset:e.objectId});case"channel":return null!=e.details.channelId?(0,m.B)("chat.index",{channel_id:e.details.channelId}):(0,m.B)("chat.index",{sendto:e.sourceUserId});case"forum_topic":return(0,m.B)("forum.topics.show",{start:"unread",topic:e.objectId})}}function f(e){if(c(e))return(0,m.B)("beatmapsets.discussion",{beatmap:e.details.beatmapId,beatmapset:e.objectId});switch(e.name){case"beatmapset_discussion_lock":case"beatmapset_discussion_unlock":case"beatmapset_disqualify":case"beatmapset_love":case"beatmapset_nominate":case"beatmapset_qualify":case"beatmapset_remove_from_loved":case"beatmapset_reset_nominations":return(0,m.B)("beatmapsets.discussion",{beatmapset:e.objectId});case"beatmapset_discussion_post_new":case"beatmapset_discussion_qualified_problem":case"beatmapset_discussion_review_new":return(0,h.bf)({beatmapId:e.details.beatmapId,beatmapsetId:e.objectId,discussionId:e.details.discussionId,postId:e.details.postId});case"beatmapset_rank":return(0,m.B)("beatmapsets.show",{beatmapset:e.objectId});case"channel_announcement":return(0,m.B)("chat.index",{channel_id:e.details.channelId});case"channel_message":return(0,m.B)("chat.index",{sendto:e.sourceUserId});case"comment_new":case"comment_reply":return(0,m.B)("comments.show",{comment:e.details.commentId});case"forum_topic_reply":return(0,m.B)("forum.posts.show",{post:e.details.postId});case"user_achievement_unlock":return v(e);case"user_beatmapset_new":case"user_beatmapset_revive":return(0,m.B)("beatmapsets.show",{beatmapset:e.details.beatmapsetId})}}function v(e){var t;const s={mode:null!==(t=e.details.achievementMode)&&void 0!==t?t:void 0,user:e.details.userId};return`${(0,m.B)("users.show",s)}#medals`}var g=s(8050),y=s(9380),w=s(2903),_=s(12),E=s(3336),O=function(e,t,s,r){var i,n=arguments.length,a=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(n<3?i(a):n>3?i(t,s,a):i(t,s))||a);return n>3&&a&&Object.defineProperty(t,s,a),a};let P=class extends i.Component{constructor(){super(...arguments),Object.defineProperty(this,"onLinkClick",{enumerable:!0,configurable:!0,writable:!0,value:e=>{var t,s;0!==e.button&&1!==e.button||null===(s=(t=this.props).markRead)||void 0===s||s.call(t)}})}get canMarkAsRead(){var e;return null!==(e=this.props.canMarkAsRead)&&void 0!==e?e:this.props.item.canMarkRead}render(){const e=(0,E.sw)(this.props.modifiers,this.props.item.category,{read:this.props.item.isRead&&!this.props.canMarkAsRead});return i.createElement("div",{className:(0,E.sb)("notification-popup-item",e)},i.createElement("a",{className:"notification-popup-item__link",href:this.props.url,onAuxClick:this.onLinkClick,onClick:this.onLinkClick}),this.renderCover(),i.createElement("div",{className:"notification-popup-item__main"},i.createElement("div",{className:"notification-popup-item__content"},this.renderCategory(),this.renderMessage(),this.renderTime(),this.renderExpandButton()),this.renderMarkAsReadButton(),this.renderDeleteButton()),this.renderUnreadStripe())}renderCategory(){if(!this.props.withCategory)return null;const e=(0,u.dW)(`notifications.item.${this.props.item.displayType}.${this.props.item.category}._`);return""===e?null:i.createElement("div",{className:"notification-popup-item__row notification-popup-item__row--category"},e)}renderCover(){const e=this.props.withCoverImage?this.props.item.details.coverUrl:null;return i.createElement("div",{className:"notification-popup-item__cover",style:{backgroundImage:(0,E.eF)(e)}},i.createElement("div",{className:"notification-popup-item__cover-overlay"},this.renderCoverIcons()))}renderCoverIcons(){return null==this.props.icons?null:this.props.icons.map((e=>i.createElement("div",{key:e,className:"notification-popup-item__cover-icon"},i.createElement("span",{className:e}))))}renderDeleteButton(){var e;return this.context.isWidget?null:i.createElement(y.Z,{isDeleting:null!==(e=this.props.isDeleting)&&void 0!==e?e:this.props.item.isDeleting,modifiers:["fancy"],onDelete:this.props.delete})}renderExpandButton(){return null==this.props.expandButton?null:i.createElement("div",{className:"notification-popup-item__row notification-popup-item__row--expand"},this.props.expandButton)}renderMarkAsReadButton(){var e;return this.canMarkAsRead?i.createElement(w.Z,{isMarkingAsRead:null!==(e=this.props.isMarkingAsRead)&&void 0!==e?e:this.props.item.isMarkingAsRead,modifiers:["fancy"],onMarkAsRead:this.props.markRead}):null}renderMessage(){return i.createElement("div",{className:"notification-popup-item__row notification-popup-item__row--message"},this.props.message)}renderTime(){if(null!=this.props.item.createdAtJson)return i.createElement("a",{className:"notification-popup-item__row notification-popup-item__row--time u-hover",href:this.props.url,onAuxClick:this.onLinkClick,onClick:this.onLinkClick},i.createElement(_.Z,{dateTime:this.props.item.createdAtJson,relative:!0}))}renderUnreadStripe(){return this.context.isWidget||!this.canMarkAsRead?null:i.createElement("span",{className:"notification-popup-item__unread-stripe"})}};Object.defineProperty(P,"contextType",{enumerable:!0,configurable:!0,writable:!0,value:g.u}),P=O([r.Pi],P);const j=P;var k=function(e,t,s,r){var i,n=arguments.length,a=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(n<3?i(a):n>3?i(t,s,a):i(t,s))||a);return n>3&&a&&Object.defineProperty(t,s,a),a};let N=class extends i.Component{constructor(){super(...arguments),Object.defineProperty(this,"handleDelete",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.props.stack.deleteItem(this.props.item)}}),Object.defineProperty(this,"handleMarkAsRead",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.props.stack.markAsRead(this.props.item)}})}render(){var e;return i.createElement(j,{delete:this.handleDelete,icons:l[null!==(e=this.props.item.name)&&void 0!==e?e:""],item:this.props.item,markRead:this.handleMarkAsRead,message:d(this.props.item,!0),modifiers:["compact"],url:f(this.props.item),withCategory:!1,withCoverImage:"user_achievement_unlock"===this.props.item.name||"user_beatmapset_new"===this.props.item.category})}};N=k([r.Pi],N);const S=N;var C=function(e,t,s,r){var i,n=arguments.length,a=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(n<3?i(a):n>3?i(t,s,a):i(t,s))||a);return n>3&&a&&Object.defineProperty(t,s,a),a};let T=class extends i.Component{constructor(){super(...arguments),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:{expanded:!1}}),Object.defineProperty(this,"handleDelete",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.props.stack.delete()}}),Object.defineProperty(this,"handleMarkAsRead",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.props.stack.markStackAsRead()}}),Object.defineProperty(this,"handleShowLess",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.setState({expanded:!1})}}),Object.defineProperty(this,"handleShowMore",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.props.stack.loadMore(this.context)}}),Object.defineProperty(this,"renderItem",{enumerable:!0,configurable:!0,writable:!0,value:e=>i.createElement("div",{key:e.id,className:"notification-popup-item-group__item"},i.createElement(S,{item:e,stack:this.props.stack}))}),Object.defineProperty(this,"toggleExpand",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.setState({expanded:!this.state.expanded})}})}render(){const e=this.props.stack.first;return null==e?null:i.createElement("div",{className:"notification-popup-item-group"},i.createElement(j,{canMarkAsRead:this.props.stack.canMarkAsRead,delete:this.handleDelete,expandButton:this.renderExpandButton(),icons:a[e.category],isDeleting:this.props.stack.isDeleting,isMarkingAsRead:this.props.stack.isMarkingAsRead,item:e,markRead:this.handleMarkAsRead,message:p(e),modifiers:["group"],url:b(e),withCategory:!0,withCoverImage:!0}),this.renderItems())}renderExpandButton(){const e=this.props.stack.total,t=this.context.isWidget?"common.count.update":"common.count.notifications";return i.createElement("button",{className:"show-more-link show-more-link--notification-group u-hover",onClick:this.toggleExpand,type:"button"},i.createElement("span",{className:"show-more-link__label"},i.createElement("span",{className:"show-more-link__label-text"},(0,u.jn)(t,e)),i.createElement("span",{className:"show-more-link__label-icon"},i.createElement("span",{className:"fas fa-angle-"+(this.state.expanded?"up":"down")}))))}renderItems(){return this.state.expanded?i.createElement("div",{className:"notification-popup-item-group__items"},this.props.stack.orderedNotifications.map(this.renderItem),i.createElement("div",{className:"notification-popup-item-group__show-more"},i.createElement("div",{className:"notification-popup-item-group__expand"},this.renderShowMore()),i.createElement("div",{className:"notification-popup-item-group__collapse"},this.renderShowLess(),this.props.stack.canMarkAsRead&&i.createElement(w.Z,{isMarkingAsRead:this.props.stack.isMarkingAsRead,onMarkAsRead:this.handleMarkAsRead}),!this.context.isWidget&&i.createElement(y.Z,{isDeleting:this.props.stack.isDeleting,onDelete:this.handleDelete})))):null}renderShowLess(){return i.createElement(n.Z,{callback:this.handleShowLess,direction:"up",hasMore:!0,label:(0,u.dW)("common.buttons.show_less"),modifiers:["notification-group"]})}renderShowMore(){const e=this.props.stack;return e.hasMore?i.createElement(n.Z,{callback:this.handleShowMore,hasMore:null!=e.cursor,loading:e.isLoading,modifiers:["notification-group"]}):null}};Object.defineProperty(T,"contextType",{enumerable:!0,configurable:!0,writable:!0,value:g.u}),T=C([r.Pi],T);const x=T;var D=function(e,t,s,r){var i,n=arguments.length,a=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(n<3?i(a):n>3?i(t,s,a):i(t,s))||a);return n>3&&a&&Object.defineProperty(t,s,a),a};let R=class extends i.Component{constructor(){super(...arguments),Object.defineProperty(this,"handleDelete",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.props.stack.deleteItem(this.props.stack.first)}}),Object.defineProperty(this,"handleMarkAsRead",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.props.stack.markAsRead(this.props.stack.first)}})}render(){var e;const t=this.props.stack.first;return null==t?null:i.createElement(j,{delete:this.handleDelete,icons:o[null!==(e=t.name)&&void 0!==e?e:""],isDeleting:t.isDeleting,isMarkingAsRead:t.isMarkingAsRead,item:t,markRead:this.handleMarkAsRead,message:d(t),modifiers:["one"],url:f(t),withCategory:!0,withCoverImage:!0})}};R=D([r.Pi],R);const M=R;var I=function(e,t,s,r){var i,n=arguments.length,a=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(n<3?i(a):n>3?i(t,s,a):i(t,s))||a);return n>3&&a&&Object.defineProperty(t,s,a),a};let L=class extends i.Component{render(){if(!this.props.stack.hasVisibleNotifications)return null;const e=this.props.stack.isSingle?M:x;return i.createElement(e,{key:this.props.stack.id,stack:this.props.stack})}};L=I([r.Pi],L);const A=L},8050:(e,t,s)=>{s.d(t,{u:()=>r});const r=(0,s(7294).createContext)({excludes:[],isWidget:!1})},6160:(e,t,s)=>{s.d(t,{Z:()=>c});var r=s(8949),i=s(7581),n=s(9014),a=s(5076),o=s(2918),l=function(e,t,s,r){var i,n=arguments.length,a=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(n<3?i(a):n>3?i(t,s,a):i(t,s))||a);return n>3&&a&&Object.defineProperty(t,s,a),a};class c{get isMarkingCurrentTypeAsRead(){return this.getNonNullTypes(this.type).some((e=>e.isMarkingAsRead))}get stacks(){return this.store.orderedStacksOfType(this.currentFilter).filter((e=>e.hasVisibleNotifications&&!this.isExcluded(e.objectType)))}get type(){return this.getType(this.currentFilter)}get typeNameFromUrl(){return(0,i.kK)((0,n.Kn)().get("type"))}constructor(e,t,s){Object.defineProperty(this,"notificationStore",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"contextType",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"currentFilter",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"store",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"typeNamesWithoutNull",{enumerable:!0,configurable:!0,writable:!0,value:i.O3.filter((e=>!(null==e||this.isExcluded(e))))}),Object.defineProperty(this,"getType",{enumerable:!0,configurable:!0,writable:!0,value:e=>this.store.getOrCreateType({objectType:e})}),this.currentFilter=void 0!==s?s:this.typeNameFromUrl,this.store=t.isWidget?e.unreadStacks:e.stacks,(0,r.rC)(this)}getTotal(e){return this.getNonNullTypes(e).reduce(((e,t)=>e+t.total),0)}loadMore(){var e;null===(e=this.type)||void 0===e||e.loadMore(this.contextType)}markCurrentTypeAsRead(){this.getNonNullTypes(this.type).forEach((e=>{e.markTypeAsRead()}))}navigateTo(e){if(this.currentFilter=e,0===[...this.stacks].length&&this.loadMore(),!this.contextType.isWidget){let t;if(null==e){const e=new URL((0,n.JJ)().href);e.searchParams.delete("type"),t=e.href}else t=(0,a.bj)(null,{type:e});o.controller.advanceHistory(t)}}getNonNullTypes(e){return null!=e.name?[e]:this.typeNamesWithoutNull.map(this.getType)}isExcluded(e){return this.contextType.excludes.includes(e)}}l([r.LO],c.prototype,"currentFilter",void 0),l([r.Fl],c.prototype,"isMarkingCurrentTypeAsRead",null),l([r.Fl],c.prototype,"stacks",null),l([r.Fl],c.prototype,"type",null),l([r.aD],c.prototype,"loadMore",null),l([r.aD],c.prototype,"markCurrentTypeAsRead",null),l([r.aD],c.prototype,"navigateTo",null)},9380:(e,t,s)=>{s.d(t,{Z:()=>c});var r=s(6741),i=s(9323),n=s(7294),a=s(3336),o=function(e,t,s,r){var i,n=arguments.length,a=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(n<3?i(a):n>3?i(t,s,a):i(t,s))||a);return n>3&&a&&Object.defineProperty(t,s,a),a};let l=class extends n.Component{render(){return this.props.isDeleting?n.createElement("div",{className:(0,a.sb)("notification-action-button",this.props.modifiers)},n.createElement("span",{className:"notification-action-button__text"},this.props.text),n.createElement("div",{className:"notification-action-button__icon"},n.createElement(r.$,null))):n.createElement("button",{className:(0,a.sb)("notification-action-button",this.props.modifiers),onClick:this.props.onDelete,type:"button"},n.createElement("span",{className:"notification-action-button__text"},this.props.text),n.createElement("div",{className:"notification-action-button__icon"},n.createElement("span",{className:"fas fa-trash"})))}};Object.defineProperty(l,"defaultProps",{enumerable:!0,configurable:!0,writable:!0,value:{modifiers:[]}}),l=o([i.Pi],l);const c=l},2468:(e,t,s)=>{s.d(t,{Ko:()=>o,d7:()=>a,lE:()=>l,u9:()=>n});var r=s(8701),i=s(7417);class n extends r.Z{constructor(e,t){super(),Object.defineProperty(this,"data",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"context",{enumerable:!0,configurable:!0,writable:!0,value:t})}}class a extends r.Z{constructor(e){super(),Object.defineProperty(this,"data",{enumerable:!0,configurable:!0,writable:!0,value:e})}}class o extends r.Z{constructor(e,t){super(),Object.defineProperty(this,"data",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"readCount",{enumerable:!0,configurable:!0,writable:!0,value:t})}static fromJson(e){const t=e.data.notifications.map((e=>(0,i.xZ)(e)));return new o(t,e.data.read_count)}}class l extends r.Z{constructor(e,t){super(),Object.defineProperty(this,"data",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"readCount",{enumerable:!0,configurable:!0,writable:!0,value:t})}static fromJson(e){const t=e.data.notifications.map((e=>(0,i.xZ)(e)));return new l(t,e.data.read_count)}}},7417:(e,t,s)=>{function r(e){return`${e.objectType}-${e.objectId}-${e.category}`}function i(e){return null!=e.objectId&&null!=e.category?null!=e.id?"notification":"stack":"type"}function n(e){return{category:e.category,id:e.id,objectId:e.object_id,objectType:e.object_type}}function a(e){return{category:e.category,id:e.id,object_id:e.objectId,object_type:e.objectType}}function o(e){return`${e.objectType}-${e.objectId}-${e.category}-${e.id}`}s.d(t,{$w:()=>r,BB:()=>o,Qs:()=>a,_n:()=>i,xZ:()=>n})},2903:(e,t,s)=>{s.d(t,{Z:()=>c});var r=s(6741),i=s(9323),n=s(7294),a=s(3336),o=function(e,t,s,r){var i,n=arguments.length,a=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(n<3?i(a):n>3?i(t,s,a):i(t,s))||a);return n>3&&a&&Object.defineProperty(t,s,a),a};let l=class extends n.Component{render(){return this.props.isMarkingAsRead?n.createElement("div",{className:(0,a.sb)("notification-action-button",this.props.modifiers)},n.createElement("span",{className:"notification-action-button__text"},this.props.text),n.createElement("div",{className:"notification-action-button__icon"},n.createElement(r.$,null))):n.createElement("button",{className:(0,a.sb)("notification-action-button",this.props.modifiers),onClick:this.props.onMarkAsRead,type:"button"},n.createElement("span",{className:"notification-action-button__text"},this.props.text),n.createElement("div",{className:"notification-action-button__icon"},n.createElement("span",{className:"fas fa-check"})))}};Object.defineProperty(l,"defaultProps",{enumerable:!0,configurable:!0,writable:!0,value:{modifiers:[]}}),l=o([i.Pi],l);const c=l},7181:(e,t,s)=>{s.d(t,{Z:()=>xs});var r=s(8949),i=function(e,t,s,r){var i,n=arguments.length,a=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(n<3?i(a):n>3?i(t,s,a):i(t,s))||a);return n>3&&a&&Object.defineProperty(t,s,a),a};class n{get hasMoreForPager(){return this.hasMore&&this.beatmapsetIds.size<this.total}get isExpired(){return null==this.fetchedAt||(new Date).getTime()-this.fetchedAt.getTime()>n.CACHE_DURATION_MS}constructor(){Object.defineProperty(this,"beatmapsetIds",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"cursorString",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchedAt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hasMore",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"total",{enumerable:!0,configurable:!0,writable:!0,value:0}),(0,r.rC)(this)}append(e){for(const t of e.beatmapsets)this.beatmapsetIds.add(t.id);this.cursorString=e.cursor_string,this.fetchedAt=new Date,this.hasMore=null!==e.cursor_string,this.total=e.total}reset(){this.beatmapsetIds.clear(),this.fetchedAt=void 0,this.cursorString=void 0,this.hasMore=!1,this.total=0}}Object.defineProperty(n,"CACHE_DURATION_MS",{enumerable:!0,configurable:!0,writable:!0,value:6e4});const a=n;i([r.LO],n.prototype,"beatmapsetIds",void 0),i([r.LO],n.prototype,"hasMore",void 0),i([r.LO],n.prototype,"total",void 0),i([r.Fl],n.prototype,"hasMoreForPager",null),i([r.Fl],n.prototype,"isExpired",null),i([r.aD],n.prototype,"append",null),i([r.aD],n.prototype,"reset",null);var o=s(6486),l=s(3924),c=s(5076),u=function(e,t,s,r){var i,n=arguments.length,a=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(n<3?i(a):n>3?i(t,s,a):i(t,s))||a);return n>3&&a&&Object.defineProperty(t,s,a),a};const d={c:"general",e:"extra",g:"genre",l:"language",m:"mode",nsfw:"nsfw",played:"played",q:"query",r:"rank",s:"status",sort:"sort"},p=(0,o.invert)(d),m=["extra","general","genre","language","mode","nsfw","played","query","rank","sort","status"],h=["query","status"],b=["played","rank"];function f(e){const t=new URL(e).searchParams,s={};for(const[r,i]of Object.entries(d)){const e=t.get(r);null!=e&&0!==e.length&&(s[i]=e)}return s}class v{get displaySort(){return this.selectedValue("sort")}get queryParams(){const e={};for(const t of m){const s=this[t];e[p[t]]=s===this.getDefault(t)?null:s}return e}get searchSort(){var e;const[t,s]=(null!==(e=this.displaySort)&&void 0!==e?e:"").split("_");return{field:t,order:s}}get supporterRequired(){return m.filter((e=>null!=this[e]&&b.includes(e)))}constructor(e){var t;Object.defineProperty(this,"extra",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"general",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"genre",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"language",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"mode",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"nsfw",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"played",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"query",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"rank",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"sort",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:null});const s=f(e);for(const r of m)this[r]=null!==(t=s[r])&&void 0!==t?t:null;(0,r.rC)(this),(0,r.Su)(this,"query",(e=>{var t;return e.newValue=(0,l.G)(null===(t=e.newValue)||void 0===t?void 0:t.trim()),e}))}getDefault(e){var t;switch(e){case"nsfw":return String(xs.userPreferences.get("beatmapset_show_nsfw"));case"played":return"any";case"status":return"leaderboard";case"sort":return(0,l.W)(this.query)?"relevance_desc":["pending","wip","graveyard","mine"].includes(null!==(t=this.status)&&void 0!==t?t:"")?"updated_desc":"ranked_desc"}return null}href(e,t){const s=t===this.getDefault(e)?null:t;return(0,c.bj)(null,Object.assign(Object.assign({},this.queryParams),{[p[e]]:s}))}selectedValue(e){var t;return null!==(t=this[e])&&void 0!==t?t:this.getDefault(e)}toKeyString(){return m.map((e=>`${e}=${this.selectedValue(e)}`)).join("&")}update(e,t){t!==this[e]&&(h.includes(e)&&(this.sort=null),this[e]=t)}}u([r.LO],v.prototype,"extra",void 0),u([r.LO],v.prototype,"general",void 0),u([r.LO],v.prototype,"genre",void 0),u([r.LO],v.prototype,"language",void 0),u([r.LO],v.prototype,"mode",void 0),u([r.LO],v.prototype,"nsfw",void 0),u([r.LO],v.prototype,"played",void 0),u([r.LO],v.prototype,"query",void 0),u([r.LO],v.prototype,"rank",void 0),u([r.LO],v.prototype,"sort",void 0),u([r.LO],v.prototype,"status",void 0),u([r.Fl],v.prototype,"displaySort",null),u([r.Fl],v.prototype,"queryParams",null),u([r.Fl],v.prototype,"searchSort",null),u([r.Fl],v.prototype,"supporterRequired",null),u([r.aD],v.prototype,"update",null);var g=s(3664),y=s(1270),w=s(3599),_=s(9014),E=s(2918),O=function(e,t,s,r){var i,n=arguments.length,a=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(n<3?i(a):n>3?i(t,s,a):i(t,s))||a);return n>3&&a&&Object.defineProperty(t,s,a),a},P=function(e,t,s,r){return new(s||(s=Promise))((function(i,n){function a(e){try{l(r.next(e))}catch(t){n(t)}}function o(e){try{l(r.throw(e))}catch(t){n(t)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(a,o)}l((r=r.apply(e,t||[])).next())}))};const j=["genre","language","extra","rank","played"];class k{constructor(e){Object.defineProperty(this,"beatmapsetSearch",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"advancedSearch",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"currentResultSet",{enumerable:!0,configurable:!0,writable:!0,value:new a}),Object.defineProperty(this,"filters",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"isExpanded",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"searchStatus",{enumerable:!0,configurable:!0,writable:!0,value:{error:null,from:0,state:"completed"}}),Object.defineProperty(this,"debouncedFilterChangedSearch",{enumerable:!0,configurable:!0,writable:!0,value:(0,o.debounce)((()=>this.filterChangedSearch()),500)}),Object.defineProperty(this,"filtersObserver",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"initialErrorMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filterChangedHandler",{enumerable:!0,configurable:!0,writable:!0,value:e=>{"update"===e.type&&e.oldValue===e.newValue||"remove"!==e.type&&"sort"===e.name&&null==e.newValue||(this.searchStatus.state="input",this.debouncedFilterChangedSearch(),"query"!==e.name&&this.debouncedFilterChangedSearch.flush())}}),(0,r.rC)(this)}get currentBeatmapsetIds(){return[...this.currentResultSet.beatmapsetIds]}get error(){return this.searchStatus.error}get hasMore(){return this.currentResultSet.hasMoreForPager}get isBusy(){return"searching"===this.searchStatus.state||"input"===this.searchStatus.state}get isPaging(){return"paging"===this.searchStatus.state}get isSupporterMissing(){var e,t;return!(null!==(t=null===(e=xs.currentUser)||void 0===e?void 0:e.is_supporter)&&void 0!==t&&t)&&this.filters.supporterRequired.length>0}get recommendedDifficulty(){return this.beatmapsetSearch.recommendedDifficulties.get(this.filters.mode)}get supporterRequiredFilterText(){const e=this.filters.supporterRequired.map((e=>(0,y.dW)(`beatmaps.listing.search.filters.${e}`)));return(0,y.m2)(e)}cancel(){this.debouncedFilterChangedSearch.cancel(),this.beatmapsetSearch.cancel()}getFilters(e){const t=this.filters.selectedValue(e);return null!=t?t.split("."):t}initialize(e){this.restoreStateFromUrl(),this.beatmapsetSearch.initialize(this.filters,e),this.initialErrorMessage=e.error}loadMore(){!this.isBusy&&this.hasMore&&this.search(this.currentResultSet.beatmapsetIds.size)}restoreTurbolinks(){this.restoreStateFromUrl(),this.search(0,!0),null!=this.initialErrorMessage&&((0,w.g)(this.initialErrorMessage,"danger"),delete this.initialErrorMessage)}search(e=0,t=!1){return P(this,void 0,void 0,(function*(){if(this.isSupporterMissing||e<0)return void(this.searchStatus={error:null,from:e,restore:t,state:"completed"});let s;this.searchStatus={from:0,restore:t,state:0===e?"searching":"paging"};try{yield this.beatmapsetSearch.get(this.filters,e)}catch(i){s=0!==i.readyState?i:null}(0,r.z)((()=>{this.searchStatus={error:s,from:e,restore:t,state:"completed"},this.currentResultSet=this.beatmapsetSearch.getResultSet(this.filters)}))}))}filterChangedSearch(){const e=(0,g.B)("beatmapsets.index",this.filters.queryParams);E.controller.advanceHistory(e),this.search()}restoreStateFromUrl(){const e=(0,_.JJ)().href;null!=this.filtersObserver&&this.filtersObserver(),this.filters=new v(e),this.filtersObserver=(0,r.N7)(this.filters,this.filterChangedHandler),this.isExpanded=(0,o.intersection)(Object.keys(f(e)),j).length>0}}O([r.LO],k.prototype,"advancedSearch",void 0),O([r.LO],k.prototype,"currentResultSet",void 0),O([r.LO],k.prototype,"filters",void 0),O([r.LO],k.prototype,"isExpanded",void 0),O([r.LO],k.prototype,"searchStatus",void 0),O([r.Fl],k.prototype,"currentBeatmapsetIds",null),O([r.Fl],k.prototype,"hasMore",null),O([r.Fl],k.prototype,"isBusy",null),O([r.Fl],k.prototype,"isPaging",null),O([r.Fl],k.prototype,"isSupporterMissing",null),O([r.Fl],k.prototype,"recommendedDifficulty",null),O([r.Fl],k.prototype,"supporterRequiredFilterText",null),O([r.aD],k.prototype,"cancel",null),O([r.aD],k.prototype,"loadMore",null),O([r.aD],k.prototype,"restoreTurbolinks",null),O([r.aD],k.prototype,"search",null),O([r.aD],k.prototype,"restoreStateFromUrl",null);var N=s(1723);const S=["chat.channel.join","chat.channel.part"];var C=s(8701);class T extends C.Z{constructor(e){super(),Object.defineProperty(this,"message",{enumerable:!0,configurable:!0,writable:!0,value:e})}}class x extends C.Z{constructor(e){super(),Object.defineProperty(this,"json",{enumerable:!0,configurable:!0,writable:!0,value:e})}}class D extends C.Z{constructor(e){super(),Object.defineProperty(this,"channelId",{enumerable:!0,configurable:!0,writable:!0,value:e})}}class R extends C.Z{constructor(e){super(),Object.defineProperty(this,"json",{enumerable:!0,configurable:!0,writable:!0,value:e})}}var M=function(e,t,s,r){var i,n=arguments.length,a=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(n<3?i(a):n>3?i(t,s,a):i(t,s))||a);return n>3&&a&&Object.defineProperty(t,s,a),a};function I(e){if("chat.message.new"===e.event)return new R(e.data);if(function(e){return null!=e.event&&S.includes(e.event)}(e))switch(e.event){case"chat.channel.join":return new x(e.data);case"chat.channel.part":return new D(e.data.channel_id)}}let L=class{handleDispatchAction(e){if(!(e instanceof T))return;const t=I(e.message);null!=t&&(0,N.WI)(t)}};L=M([N.yz],L);const A=L;var $=s(3775),B=function(e,t,s,r){var i,n=arguments.length,a=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(n<3?i(a):n>3?i(t,s,a):i(t,s))||a);return n>3&&a&&Object.defineProperty(t,s,a),a};class U{set title(e){(0,r.z)((()=>{this.origTitle=`${e} | osu!`}))}constructor(e){Object.defineProperty(this,"core",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"disposer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"origTitle",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"resetTitle",{enumerable:!0,configurable:!0,writable:!0,value:()=>{var e;document.title=this.origTitle,null===(e=this.disposer)||void 0===e||e.call(this)}}),Object.defineProperty(this,"setTitle",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.origTitle=document.title,this.disposer=(0,r.EH)((()=>{const e=this.core.dataStore.notificationStore.unreadStacks.total,t=0===e?"":`(${(0,$.uf)(e)}) `;document.title=`${t}${this.origTitle}`}))}}),(0,r.rC)(this),document.addEventListener("turbolinks:load",this.setTitle),document.addEventListener("turbolinks:before-cache",this.resetTitle)}}B([r.LO],U.prototype,"origTitle",void 0),B([r.aD],U.prototype,"resetTitle",void 0),B([r.aD],U.prototype,"setTitle",void 0);var F=s(9755);class W{constructor(){Object.defineProperty(this,"sitekey",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"containers",{enumerable:!0,configurable:!0,writable:!0,value:()=>document.querySelectorAll(".js-captcha--container")}),Object.defineProperty(this,"disableSubmit",{enumerable:!0,configurable:!0,writable:!0,value:e=>{const t=this.submitButton(e);null!=t&&(t.disabled=!0)}}),Object.defineProperty(this,"enableSubmit",{enumerable:!0,configurable:!0,writable:!0,value:e=>{const t=this.submitButton(e);null!=t&&(t.disabled=!1)}}),Object.defineProperty(this,"findContainer",{enumerable:!0,configurable:!0,writable:!0,value:e=>{var t,s;return null===(s=(0,$.h3)(null===(t=(0,$.h3)(e))||void 0===t?void 0:t.closest("form")))||void 0===s?void 0:s.querySelector(".js-captcha--container")}}),Object.defineProperty(this,"init",{enumerable:!0,configurable:!0,writable:!0,value:e=>{this.sitekey=e,this.renderAll()}}),Object.defineProperty(this,"isEnabled",{enumerable:!0,configurable:!0,writable:!0,value:e=>this.isTriggered(e)&&"object"==typeof grecaptcha&&"function"==typeof grecaptcha.render&&""!==this.sitekey}),Object.defineProperty(this,"isLoaded",{enumerable:!0,configurable:!0,writable:!0,value:e=>""!==e.innerHTML}),Object.defineProperty(this,"isTriggered",{enumerable:!0,configurable:!0,writable:!0,value:e=>"1"===e.dataset.captchaTriggered}),Object.defineProperty(this,"render",{enumerable:!0,configurable:!0,writable:!0,value:e=>{if(this.isEnabled(e)&&!this.isLoaded(e)){const t=()=>this.disableSubmit(e),s=grecaptcha.render(e,{callback:()=>this.enableSubmit(e),"error-callback":t,"expired-callback":t,sitekey:this.sitekey,theme:"dark"});e.dataset.captchaId=s.toString(),t()}}}),Object.defineProperty(this,"reset",{enumerable:!0,configurable:!0,writable:!0,value:e=>{var t;this.isEnabled(e)&&(grecaptcha.reset(+(null!==(t=e.dataset.captchaId)&&void 0!==t?t:"")),this.disableSubmit(e))}}),Object.defineProperty(this,"submitButton",{enumerable:!0,configurable:!0,writable:!0,value:e=>{var t;return null===(t=e.closest("form"))||void 0===t?void 0:t.querySelector(".js-captcha--submit-button")}}),Object.defineProperty(this,"trigger",{enumerable:!0,configurable:!0,writable:!0,value:e=>{this.isTriggered(e)||(e.dataset.captchaTriggered="1",this.render(e))}}),Object.defineProperty(this,"renderAll",{enumerable:!0,configurable:!0,writable:!0,value:()=>{for(const e of this.containers())this.render(e)}}),Object.defineProperty(this,"resetOnError",{enumerable:!0,configurable:!0,writable:!0,value:e=>{const t=this.findContainer((0,$.h3)(e.target));null!=t&&this.reset(t)}}),F(document).on("turbolinks:load",this.renderAll),F(document).on("ajax:error",".js-captcha--reset-on-error",this.resetOnError)}}var Z=s(9162),H=s(6122),G=s(9755);class V{constructor(){Object.defineProperty(this,"current",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"documentMouseEventTarget",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"close",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.show()}}),Object.defineProperty(this,"restoreSaved",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.show(document.body.dataset.clickMenuCurrent)}}),Object.defineProperty(this,"saveCurrent",{enumerable:!0,configurable:!0,writable:!0,value:()=>{null==this.current?delete document.body.dataset.clickMenuCurrent:document.body.dataset.clickMenuCurrent=this.current}}),Object.defineProperty(this,"show",{enumerable:!0,configurable:!0,writable:!0,value:e=>{var t,s;const r=this.tree();this.current=e;const i=this.tree(),n=document.querySelectorAll(".js-click-menu[data-click-menu-id]");let a=null,o=!1;for(const c of n){if(!(c instanceof HTMLElement))continue;const e=c.dataset.clickMenuId;null==e||-1===i.indexOf(e)?((0,Z.U6)(c),c.classList.remove("js-click-menu--active"),null===(t=this.menuLink(e))||void 0===t||t.classList.remove("js-click-menu--active")):((0,Z.Ji)(c),c.classList.add("js-click-menu--active"),null===(s=this.menuLink(e))||void 0===s||s.classList.add("js-click-menu--active"),o=!0,e===this.current&&(a=c))}o||(this.current=null),G.publish("click-menu:current",{previousTree:r,target:this.current,tree:i});const l=null==a?void 0:a.querySelector(".js-click-menu--autofocus");l instanceof HTMLElement&&l.focus()}}),Object.defineProperty(this,"toggle",{enumerable:!0,configurable:!0,writable:!0,value:e=>{const t=e.currentTarget,s=this.tree();e.preventDefault();const r=t.dataset.clickMenuTarget;let i=r;if(null!=r){const e=s.indexOf(r);-1!==e&&(i=s[e+1])}this.show(i)}}),Object.defineProperty(this,"tree",{enumerable:!0,configurable:!0,writable:!0,value:()=>{if(null==this.current)return[];let e=this.current;const t=[e];for(;e=this.closestMenuId(this.menuLink(e)),null!=e;)t.push(e);return t}}),Object.defineProperty(this,"onDocumentMousedown",{enumerable:!0,configurable:!0,writable:!0,value:e=>{this.documentMouseEventTarget=0===e.button?e.target:null}}),Object.defineProperty(this,"onDocumentMouseup",{enumerable:!0,configurable:!0,writable:!0,value:e=>{this.documentMouseEventTarget===e.target&&0===e.button&&((0,H.u)()||null!=this.current&&(G(e.target).closest(".js-click-menu").length>0||this.show()))}}),G(document).on("click",".js-click-menu--close",this.close),G(document).on("click",".js-click-menu[data-click-menu-target]",this.toggle),G(document).on("mousedown",this.onDocumentMousedown),G(document).on("mouseup",this.onDocumentMouseup),document.addEventListener("turbolinks:load",this.restoreSaved),document.addEventListener("turbolinks:before-cache",this.saveCurrent)}closestMenuId(e){if(null!=e)return G(e).parents("[data-click-menu-id]").attr("data-click-menu-id")}menu(e){return document.querySelector(`.js-click-menu[data-click-menu-id${null==e?"":`='${e}'`}]`)}menuLink(e){return document.querySelector(`.js-click-menu[data-click-menu-target${null==e?"":`='${e}'`}]`)}}var q=s(9755);const z="//platform.enchant.com";class K{constructor(e){Object.defineProperty(this,"turbolinksReload",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"load",{enumerable:!0,configurable:!0,writable:!0,value:()=>{null!=document.querySelector(".enchant-help-center")&&(window.enchant=[],this.turbolinksReload.load(z))}}),Object.defineProperty(this,"showMessageWindow",{enumerable:!0,configurable:!0,writable:!0,value:e=>{e.preventDefault(),null!=window.enchant&&null!=window.enchant.messenger&&"function"==typeof window.enchant.messenger.open&&window.enchant.messenger.open()}}),Object.defineProperty(this,"unload",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.turbolinksReload.forget(z),q('#enchant-messenger-main, #enchant-messenger-launcher, iframe[src^="https://enchantwidgets-"]').remove(),document.querySelectorAll("style").forEach((e=>{const t=e.textContent;null!=t&&/#enchant-/.exec(t)&&q(e).remove()}))}}),q(document).on("turbolinks:load",this.load),q(document).on("turbolinks:before-cache",this.unload),q(document).on("click",".js-enchant--show",this.showMessageWindow)}}var J=s(9755);class Q{constructor(){Object.defineProperty(this,"switchEdit",{enumerable:!0,configurable:!0,writable:!0,value:e=>{const t=J(e.target).parents(".js-forum-poll--container");if("1"===t.attr("data-edit")){t.attr("data-edit","0");const s=J(e.target).closest("form")[0];null!=s&&s.reset()}else t.attr("data-edit","1")}}),Object.defineProperty(this,"switchPage",{enumerable:!0,configurable:!0,writable:!0,value:e=>{const t=e.currentTarget;if(!(t instanceof HTMLElement))return;const s=t.dataset.targetPage;"string"==typeof s&&J(e.target).parents(".js-forum-poll--container").attr("data-page",s)}}),J(document).on("click",".js-forum-poll--switch-page",this.switchPage).on("click",".js-forum-poll--switch-edit",this.switchEdit)}}var Y=s(9755);class X{constructor(){Object.defineProperty(this,"handleCancel",{enumerable:!0,configurable:!0,writable:!0,value:e=>{var t;e.preventDefault(),Y.publish("forum-post-input:clear",[e.target]);const s=Y(e.target).parents(".js-forum-post-edit--container");s.html(null!==(t=s.attr("data-original-post"))&&void 0!==t?t:"").attr("data-original-post",null)}}),Object.defineProperty(this,"handleEditSaved",{enumerable:!0,configurable:!0,writable:!0,value:(e,t)=>{const s=e.target;setTimeout((()=>{this.saved(s,t)}))}}),Object.defineProperty(this,"handleEditStart",{enumerable:!0,configurable:!0,writable:!0,value:(e,t)=>{const s=e.target;setTimeout((()=>{this.start(s,t)}))}}),Object.defineProperty(this,"saved",{enumerable:!0,configurable:!0,writable:!0,value:(e,t)=>{if(!(e instanceof HTMLElement))throw new Error("target must be instance of HTMLElement");Y(e).parents(".js-forum-post").replaceWith(t)}}),Object.defineProperty(this,"start",{enumerable:!0,configurable:!0,writable:!0,value:(e,t)=>{if(!(e instanceof HTMLElement))throw new Error("target must be instance of HTMLElement");const s=Y(e).parents(".js-forum-post-edit--container");s.attr("data-original-post",s.html()).html(t).find("[name=body]").focus(),Y.publish("forum-post-input:restore",[s[0]])}}),Y(document).on("ajax:success",".js-edit-post-start",this.handleEditStart).on("click",".js-edit-post-cancel",this.handleCancel).on("ajax:success",".js-forum-post-edit",this.handleEditSaved)}}var ee=s(9755);function te(e){var t;if(!(e instanceof HTMLElement))return;const s=null!==(t=e.closest(".js-forum-post"))&&void 0!==t?t:e.closest("form");if(!(s instanceof HTMLElement))return;const r=s.querySelector("[name=body]");return r instanceof HTMLTextAreaElement?r:void 0}class se{constructor(){Object.defineProperty(this,"handleClear",{enumerable:!0,configurable:!0,writable:!0,value:(e,t)=>{this.clearInput(te(t))}}),Object.defineProperty(this,"handlePageLoad",{enumerable:!0,configurable:!0,writable:!0,value:()=>{for(const e of document.querySelectorAll(".js-forum-post-input"))this.handleRestore(null,e)}}),Object.defineProperty(this,"handlePostSaved",{enumerable:!0,configurable:!0,writable:!0,value:e=>{this.clearInput(te(e.target))}}),Object.defineProperty(this,"handleRestore",{enumerable:!0,configurable:!0,writable:!0,value:(e,t)=>{const s=te(t);if(null==s)return;const r=this.getKeyFromInput(s);if(null==r)return;const i=localStorage.getItem(r);if(null!=i&&(s.value=i),r.startsWith("forum-post-input:topic:")){const e=`forum-topic-reply--${(0,_.JJ)().pathname}--text`,t=localStorage.getItem(e);null!=t&&(localStorage.removeItem(e),localStorage.setItem(r,t),s.value=t)}}}),Object.defineProperty(this,"onInput",{enumerable:!0,configurable:!0,writable:!0,value:e=>{const t=e.currentTarget;if(!(t instanceof HTMLTextAreaElement))return;const s=this.getKeyFromInput(t);if(null==s)return;""===t.value?localStorage.removeItem(s):localStorage.setItem(s,t.value)}}),ee(document).on("input change",".js-forum-post-input",this.onInput).on("turbolinks:load",this.handlePageLoad).on("ajax:success",".js-forum-post-input--form",this.handlePostSaved),ee.subscribe("forum-post-input:restore",this.handleRestore),ee.subscribe("forum-post-input:clear",this.handleClear)}clearInput(e){if(null==e)return;const t=this.getKeyFromInput(e);null!=t&&localStorage.removeItem(t)}getKeyFromInput(e){return this.prefixKey(e.dataset.forumPostInputId)}prefixKey(e){if(null!=e&&""!==e)return`forum-post-input:${e}`}}var re=s(3518),ie=s(9755);class ne{constructor(){Object.defineProperty(this,"onClickReportButton",{enumerable:!0,configurable:!0,writable:!0,value:e=>{if(0!==e.button)return;const t=e.currentTarget.closest(".js-forum-post");if(null==t)return;const s=t.dataset.postId,r=t.dataset.postUsername;null!=s&&null!=r&&(0,re.Y1)({reportableId:s,reportableType:"forum_post",username:r})}}),ie(document).on("click",".js-forum-post-report",this.onClickReportButton)}}var ae=s(381);class oe{constructor(){Object.defineProperty(this,"observer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"formatElem",{enumerable:!0,configurable:!0,writable:!0,value:e=>{"1"!==e.dataset.localtime&&(e.dataset.localtime="1",e.classList.add("js-tooltip-time"),e.title=e.dateTime,e.innerText=ae(e.dateTime).format("LLL"))}}),Object.defineProperty(this,"formatElems",{enumerable:!0,configurable:!0,writable:!0,value:e=>(null==e&&(e=this.getElems(document.body)),e.map(this.formatElem))}),Object.defineProperty(this,"getElems",{enumerable:!0,configurable:!0,writable:!0,value:e=>e instanceof HTMLElement?e instanceof HTMLTimeElement&&e.classList.contains("js-localtime")?[e]:[...e.querySelectorAll("time.js-localtime")]:[]}),Object.defineProperty(this,"mutationHandler",{enumerable:!0,configurable:!0,writable:!0,value:e=>{const t=[];e.forEach((e=>{e.addedNodes.forEach((e=>{t.push(...this.getElems(e))}))})),this.formatElems(t)}}),this.observer=new MutationObserver(this.mutationHandler),this.observer.observe(document,{childList:!0,subtree:!0})}}var le=s(9755);const ce="js-mobile-toggle--active";class ue{constructor(){Object.defineProperty(this,"toggle",{enumerable:!0,configurable:!0,writable:!0,value:e=>{const t=e.currentTarget;if(!(t instanceof HTMLElement))return;const s=t.dataset.mobileToggleTarget;if(null==s)return;const r=document.querySelector(`.js-mobile-toggle[data-mobile-toggle-id=${s}]`);if(!(r instanceof HTMLElement))return;const i=!t.classList.contains(ce);t.classList.toggle(ce,i),r.classList.toggle("hidden-xs",!i)}}),le(document).on("click",".js-mobile-toggle",this.toggle)}}var de=s(9755);const pe=e=>{var t;return null!==(t=e.clientX)&&void 0!==t?t:e.touches[0].clientX};let me=null;class he{constructor(e){Object.defineProperty(this,"active",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"bar",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"endCallback",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"moveCallback",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"percentage",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"end",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.active=!1,de(document).off("mousemove touchmove",this.onMove),de(document).off("mouseup touchend",this.end),de(window).off("blur",this.end),de(document).off("turbolinks:before-cache",this.end),null!=this.endCallback&&this.endCallback(this),this.bar.style.removeProperty("--bar"),this.bar.dataset.audioDragging="0",me=null}}),Object.defineProperty(this,"getPercentage",{enumerable:!0,configurable:!0,writable:!0,value:()=>this.percentage}),Object.defineProperty(this,"move",{enumerable:!0,configurable:!0,writable:!0,value:e=>{if(!this.active)return;const t=this.bar.getBoundingClientRect(),s=e-t.left,r=t.width;this.percentage=(0,o.clamp)(s/r,0,1),null!=this.moveCallback&&this.moveCallback(this),this.bar.style.setProperty("--bar",this.percentage.toString())}}),Object.defineProperty(this,"onMove",{enumerable:!0,configurable:!0,writable:!0,value:e=>{const t=pe(e);requestAnimationFrame((()=>{this.move(t)}))}}),this.endCallback=e.endCallback,this.moveCallback=e.moveCallback,this.bar=e.bar,this.bar.dataset.audioDragging="1",this.move(pe(e.initialEvent)),de(document).on("mousemove touchmove",this.onMove),de(document).on("mouseup touchend",this.end),de(window).on("blur",this.end),de(document).on("turbolinks:before-cache",this.end)}static start(e){if(0===e.initialEvent.which||1===e.initialEvent.which)return null!=me&&me.end(),me=new he(e),me}}Object.defineProperty(he,"startEvents",{enumerable:!0,configurable:!0,writable:!0,value:"mousedown touchstart"});const be=he,fe=e=>e.toString().padStart(2,"0"),ve={},ge=(e,t)=>{var s;const r=Math.floor(e);if(ve.time!==r||ve.format!==t){ve.format=t,ve.time=r;const e=r%60,s=Math.floor(r/60);if("minute_minimal"===t)ve.formatted=`'${s}:${fe(e)}'`;else if("minute"===t)ve.formatted=`'${fe(s)}:${fe(e)}'`;else{const r=s%60,i=Math.floor(s/60);ve.formatted="hour_minimal"===t?`'${i}:${fe(r)}:${fe(e)}'`:`'${fe(i)}:${fe(r)}:${fe(e)}'`}}return null!==(s=ve.formatted)&&void 0!==s?s:""};var ye=s(9755),we=function(e,t,s,r){var i,n=arguments.length,a=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(n<3?i(a):n>3?i(t,s,a):i(t,s))||a);return n>3&&a&&Object.defineProperty(t,s,a),a};class _e{constructor(e){Object.defineProperty(this,"userPreferences",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"audio",{enumerable:!0,configurable:!0,writable:!0,value:new Audio}),Object.defineProperty(this,"currentSlider",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"durationFormatted",{enumerable:!0,configurable:!0,writable:!0,value:"'0:00'"}),Object.defineProperty(this,"hasWorkingVolumeControl",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"hideMainPlayerTimeout",{enumerable:!0,configurable:!0,writable:!0,value:-1}),Object.defineProperty(this,"mainPlayer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"observer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"pagePlayer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"playerNext",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"playerPrev",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"settingNavigation",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:"paused"}),Object.defineProperty(this,"timeFormat",{enumerable:!0,configurable:!0,writable:!0,value:"minute_minimal"}),Object.defineProperty(this,"url",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"checkVolumeSettings",{enumerable:!0,configurable:!0,writable:!0,value:()=>{const e=this.audio.volume,t=.1===e?.2:.1;this.audio.volume=t,setTimeout((()=>{this.hasWorkingVolumeControl=this.audio.volume===t,this.audio.volume=e,this.syncVolumeDisplay()}),0)}}),Object.defineProperty(this,"ensurePagePlayerIsAttached",{enumerable:!0,configurable:!0,writable:!0,value:()=>{null==this.pagePlayer||document.body.contains(this.pagePlayer)||(this.pagePlayer=void 0)}}),Object.defineProperty(this,"load",{enumerable:!0,configurable:!0,writable:!0,value:e=>{const t=e.dataset.audioUrl;if(null==t)throw new Error("Player is missing url");this.audio.paused||this.stop(),this.setTime(0),this.pagePlayer=e,this.url=t,this.audio.setAttribute("src",t),this.audio.currentTime=0,this.setState("loading");const s=this.audio.play();null==s||s.catch((e=>{if(_e.ignoredErrors.includes(e.name))return console.error("playback failed:",e.name),void this.stop();throw e})),this.setNavigation()}}),Object.defineProperty(this,"nav",{enumerable:!0,configurable:!0,writable:!0,value:e=>{const t=e.currentTarget;t instanceof HTMLElement&&("prev"===t.dataset.audioNav&&null!=this.playerPrev?this.load(this.playerPrev):"next"===t.dataset.audioNav&&null!=this.playerNext&&this.load(this.playerNext))}}),Object.defineProperty(this,"observePage",{enumerable:!0,configurable:!0,writable:!0,value:e=>{this.ensurePagePlayerIsAttached();const t=[],s=[],r=null==this.pagePlayer;e.forEach((e=>{e.addedNodes.forEach((e=>{if(e instanceof HTMLElement&&(e instanceof HTMLAudioElement?t.push(e):t.push(...e.querySelectorAll("audio")),r))if(e.classList.contains("js-audio--player"))s.push(e);else for(const t of[...e.querySelectorAll(".js-audio--player")])t instanceof HTMLElement&&s.push(t)}))})),s.push(...this.replaceAudioElems(t)),this.reattachPagePlayer(s)}}),Object.defineProperty(this,"onClickPlay",{enumerable:!0,configurable:!0,writable:!0,value:e=>{e.preventDefault();const t=this.findPlayer(e.currentTarget);if(null==t)throw new Error("couldn't find pagePlayer of the play button");t===this.pagePlayer?this.togglePlay():this.load(t)}}),Object.defineProperty(this,"onDocumentReady",{enumerable:!0,configurable:!0,writable:!0,value:()=>{if(null==this.mainPlayer){const e=document.querySelector(".js-audio--main");if(null==e)return void console.error("page is missing main player placeholder");this.mainPlayer=(()=>{const e=document.createElement("div");return e.className="audio-player audio-player--main",e.innerHTML=`\n    <button\n      type="button"\n      class="audio-player__button audio-player__button--prev js-audio--nav"\n      data-audio-nav="prev"\n    ><span class="fas fa-fw fa-step-backward"></span></button>\n\n    <button\n      type="button"\n      class="audio-player__button audio-player__button--play js-audio--main-play"\n    ><span class="fa-fw play-button"></span></button>\n\n    <button\n      type="button"\n      class="audio-player__button audio-player__button--next js-audio--nav"\n      data-audio-nav="next"\n    ><span class="fas fa-fw fa-step-forward"></span></button>\n\n    <div class="audio-player__bar audio-player__bar--progress js-audio--seek">\n      <div class="audio-player__bar-current"></div>\n    </div>\n\n    <div class="audio-player__timestamps">\n      <div class="audio-player__timestamp audio-player__timestamp--current"></div>\n      <div class="audio-player__timestamp-separator">/</div>\n      <div class="audio-player__timestamp audio-player__timestamp--total"></div>\n    </div>\n\n    <div class="audio-player__volume-control">\n      <button type="button" class="audio-player__volume-button js-audio--toggle-mute"></button>\n      <div class="audio-player__bar audio-player__bar--volume js-audio--volume">\n        <div class="audio-player__bar-current"></div>\n      </div>\n    </div>\n\n    <div class="audio-player__autoplay-control">\n      <button type="button" class="audio-player__autoplay-button js-audio--toggle-autoplay" title="${(0,y.dW)("layout.audio.autoplay")}"></button>\n    </div>\n  `,e})(),e.replaceWith(this.mainPlayer),(0,r.EH)((()=>{this.audio.muted=this.userPreferences.get("audio_muted"),this.audio.volume=this.userPreferences.get("audio_volume");const e=this.userPreferences.get("audio_autoplay")?"1":"0";null!=this.mainPlayer&&(this.mainPlayer.dataset.audioAutoplay=e)})),this.checkVolumeSettings(),this.syncState()}null==this.observer&&(this.observer=new MutationObserver(this.observePage),this.observer.observe(document,{childList:!0,subtree:!0})),this.replaceAudioElems(),this.reattachPagePlayer()}}),Object.defineProperty(this,"onEnded",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.stop(),null!=this.playerNext&&this.userPreferences.get("audio_autoplay")&&this.load(this.playerNext)}}),Object.defineProperty(this,"onPause",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.setState("paused")}}),Object.defineProperty(this,"onPlaying",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.setTimeFormat(),this.durationFormatted=ge(this.audio.duration,this.timeFormat),this.setState("playing")}}),Object.defineProperty(this,"onSeekEnd",{enumerable:!0,configurable:!0,writable:!0,value:e=>{this.currentSlider=void 0;const t=1===e.getPercentage()?this.audio.duration-.01:this.audio.duration*e.getPercentage();this.setTime(t)}}),Object.defineProperty(this,"onSeekStart",{enumerable:!0,configurable:!0,writable:!0,value:e=>{const t=e.currentTarget;t instanceof HTMLElement&&(null!=this.pagePlayer&&this.pagePlayer.contains(t)||null!=this.mainPlayer&&this.mainPlayer.contains(t))&&Number.isFinite(this.audio.duration)&&0!==this.audio.duration&&(this.currentSlider=be.start({bar:t,endCallback:this.onSeekEnd,initialEvent:e}))}}),Object.defineProperty(this,"onTimeupdate",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.audio.paused&&this.syncProgress()}}),Object.defineProperty(this,"onVolumeChangeEnd",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.currentSlider=void 0,this.userPreferences.set("audio_volume",this.audio.volume)}}),Object.defineProperty(this,"onVolumeChangeMove",{enumerable:!0,configurable:!0,writable:!0,value:e=>{this.audio.volume=e.getPercentage()}}),Object.defineProperty(this,"onVolumeChangeStart",{enumerable:!0,configurable:!0,writable:!0,value:e=>{const t=e.currentTarget;t instanceof HTMLElement&&(this.currentSlider=be.start({bar:t,endCallback:this.onVolumeChangeEnd,initialEvent:e,moveCallback:this.onVolumeChangeMove}))}}),Object.defineProperty(this,"reattachPagePlayer",{enumerable:!0,configurable:!0,writable:!0,value:e=>{if(this.ensurePagePlayerIsAttached(),null!=this.url&&null==this.pagePlayer){null==e&&(e=[...document.querySelectorAll(".js-audio--player")]);for(const t of e)if(t instanceof HTMLElement&&t.dataset.audioUrl===this.url){this.pagePlayer=t,this.syncState();break}}this.setNavigation()}}),Object.defineProperty(this,"replaceAudioElem",{enumerable:!0,configurable:!0,writable:!0,value:e=>{var t,s;const r=null!==(t=(0,l.G)(e.src))&&void 0!==t?t:(0,l.G)(null===(s=e.querySelector("source"))||void 0===s?void 0:s.src);if(null==r)throw new Error("audio element is missing src");const i=(()=>{const e=document.createElement("div");return e.className="audio-player js-audio--player",e.innerHTML='\n    <button\n    type="button"\n    class="audio-player__button audio-player__button--play js-audio--play"\n    ><span class="fa-fw play-button"></span></button>\n\n    <div class="audio-player__bar audio-player__bar--progress js-audio--seek">\n      <div class="audio-player__bar-current"></div>\n    </div>\n\n    <div class="audio-player__timestamps">\n      <div class="audio-player__timestamp audio-player__timestamp--current"></div>\n      <div class="audio-player__timestamp-separator">/</div>\n      <div class="audio-player__timestamp audio-player__timestamp--total"></div>\n    </div>\n  ',e})();return i.dataset.audioUrl=r,i.dataset.audioState="paused",e.replaceWith(i),i}}),Object.defineProperty(this,"replaceAudioElems",{enumerable:!0,configurable:!0,writable:!0,value:e=>(null==e&&(e=[...document.querySelectorAll("audio")]),e.map(this.replaceAudioElem))}),Object.defineProperty(this,"setNavigation",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.settingNavigation||(this.settingNavigation=!0,window.setTimeout((()=>{var e;this.playerNext=void 0,this.playerPrev=void 0;const t=null===(e=this.pagePlayer)||void 0===e?void 0:e.closest(".js-audio--group");if(t instanceof HTMLElement){const e=t.querySelectorAll(".js-audio--player");for(let t=0;t<e.length;t++)if(e[t]===this.pagePlayer){if(t>0){const s=e[t-1];s instanceof HTMLElement&&(this.playerPrev=s)}const s=e[t+1];s instanceof HTMLElement&&(this.playerNext=s);break}}null!=this.mainPlayer&&(this.mainPlayer.dataset.audioHasPrev=null==this.playerPrev?"0":"1",this.mainPlayer.dataset.audioHasNext=null==this.playerNext?"0":"1"),this.settingNavigation=!1})))}}),Object.defineProperty(this,"setState",{enumerable:!0,configurable:!0,writable:!0,value:e=>{this.state=e,this.syncState(),window.clearTimeout(this.hideMainPlayerTimeout),"playing"===this.state||"loading"===this.state?null!=this.mainPlayer&&(this.mainPlayer.dataset.audioVisible="1"):this.hideMainPlayerTimeout=window.setTimeout((()=>{null!=this.mainPlayer&&(this.mainPlayer.dataset.audioVisible="0")}),4e3)}}),Object.defineProperty(this,"setTime",{enumerable:!0,configurable:!0,writable:!0,value:e=>{this.audio.currentTime=e,this.syncProgress()}}),Object.defineProperty(this,"setTimeFormat",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.audio.duration<600?this.timeFormat="minute_minimal":this.audio.duration<3600?this.timeFormat="minute":this.audio.duration<36e3?this.timeFormat="hour_minimal":this.timeFormat="hour"}}),Object.defineProperty(this,"stop",{enumerable:!0,configurable:!0,writable:!0,value:()=>{var e;this.audio.pause(),null===(e=this.currentSlider)||void 0===e||e.end(),this.audio.currentTime=0,this.onPause()}}),Object.defineProperty(this,"syncProgress",{enumerable:!0,configurable:!0,writable:!0,value:()=>{if(this.audio.duration>0){const e=this.audio.currentTime/this.audio.duration,t=e>=.5?"1":"0",s=e.toString(),r=ge(this.audio.currentTime,this.timeFormat);this.updatePlayers((e=>{e.style.setProperty("--current-time",r),e.style.setProperty("--progress",s),e.dataset.audioOver50=t}))}this.audio.paused||requestAnimationFrame(this.syncProgress)}}),Object.defineProperty(this,"syncState",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.updatePlayers((e=>{e.dataset.audioHasDuration=Number.isFinite(this.audio.duration)?"1":"0",e.dataset.audioState=this.state,e.dataset.audioTimeFormat=this.timeFormat,e.style.setProperty("--duration",this.durationFormatted)})),this.syncProgress(),this.syncVolumeDisplay()}}),Object.defineProperty(this,"syncVolumeDisplay",{enumerable:!0,configurable:!0,writable:!0,value:()=>{null!=this.mainPlayer&&(this.mainPlayer.dataset.audioVolumeBarVisible=this.hasWorkingVolumeControl?"1":"0",this.mainPlayer.dataset.audioVolume=this.volumeIcon(),this.mainPlayer.style.setProperty("--volume",this.audio.volume.toString()))}}),Object.defineProperty(this,"toggleAutoplay",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.userPreferences.set("audio_autoplay",!this.userPreferences.get("audio_autoplay"))}}),Object.defineProperty(this,"toggleMute",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.userPreferences.set("audio_muted",!this.userPreferences.get("audio_muted"))}}),Object.defineProperty(this,"togglePlay",{enumerable:!0,configurable:!0,writable:!0,value:()=>{null!=this.url&&(this.audio.paused?this.audio.play():this.audio.pause())}}),Object.defineProperty(this,"updatePlayers",{enumerable:!0,configurable:!0,writable:!0,value:e=>{[this.mainPlayer,this.pagePlayer].forEach((t=>{null!=t&&e(t)}))}}),Object.defineProperty(this,"volumeIcon",{enumerable:!0,configurable:!0,writable:!0,value:()=>this.audio.muted?"muted":0===this.audio.volume?"silent":this.audio.volume<.4?"quiet":"normal"}),(0,r.rC)(this),this.audio.volume=0,this.audio.addEventListener("pause",this.onPause),this.audio.addEventListener("playing",this.onPlaying),this.audio.addEventListener("ended",this.onEnded),this.audio.addEventListener("timeupdate",this.onTimeupdate),this.audio.addEventListener("volumechange",this.syncVolumeDisplay),ye(document).on("click",".js-audio--play",this.onClickPlay).on("click",".js-audio--main-play",this.togglePlay).on(be.startEvents,".js-audio--seek",this.onSeekStart).on(be.startEvents,".js-audio--volume",this.onVolumeChangeStart).on("click",".js-audio--toggle-mute",this.toggleMute).on("click",".js-audio--toggle-autoplay",this.toggleAutoplay).on("click",".js-audio--nav",this.nav),document.addEventListener("turbolinks:load",this.onDocumentReady)}findPlayer(e){var t,s;const r=null!==(s=null===(t=this.mainPlayer)||void 0===t?void 0:t.contains(e))&&void 0!==s&&s?this.pagePlayer:e.closest(".js-audio--player");if(r instanceof HTMLElement)return r}}Object.defineProperty(_e,"ignoredErrors",{enumerable:!0,configurable:!0,writable:!0,value:["AbortError","NotAllowedError","NotSupportedError"]});const Ee=_e;we([r.aD],_e.prototype,"onEnded",void 0),we([r.aD],_e.prototype,"onVolumeChangeEnd",void 0),we([r.aD],_e.prototype,"toggleAutoplay",void 0),we([r.aD],_e.prototype,"toggleMute",void 0);var Oe=s(5863),Pe=s(3935),je=s(9755),ke=s(2918);class Ne{constructor(e,t){Object.defineProperty(this,"core",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"turbolinksReload",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"components",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"newVisit",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"pageReady",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"renderedContainers",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"scrolled",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"timeoutScroll",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"boot",{enumerable:!0,configurable:!0,writable:!0,value:()=>{if(this.pageReady&&null!=window.newBody)for(const[e,t]of this.components.entries()){const s=window.newBody.querySelectorAll(`.js-react--${e}`);for(const e of s)e instanceof HTMLElement&&!this.renderedContainers.has(e)&&(this.renderedContainers.add(e),(0,r.z)((()=>{Pe.render(t(e),e)})))}}}),Object.defineProperty(this,"destroy",{enumerable:!0,configurable:!0,writable:!0,value:()=>{for(const e of this.renderedContainers.values())document.body.contains(e)||(Pe.unmountComponentAtNode(e),this.renderedContainers.delete(e))}}),Object.defineProperty(this,"handleBeforeCache",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.pageReady=!1,window.clearTimeout(this.timeoutScroll)}}),Object.defineProperty(this,"handleBeforeRender",{enumerable:!0,configurable:!0,writable:!0,value:e=>{window.newBody=e.originalEvent.data.newBody,this.setNewUrl(),this.pageReady=!0,(0,Oe.w)(),this.core.updateCurrentUser(),this.loadScripts(!1),this.boot()}}),Object.defineProperty(this,"handleBeforeVisit",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.newVisit=!0}}),Object.defineProperty(this,"handleLoad",{enumerable:!0,configurable:!0,writable:!0,value:()=>{var e;null!==(e=window.newBody)&&void 0!==e||(window.newBody=document.body),window.newUrl=null,this.pageReady=!0,this.scrolled=!1,je(window).off("scroll",this.handleWindowScroll),je(window).on("scroll",this.handleWindowScroll),window.setTimeout((()=>{this.destroy(),this.loadScripts(),this.boot(),this.timeoutScroll=window.setTimeout(this.scrollOnNewVisit,100)}),1)}}),Object.defineProperty(this,"handleWindowScroll",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.scrolled=this.scrolled||0!==window.scrollX||0!==window.scrollY}}),Object.defineProperty(this,"scrollOnNewVisit",{enumerable:!0,configurable:!0,writable:!0,value:()=>{var e;je(window).off("scroll",this.handleWindowScroll);const t=this.newVisit;if(this.newVisit=!1,!t||this.scrolled)return;const s=decodeURIComponent((0,_.JJ)().hash.substr(1));""!==s&&(null===(e=document.getElementById(s))||void 0===e||e.scrollIntoView())}}),je(document).on("turbolinks:before-cache",this.handleBeforeCache),je(document).on("turbolinks:before-visit",this.handleBeforeVisit),je(document).on("turbolinks:load",this.handleLoad),je(document).on("turbolinks:before-render",this.handleBeforeRender)}register(e,t){this.components.has(e)||(this.components.set(e,t),this.boot())}runAfterPageLoad(e){if(document.body!==window.newBody)return je(document).one("turbolinks:load",e),()=>{je(document).off("turbolinks:load",e)};e()}loadScripts(e=!0){if(null==window.newBody)return;const t=e?"load":"loadSync";window.newBody.querySelectorAll(".js-react-turbolinks--script").forEach((e=>{if(e instanceof HTMLDivElement){const s=e.dataset.src;null!=s&&this.turbolinksReload[t](s)}}))}setNewUrl(){var e,t,s,r;const i=null!==(s=null===(t=null===(e=ke.controller.currentVisit)||void 0===e?void 0:e.redirectedToLocation)||void 0===t?void 0:t.absoluteURL)&&void 0!==s?s:null===(r=ke.controller.currentVisit)||void 0===r?void 0:r.location.absoluteURL;window.newUrl=null==i?document.location:new URL(i)}}var Se=s(9755);class Ce{get breadcrumbsElement(){var e;return null===(e=window.newBody)||void 0===e?void 0:e.querySelector(".js-sticky-header-breadcrumbs")}get contentElement(){var e;return null===(e=window.newBody)||void 0===e?void 0:e.querySelector(".js-sticky-header-content")}get headerHeight(){const e=window._styles.header;return xs.windowSize.isMobile?e.heightMobile:e.heightSticky}get header(){return document.querySelector(".js-pinned-header")}get marker(){return document.querySelector(".js-sticky-header")}get pinnedSticky(){return document.querySelector(".js-pinned-header-sticky")}get scrollOffsetValue(){const e=this.pinnedSticky,t=null==e?0:e.getBoundingClientRect().height;return this.headerHeight+t}get shouldStick(){const e=this.marker,t=this.pinnedSticky;if(null==e||null==t)return;return e.getBoundingClientRect().top<this.headerHeight+t.getBoundingClientRect().height}constructor(){Object.defineProperty(this,"debouncedOnScroll",{enumerable:!0,configurable:!0,writable:!0,value:(0,o.debounce)((()=>this.onScroll()),20)}),Object.defineProperty(this,"onScroll",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.pin(),this.stickOrUnstick()}}),Object.defineProperty(this,"stickOrUnstick",{enumerable:!0,configurable:!0,writable:!0,value:()=>{const e=this.shouldStick;null!=e&&this.setVisible(e)}}),Se(window).on("scroll",this.onScroll),Se(document).on("turbolinks:load",this.debouncedOnScroll),Se(window).on("resize",this.stickOrUnstick)}scrollOffset(e){return Math.max(0,e-this.scrollOffsetValue)}pin(){null!=this.header&&(this.shouldPin()?document.body.classList.add("js-header-is-pinned"):document.body.classList.remove("js-header-is-pinned"))}setVisible(e){(0,Z.Eo)((0,$.h3)(this.pinnedSticky),e),Se(document).trigger("sticky-header:sticking",[e])}shouldPin(e){return(null!=e?e:window.pageYOffset)>30||this.shouldStick}}var Te=s(9755);class xe{constructor(){Object.defineProperty(this,"observer",{enumerable:!0,configurable:!0,writable:!0,value:new MutationObserver(xe.handleMutations)}),this.observer.observe(document,{attributeFilter:["datetime"],attributeOldValue:!0,childList:!0,subtree:!0})}}Object.defineProperty(xe,"className",{enumerable:!0,configurable:!0,writable:!0,value:"js-timeago"}),Object.defineProperty(xe,"searchQuery",{enumerable:!0,configurable:!0,writable:!0,value:`.${xe.className}`}),Object.defineProperty(xe,"handleMutation",{enumerable:!0,configurable:!0,writable:!0,value:e=>{switch(e.type){case"childList":Te(e.addedNodes).find(xe.searchQuery).addBack(xe.searchQuery).timeago();break;case"attributes":e.target instanceof HTMLTimeElement&&e.target.dateTime!==e.oldValue&&e.target.classList.contains(xe.className)&&Te(e.target).timeago("updateFromDOM")}}}),Object.defineProperty(xe,"handleMutations",{enumerable:!0,configurable:!0,writable:!0,value:e=>{null!=Te.fn.timeago&&e.forEach(xe.handleMutation)}});const De=xe;var Re=s(9755);class Me{constructor(){Object.defineProperty(this,"loaded",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"loading",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"abortLoading",{enumerable:!0,configurable:!0,writable:!0,value:()=>{for(const e of this.loading.values())e.abort()}}),Object.defineProperty(this,"forget",{enumerable:!0,configurable:!0,writable:!0,value:e=>{var t;this.loaded.delete(e),null===(t=this.loading.get(e))||void 0===t||t.abort()}}),Re(document).on("turbolinks:before-cache",this.abortLoading)}load(e){if(this.loaded.has(e)||this.loading.has(e))return this.loading.get(e);const t=Re.ajax(e,{cache:!0,dataType:"script"});return this.loading.set(e,t),t.done((()=>this.loaded.add(e))).always((()=>this.loading.delete(e))),t}loadSync(e){this.loaded.has(e)||(this.loading.has(e)&&this.forget(e),Re.ajax(e,{async:!1,cache:!0,dataType:"script"}),this.loaded.add(e))}}var Ie=s(9755),Le=function(e,t,s,r){var i,n=arguments.length,a=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(n<3?i(a):n>3?i(t,s,a):i(t,s))||a);return n>3&&a&&Object.defineProperty(t,s,a),a};class Ae{constructor(){Object.defineProperty(this,"pins",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),(0,r.rC)(this)}apiPin(e,t){const s=e.current_user_attributes.pin;if(null==s)throw new Error("can't pin score without current user attributes");return Ie.ajax((0,g.B)("score-pins.store"),{data:s,dataType:"json",method:t?"POST":"DELETE"}).done((0,r.aD)((()=>{this.markPinned(e,t),Ie.publish("score:pin",[t,e])})))}canBePinned(e){return null!=e.current_user_attributes.pin}isPinned(e){const t=e.current_user_attributes.pin;if(null==t)return!1;const s=this.mapKey(t);return this.pins.has(s)||(0,r.z)((()=>{this.pins.set(s,t.is_pinned)})),this.pins.get(s)}markPinned(e,t){const s=e.current_user_attributes.pin;if(null==s)return;const r=this.mapKey(s);if(null==r)return null;this.pins.set(r,t)}mapKey(e){return`${e.score_type}:${e.score_id}`}}Le([r.LO],Ae.prototype,"pins",void 0),Le([r.aD],Ae.prototype,"markPinned",null);var $e=s(6808),Be=s(9703),Ue=s(9755);class Fe{constructor(e){Object.defineProperty(this,"captcha",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"callback",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"show",{enumerable:!0,configurable:!0,writable:!0,value:e=>{this.callback=e,window.setTimeout((()=>{var e;Ue(document).trigger("gallery:close"),null===(e=Ue(".js-user-login--menu")[0])||void 0===e||e.click()}),0)}}),Object.defineProperty(this,"showIfGuest",{enumerable:!0,configurable:!0,writable:!0,value:e=>null==xs.currentUser&&(this.show(e),!0)}),Object.defineProperty(this,"showOnError",{enumerable:!0,configurable:!0,writable:!0,value:(e,t)=>{var s;return 401===e.status&&"basic"===(null===(s=e.responseJSON)||void 0===s?void 0:s.authentication)&&(null!=xs.currentUser?(0,_.sl)():this.show(t),!0)}}),Object.defineProperty(this,"clearError",{enumerable:!0,configurable:!0,writable:!0,value:()=>{Ue(".js-login-form--error").text("")}}),Object.defineProperty(this,"loginError",{enumerable:!0,configurable:!0,writable:!0,value:(e,t)=>{e.preventDefault(),e.stopPropagation(),Ue(".js-login-form--error").text((0,Be.l5)(t));const s=this.captcha.findContainer(e.currentTarget);null!=s&&window.setTimeout((()=>{const e=t.responseJSON;var r;"object"==typeof(r=e)&&null!=r&&"captcha_triggered"in r&&e.captcha_triggered&&this.captcha.trigger(s),this.captcha.reset(s)}),0)}}),Object.defineProperty(this,"loginSuccess",{enumerable:!0,configurable:!0,writable:!0,value:(e,t)=>{const s=this.callback;null!=s?(this.reset(),this.refreshToken(),Ue.publish("user:update",t.user),window.setTimeout((()=>{var e;null===(e=Ue(".js-user-login--menu")[0])||void 0===e||e.click(),Ue(".js-user-header").replaceWith(t.header),Ue(".js-user-header-popup").html(t.header_popup),s()}),0)):(0,_.sl)()}}),Object.defineProperty(this,"onError",{enumerable:!0,configurable:!0,writable:!0,value:(e,t)=>{this.showOnError(t,(0,$.A$)(e.target))}}),Object.defineProperty(this,"refreshToken",{enumerable:!0,configurable:!0,writable:!0,value:()=>{var e;const t=null!==(e=$e.get("XSRF-TOKEN"))&&void 0!==e?e:null;Ue('[name="_token"]').attr("value",t),Ue('[name="csrf-token"]').attr("content",t)}}),Object.defineProperty(this,"reset",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.callback=void 0}}),Object.defineProperty(this,"showOnClick",{enumerable:!0,configurable:!0,writable:!0,value:e=>{e.preventDefault(),this.show()}}),Object.defineProperty(this,"showOnLoad",{enumerable:!0,configurable:!0,writable:!0,value:()=>{window.showLoginModal&&(window.showLoginModal=void 0,this.show())}}),Object.defineProperty(this,"showToContinue",{enumerable:!0,configurable:!0,writable:!0,value:e=>{if(null!=xs.currentUser)return;e.preventDefault();const t=(0,$.A$)(e.target);window.setTimeout((()=>{this.show(t)}),0)}}),Ue(document).on("ajax:success",".js-login-form",this.loginSuccess).on("ajax:error",".js-login-form",this.loginError).on("submit",".js-login-form",this.clearError).on("input",".js-login-form-input",this.clearError).on("click",".js-user-link",this.showOnClick).on("click",".js-login-required--click",this.showToContinue).on("ajax:before",".js-login-required--click",(()=>null!=xs.currentUser)).on("ajax:error",this.onError).on("turbolinks:load",this.showOnLoad),Ue.subscribe("nav:popup:hidden",this.reset)}}class We{}var Ze=s(9755);class He{constructor(){Object.defineProperty(this,"handleUserLogin",{enumerable:!0,configurable:!0,writable:!0,value:()=>{(0,N.WI)(new We)}}),Object.defineProperty(this,"handleUserLogout",{enumerable:!0,configurable:!0,writable:!0,value:e=>{const t=(0,l.W)(e.currentTarget.dataset.redirectHome);this.logout(t)}}),Ze(document).on("ajax:success",".js-logout-link",this.handleUserLogout).on("ajax:success",".js-login-form",this.handleUserLogin)}logout(e=!1){localStorage.clear(),e?location.href=(0,g.B)("home"):location.reload()}}var Ge=function(e,t,s,r){var i,n=arguments.length,a=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(n<3?i(a):n>3?i(t,s,a):i(t,s))||a);return n>3&&a&&Object.defineProperty(t,s,a),a};class Ve{get blocks(){return null==this.core.currentUser?new Set:new Set(this.core.currentUser.blocks.map((e=>e.target_id)))}get friends(){return null==this.core.currentUser?new Map:new Map(this.core.currentUser.friends.map((e=>[e.target_id,e])))}constructor(e){Object.defineProperty(this,"core",{enumerable:!0,configurable:!0,writable:!0,value:e}),(0,r.rC)(this)}isFriendWith(e){return null!=this.friends.get(e)}}Ge([r.Fl],Ve.prototype,"blocks",null),Ge([r.Fl],Ve.prototype,"friends",null);const qe={audio_autoplay:!1,audio_muted:!1,audio_volume:.45,beatmapset_card_size:"normal",beatmapset_download:"all",beatmapset_show_nsfw:!1,beatmapset_title_show_original:!1,comments_show_deleted:!1,comments_sort:"new",forum_posts_show_deleted:!0,profile_cover_expanded:!0,user_list_filter:"all",user_list_sort:"last_visit",user_list_view:"card"};var ze=s(9755),Ke=function(e,t,s,r){var i,n=arguments.length,a=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(n<3?i(a):n>3?i(t,s,a):i(t,s))||a);return n>3&&a&&Object.defineProperty(t,s,a),a};class Je{constructor(){Object.defineProperty(this,"current",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"updatingOptions",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"user",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.current=Object.assign({},qe,this.fromStorage()),(0,r.rC)(this)}get(e){return this.current[e]}set(e,t){if(this.current[e]!==t&&(this.current[e]=t,localStorage.userPreferences=JSON.stringify(this.current),null!=this.user))return this.updatingOptions=!0,ze.ajax((0,g.B)("account.options"),{data:{user_profile_customization:{[e]:t}},dataType:"JSON",method:"PUT"}).done((e=>{ze.publish("user:update",e)})).fail((0,Be.Gi)()).always((()=>{this.updatingOptions=!1}))}setUser(e){this.user=e,null==e||this.updatingOptions||(this.current=null==e?void 0:e.user_preferences)}fromStorage(){try{const e=localStorage.getItem("userPreferences");if(null!=e){const t=JSON.parse(e);if(null!=t&&"object"==typeof t)return t}}catch(e){}return{}}}Ke([r.LO],Je.prototype,"current",void 0),Ke([r.aD],Je.prototype,"set",null),Ke([r.aD],Je.prototype,"setUser",null);var Qe=s(9755);class Ye{get inputBox(){return document.querySelector(".js-user-verification--input")}get message(){return document.querySelector(".js-user-verification--message")}get messageSpinner(){return document.querySelector(".js-user-verification--message-spinner")}get messageText(){return document.querySelector(".js-user-verification--message-text")}get reference(){return document.querySelector(".js-user-verification--reference")}constructor(){Object.defineProperty(this,"callback",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"delayShow",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"delayShowCallback",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modal",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"request",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"showOnError",{enumerable:!0,configurable:!0,writable:!0,value:(e,t)=>{return 401===(s=e).status&&"verify"===(null===(r=s.responseJSON)||void 0===r?void 0:r.authentication)&&(this.show(e.responseJSON.box,t),!0);var s,r}}),Object.defineProperty(this,"autoSubmit",{enumerable:!0,configurable:!0,writable:!0,value:()=>{var e;const t=this.inputBox;if(null==t)return;const s=t.value.replace(/\s/g,""),r=t.dataset.lastKey,i=parseInt(null!==(e=t.dataset.verificationKeyLength)&&void 0!==e?e:"",10);0===s.length&&this.setMessage(),i===s.length&&s!==r&&(t.dataset.lastKey=s,this.prepareForRequest("verifying"),this.request=Qe.post((0,g.B)("account.verify"),{verification_key:s}).done(this.success).fail(this.error))}}),Object.defineProperty(this,"error",{enumerable:!0,configurable:!0,writable:!0,value:e=>{this.setMessage((0,Be.l5)(e))}}),Object.defineProperty(this,"float",{enumerable:!0,configurable:!0,writable:!0,value:(e,t,s)=>{e?(t.classList.add("js-user-verification--center"),t.style.paddingTop=""):(t.classList.remove("js-user-verification--center"),t.style.paddingTop=`${null!=s?s:0}px`)}}),Object.defineProperty(this,"isActive",{enumerable:!0,configurable:!0,writable:!0,value:()=>{var e;return null===(e=this.modal)||void 0===e?void 0:e.classList.contains("js-user-verification--active")}}),Object.defineProperty(this,"onError",{enumerable:!0,configurable:!0,writable:!0,value:(e,t)=>this.showOnError(t,(0,$.A$)(e.target))}),Object.defineProperty(this,"prepareForRequest",{enumerable:!0,configurable:!0,writable:!0,value:e=>{var t;null===(t=this.request)||void 0===t||t.abort(),this.setMessage((0,y.dW)(`user_verification.box.${e}`),!0)}}),Object.defineProperty(this,"reissue",{enumerable:!0,configurable:!0,writable:!0,value:e=>{e.preventDefault(),this.prepareForRequest("issuing"),this.request=Qe.post((0,g.B)("account.reissue-code")).done((e=>{this.setMessage(e.message)})).fail(this.error)}}),Object.defineProperty(this,"reposition",{enumerable:!0,configurable:!0,writable:!0,value:()=>{var e,t;if(this.isActive()&&null!=this.modal)if(xs.windowSize.isMobile)this.float(!0,this.modal);else{const s=null!==(t=null===(e=this.reference)||void 0===e?void 0:e.getBoundingClientRect().bottom)&&void 0!==t?t:0;this.float(s<0,this.modal,s)}}}),Object.defineProperty(this,"setDelayShow",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.delayShow=!0}}),Object.defineProperty(this,"setMessage",{enumerable:!0,configurable:!0,writable:!0,value:(e,t=!1)=>{const s=this.message;if(null==s)return;if(null==e||0===e.length)return void(0,Z.U6)(s);const r=this.messageText,i=this.messageSpinner;null!=r&&null!=i&&(r.textContent=e,(0,Z.Eo)(i,t),(0,Z.Ji)(s))}}),Object.defineProperty(this,"setModal",{enumerable:!0,configurable:!0,writable:!0,value:()=>{const e=document.querySelector(".js-user-verification");this.modal=e instanceof HTMLElement?e:void 0}}),Object.defineProperty(this,"show",{enumerable:!0,configurable:!0,writable:!0,value:(e,t)=>{this.delayShow?this.delayShowCallback=()=>this.show(e,t):(this.callback=t,null!=e&&Qe(".js-user-verification--box").html(e),this.$modal().modal({backdrop:"static",keyboard:!1,show:!0}).addClass("js-user-verification--active"),this.reposition())}}),Object.defineProperty(this,"showOnLoad",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.delayShow=!1,null!=this.delayShowCallback?(this.delayShowCallback(),this.delayShowCallback=void 0):this.isVerificationPage()&&this.show()}}),Object.defineProperty(this,"success",{enumerable:!0,configurable:!0,writable:!0,value:()=>{if(!this.isActive()||null==this.modal)return;const e=this.inputBox;if(null==e)return;this.$modal().modal("hide"),this.modal.classList.remove("js-user-verification--active");const t=this.callback;if(this.callback=void 0,this.setMessage(),e.value="",e.dataset.lastKey="",this.isVerificationPage())return(0,_.sl)();null==t||t()}}),Qe(document).on("ajax:error",this.onError).on("turbolinks:load",this.setModal).on("turbolinks:load",this.showOnLoad).on("turbolinks:visit",this.setDelayShow).on("input",".js-user-verification--input",this.autoSubmit).on("click",".js-user-verification--reissue",this.reissue),Qe.subscribe("user-verification:success",this.success),Qe(window).on("resize scroll",this.reposition)}$modal(){return Qe(".js-user-verification")}isVerificationPage(){return null!=document.querySelector(".js-user-verification--on-load")}}var Xe=s(9755);class et{constructor(){Object.defineProperty(this,"createTooltip",{enumerable:!0,configurable:!0,writable:!0,value:(e,t)=>{Xe(e).qtip({content:{text:t},hide:{delay:200,effect(){Xe(this).fadeTo(110,0)},fixed:!0},position:{at:"top center",my:"bottom center",viewport:Xe(window)},show:{delay:200,effect(){Xe(this).fadeTo(110,1)},ready:!0},style:{classes:"tooltip-default tooltip-default--interactable"}})}}),Object.defineProperty(this,"showTooltip",{enumerable:!0,configurable:!0,writable:!0,value:e=>{var t;if(!(e.currentTarget instanceof HTMLAnchorElement))return;const s=e.currentTarget,r=s.getAttribute("href");if(null==r)return;const i=null===(t=document.querySelector(r))||void 0===t?void 0:t.firstElementChild;if(!(i instanceof HTMLParagraphElement))return;const n=document.createElement("div");n.insertAdjacentHTML("afterbegin",i.innerHTML),n.querySelectorAll("*").forEach((e=>{"doc-backlink"===e.getAttribute("role")?e.remove():e.removeAttribute("class")})),this.createTooltip(s,n)}}),Xe(document).on("mouseover",".js-reference-link",this.showTooltip)}}var tt=s(9755),st=function(e,t,s,r){var i,n=arguments.length,a=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(n<3?i(a):n>3?i(t,s,a):i(t,s))||a);return n>3&&a&&Object.defineProperty(t,s,a),a};class rt{constructor(){Object.defineProperty(this,"hasFocus",{enumerable:!0,configurable:!0,writable:!0,value:document.hasFocus()}),(0,r.rC)(this),tt(window).on("blur focus",(0,r.aD)((()=>this.hasFocus=document.hasFocus())))}}st([r.LO],rt.prototype,"hasFocus",void 0);var it=s(9755),nt=function(e,t,s,r){var i,n=arguments.length,a=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(n<3?i(a):n>3?i(t,s,a):i(t,s))||a);return n>3&&a&&Object.defineProperty(t,s,a),a};class at{get isDesktop(){return this.privateIsDesktop}get isMobile(){return!this.privateIsDesktop}constructor(){Object.defineProperty(this,"privateIsDesktop",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"handleResize",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.privateIsDesktop=window.matchMedia("(min-width: 900px)").matches;const e=.01*window.innerHeight;document.documentElement.style.setProperty("--vh",`${e}px`)}}),this.handleResize(),(0,r.rC)(this),it(window).on("resize",this.handleResize)}}nt([r.LO],at.prototype,"privateIsDesktop",void 0),nt([r.aD],at.prototype,"handleResize",void 0);class ot{constructor(e=7500,t=18e5){Object.defineProperty(this,"initialDelay",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"maxDelay",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"current",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.current=Math.max(e,1)}get(){const e=this.current+(0,o.random)(5e3,2e4);return this.current=Math.min(2*this.current,this.maxDelay),e}reset(){this.current=this.initialDelay}}var lt=s(2468),ct=s(9755),ut=function(e,t,s,r){var i,n=arguments.length,a=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(n<3?i(a):n>3?i(t,s,a):i(t,s))||a);return n>3&&a&&Object.defineProperty(t,s,a),a};let dt=class{get hasData(){return null!=this.firstLoadedAt}constructor(e){Object.defineProperty(this,"socketWorker",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"waitingVerification",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"firstLoadedAt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"retryDelay",{enumerable:!0,configurable:!0,writable:!0,value:new ot}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"xhr",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"loadMore",{enumerable:!0,configurable:!0,writable:!0,value:()=>{null==this.xhr&&(window.clearTimeout(this.timeout),this.xhr=ct.ajax({dataType:"json",url:(0,g.B)("notifications.index",{unread:1})}),this.xhr.always((()=>{this.xhr=null})).done((e=>(0,r.z)((()=>{this.waitingVerification=!1,this.loadBundle(e),this.retryDelay.reset()})))).fail((e=>(0,r.z)((()=>{var t;"object"==typeof(t=e.responseJSON)&&null!=t&&"error"in t&&"string"==typeof t.error&&"verification"===e.responseJSON.error?this.waitingVerification=!0:401!==e.status&&this.delayedRetryInitialLoadMore()})))))}}),(0,r.N7)(this.socketWorker,"connectionStatus",(e=>{"connected"===e.newValue&&this.loadMore()}),!0),ct.subscribe("user-verification:success.notifications-worker",(()=>{this.loadMore()})),(0,r.rC)(this)}handleDispatchAction(e){if(!(e instanceof T))return;const t=e.message;if("delete"===t.event){const e=new Date(t.data.timestamp);null!=this.firstLoadedAt&&e>this.firstLoadedAt&&(0,N.WI)(lt.Ko.fromJson(t))}else if((e=>"new"===e.event)(t))(0,N.WI)(new lt.d7(t.data));else if((e=>"read"===e.event)(t)){const e=new Date(t.data.timestamp);null!=this.firstLoadedAt&&e>this.firstLoadedAt&&(0,N.WI)(lt.lE.fromJson(t))}}delayedRetryInitialLoadMore(){this.timeout=window.setTimeout(this.loadMore,this.retryDelay.get())}loadBundle(e){(0,N.WI)(new lt.u9(e,{isWidget:!0})),null==this.firstLoadedAt&&(this.firstLoadedAt=new Date(e.timestamp))}};ut([r.LO],dt.prototype,"waitingVerification",void 0),ut([r.LO],dt.prototype,"firstLoadedAt",void 0),ut([r.Fl],dt.prototype,"hasData",null),ut([r.aD],dt.prototype,"loadBundle",null),dt=ut([N.yz],dt);const pt=dt;class mt{constructor(e){Object.defineProperty(this,"message",{enumerable:!0,configurable:!0,writable:!0,value:e})}}class ht{constructor(e){Object.defineProperty(this,"connected",{enumerable:!0,configurable:!0,writable:!0,value:e})}}var bt=s(9755),ft=function(e,t,s,r){var i,n=arguments.length,a=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(n<3?i(a):n>3?i(t,s,a):i(t,s))||a);return n>3&&a&&Object.defineProperty(t,s,a),a};let vt=class{get isConnected(){return"connected"===this.connectionStatus}constructor(){Object.defineProperty(this,"connectionStatus",{enumerable:!0,configurable:!0,writable:!0,value:"disconnected"}),Object.defineProperty(this,"hasConnectedOnce",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"userId",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"active",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"endpoint",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"retryDelay",{enumerable:!0,configurable:!0,writable:!0,value:new ot}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"ws",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"xhr",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"handleNewEvent",{enumerable:!0,configurable:!0,writable:!0,value:e=>{const t=this.parseMessageEvent(e);null!=t&&("logout"===t.event?(this.destroy(),xs.userLoginObserver.logout()):(e=>"verified"===e.event)(t)?bt.publish("user-verification:success"):(0,N.WI)(new T(t)))}}),Object.defineProperty(this,"reconnectWebSocket",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.connectionStatus="disconnected",this.active&&(this.timeout.connectWebSocket=window.setTimeout((0,r.aD)((()=>{this.ws=null,this.connectWebSocket()})),this.retryDelay.get()))}}),Object.defineProperty(this,"startWebSocket",{enumerable:!0,configurable:!0,writable:!0,value:()=>{if(null!=this.endpoint)return this.connectWebSocket();null==this.xhr&&(window.clearTimeout(this.timeout.startWebSocket),this.xhr=bt.get((0,g.B)("notifications.endpoint")),this.xhr.always((()=>{this.xhr=null})).done((e=>{this.retryDelay.reset(),this.endpoint=e.url,this.connectWebSocket()})).fail((e=>{401!==e.status?this.timeout.startWebSocket=window.setTimeout(this.startWebSocket,this.retryDelay.get()):this.destroy()})))}}),(0,r.rC)(this),(0,r.U5)((()=>this.isConnected),(e=>(0,N.WI)(new ht(e))),{fireImmediately:!0})}boot(){this.active=null!=this.userId,this.active&&this.startWebSocket()}handleDispatchAction(e){var t,s;(null===(t=this.ws)||void 0===t?void 0:t.readyState)===WebSocket.OPEN&&e instanceof mt&&(null===(s=this.ws)||void 0===s||s.send(JSON.stringify(e.message)))}setUserId(e){e!==this.userId&&(this.active&&this.destroy(),this.userId=e,this.boot())}connectWebSocket(){if(!this.active||null==this.endpoint||null!=this.ws)return;this.connectionStatus="connecting",window.clearTimeout(this.timeout.connectWebSocket);const e=document.querySelector("meta[name=csrf-token]");if(null==e)return;const t=e.getAttribute("content");this.ws=new WebSocket(`${this.endpoint}?csrf=${t}`),this.ws.addEventListener("open",(0,r.aD)((()=>{this.retryDelay.reset(),this.connectionStatus="connected",this.hasConnectedOnce=!0}))),this.ws.addEventListener("close",this.reconnectWebSocket),this.ws.addEventListener("message",this.handleNewEvent)}destroy(){var e;this.connectionStatus="disconnecting",this.userId=null,this.active=!1,null===(e=this.xhr)||void 0===e||e.abort(),(0,o.forEach)(this.timeout,(e=>window.clearTimeout(e))),null!=this.ws&&(this.ws.close(),this.ws=null),this.connectionStatus="disconnected"}parseMessageEvent(e){try{const s=JSON.parse(e.data);if("object"==typeof(t=s)&&null!=t&&"event"in t)return s;console.error("message missing event type.")}catch(s){console.error("Failed parsing data:",e.data)}var t}};ft([r.LO],vt.prototype,"connectionStatus",void 0),ft([r.LO],vt.prototype,"hasConnectedOnce",void 0),ft([r.LO],vt.prototype,"active",void 0),ft([r.Fl],vt.prototype,"isConnected",null),ft([r.aD],vt.prototype,"connectWebSocket",null),ft([r.aD],vt.prototype,"destroy",null),ft([r.aD],vt.prototype,"reconnectWebSocket",void 0),vt=ft([N.yz],vt);const gt=vt;var yt=s(9755),wt=function(e,t,s,r){var i,n=arguments.length,a=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(n<3?i(a):n>3?i(t,s,a):i(t,s))||a);return n>3&&a&&Object.defineProperty(t,s,a),a};let _t=class{constructor(e){Object.defineProperty(this,"beatmapsetStore",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"recommendedDifficulties",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"resultSets",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"xhr",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),(0,r.rC)(this)}cancel(){this.xhr&&this.xhr.abort()}get(e,t=0){if(t<0)throw Error("from must be > 0");const s=e.toKeyString(),i=this.getOrCreate(s);return t>0&&t<i.beatmapsetIds.size||0===t&&!i.isExpired?Promise.resolve(i):this.fetch(e,t).then((s=>(null!=s&&(0,r.z)((()=>{0===t&&i.reset(),this.updateBeatmapsetStore(s),i.append(s),this.recommendedDifficulties.set(e.mode,s.recommended_difficulty)})),i)))}getResultSet(e){const t=e.toKeyString();return this.getOrCreate(t)}handleDispatchAction(e){e instanceof We&&this.clear()}initialize(e,t){this.updateBeatmapsetStore(t);const s=e.toKeyString(),r=this.getOrCreate(s);null==r.fetchedAt&&(r.append(t),this.recommendedDifficulties.set(e.mode,t.recommended_difficulty))}clear(){this.resultSets.clear(),this.recommendedDifficulties.clear()}fetch(e,t){this.cancel();const s=e.queryParams,r=e.toKeyString(),i=this.getOrCreate(r).cursorString;if(t>0)if(null!=i)s.cursor_string=i;else if(null===i)return Promise.resolve(null);const n=(0,g.B)("beatmapsets.search");return this.xhr=yt.ajax(n,{data:s,dataType:"json",method:"get"}),this.xhr}getOrCreate(e){let t=this.resultSets.get(e);return null==t&&(t=new a,this.resultSets.set(e,t)),t}updateBeatmapsetStore(e){for(const t of e.beatmapsets)this.beatmapsetStore.update(t)}};wt([r.LO],_t.prototype,"recommendedDifficulties",void 0),wt([r.LO],_t.prototype,"resultSets",void 0),wt([r.aD],_t.prototype,"get",null),wt([r.aD],_t.prototype,"initialize",null),wt([r.aD],_t.prototype,"clear",null),_t=wt([N.yz],_t);class Et{constructor(e){Object.defineProperty(this,"channelId",{enumerable:!0,configurable:!0,writable:!0,value:e})}}var Ot=s(789),Pt=s(6192),jt=s(8256),kt=s(849);class Nt{constructor(e){Object.defineProperty(this,"json",{enumerable:!0,configurable:!0,writable:!0,value:e})}}class St{constructor(e){Object.defineProperty(this,"channelStore",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"lastHistoryId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"retryDelay",{enumerable:!0,configurable:!0,writable:!0,value:new ot(0,45e3)}),Object.defineProperty(this,"timerId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"xhr",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ping",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.xhr=(0,kt.In)(this.channelStore.lastReceivedMessageId,this.lastHistoryId).done((e=>{var t;const s=null===(t=(0,o.maxBy)(e.silences,"id"))||void 0===t?void 0:t.id;null!=s&&(this.lastHistoryId=s),(0,N.WI)(new Nt(e.silences)),this.retryDelay.reset(),this.scheduleNextPing()})).fail((e=>{401!==e.status&&this.scheduleNextPing()}))}})}start(){null==this.timerId&&this.scheduleNextPing()}stop(){var e;null===(e=this.xhr)||void 0===e||e.abort(),this.retryDelay.reset(),null!=this.timerId&&(window.clearTimeout(this.timerId),this.timerId=void 0)}scheduleNextPing(){this.timerId=window.setTimeout(this.ping,this.retryDelay.get())}}var Ct=s(2918),Tt=function(e,t,s,r){var i,n=arguments.length,a=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(n<3?i(a):n>3?i(t,s,a):i(t,s))||a);return n>3&&a&&Object.defineProperty(t,s,a),a},xt=function(e,t,s,r){return new(s||(s=Promise))((function(i,n){function a(e){try{l(r.next(e))}catch(t){n(t)}}function o(e){try{l(r.throw(e))}catch(t){n(t)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(a,o)}l((r=r.apply(e,t||[])).next())}))};let Dt=class{get isChatMounted(){return this.viewsMounted.size>0}get isJoiningChannel(){return null!=this.waitJoinChannelUuid}get selectedChannel(){return null==this.selected||"create"===this.selected?null:this.channelStore.get(this.selected)}get showingCreateAnnouncement(){return"create"===this.selected}get channelList(){return Pt.R9.flatMap((e=>this.channelStore.groupedChannels[e]))}constructor(e){Object.defineProperty(this,"channelStore",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"canChatAnnounce",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"createAnnouncement",{enumerable:!0,configurable:!0,writable:!0,value:new jt.ZP}),Object.defineProperty(this,"isReady",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"skipRefresh",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"viewsMounted",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"isConnected",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lastHistoryId",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"pingService",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"selected",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"selectedIndex",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"waitJoinChannelUuid",{enumerable:!0,configurable:!0,writable:!0,value:null}),this.pingService=new St(e),(0,r.rC)(this),(0,r.N7)(e.channels,(e=>{"delete"===e.type&&this.refocusSelectedChannel()})),(0,r.EH)((()=>{this.isReady&&this.isChatMounted?(this.pingService.start(),(0,N.WI)(new mt({event:"chat.start"}))):(this.pingService.stop(),(0,N.WI)(new mt({event:"chat.end"})))})),(0,r.EH)((()=>xt(this,void 0,void 0,(function*(){this.isConnected&&this.isChatMounted&&(this.skipRefresh?this.skipRefresh=!1:yield this.updateChannelList(),(0,r.z)((()=>{"number"==typeof this.selected&&this.channelStore.loadChannel(this.selected),this.isReady=!0})))}))))}handleDispatchAction(e){e instanceof x?this.handleChatChannelJoinEvent(e):e instanceof D?this.handleChatChannelPartEvent(e):e instanceof Et?this.handleChatNewConversationAdded(e):e instanceof Ot.Z?this.handleFriendUpdated(e):e instanceof ht&&this.handleSocketStateChanged(e)}joinChannel(){if(!this.createAnnouncement.isValid||this.isJoiningChannel)return;const e=this.createAnnouncement.toJson();this.waitJoinChannelUuid=e.uuid,(0,kt.C8)(e).fail((0,r.aD)((e=>{(0,Be.qQ)(e),this.waitJoinChannelUuid=null})))}selectChannel(e,t="advanceHistory"){var s,r;if(this.selected===e)return;if(null===(s=this.selectedChannel)||void 0===s||s.throttledSendMarkAsRead(),this.selected=e,"create"===e)return void(null!=t&&Ct.controller[t]((0,c.bj)(null,{channel_id:null,sendto:null},"create")));if(null==e)return;const i=this.channelStore.get(e);if(null!=i){if(this.selectedIndex=this.channelList.indexOf(i),this.channelStore.loadChannel(e),null!=t){const e=i.newPmChannel?{channel_id:null,sendto:null===(r=i.pmTarget)||void 0===r?void 0:r.toString()}:{channel_id:i.channelId.toString(),sendto:null};Ct.controller[t]((0,c.bj)(null,e,""))}xs.browserTitleWithNotificationCount.title=`${i.name} · ${(0,y.dW)("page_title.main.chat_controller._")}`}else console.error(`Trying to switch to non-existent channel ${e}`)}selectFirst(){0!==this.channelList.length&&(this.selectChannel(this.channelList[0].channelId,null),Ct.controller.replaceHistory((0,c.bj)(null,{channel_id:null,sendto:null})))}focusChannelAtIndex(e){if(0===this.channelList.length)return;const t=(0,o.clamp)(e,0,this.channelList.length-1),s=this.channelList[t];this.selectChannel(s.channelId)}handleChatChannelJoinEvent(e){this.channelStore.update(e.json),null!=this.waitJoinChannelUuid&&this.waitJoinChannelUuid===e.json.uuid&&(this.selectChannel(e.json.channel_id),this.waitJoinChannelUuid=null,"ANNOUNCE"===e.json.type&&this.createAnnouncement.clear())}handleChatChannelPartEvent(e){this.channelStore.partChannel(e.channelId,!1)}handleChatNewConversationAdded(e){this.selectChannel(e.channelId)}handleFriendUpdated(e){if(!this.isChatMounted)return;const t=this.channelStore.groupedChannels.PM.find((t=>t.pmTarget===e.userId));null==t||t.loadMetadata()}handleSocketStateChanged(e){this.isConnected=e.connected,e.connected||(this.channelStore.channels.forEach((e=>e.needsRefresh=!0)),this.isReady=!1)}refocusSelectedChannel(){this.showingCreateAnnouncement||(null!=this.selectedChannel?this.selectChannel(this.selectedChannel.channelId):this.focusChannelAtIndex(this.selectedIndex))}updateChannelList(){return xt(this,void 0,void 0,(function*(){const e=yield(0,kt.C4)(this.channelStore.lastReceivedMessageId,this.lastHistoryId);e&&(0,r.z)((()=>{var t;const s=null===(t=(0,o.maxBy)(e.silences,"id"))||void 0===t?void 0:t.id;null!=s&&(this.lastHistoryId=s),this.channelStore.updateWithChatUpdates(e)}))}))}};Tt([r.LO],Dt.prototype,"canChatAnnounce",void 0),Tt([r.LO],Dt.prototype,"createAnnouncement",void 0),Tt([r.LO],Dt.prototype,"isReady",void 0),Tt([r.LO],Dt.prototype,"viewsMounted",void 0),Tt([r.LO],Dt.prototype,"isConnected",void 0),Tt([r.LO],Dt.prototype,"selected",void 0),Tt([r.LO],Dt.prototype,"waitJoinChannelUuid",void 0),Tt([r.Fl],Dt.prototype,"isChatMounted",null),Tt([r.Fl],Dt.prototype,"isJoiningChannel",null),Tt([r.Fl],Dt.prototype,"selectedChannel",null),Tt([r.Fl],Dt.prototype,"channelList",null),Tt([r.aD],Dt.prototype,"joinChannel",null),Tt([r.aD],Dt.prototype,"selectChannel",null),Tt([r.aD],Dt.prototype,"selectFirst",null),Tt([r.aD],Dt.prototype,"focusChannelAtIndex",null),Tt([r.aD],Dt.prototype,"handleChatChannelJoinEvent",null),Tt([r.aD],Dt.prototype,"handleChatChannelPartEvent",null),Tt([r.aD],Dt.prototype,"handleChatNewConversationAdded",null),Tt([r.aD],Dt.prototype,"handleFriendUpdated",null),Tt([r.aD],Dt.prototype,"handleSocketStateChanged",null),Tt([r.aD],Dt.prototype,"refocusSelectedChannel",null),Tt([r.aD],Dt.prototype,"updateChannelList",null),Dt=Tt([N.yz],Dt);const Rt=Dt;var Mt=function(e,t,s,r){var i,n=arguments.length,a=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(n<3?i(a):n>3?i(t,s,a):i(t,s))||a);return n>3&&a&&Object.defineProperty(t,s,a),a};class It{constructor(){Object.defineProperty(this,"beatmapsets",{enumerable:!0,configurable:!0,writable:!0,value:r.LO.map()}),(0,r.rC)(this)}get(e){return this.beatmapsets.get(e)}handleDispatchAction(e){e instanceof We&&this.flushStore()}update(e){this.beatmapsets.set(e.id,e)}flushStore(){this.beatmapsets.clear()}}Mt([r.LO],It.prototype,"beatmapsets",void 0),Mt([r.aD],It.prototype,"update",null),Mt([r.aD],It.prototype,"flushStore",null);var Lt=s(8457),At=s(7595),$t=s(9603),Bt=function(e,t,s,r){var i,n=arguments.length,a=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(n<3?i(a):n>3?i(t,s,a):i(t,s))||a);return n>3&&a&&Object.defineProperty(t,s,a),a},Ut=function(e,t,s,r){return new(s||(s=Promise))((function(i,n){function a(e){try{l(r.next(e))}catch(t){n(t)}}function o(e){try{l(r.throw(e))}catch(t){n(t)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(a,o)}l((r=r.apply(e,t||[])).next())}))};function Ft(e,t){return e.name.localeCompare(t.name)}const Wt={ANNOUNCE:Ft,GROUP:Ft,PM:(e,t)=>e.newPmChannel?-1:t.newPmChannel?1:e.lastMessageId===t.lastMessageId?0:e.lastMessageId>t.lastMessageId?-1:1,PUBLIC:Ft};let Zt=class{get groupedChannels(){const e=function(){const e={};for(const t of Pt.R9)e[t]=[];return e}();for(const t of this.channels.values())null!=t.supportedType&&e[t.supportedType].push(t);for(const t of Pt.R9)e[t]=e[t].sort(Wt[t]);return e}constructor(){Object.defineProperty(this,"channels",{enumerable:!0,configurable:!0,writable:!0,value:r.LO.map()}),Object.defineProperty(this,"lastReceivedMessageId",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"ignoredChannels",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),(0,r.rC)(this)}addNewConversation(e,t){const s=this.update(e);return s.addMessages([$t.Z.fromJson(t)]),s}findPM(e){var t;if(e===(null===(t=xs.currentUser)||void 0===t?void 0:t.id))return null;for(const[,s]of this.channels)if("PM"===s.type&&s.userIds.includes(e))return s;return null}flushStore(){this.channels.clear()}get(e){return this.channels.get(e)}handleDispatchAction(e){e instanceof R?this.handleChatMessageNewEvent(e):e instanceof Lt.O?this.handleChatMessageSendAction(e):e instanceof Nt&&this.handleChatUpdateSilences(e)}loadChannel(e){var t;null===(t=this.channels.get(e))||void 0===t||t.load()}loadChannelEarlierMessages(e){var t;null===(t=this.get(e))||void 0===t||t.loadEarlierMessages()}partChannel(e,t=!0){const s=this.get(e);null!=s&&(e>0&&t&&(s.isHideable||this.ignoredChannels.add(e),(0,kt.IQ)(e,xs.currentUserOrFail.id).always((()=>this.ignoredChannels.delete(e)))),this.channels.delete(e))}update(e){const t=e.channel_id;let s=this.channels.get(t);return s||(s=new At.Z(t),this.channels.set(t,s)),s.updateWithJson(e),this.ignoredChannels.delete(t),s}updateMany(e){this.ignoredChannels.clear(),(0,Pt.N)(e).forEach((e=>{this.update(e)})),this.channels.forEach((t=>{t.newPmChannel||e.find((e=>e.channel_id===t.channelId))||this.channels.delete(t.channelId)}))}updateWithChatUpdates(e){var t;if(null!=e.presence&&this.updateMany(e.presence),null!=e.messages){this.updateLastReceivedMessageId(e.messages);const s=(0,o.groupBy)(e.messages,"channel_id");for(const e of Object.keys(s)){const r=parseInt(e,10),i=s[r].map($t.Z.fromJson);null===(t=this.channels.get(r))||void 0===t||t.addMessages(i)}}null!=e.silences&&(0,N.WI)(new Nt(e.silences))}handleChatMessageNewEvent(e){return Ut(this,void 0,void 0,(function*(){for(const s of e.json.messages){const e=this.channels.get(s.channel_id);if(null!=e)e.addMessage(s);else if(!this.ignoredChannels.has(s.channel_id))try{const e=yield(0,kt.mr)(s.channel_id);this.update(e)}catch(t){if(!(0,Be.bE)(t))throw t;404!==t.status&&(0,Be.qQ)(t)}}this.updateLastReceivedMessageId(e.json.messages)}))}handleChatMessageSendAction(e){return Ut(this,void 0,void 0,(function*(){const t=e.message,s=this.get(t.channelId);if(null!=s){s.addSendingMessage(t);try{if(s.newPmChannel){const e=s.pmTarget;if(null==e)return void console.error("sendMessage:: userId not found?? this shouldn't happen");const i=yield(0,kt.Ki)(e,t);(0,r.z)((()=>{this.channels.delete(t.channelId);const e=this.addNewConversation(i.channel,i.message);(0,N.WI)(new Et(e.channelId))}))}else{const e=yield(0,kt.bG)(t);s.afterSendMesssage(t,e)}}catch(i){if(s.afterSendMesssage(t,null),!(0,Be.bE)(i))throw i;(0,Be.qQ)(i)}}else console.error("channel missing")}))}handleChatUpdateSilences(e){const t=new Set(e.json.map((e=>e.user_id)));this.removePublicMessagesFromUserIds(t)}removePublicMessagesFromUserIds(e){this.groupedChannels.PUBLIC.forEach((t=>{t.removeMessagesFromUserIds(e)}))}updateLastReceivedMessageId(e){var t,s;null!=e&&(this.lastReceivedMessageId=null!==(s=null===(t=(0,o.maxBy)(e,"message_id"))||void 0===t?void 0:t.message_id)&&void 0!==s?s:this.lastReceivedMessageId)}};Bt([r.LO],Zt.prototype,"channels",void 0),Bt([r.Fl],Zt.prototype,"groupedChannels",null),Bt([r.aD],Zt.prototype,"addNewConversation",null),Bt([r.aD],Zt.prototype,"flushStore",null),Bt([r.aD],Zt.prototype,"loadChannel",null),Bt([r.aD],Zt.prototype,"loadChannelEarlierMessages",null),Bt([r.aD],Zt.prototype,"partChannel",null),Bt([r.aD],Zt.prototype,"update",null),Bt([r.aD],Zt.prototype,"updateMany",null),Bt([r.aD],Zt.prototype,"updateWithChatUpdates",null),Bt([r.aD],Zt.prototype,"handleChatMessageNewEvent",null),Bt([r.aD],Zt.prototype,"handleChatMessageSendAction",null),Bt([r.aD],Zt.prototype,"handleChatUpdateSilences",null),Bt([r.aD],Zt.prototype,"removePublicMessagesFromUserIds",null),Bt([r.aD],Zt.prototype,"updateLastReceivedMessageId",null),Zt=Bt([N.yz],Zt);const Ht=Zt;var Gt=s(9755),Vt=function(e,t,s,r){var i,n=arguments.length,a=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(n<3?i(a):n>3?i(t,s,a):i(t,s))||a);return n>3&&a&&Object.defineProperty(t,s,a),a};class qt{constructor(e){Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"isRevoking",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"revoked",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"scopes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"user",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"userId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.id=e.id,this.name=e.name,this.scopes=new Set(e.scopes),this.userId=e.user_id,this.user=e.user,(0,r.rC)(this)}revoke(){this.isRevoking=!0;const e=Gt.ajax({method:"DELETE",url:(0,g.B)("oauth.authorized-clients.destroy",{authorized_client:this.id})});return e.done((0,r.aD)((()=>{this.revoked=!0}))).always((0,r.aD)((()=>{this.isRevoking=!1}))),e}}Vt([r.LO],qt.prototype,"isRevoking",void 0),Vt([r.LO],qt.prototype,"revoked",void 0),Vt([r.LO],qt.prototype,"scopes",void 0),Vt([r.aD],qt.prototype,"revoke",null);var zt=function(e,t,s,r){var i,n=arguments.length,a=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(n<3?i(a):n>3?i(t,s,a):i(t,s))||a);return n>3&&a&&Object.defineProperty(t,s,a),a};class Kt{constructor(){Object.defineProperty(this,"clients",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),(0,r.rC)(this)}handleDispatchAction(e){e instanceof We&&this.flushStore()}initialize(e){for(const t of e){const e=new qt(t);this.clients.set(e.id,e)}}flushStore(){this.clients.clear()}}zt([r.LO],Kt.prototype,"clients",void 0),zt([r.aD],Kt.prototype,"flushStore",null);var Jt=s(7417),Qt=s(1882),Yt=function(e,t,s,r){var i,n=arguments.length,a=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(n<3?i(a):n>3?i(t,s,a):i(t,s))||a);return n>3&&a&&Object.defineProperty(t,s,a),a};class Xt{get canMarkAsRead(){for(const[,e]of this.notifications)if(e.canMarkRead)return!0;return!1}get first(){var e;return null!==(e=this.orderedNotifications[0])&&void 0!==e?e:this.lastNotification}get hasMore(){return!(this.notifications.size>=this.total||null==this.cursor)}get hasVisibleNotifications(){return this.notifications.size>0}get id(){return`${this.objectType}-${this.objectId}-${this.category}`}get identity(){return{category:this.category,objectId:this.objectId,objectType:this.objectType}}get isSingle(){return 1===this.total}get orderedNotifications(){return[...this.notifications.values()].sort(((e,t)=>t.id-e.id))}get type(){return this.objectType}constructor(e,t,s,i){Object.defineProperty(this,"objectId",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"objectType",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"category",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"resolver",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"cursor",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"displayOrder",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"isDeleting",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"isLoading",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"isMarkingAsRead",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"notifications",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"total",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"lastNotification",{enumerable:!0,configurable:!0,writable:!0,value:null}),(0,r.rC)(this)}static fromJson(e,t){const s=new Xt(e.object_id,e.object_type,e.category,t);return s.updateWithJson(e),s}add(e){this.notifications.set(e.id,e),this.displayOrder=Math.max(e.id,this.displayOrder)}delete(){this.resolver.delete(this)}deleteItem(e){null!=e&&this.notifications.has(e.id)&&this.resolver.delete(e)}loadMore(e){null!=this.cursor&&(this.isLoading=!0,this.resolver.loadMore(this.identity,e,this.cursor).always((0,r.aD)((()=>{this.isLoading=!1}))))}markAsRead(e){null!=e&&this.notifications.has(e.id)&&this.resolver.queueMarkAsRead(e)}markStackAsRead(){this.resolver.queueMarkAsRead(this)}remove(e){1===this.notifications.size&&(this.lastNotification=this.notifications.values().next().value);const t=this.notifications.delete(e.id);return t&&this.total--,t}updateWithJson(e){this.cursor=e.cursor,this.total=e.total}}Yt([r.LO],Xt.prototype,"cursor",void 0),Yt([r.LO],Xt.prototype,"displayOrder",void 0),Yt([r.LO],Xt.prototype,"isDeleting",void 0),Yt([r.LO],Xt.prototype,"isLoading",void 0),Yt([r.LO],Xt.prototype,"isMarkingAsRead",void 0),Yt([r.LO],Xt.prototype,"notifications",void 0),Yt([r.LO],Xt.prototype,"total",void 0),Yt([r.LO],Xt.prototype,"lastNotification",void 0),Yt([r.Fl],Xt.prototype,"canMarkAsRead",null),Yt([r.Fl],Xt.prototype,"first",null),Yt([r.Fl],Xt.prototype,"hasMore",null),Yt([r.Fl],Xt.prototype,"hasVisibleNotifications",null),Yt([r.Fl],Xt.prototype,"id",null),Yt([r.Fl],Xt.prototype,"isSingle",null),Yt([r.Fl],Xt.prototype,"orderedNotifications",null),Yt([r.aD],Xt.prototype,"add",null),Yt([r.aD],Xt.prototype,"delete",null),Yt([r.aD],Xt.prototype,"deleteItem",null),Yt([r.aD],Xt.prototype,"loadMore",null),Yt([r.aD],Xt.prototype,"markAsRead",null),Yt([r.aD],Xt.prototype,"markStackAsRead",null),Yt([r.aD],Xt.prototype,"remove",null),Yt([r.aD],Xt.prototype,"updateWithJson",null);var es=s(7581),ts=s(4927),ss=s(9755),rs=function(e,t,s,r){var i,n=arguments.length,a=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(n<3?i(a):n>3?i(t,s,a):i(t,s))||a);return n>3&&a&&Object.defineProperty(t,s,a),a};class is{constructor(){Object.defineProperty(this,"debouncedDeleteByIds",{enumerable:!0,configurable:!0,writable:!0,value:(0,o.debounce)((()=>this.deleteByIds()),500)}),Object.defineProperty(this,"debouncedSendQueuedMarkedAsRead",{enumerable:!0,configurable:!0,writable:!0,value:(0,o.debounce)((()=>this.sendQueuedMarkedAsRead()),500)}),Object.defineProperty(this,"deleteByIdsQueue",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"queuedMarkedAsRead",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"queuedMarkedAsReadIdentities",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),(0,r.rC)(this)}delete(e){if(e.isDeleting=!0,e instanceof Qt.Z)return this.deleteByIdsQueue.set(e.id,e),void this.debouncedDeleteByIds();ss.ajax({data:{identities:[(0,Jt.Qs)(e.identity)]},dataType:"json",method:"DELETE",url:(0,g.B)("notifications.index")}).done((0,r.aD)((()=>{(0,N.WI)(new lt.Ko([e.identity],0))}))).fail(Be.qQ).always((0,r.aD)((()=>e.isDeleting=!1)))}loadMore(e,t,s){const r=(0,Jt.Qs)(e);delete r.id;const i=(0,g.B)("notifications.index",r),n={data:{cursor:s,unread:t.isWidget},dataType:"json",url:i};return ss.ajax(n).then((e=>{(0,N.WI)(new lt.u9(e,t))}))}queueMarkAsRead(e){e.isMarkingAsRead=!0;const t=e.identity;"stack"!==(0,Jt._n)(t)?(e instanceof Qt.Z&&e.canMarkRead?this.queuedMarkedAsRead.set(e.id,e):this.queuedMarkedAsReadIdentities.set((0,Jt.BB)(t),e),this.debouncedSendQueuedMarkedAsRead()):this.sendMarkAsReadRequest({identities:[(0,Jt.Qs)(e.identity)]}).then((0,r.aD)((()=>{(0,N.WI)(new lt.lE([t],0))}))).always((0,r.aD)((()=>e.isMarkingAsRead=!1)))}deleteByIds(){if(0===this.deleteByIdsQueue.size)return;const e=[...this.deleteByIdsQueue.values()],t=e.map((e=>e.identity));this.deleteByIdsQueue.clear(),ss.ajax({data:{notifications:t.map(Jt.Qs)},dataType:"json",method:"DELETE",url:(0,g.B)("notifications.index")}).then((0,r.aD)((()=>{(0,N.WI)(new lt.Ko(t,0))}))).always((0,r.aD)((()=>e.forEach((e=>e.isDeleting=!1)))))}sendMarkAsReadRequest(e){const t=ss.ajax({data:e,dataType:"json",method:"POST",url:(0,g.B)("notifications.mark-read")});return t.fail(Be.qQ),t}sendQueuedMarkedAsRead(){if(this.queuedMarkedAsRead.size>0){const e=[...this.queuedMarkedAsRead.values()],t=e.map((e=>e.identity));this.queuedMarkedAsRead.clear(),this.sendMarkAsReadRequest({notifications:t.map(Jt.Qs)}).then((0,r.aD)((()=>{(0,N.WI)(new lt.lE(t,0))}))).always((0,r.aD)((()=>e.forEach((e=>e.isMarkingAsRead=!1)))))}if(this.queuedMarkedAsReadIdentities.size>0){const e=[...this.queuedMarkedAsReadIdentities.values()],t=e.map((e=>e.identity));this.queuedMarkedAsReadIdentities.clear(),this.sendMarkAsReadRequest({identities:t.map(Jt.Qs)}).then((0,r.aD)((()=>{(0,N.WI)(new lt.lE(t,0))}))).always((0,r.aD)((()=>e.forEach((e=>e.isMarkingAsRead=!1)))))}}}rs([r.aD],is.prototype,"delete",null),rs([r.aD],is.prototype,"loadMore",null),rs([r.aD],is.prototype,"queueMarkAsRead",null);var ns=function(e,t,s,r){var i,n=arguments.length,a=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(n<3?i(a):n>3?i(t,s,a):i(t,s))||a);return n>3&&a&&Object.defineProperty(t,s,a),a};let as=class{get allStacks(){return this.allType.stacks}get allType(){return this.getOrCreateType({objectType:null})}get isEmpty(){return 1===this.types.size&&0===this.allStacks.size}get total(){return this.allType.total}set total(e){this.allType.total=e}constructor(e){Object.defineProperty(this,"notificationStore",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"types",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"deletedStacks",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"resolver",{enumerable:!0,configurable:!0,writable:!0,value:new is}),Object.defineProperty(this,"removeByNotification",{enumerable:!0,configurable:!0,writable:!0,value:e=>{var t,s;if(null==e.id)return;const r=this.getStack(e),i=this.getOrCreateType(e),n=null==r?void 0:r.notifications.get(e.id);null==n?null!=r&&e.id<(null!==(s=null===(t=r.cursor)||void 0===t?void 0:t.id)&&void 0!==s?s:0)&&(this.total--,r.total--,i.total--):(null==r||r.remove(n),i.total--,this.total--)}}),this.getOrCreateType({objectType:null}),(0,r.rC)(this)}flushStore(){this.types.clear()}getOrCreateType(e){let t=this.types.get(e.objectType);return null==t&&(t=new es.ZP(e.objectType,this.resolver),this.types.set(t.name,t)),t}getStack(e){var t;return null===(t=this.types.get(e.objectType))||void 0===t?void 0:t.stacks.get((0,Jt.$w)(e))}handleDispatchAction(e){e instanceof lt.Ko?this.handleNotificationEventDelete(e):e instanceof lt.d7?this.handleNotificationEventNew(e):e instanceof lt.u9?this.handleNotificationEventMoreLoaded(e):e instanceof lt.lE?this.handleNotificationEventRead(e):e instanceof We&&this.flushStore()}handleNotificationEventDelete(e){this.removeByEvent(e)}handleNotificationEventMoreLoaded(e){e.context.isWidget||this.updateWithBundle(e.data)}handleNotificationEventNew(e){const t=e.data;let s=this.notificationStore.get(t.id);null==s?(s=Qt.Z.fromJson(t),this.notificationStore.add(s)):s.updateFromJson(t);const r=s.identity,i=this.getOrCreateType(r);let n=this.getStack(r);null==n&&(n=new Xt(t.object_id,t.object_type,(0,ts.Yg)(t.name),this.resolver)),n.notifications.has(s.id)||(n.total++,i.total++,this.total++),n.add(s),i.stacks.set(n.id,n),this.allStacks.set(n.id,n)}handleNotificationEventRead(e){}orderedStacksOfType(e){return this.stacksOfType(e).sort(((e,t)=>t.displayOrder-e.displayOrder))}removeByEvent(e){for(const t of e.data){switch((0,Jt._n)(t)){case"type":this.removeByType(t);break;case"stack":this.removeByStack(t,e.readCount);break;case"notification":this.removeByNotification(t)}}}stacksOfType(e){var t,s;const r=this.types.get(e),i=[];if(null==r)return i;const n=null!==(s=null===(t=r.cursor)||void 0===t?void 0:t.id)&&void 0!==s?s:0;for(const[,a]of r.stacks)void 0!==(null==r?void 0:r.cursor)&&a.displayOrder>=n&&i.push(a);return i}updateWithBundle(e){var t,s,r;null===(t=e.types)||void 0===t||t.forEach((e=>this.updateWithTypeJson(e))),null===(s=e.stacks)||void 0===s||s.forEach((e=>this.updateWithStackJson(e))),null===(r=e.notifications)||void 0===r||r.forEach((e=>this.updateWithNotificationJson(e)))}removeByStack(e,t){const s=this.getStack(e),r=(0,Jt.$w)(e);if(null==s)return void(this.deletedStacks.has(r)||(this.deletedStacks.add(r),this.total-=t));this.deletedStacks.add(r),this.allStacks.delete(r),this.total-=s.total;this.getOrCreateType(e).removeStack(s)}removeByType(e){const t=this.getOrCreateType(e);if(null===t.name){for(const[e,t]of this.types)null!==e&&this.removeType(t);t.total=0}else this.removeType(t)}removeType(e){e.stacks.forEach((e=>{this.allType.removeStack(e)})),e.total=0,this.types.delete(e.name)}updateWithNotificationJson(e){var t;let s=this.notificationStore.get(e.id);null==s?(s=Qt.Z.fromJson(e),this.notificationStore.add(s)):s.updateFromJson(e);null===(t=this.getOrCreateType(s.identity).stacks.get(s.stackId))||void 0===t||t.add(s)}updateWithStackJson(e){const t=this.getOrCreateType((0,Jt.xZ)(e));let s=t.stacks.get(function(e){return`${e.object_type}-${e.object_id}-${e.category}`}(e));null==s?(s=Xt.fromJson(e,this.resolver),t.stacks.set(s.id,s),this.allType.stacks.set(s.id,s)):s.updateWithJson(e)}updateWithTypeJson(e){this.getOrCreateType({objectType:e.name}).updateWithJson(e)}};ns([r.LO],as.prototype,"types",void 0),ns([r.Fl],as.prototype,"total",null),ns([r.aD],as.prototype,"flushStore",null),ns([r.aD],as.prototype,"getOrCreateType",null),ns([r.aD],as.prototype,"handleDispatchAction",null),ns([r.aD],as.prototype,"handleNotificationEventDelete",null),ns([r.aD],as.prototype,"handleNotificationEventMoreLoaded",null),ns([r.aD],as.prototype,"handleNotificationEventNew",null),ns([r.aD],as.prototype,"handleNotificationEventRead",null),ns([r.aD],as.prototype,"removeByEvent",null),ns([r.aD],as.prototype,"updateWithBundle",null),as=ns([N.yz],as);const os=as;var ls=function(e,t,s,r){var i,n=arguments.length,a=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(n<3?i(a):n>3?i(t,s,a):i(t,s))||a);return n>3&&a&&Object.defineProperty(t,s,a),a};let cs=class extends os{handleNotificationEventMoreLoaded(e){e.context.isWidget&&this.updateWithBundle(e.data)}handleNotificationEventNew(e){e.data.is_read||super.handleNotificationEventNew(e)}handleNotificationEventRead(e){this.removeByEvent(e)}updateWithBundle(e){super.updateWithBundle(e),null!=e.unread_count&&(this.total=e.unread_count)}};ls([r.KG],cs.prototype,"handleNotificationEventMoreLoaded",null),ls([r.KG],cs.prototype,"handleNotificationEventNew",null),ls([r.KG],cs.prototype,"handleNotificationEventRead",null),ls([r.KG],cs.prototype,"updateWithBundle",null),cs=ls([N.yz],cs);const us=cs;var ds=function(e,t,s,r){var i,n=arguments.length,a=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(n<3?i(a):n>3?i(t,s,a):i(t,s))||a);return n>3&&a&&Object.defineProperty(t,s,a),a};let ps=class{constructor(){Object.defineProperty(this,"notifications",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"stacks",{enumerable:!0,configurable:!0,writable:!0,value:new os(this)}),Object.defineProperty(this,"unreadStacks",{enumerable:!0,configurable:!0,writable:!0,value:new us(this)}),(0,r.rC)(this)}add(e){this.notifications.set(e.id,e)}flushStore(){this.notifications.clear()}get(e){return this.notifications.get(e)}handleDispatchAction(e){e instanceof lt.Ko?this.handleNotificationEventDelete(e):e instanceof lt.lE?this.handleNotificationEventRead(e):e instanceof We&&this.flushStore()}handleNotificationEventDelete(e){this.eachByEvent(e,(e=>{this.notifications.delete(e.id)}))}handleNotificationEventRead(e){this.eachByEvent(e,(e=>{e.isRead=!0}))}eachByEvent(e,t){for(const s of e.data){switch((0,Jt._n)(s)){case"type":this.eachByType(s,t);break;case"stack":this.eachByStack(s,t);break;case"notification":{if(null==s.id)return;const e=this.get(s.id);null!=e&&t(e);break}}}}eachByStack(e,t){const s=(0,Jt.$w)(e);this.notifications.forEach((e=>{e.stackId===s&&t(e)}))}eachByType(e,t){this.notifications.forEach((s=>{null!=e.objectType&&s.objectType!==e.objectType||t(s)}))}};ds([r.LO],ps.prototype,"notifications",void 0),ds([r.aD],ps.prototype,"add",null),ds([r.aD],ps.prototype,"flushStore",null),ds([r.aD],ps.prototype,"handleDispatchAction",null),ds([r.aD],ps.prototype,"handleNotificationEventDelete",null),ds([r.aD],ps.prototype,"handleNotificationEventRead",null),ps=ds([N.yz],ps);const ms=ps;var hs=s(9755),bs=function(e,t,s,r){var i,n=arguments.length,a=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(n<3?i(a):n>3?i(t,s,a):i(t,s))||a);return n>3&&a&&Object.defineProperty(t,s,a),a};class fs extends qt{get redirect(){return this.redirectOrig.replace(/,/g,"\r\n")}constructor(e){super(e),Object.defineProperty(this,"isResetting",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"isUpdating",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"secret",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"redirectOrig",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.redirectOrig=e.redirect,this.secret=e.secret,(0,r.rC)(this)}delete(){this.isRevoking=!0;const e=hs.ajax({method:"DELETE",url:(0,g.B)("oauth.clients.destroy",{client:this.id})});return e.done((0,r.aD)((()=>{this.revoked=!0}))).always((0,r.aD)((()=>{this.isRevoking=!1}))),e}resetSecret(){this.isResetting=!0;const e=hs.ajax({method:"POST",url:(0,g.B)("oauth.clients.reset-secret",{client:this.id})});return e.done((e=>{this.updateFromJson(e)})).always((0,r.aD)((()=>{this.isResetting=!1}))),e}updateFromJson(e){this.id=e.id,this.name=e.name,this.scopes=new Set(e.scopes),this.userId=e.user_id,this.user=e.user,this.redirectOrig=e.redirect,this.secret=e.secret}updateWith(e){const{redirect:t}=e;this.isUpdating=!0;const s=hs.ajax({data:{redirect:t},method:"PUT",url:(0,g.B)("oauth.clients.update",{client:this.id})});return s.done((e=>{this.updateFromJson(e)})).always((0,r.aD)((()=>{this.isUpdating=!1}))),s}}bs([r.LO],fs.prototype,"isResetting",void 0),bs([r.LO],fs.prototype,"isUpdating",void 0),bs([r.LO],fs.prototype,"redirectOrig",void 0),bs([r.Fl],fs.prototype,"redirect",null),bs([r.aD],fs.prototype,"delete",null),bs([r.aD],fs.prototype,"resetSecret",null),bs([r.aD],fs.prototype,"updateFromJson",null),bs([r.aD],fs.prototype,"updateWith",null);var vs=function(e,t,s,r){var i,n=arguments.length,a=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(n<3?i(a):n>3?i(t,s,a):i(t,s))||a);return n>3&&a&&Object.defineProperty(t,s,a),a};class gs{constructor(){Object.defineProperty(this,"clients",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),(0,r.rC)(this)}handleDispatchAction(e){e instanceof We&&this.flushStore()}initialize(e){for(const t of e)this.updateWithJson(t)}updateWithJson(e){const t=new fs(e);return this.clients.set(t.id,t),t}flushStore(){this.clients.clear()}}vs([r.LO],gs.prototype,"clients",void 0),vs([r.aD],gs.prototype,"updateWithJson",null),vs([r.aD],gs.prototype,"flushStore",null);var ys=function(e,t,s,r){var i,n=arguments.length,a=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(n<3?i(a):n>3?i(t,s,a):i(t,s))||a);return n>3&&a&&Object.defineProperty(t,s,a),a};class ws{constructor(){Object.defineProperty(this,"account",{enumerable:!0,configurable:!0,writable:!0,value:{client:null,isCreatingNewClient:!1,newClientVisible:!1}}),(0,r.rC)(this)}}ys([r.LO],ws.prototype,"account",void 0);var _s=s(8125),Es=function(e,t,s,r){var i,n=arguments.length,a=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(n<3?i(a):n>3?i(t,s,a):i(t,s))||a);return n>3&&a&&Object.defineProperty(t,s,a),a};let Os=class{constructor(){Object.defineProperty(this,"users",{enumerable:!0,configurable:!0,writable:!0,value:r.LO.map()}),(0,r.rC)(this)}flushStore(){this.users=r.LO.map()}get(e){return this.users.get(e)}handleDispatchAction(e){e instanceof R&&this.updateMany(e.json.users)}update(e){const t=e.id;let s=this.users.get(t);return null==s&&(s=new _s.ZP(t),this.users.set(t,s)),s.updateWithJson(e),s}updateMany(e){if(null!=e)for(const t of e)this.update(t)}};Es([r.LO],Os.prototype,"users",void 0),Es([r.aD],Os.prototype,"flushStore",null),Es([r.aD],Os.prototype,"update",null),Es([r.aD],Os.prototype,"updateMany",null),Os=Es([N.yz],Os);const Ps=Os;class js{constructor(){Object.defineProperty(this,"beatmapsetSearch",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"beatmapsetStore",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"channelStore",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"chatState",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientStore",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"notificationStore",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ownClientStore",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"uiState",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"userStore",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.beatmapsetStore=new It,this.beatmapsetSearch=new _t(this.beatmapsetStore),this.clientStore=new Kt,this.notificationStore=new ms,this.ownClientStore=new gs,this.userStore=new Ps,this.channelStore=new Ht,this.chatState=new Rt(this.channelStore),this.uiState=new ws}}var ks=s(8278),Ns=s(9755),Ss=function(e,t,s,r){var i,n=arguments.length,a=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(n<3?i(a):n>3?i(t,s,a):i(t,s))||a);return n>3&&a&&Object.defineProperty(t,s,a),a};class Cs{get currentUserOrFail(){if(null==this.currentUser)throw new Error("current user is null");return this.currentUser}constructor(){Object.defineProperty(this,"beatmapsetSearchController",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"browserTitleWithNotificationCount",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"captcha",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"chatWorker",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clickMenu",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"currentUser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"currentUserModel",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dataStore",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"enchant",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"forumPoll",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"forumPostEdit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"forumPostInput",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"forumPostReport",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"localtime",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"mobileToggle",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"notificationsWorker",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"osuAudio",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reactTurbolinks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"referenceLinkTooltip",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"scorePins",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"socketWorker",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stickyHeader",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeago",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"turbolinksReload",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"userLogin",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"userLoginObserver",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"userPreferences",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"userVerification",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"windowFocusObserver",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"windowSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"updateCurrentUser",{enumerable:!0,configurable:!0,writable:!0,value:()=>{const e=(0,ks.Um)("json-current-user",!0);null!=e&&(window.currentUser=e,this.setCurrentUser(window.currentUser))}}),Object.defineProperty(this,"onCurrentUserUpdate",{enumerable:!0,configurable:!0,writable:!0,value:(e,t)=>{this.setCurrentUser(t)}}),Object.defineProperty(this,"setCurrentUser",{enumerable:!0,configurable:!0,writable:!0,value:e=>{var t;const s=null==e.id?void 0:e;null!=s&&this.dataStore.userStore.update(s),this.socketWorker.setUserId(null!==(t=null==s?void 0:s.id)&&void 0!==t?t:null),this.currentUser=s,this.userPreferences.setUser(this.currentUser)}});const e="loading"===document.readyState;e&&document.addEventListener("DOMContentLoaded",this.updateCurrentUser),Ns.subscribe("user:update",this.onCurrentUserUpdate),this.captcha=new W,this.chatWorker=new A,this.clickMenu=new V,this.currentUserModel=new Ve(this),this.forumPoll=new Q,this.forumPostEdit=new X,this.forumPostInput=new se,this.forumPostReport=new ne,this.localtime=new oe,this.mobileToggle=new ue,this.browserTitleWithNotificationCount=new U(this),this.referenceLinkTooltip=new et,this.scorePins=new Ae,this.stickyHeader=new Ce,this.timeago=new De,this.turbolinksReload=new Me,this.userPreferences=new Je,this.userVerification=new Ye,this.windowSize=new at,this.enchant=new K(this.turbolinksReload),this.osuAudio=new Ee(this.userPreferences),this.reactTurbolinks=new Ne(this,this.turbolinksReload),this.userLogin=new Fe(this.captcha),this.dataStore=new js,this.userLoginObserver=new He,this.windowFocusObserver=new rt,this.beatmapsetSearchController=new k(this.dataStore.beatmapsetSearch),this.socketWorker=new gt,this.notificationsWorker=new pt(this.socketWorker),(0,r.rC)(this),e||this.updateCurrentUser()}}Ss([r.LO],Cs.prototype,"currentUser",void 0),Ss([r.Fl],Cs.prototype,"currentUserOrFail",null),Ss([r.aD],Cs.prototype,"setCurrentUser",void 0);const Ts=new Cs;window.osuCore=Ts;const xs=Ts},6185:(e,t,s)=>{s.d(t,{Z:()=>c});var r=s(4001),i=s(381),n=s(7294),a=s(3336),o=s(3924);class l extends n.PureComponent{render(){return 0===this.props.badges.length?null:n.createElement("div",{className:(0,a.sb)("profile-badges",this.props.modifiers)},this.props.badges.map((e=>{const t=(0,o.W)(e.awarded_at)?`<div>${e.description}</div>\n            <div class='profile-badges__date'>${i(e.awarded_at).format("LL")}</div>`:null,s=n.createElement(r.Z,{className:"profile-badges__badge","data-html-title":t,src:e.image_url,title:e.description});return(0,o.W)(e.url)?n.createElement("a",{key:e.image_url,href:e.url},s):n.createElement("span",{key:e.image_url},s)})))}}Object.defineProperty(l,"defaultProps",{enumerable:!0,configurable:!0,writable:!0,value:{badges:[]}});const c=l},3685:(e,t,s)=>{s.d(t,{Z:()=>g});var r=s(5523),i=s(6741),n=s(4929),a=s(6407),o=s(3664),l=s(6486),c=s(8949),u=s(9323),d=s(7181),p=s(7294),m=s(3336),h=s(1270),b=function(e,t,s,r){var i,n=arguments.length,a=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(n<3?i(a):n>3?i(t,s,a):i(t,s))||a);return n>3&&a&&Object.defineProperty(t,s,a),a};function f(){}let v=class extends p.Component{get showCover(){return d.Z.userPreferences.get("profile_cover_expanded")}constructor(e){super(e),Object.defineProperty(this,"onCoverExpandedToggle",{enumerable:!0,configurable:!0,writable:!0,value:()=>{d.Z.userPreferences.set("profile_cover_expanded",!this.showCover)}}),(0,c.rC)(this)}render(){var e,t;return p.createElement("div",{className:(0,m.sb)("profile-info",this.props.modifiers,{cover:this.showCover})},this.showCover&&p.createElement("div",{className:"profile-info__bg",style:{backgroundImage:(0,m.eF)(this.props.coverUrl)}},this.props.isUpdatingCover&&p.createElement("div",{className:"profile-info__spinner"},p.createElement(i.$,null)),this.props.editor),p.createElement("div",{className:"profile-info__details"},this.props.user.id===(null===(e=d.Z.currentUser)||void 0===e?void 0:e.id)?p.createElement("a",{className:"profile-info__avatar",href:`${(0,o.B)("account.edit")}#avatar`,title:(0,h.dW)("users.show.change_avatar")},this.renderAvatar()):p.createElement("div",{className:"profile-info__avatar"},this.renderAvatar()),p.createElement("div",{className:"profile-info__info"},p.createElement("h1",{className:"profile-info__name"},p.createElement("span",{className:"u-ellipsis-pre-overflow"},this.props.user.username),p.createElement("div",{className:"profile-info__previous-usernames"},this.renderPreviousUsernames()),p.createElement("div",{className:"profile-info__icons profile-info__icons--name-inline"},this.renderIcons())),this.renderTitle(),p.createElement("div",{className:"profile-info__flags"},null!=(null===(t=this.props.user.country)||void 0===t?void 0:t.code)&&p.createElement("a",{className:"profile-info__flag",href:(0,o.B)("rankings",{country:this.props.user.country.code,mode:this.props.currentMode,type:"performance"})},p.createElement("span",{className:"profile-info__flag-flag"},p.createElement(r.Z,{country:this.props.user.country})),p.createElement("span",{className:"profile-info__flag-text"},this.props.user.country.name)),p.createElement("div",{className:"profile-info__icons profile-info__icons--flag-inline"},this.renderIcons()))),p.createElement("div",{className:"profile-info__cover-toggle"},p.createElement("button",{className:"btn-circle btn-circle--page-toggle",onClick:this.onCoverExpandedToggle,title:(0,h.dW)("users.show.cover.to_"+(this.showCover?"0":"1")),type:"button"},p.createElement("span",{className:this.showCover?"fas fa-chevron-up":"fas fa-chevron-down"})))))}renderAvatar(){return p.createElement(n.Z,{modifiers:"full",user:this.props.user})}renderIcons(){var e;return p.createElement(p.Fragment,null,this.props.user.is_supporter&&p.createElement("a",{className:"profile-info__icon profile-info__icon--supporter",href:(0,o.B)("support-the-game"),title:(0,h.dW)("users.show.is_supporter")},(0,l.times)(null!==(e=this.props.user.support_level)&&void 0!==e?e:0,(e=>p.createElement("span",{key:e,className:"fas fa-heart"})))),p.createElement(a.Z,{groups:this.props.user.groups,modifiers:"profile-page",wrapper:"profile-info__icon"}))}renderPreviousUsernames(){if(null==this.props.user.previous_usernames||0===this.props.user.previous_usernames.length)return null;const e=this.props.user.previous_usernames.join(", ");return p.createElement("div",{className:"profile-previous-usernames"},p.createElement("a",{className:"profile-previous-usernames__icon profile-previous-usernames__icon--with-title",onClick:f,title:`${(0,h.dW)("users.show.previous_usernames")}: ${e}`},p.createElement("span",{className:"fas fa-address-card"})),p.createElement("div",{className:"profile-previous-usernames__icon profile-previous-usernames__icon--plain"},p.createElement("span",{className:"fas fa-address-card"})),p.createElement("div",{className:"profile-previous-usernames__content"},p.createElement("div",{className:"profile-previous-usernames__title"},(0,h.dW)("users.show.previous_usernames")),p.createElement("div",{className:"profile-previous-usernames__names"},e)))}renderTitle(){var e;if(null==this.props.user.title)return null;const t={children:this.props.user.title,className:"profile-info__title",style:{color:null!==(e=this.props.user.profile_colour)&&void 0!==e?e:void 0}};return null!=this.props.user.title_url?p.createElement("a",Object.assign({href:this.props.user.title_url},t)):p.createElement("span",Object.assign({},t))}};b([c.Fl],v.prototype,"showCover",null),v=b([u.Pi],v);const g=v},8838:(e,t,s)=>{s.d(t,{Z:()=>w});var r=s(7868),i=s(7454),n=s(1759),a=s(7294),o=s(3336),l=s(1270);function c({level:e}){let t="iron";e>=110?t="lustrous":e>=105?t="radiant":e>=100?t="rhodium":e>=80?t="platinum":e>=60?t="gold":e>=40?t="silver":e>=20&&(t="bronze");const s=(0,o.sb)("user-level",`tier-${t}`);return a.createElement("div",{className:s,title:(0,l.dW)("users.show.stats.level",{level:e})},a.createElement("div",{className:"user-level__icon"}),a.createElement("span",{className:"user-level__level"},e))}var u=s(3664),d=s(9323),p=s(7181),m=s(5069),h=s(4498),b=s(2325),f=s(5076);function v(e){return a.createElement("div",{className:"btn-circle btn-circle--page-toggle btn-circle--page-toggle-detail",title:(0,l.dW)("common.buttons.show_more_options")},a.createElement(h.Z,null,(t=>a.createElement("div",{className:"simple-menu"},a.createElement("a",{className:"simple-menu__item",href:(0,f.tB)(e.user),onClick:t},a.createElement("span",{className:"fas fa-gift"}),` ${(0,l.dW)("users.card.gift_supporter")}`),a.createElement(m.Z,{modifiers:"inline",onClick:t,userId:e.user.id,wrapperClass:"simple-menu__item"}),a.createElement(b.c,{className:"simple-menu__item",icon:!0,onFormOpen:t,reportableId:e.user.id.toString(),reportableType:"user",user:e.user})))))}var g=function(e,t,s,r){var i,n=arguments.length,a=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(n<3?i(a):n>3?i(t,s,a):i(t,s))||a);return n>3&&a&&Object.defineProperty(t,s,a),a};let y=class extends a.Component{get showMessageButton(){return null==p.Z.currentUser||p.Z.currentUser.id!==this.props.user.id&&!p.Z.currentUserModel.blocks.has(this.props.user.id)}render(){return a.createElement("div",{className:"profile-detail-bar"},a.createElement(n.Z,{alwaysVisible:!0,followers:this.props.user.follower_count,modifiers:"profile-page",userId:this.props.user.id}),this.props.user.is_bot?this.renderMessageButton():this.renderNonBotButtons())}renderMessageButton(){return this.showMessageButton?a.createElement("div",null,a.createElement("a",{className:"user-action-button user-action-button--profile-page",href:(0,u.B)("messages.users.show",{user:this.props.user.id}),title:(0,l.dW)("users.card.send_message")},a.createElement("i",{className:"fas fa-envelope"}))):null}renderNonBotButtons(){return a.createElement(a.Fragment,null,a.createElement(i.Z,{alwaysVisible:!0,followers:this.props.user.mapping_follower_count,modifiers:"profile-page",showFollowerCounter:!0,userId:this.props.user.id}),this.renderMessageButton(),(e=this.props.user,null!=p.Z.currentUser&&p.Z.currentUser.id!==e.id&&a.createElement(v,{user:this.props.user})),null!=this.props.user.statistics&&a.createElement("div",{className:"profile-detail-bar__level"},a.createElement("div",{className:"profile-detail-bar__level-bar"},a.createElement(r.Z,{current:this.props.user.statistics.level.progress,modifiers:"user-profile",textPrecision:0,title:(0,l.dW)("users.show.stats.level_progress"),total:100})),a.createElement(c,{level:this.props.user.statistics.level.current})));var e}};y=g([d.Pi],y);const w=y},8082:(e,t,s)=>{s.d(t,{Z:()=>n});var r=s(7294),i=s(1270);function n(e){return r.createElement("div",{className:"u-relative"},r.createElement("h2",{className:"title title--page-extra"},(0,i.dW)(`users.show.extra.${e.name}.title`)),e.withEdit&&r.createElement("span",{className:"sortable-handle sortable-handle--profile-page-extra hidden-xs js-profile-page-extra--sortable-handle"},r.createElement("i",{className:"fas fa-bars"})))}},2992:(e,t,s)=>{s.d(t,{Z:()=>n});var r=s(3664),i=s(9755);function n(e,t,s){return i.ajax((0,r.B)("users.extra-page",{mode:s,page:t,user:e.id}))}},8715:(e,t,s)=>{s.d(t,{Z:()=>l});var r=s(3664),i=s(1270);const n=["modding","playlists","realtime"],a={modding:e=>(0,r.B)("users.modding.index",{user:e}),playlists:e=>(0,r.B)("users.multiplayer.index",{typeGroup:"playlists",user:e}),realtime:e=>(0,r.B)("users.multiplayer.index",{typeGroup:"realtime",user:e}),show:e=>(0,r.B)("users.show",{user:e})};function o(e,t,s){return{active:t,title:(0,i.dW)(`layout.header.users.${e}`),url:a[e](s)}}function l(e,t){const s=[o("show","show"===t,e.id)];return e.is_bot||n.forEach((r=>{s.push(o(r,t===r,e.id))})),s}},8788:(e,t,s)=>{function r(e,t,s){var r;const i=null!==(r=e.data(t))&&void 0!==r?r:[];e.data(t,[...i,...s])}s.d(t,{Z:()=>r})},3955:(e,t,s)=>{s.d(t,{Z:()=>a});var r=s(1982),i=s(7631),n=s(8788);function a(){(0,n.Z)(this,"micromarkExtensions",[i.E]),(0,n.Z)(this,"fromMarkdownExtensions",[r.t])}},5305:(e,t,s)=>{s.d(t,{Z:()=>c});var r=s(8788);const i=["attention","autolink","blankLine","blockQuote","characterReference","codeFenced","codeIndented","codeText","definition","hardBreakEscape","headingAtx","htmlFlow","htmlText","labelEnd","labelStartImage","labelStartLink","list","setextUnderline","thematicBreak"];const n=["autolink","definition","hardBreakEscape","headingAtx","htmlFlow","htmlText","setextUnderline","thematicBreak"],a=[...n,"blockQuote","codeFenced","codeIndented","codeText","list"],o={chat:["definition","htmlFlow","htmlText","labelStartImage","setextUnderline"],chatPlain:(l=["autolink","labelEnd","labelStartLink"],i.filter((e=>!l.includes(e)))),default:n,editor:[...a,"codeFenced","codeIndented","codeText","labelEnd","labelStartImage","labelStartLink"],reviews:a};var l;function c(e){var t;(0,r.Z)(this,"micromarkExtensions",[{disable:{null:o[null!==(t=null==e?void 0:e.type)&&void 0!==t?t:"default"]}}])}},7790:(e,t,s)=>{s.d(t,{Z:()=>a});var r=s(7294),i=s(3775),n=s(1270);function a(e){let t,s;const a=null!=e.score.best_id,o="solo_score"===e.score.type;return a||o?null==e.score.pp?o&&!e.score.passed?(t=(0,n.dW)("scores.status.non_passing"),s="-"):(t=(0,n.dW)("scores.status.processing"),s=r.createElement("span",{className:"fas fa-exclamation-triangle"})):(t=(0,i.uf)(e.score.pp),s=r.createElement(r.Fragment,null,(0,i.uf)(Math.round(e.score.pp)),e.suffix)):(t=(0,n.dW)("scores.status.non_best"),s="-"),r.createElement("span",{title:t},s)}},8259:(e,t,s)=>{s.d(t,{Gw:()=>i,XI:()=>a,Xl:()=>n});var r=s(7294);function i(e){this.setState({activeKey:e})}const n=(0,r.createContext)({activeKeyDidChange:e=>{}}),a=(0,r.createContext)(null)},556:(e,t,s)=>{s.d(t,{Z:()=>n});var r=s(8949),i=function(e,t,s,r){var i,n=arguments.length,a=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(a=(n<3?i(a):n>3?i(t,s,a):i(t,s))||a);return n>3&&a&&Object.defineProperty(t,s,a),a};class n{constructor(){Object.defineProperty(this,"cursorString",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"rooms",{enumerable:!0,configurable:!0,writable:!0,value:[]}),(0,r.rC)(this)}updateWithJson(e){for(const t of e.rooms)this.rooms.push(t);this.cursorString=e.cursor_string}}i([r.LO],n.prototype,"cursorString",void 0),i([r.LO],n.prototype,"rooms",void 0),i([r.aD],n.prototype,"updateWithJson",null)},2094:(e,t,s)=>{s.d(t,{d:()=>r});const r=(0,s(7294).createContext)(void 0)},5225:(e,t,s)=>{s.d(t,{Z:()=>r});const r=(0,s(7294).createContext)({isFriendsPage:!1})},9703:(e,t,s)=>{s.d(t,{Gi:()=>b,Jn:()=>p,bE:()=>m,f$:()=>f,hd:()=>u,l5:()=>v,qQ:()=>h,vU:()=>d});var r=s(7181),i=s(3775),n=s(1270),a=s(3599),o=s(3924),l=s(9755);const c=["status","statusText","readyState","responseText"];function u(e=document.body){return(t,s,r)=>l(e).trigger("ajax:error",[t,s,r])}const d=(e,t,s)=>{"abort"!==t&&(r.Z.userLogin.showOnError(e,s)||r.Z.userVerification.showOnError(e,s)||(0,a.g)(v(e),"danger"))},p=(e,t)=>{d(t.jqXHR,t.textStatus,(()=>{var e;null===(e=t.submit)||void 0===e||e.call(t)}))};function m(e){return"object"==typeof e&&null!=e&&c.every((t=>t in e))}const h=e=>d(e,e.statusText),b=e=>(t,s)=>{d(t,s,e)},f=e=>b((0,i.A$)(e));function v(e){var t,s;if(null==e||null==e.responseJSON)return(0,n.dW)("errors.unknown");const r=e.responseJSON;if(null!=r.validation_error)return`${Object.values(r.validation_error).flat().join(", ")}.`;let i=null!==(s=null!==(t=r.error)&&void 0!==t?t:r.message)&&void 0!==s?s:"";if(!(0,o.W)(i)){const t=`errors.codes.http-${e.status}`;i=(0,n.dW)(t),i===t&&(i=(0,n.dW)("errors.unknown"))}return i}},7629:(e,t,s)=>{s.d(t,{sE:()=>d,xU:()=>u,yh:()=>p,ru:()=>m,Dd:()=>h,yb:()=>b,UI:()=>f});var r=s(7543);var i=s(8152),n=s(6486),a=s(7181),o=s(8278),l=s(9755);const c=r.scaleLinear().domain([.1,1.25,2,2.5,3.3,4.2,4.9,5.8,6.7,7.7,9]).clamp(!0).range(["#4290FB","#4FC0FF","#4FFFD5","#7CFF4F","#F6F05C","#FF8068","#FF4E6F","#C645B8","#6563DE","#18158E","#000000"]).interpolate(r.interpolateRgb.gamma(2.2));function u(e){var t,s,r,a;if(null!=e.items){let r=null,c=null;const u=function(e){var t,s;null==g&&(g=null!==(t=(0,o.Um)("json-recommended-star-difficulty-all"))&&void 0!==t?t:{},l(document).one("turbolinks:before-cache",(()=>{g=null})));return null!==(s=g[e])&&void 0!==s?s:1}(null!==(t=e.mode)&&void 0!==t?t:i.z[0]);for(const t of e.items){const e=Math.abs(t.difficulty_rating-u);(null==(a=t).accuracy||null==a.deleted_at&&!a.convert)&&(null==r||e<r)&&(r=e,c=t)}return null!==(s=null!=c?c:n.last(e.items))&&void 0!==s?s:null}if(null==e.group)return null;const c=null==e.mode?v():[e.mode];for(const i of c){const t=u({items:null!==(r=e.group.get(i))&&void 0!==r?r:[],mode:i});if(null!=t)return t}return null}function d(e){var t;const s=null==e.mode?v():[e.mode];for(const r of s){const s=null===(t=e.group.get(r))||void 0===t?void 0:t.find((t=>t.id===e.id));if(null!=s)return s}return null}function p(e){return e<.1?"#AAAAAA":e>=9?"#000000":c(e)}function m(e){const t=n.groupBy(null!=e?e:[],"mode"),s=new Map;return i.z.forEach((e=>{var r;s.set(e,function(e){if(0===e.length)return[];if("mania"===e[0].mode)return n.orderBy(e,["convert","cs","difficulty_rating"],["desc","asc","asc"]);return n.orderBy(e,["convert","difficulty_rating"],["desc","asc"])}(null!==(r=t[e])&&void 0!==r?r:[]))})),s}function h(e){switch(e){case 0:return"osu";case 1:return"taiko";case 2:return"fruits";case 3:return"mania";default:throw new Error("invalid ruleset id passed")}}function b(e){return"ranked"===e.status||"approved"===e.status}function f(e){return[...m(e).values()].flat()}function v(){var e;const t=null===(e=a.Z.currentUser)||void 0===e?void 0:e.playmode;if(null==t||!i.z.includes(t))return i.z;const s=n.without(i.z,t);return s.unshift(t),s}let g=null},41:(e,t,s)=>{s.d(t,{G2:()=>O,e7:()=>P,f9:()=>m,vx:()=>j,i$:()=>N,L9:()=>x,bf:()=>D,nc:()=>w,g8:()=>_,Uq:()=>R,ZB:()=>I,en:()=>L,cO:()=>A,of:()=>$,Qu:()=>B,Xe:()=>g,Qq:()=>y,Ks:()=>U});var r=s(7005);const i=Object.freeze({colour:"hsl(var(--hsl-l1))",has_listing:!1,has_playmodes:!1,id:-1,identifier:"guest",is_probationary:!1,name:"Difficulty Guest",short_name:"GUEST"});var n=s(78),a=s(8152),o=s(3664),l=s(6486),c=s(381),u=s(7181),d=s(9014),p=(s(5076),s(1327));const m="total",h=new Set(["deleted","hype","mapperNotes","mine","pending","praises","resolved","total"]),b=new Set(["events","generalAll","reviews"]),f=new Set(r.q),v="-",g=/\b(((\d{2,}):([0-5]\d)[:.](\d{3}))(\s\((?:\d+[,|])*\d+\))?)/,y=new RegExp(g,"g"),w=750,_=100,E=new Set(["suggestion","problem"]);function O({beatmapset:e,currentBeatmap:t,discussion:s,user:r}){var a;return null==r?null:r.id===e.user_id?n.Z:null!=t&&s.beatmap_id===t.id&&r.id===t.user_id?i:null===(a=r.groups)||void 0===a?void 0:a[0]}function P(){const e=u.Z.currentUser;return null!=e&&(e.is_admin||e.is_moderator)}function j(e){return null!=e&&e!==v?"timeline":"generalAll"}function k(e){return"review"===e.message_type?"reviews":null!=e.beatmap_id?null!=e.timestamp?"timeline":"general":"generalAll"}function N(e){const t=e%1e3,s=Math.floor(e/1e3)%60,r=Math.floor(e/1e3/60);return`${(0,l.padStart)(r.toString(),2,"0")}:${(0,l.padStart)(s.toString(),2,"0")}:${(0,l.padStart)(t.toString(),3,"0")}`}function S(e){return f.has(e)}function C(e){return null==e.deleted_at&&null!=e.timestamp&&E.has(e.message_type)&&(e.user_id!==u.Z.currentUserOrFail.id||c(e.updated_at).diff(c(),"hour")<=-24)}const T={nat:a.z};function x(e,t){return null!=e&&null!=e.groups&&e.groups.some((e=>{var s,r;if(null!=t){let i=null!==(s=e.playmodes)&&void 0!==s?s:[];return 0===i.length&&(i=null!==(r=T[e.identifier])&&void 0!==r?r:[]),("bng"===e.identifier||"nat"===e.identifier)&&i.includes(t)}return"bng"===e.identifier||"nat"===e.identifier}))}function D(e){var t,s;const{beatmap:r,discussion:i,filter:n,post:a,user:l}=e;let{beatmapId:c,beatmapsetId:u,discussionId:d,mode:p,postId:m}=e;if(null!=r&&(u=r.beatmapset_id,c=r.id),null!=i){d=i.id;const e=B(i);null!=e&&(u=e.beatmapsetId,c=null!==(t=e.beatmapId)&&void 0!==t?t:void 0,p=e.mode)}m=null!==(s=null==a?void 0:a.id)&&void 0!==s?s:m;const h={beatmap:null==c||b.has(p)?v:c,beatmapset:u,mode:null!=p?p:j(c)};null!=n&&"total"!==n&&"events"!==h.mode&&(h.filter=n);const f=new URL((0,o.B)("beatmapsets.discussion",h));return null!=d&&(f.hash=`/${d}`,null!=m&&(f.hash+=`/${m}`)),null!=l&&f.searchParams.set("user",l.toString()),f.toString()}function R(e,t){var s,r,i,n,a,o;const c={};for(const l of e)if(C(l)){const e=M(Math.abs(l.timestamp-t));null!=e&&(null!==(s=c[e])&&void 0!==s||(c[e]=[]),null===(r=c[e])||void 0===r||r.push(l))}const u=null!==(o=null!==(a=null!==(n=null!==(i=c.d0)&&void 0!==i?i:c.d100)&&void 0!==n?n:c.d1000)&&void 0!==a?a:c.other)&&void 0!==o?o:[];return(0,l.sortBy)(u,"timestamp")}function M(e){return e>5e3?null:0===e?"d0":e<100?"d100":e<1e3?"d1000":"other"}function I(e){if(null==e)return null;const t=e.match(g);if(null==t)return null;const s=t.slice(1).map((e=>{var t;return null!==(t=(0,p.w)(e))&&void 0!==t?t:0}));return 1e3*(60*s[2]+s[3])+s[4]}function L(e,t){const s=new URL(null!=e?e:(0,d.JJ)().href),[,r,i,n,a,o,c]=s.pathname.split(/\/+/),u=(0,p.w)(i);if("beatmapsets"!==r||"discussion"!==n||null==u)return null;const m=(0,p.w)(a),b={beatmapId:m,beatmapsetId:u,filter:(f=c,h.has(f)?c:"total"),mode:S(o)?o:j(m),user:(0,p.w)(s.searchParams.get("user"))};var f;if("/"===s.hash[1]){const[e,r]=s.hash.split("/").slice(1,3).map(p.w);if(null!=e&&(b.discussionId=e,null!=r&&(b.postId=r),null!=t&&null!=e)){const s=t.find((t=>t.id===e));if(null!=s){if((0,l.assign)(b,B(s)),null!=s.posts){const e=s.posts.find((e=>e.id===r));null==e&&(b.postId=void 0)}}else b.discussionId=void 0,b.postId=void 0}}return b}function A(e=""){const t=L(),s={href:e,rel:"nofollow noreferrer",target:"_blank"};let r;try{r=new URL(e)}catch(i){}if(null!=r&&r.host===(0,d.JJ)().host){const e=L(r.href);if(null!=(null==e?void 0:e.discussionId)&&null!=e.beatmapsetId){const r=[e.discussionId,e.postId].filter(Number.isFinite).join("/");(null==t?void 0:t.beatmapsetId)===e.beatmapsetId?(s.children=`#${r}`,s.className="js-beatmap-discussion--jump",s.target=void 0):s.children=`${e.beatmapsetId}#${r}`}}return s}function $(e){return"posts"in e?e.posts[0]:e.starting_post}function B(e){return{beatmapId:e.beatmap_id,beatmapsetId:e.beatmapset_id,discussionId:e.id,mode:k(e)}}function U(e,t=!1){return null!=e&&0!==e.length&&(!t||e.length<=w)}},6817:(e,t,s)=>{s.d(t,{F:()=>h,YQ:()=>d,aU:()=>u,c0:()=>p,uX:()=>m,wm:()=>c});var r=s(3664),i=s(6486),n=s(8949),a=s(7181),o=s(9703),l=s(9755);function c(e){return null==e.availability||e.availability.download_disabled||null!=e.availability.more_information}function u(e){return a.Z.userPreferences.get("beatmapset_title_show_original")?e.artist_unicode:e.artist}function d(e){return a.Z.userPreferences.get("beatmapset_title_show_original")?e.title_unicode:e.title}function p(e,t){return e.legacy_mode?e[t]:(0,i.sum)(Object.values(e[t]))}function m(e){return!e.nsfw||a.Z.userPreferences.get("beatmapset_show_nsfw")}const h=(0,n.aD)((e=>{const t=()=>{h(e)};if(a.Z.userLogin.showIfGuest(t))return;const s=!e.has_favourited;e.has_favourited=s,e.favourite_count+=s?1:-1;const i=l.ajax((0,r.B)("beatmapsets.favourites.store",{beatmapset:e.id}),{data:{action:s?"favourite":"unfavourite"},method:"POST"});return i.fail(((r,i)=>(0,n.z)((()=>{e.has_favourited=!s,e.favourite_count+=s?-1:1,(0,o.vU)(r,i,t)})))).done((t=>(0,n.z)((()=>{e.favourite_count=t.favourite_count})))),i}))},8612:(e,t,s)=>{s.d(t,{Qc:()=>a,R_:()=>o,gp:()=>l});var r=s(8152),i=s(1327),n=s(9014);function a(e){const[t,s]=e.slice(1).split("/");return{beatmapId:(0,i.w)(s),playmode:(0,r.U)(t)}}function o({beatmap:e,ruleset:t}){let s="";return null!=t||(t=null==e?void 0:e.mode),null!=t&&(s+=`#${t}`,null!=e&&(s+=`/${e.id}`)),s}function l(e){const t=(0,n.JJ)().href,s=`${t.replace(/#.*/,"")}${e}`;s!==t&&history.replaceState(history.state,"",s)}},3857:(e,t,s)=>{s.d(t,{C:()=>n,M6:()=>i,_j:()=>o,z4:()=>a});var r=s(9162);function i(){a(!1)}function n(){a(!0)}function a(e,t){var s;const i=null===(s=window.newBody)||void 0===s?void 0:s.querySelector(".js-blackout");i instanceof HTMLElement&&(i.style.opacity=e&&null!=t?String(t):"",(0,r.Eo)(i,e))}function o(){const e=document.querySelector(".js-blackout");return e instanceof HTMLElement&&""!==e.style.opacity}},3336:(e,t,s)=>{s.d(t,{$$:()=>o,eF:()=>c,sb:()=>a,sw:()=>l});var r=s(6486),i=s(3924);const n=(e,t)=>{e.forEach((e=>{Array.isArray(e)?e.forEach((e=>{null!=e&&t(e)})):"string"==typeof e?t(e):(0,r.forEach)(e,((e,s)=>{e&&t(s)}))}))};function a(e,...t){let s=e;return n(t,(t=>s+=` ${e}--${t}`)),s}function o(e){var t;return{"--group-colour":null!==(t=null==e?void 0:e.colour)&&void 0!==t?t:"initial"}}function l(...e){const t=[];return n(e,(e=>t.push(e))),t}function c(e){return(0,i.W)(e)?`url("${String(e).replace(/"/g,"%22")}")`:void 0}},9162:(e,t,s)=>{function r(e){null==e||e.setAttribute("data-visibility","visible")}function i(e){null==e||e.setAttribute("data-visibility","hidden")}function n(e,t){if(null==e)return;const s=(null!=t?t:!function(e){return"hidden"!==(null==e?void 0:e.getAttribute("data-visibility"))}(e))?r:i;s(e)}s.d(t,{Eo:()=>n,Ji:()=>r,U6:()=>i})},3775:(e,t,s)=>{s.d(t,{A$:()=>u,CP:()=>E,Eu:()=>g,LU:()=>h,Mu:()=>l,ZL:()=>c,bG:()=>O,cK:()=>_,h3:()=>y,ib:()=>d,oN:()=>P,ri:()=>w,td:()=>m,uf:()=>f});var r=s(6486),i=s(3336),n=s(9755);const a=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],o=1e3;function l(){return 0===c()}function c(){const e=document.documentElement;return e.scrollHeight-e.scrollTop-e.clientHeight}function u(e){if(e instanceof HTMLElement)return e instanceof HTMLFormElement?()=>n(e).submit():()=>e.click()}function d(e){if(null!=e)return{"--bg":(0,i.eF)(e),"--bg-2x":(0,i.eF)(O(e))}}function p(e){return(0,r.padStart)(e.toString(),2,"0")}function m(e,t=2){if(e<o)return`${e} B`;const s=Math.floor(Math.log(e)/Math.log(o));return`${f(e/Math.pow(o,s),t)} ${a[s]}`}function h(e){const t=e%60,s=Math.floor(e/60)%60,r=Math.floor(e/3600);return r>0?`${r}:${p(s)}:${p(t)}`:`${s}:${p(t)}`}const b=new Intl.NumberFormat(window.currentLocale);function f(e,t,s,r){return null==t&&null==s&&null==r?b.format(e):(null!=s||(s={}),null!=t&&(s.minimumFractionDigits=t,s.maximumFractionDigits=t),e.toLocaleString(null!=r?r:window.currentLocale,s))}const v=new Intl.NumberFormat(window.currentLocale,{maximumFractionDigits:1,minimumFractionDigits:0,notation:"compact"});function g(e){return null==e?void 0:v.format(e)}function y(e){return e instanceof HTMLElement?e:null}function w(e){const t=y(e);if(null==t)return!1;if(_(t)||["A","BUTTON"].includes(t.tagName))return!0;const s=y(t.parentNode);return null!=s&&w(s)}function _(e){return["INPUT","OPTION","SELECT","TEXTAREA"].includes(e.tagName)||e.isContentEditable}const E="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7";function O(e){if(null!=e)return e.replace(/(\.[^.]+)$/,"@2x$1")}function P(e){return e.replace(/<[^>]*>/g,"")}},7937:(e,t,s)=>{s.d(t,{k:()=>n,z:()=>r});var r,i=s(7181);function n(e){return t=>{let s=null;"Escape"===t.key?s=r.Cancel:"Enter"===t.key&&!t.shiftKey&&i.Z.windowSize.isDesktop&&(t.preventDefault(),s=r.Submit),e(s,t)}}!function(e){e.Cancel="cancel",e.Submit="submit"}(r||(r={}))},8278:(e,t,s)=>{function r(e,t){return 0===e.length?t:`${e}[${t}]`}function i(e,t){let s="";for(const i of t)s=r(s,i);return r(s,e)}function n(e,t=[]){const s=new Map;for(const r of Object.keys(e)){const a=e[r];if(null!=a)if(Array.isArray(a))s.set(i(r,t),a);else for(const[e,i]of n(a,t.concat(r)))s.set(e,i)}return s}function a(e){return null!=e?JSON.parse(JSON.stringify(e)):e}function o(e){const t=l(e);if(null==t)throw new Error(`script element ${e} is missing or contains nullish value.`);return t}function l(e,t=!1){var s;const r=(null!==(s=window.newBody)&&void 0!==s?s:document.body).querySelector(`#${e}`);if(!(r instanceof HTMLScriptElement))return;const i=JSON.parse(r.text);return t&&r.remove(),i}function c(e,t){const s=JSON.stringify(t),r=document.getElementById(e);let i;if(null==r)i=document.createElement("script"),i.id=e,i.type="application/json",document.body.appendChild(i);else{if(!(r instanceof HTMLScriptElement))throw new Error(`existing ${e} is not a script element.`);i=r}i.text=s}s.d(t,{Cw:()=>c,Lm:()=>a,Mo:()=>o,Um:()=>l,lv:()=>n})},1270:(e,t,s)=>{s.d(t,{Pc:()=>a,Xl:()=>u,dW:()=>o,jn:()=>c,m2:()=>l});s(9705);var r=s(7294),i=s(3775),n=s(3924);function a(e,t="common.array_and"){const s=[];if(e.length>0&&(s.push(e[0]),e.length>1)){const i=e.length-1,n=o(1===i?`${t}.two_words_connector`:`${t}.last_word_connector`),a=o(`${t}.words_connector`);for(let t=1;t<i;t++)s.push(r.createElement(r.Fragment,{key:e[t].key},a,e[t]));s.push(r.createElement(r.Fragment,{key:e[i].key},n,e[i]))}return r.createElement(r.Fragment,null,s)}function o(e,t={},s){return u(e,s)||(s=fallbackLocale),window.Lang.get(e,t,s)}function l(e,t="common.array_and"){switch(e.length){case 0:return"";case 1:return`${e[0]}`;case 2:return e.join(o(`${t}.two_words_connector`));default:return`${e.slice(0,-1).join(o(`${t}.words_connector`))}${o(`${t}.last_word_connector`)}${e.slice(-1)[0]}`}}function c(e,t,s={},r){null!=r||(r=currentLocale);const n=r===fallbackLocale;if(!n&&!u(e,r))return c(e,t,s,fallbackLocale);s.count_delimited=(0,i.uf)(t,void 0,void 0,r);const a=window.Lang.choice(e,t,s,r);return n||null!=a?a:(delete s.count,c(e,t,s,fallbackLocale))}function u(e,t){null!=t||(t=window.currentLocale),window.Lang.setFallback(t);const s=window.Lang.get(e,void 0,t),r=(0,n.W)(s)&&s!==e;return window.Lang.setFallback(window.fallbackLocale),r}},9711:(e,t,s)=>{s.d(t,{Lt:()=>o,Uq:()=>a,ew:()=>n});var r=s(6486);function i(){const e=document.querySelector(".js-loading-overlay");if(e instanceof HTMLElement)return e}function n(){const e=i();null!=e&&e.classList.add("loading-overlay--visible")}const a=(0,r.debounce)(n,5e3,{maxWait:5e3});function o(){a.cancel();const e=i();null!=e&&e.classList.remove("loading-overlay--visible")}},1327:(e,t,s)=>{function r(e){if(Number.isInteger(e))return e;if("string"==typeof e){const t=parseInt(e,10);if(Number.isInteger(t))return t}}s.d(t,{w:()=>r})},6122:(e,t,s)=>{s.d(t,{u:()=>n});var r=s(9003),i=s(9755);function n(){return(0,r.g)()||i("#overlay").is(":visible")||document.body.classList.contains("modal-open")}},7563:(e,t,s)=>{s.d(t,{Af:()=>o,mG:()=>c,t7:()=>a});var r=s(3664),i=s(8949),n=s(9755);const a=(0,i.aD)(((e,t,s)=>{e.pagination.loading=!0;let a=s.limit;"number"==typeof a&&Number.isFinite(a)||(a=50);const o=a+1,c=Object.assign(Object.assign({},s),{limit:o,offset:e.items.length});return n.ajax((0,r.B)(t,c)).done((t=>{l(e,t,o)})).always((0,i.aD)((()=>{e.pagination.loading=!1})))})),o=(e,t)=>a(e,"users.kudosu",{user:t}),l=(0,i.aD)(((e,t,s)=>{e.pagination.hasMore=c(s-1,t),e.items.push(...t)})),c=(0,i.aD)(((e,t)=>{const s=t.length>e;return s&&t.pop(),s}))},3599:(e,t,s)=>{s.d(t,{g:()=>a});var r=s(3775),i=s(9755);const n=["danger","warning"];function a(e,t="info"){var s;const a=i("#popup-container"),o=i(".popup-clone").clone(),l=()=>o.trigger("click");o.addClass(`alert-${t} popup-active`).removeClass("popup-clone"),o.find(".popup-text").html(e),n.includes(t)?i("#overlay").off("click.close-alert").one("click.close-alert",l).fadeIn():setTimeout(l,5e3),null===(s=(0,r.h3)(document.activeElement))||void 0===s||s.blur(),o.appendTo(a).fadeIn()}},3684:(e,t,s)=>{s.d(t,{Fi:()=>p,JP:()=>f,M8:()=>b,O0:()=>u,aG:()=>o,c1:()=>l,sQ:()=>c,wG:()=>v,yT:()=>h});var r=s(3664),i=s(7181),n=s(7629),a=s(1270);function o(e){return(null!=e.best_id||"solo_score"===e.type)&&null!=i.Z.currentUser&&e.user_id!==i.Z.currentUser.id}function l(e){return o(e)||c(e)||u(e)||i.Z.scorePins.canBePinned(e)}function c(e){return e.has_replay}function u(e){return null!=e.best_id||"solo_score"===e.type}const d=["good","great","large_tick_hit","legacy_combo_increase","meh","ok","perfect"];function p(e){if(null!=e.legacy_perfect)return e.legacy_perfect;if("mania"===(0,n.Dd)(e.ruleset_id))return["miss","large_tick_miss"].every((t=>null==e.statistics[t]||0===e.statistics[t]));const t=d.reduce(((t,s)=>{var r;return t+(null!==(r=e.maximum_statistics[s])&&void 0!==r?r:0)}),0);return 0!==t&&e.max_combo===t}const m=(0,a.dW)("beatmapsets.show.scoreboard.headers.miss"),h={fruits:[{attribute:"great",label:"fruits"},{attribute:"large_tick_hit",label:"ticks"},{attribute:"small_tick_miss",label:"drp miss"},{attribute:"miss",label:m}],mania:[{attribute:"perfect",label:"max"},{attribute:"great",label:"300"},{attribute:"good",label:"200"},{attribute:"ok",label:"100"},{attribute:"meh",label:"50"},{attribute:"miss",label:m}],osu:[{attribute:"great",label:"300"},{attribute:"ok",label:"100"},{attribute:"meh",label:"50"},{attribute:"miss",label:m}],taiko:[{attribute:"great",label:"great"},{attribute:"ok",label:"good"},{attribute:"miss",label:m}]};function b(e){if("solo_score"===e.type)return(0,r.B)("scores.download",{score:e.id});if(null!=e.best_id)return(0,r.B)("scores.download-legacy",{rulesetOrScore:(0,n.Dd)(e.ruleset_id),score:e.best_id});throw new Error("score json doesn't have download url")}function f(e){if("solo_score"===e.type)return(0,r.B)("scores.show",{rulesetOrScore:e.id});if(null!=e.best_id)return(0,r.B)("scores.show",{rulesetOrScore:(0,n.Dd)(e.ruleset_id),score:e.best_id});throw new Error("score json doesn't have url")}function v(e){var t;return null!==(t=e.legacy_total_score)&&void 0!==t?t:e.total_score}},9139:(e,t,s)=>{s.d(t,{V:()=>a,d:()=>n});var r=s(2918);let i=0;function n(){return++i}function a(){return r.uuid()}},3924:(e,t,s)=>{function r(e){return i(e)?e:null}function i(e){return null!=e&&""!==e}s.d(t,{G:()=>r,W:()=>i})},9696:(e,t,s)=>{function r(e){}s.d(t,{Q:()=>r})},9014:(e,t,s)=>{s.d(t,{JJ:()=>n,Kn:()=>a,c4:()=>o,sl:()=>l});var r=s(9755),i=s(2918);function n(){var e;return null!==(e=window.newUrl)&&void 0!==e?e:document.location}function a(){const e=n();return e instanceof URL?e.searchParams:new URLSearchParams(e.search)}function o(e,t=!1,{action:s}={action:"advance"}){t&&function(){const{pageXOffset:e,pageYOffset:t}=window;r(document).one("turbolinks:load",(()=>window.scrollTo(e,t)))}(),i.visit(e,{action:s})}function l(e=!0){r(document).off(".ujsHideLoadingOverlay"),i.clearCache(),o(n().href,e,{action:"replace"})}},5076:(e,t,s)=>{s.d(t,{Au:()=>u,Dz:()=>g,FP:()=>b,TR:()=>m,_r:()=>E,bj:()=>w,dP:()=>_,ni:()=>f,pc:()=>y,rb:()=>p,ri:()=>v,tB:()=>h,vU:()=>d});var r=s(3664),i=s(6486),n=s(8612),a=s(9014),o=function(e,t){var s={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(s[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(s[r[i]]=e[r[i]])}return s};const l=["admin","api/v2","beatmaps","beatmapsets","client-verifications","comments","community","help","home","groups","legal","multiplayer","news","notifications","oauth","rankings","scores","seasons","session","store","users","wiki"].join("|"),c=RegExp(`^/(?:${l})(?:$|/|#)`);function u(e){return`osu://b/${e}`}function d(e){return`osu://s/${e}`}function p(e,t){return(0,r.B)("beatmapsets.show",{beatmapset:e.beatmapset_id})+(0,n.R_)({beatmap:e,ruleset:t})}function m(e){return(0,r.B)("changelog.build",{build:e.version,stream:e.update_stream.name})}function h(e){return(0,r.B)("store.products.show",{product:"supporter-tag",target:e.username})}function b(e){return e.isHTML()||(0,i.startsWith)(e.getPath(),"/home/changelog/")}function f(e){return c.test(e.getPath())}function v(e){return`osu://edit/${e}`}function g(e,t,s){(null==s?void 0:s.unescape)&&(e=(0,i.unescape)(e),t=(0,i.unescape)(t));const r=document.createElement("a");if(r.textContent=t,r.setAttribute("href",e),null!=s&&(s.isRemote&&r.setAttribute("data-remote","1"),null!=s.classNames&&(r.className=s.classNames.join(" ")),null!=s.props)){const e=s.props,{className:t}=e,i=o(e,["className"]);null!=t&&(r.className=t);for(const[s,n]of Object.entries(i))null!=n&&r.setAttribute(s,n)}return r.outerHTML}function y(e){if("javascript:void(0)"!==e)return e}function w(e,t,s){const r=(0,a.JJ)(),i=new URL(null!=e?e:r.href,r.origin);for(const[n,a]of Object.entries(t))null!=a?i.searchParams.set(n,a):i.searchParams.delete(n);return null!=s&&(i.hash=s),i.href}function _(e,t){return(0,r.B)("wiki.show",{locale:null!=t?t:currentLocale,path:"WIKI_PATH"}).replace("WIKI_PATH",encodeURI(e))}function E(e){return(0,r.B)("wiki.show",{path:"WIKI_PATH"}).replace("/WIKI_PATH",encodeURI(e))}}}]);
//# sourceMappingURL=commons.b00646e5.js.map